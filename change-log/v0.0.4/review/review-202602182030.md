# PR Review Summary â€” 2026-02-18 20:30

**å¯¾è±¡:** myT-x/ é…ä¸‹ã®å…¨å¤‰æ›´ãƒ•ã‚¡ã‚¤ãƒ« (63ãƒ•ã‚¡ã‚¤ãƒ«, +6716/-2455è¡Œ)
**ãƒ¬ãƒ“ãƒ¥ãƒ¼æ‰‹æ³•:** 5ã‚«ãƒ†ã‚´ãƒªã«åˆ†å‰²ã—ã€ä¸¦åˆ—ã§å°‚é–€ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’å®Ÿè¡Œ

## ãƒ¬ãƒ“ãƒ¥ãƒ¼å¯¾è±¡ã‚«ãƒ†ã‚´ãƒª

| ã‚«ãƒ†ã‚´ãƒª | ãƒ•ã‚¡ã‚¤ãƒ«æ•° | ä¸»ãªå¯¾è±¡ |
|---------|-----------|---------|
| Appå±¤ | 14 | app.go, app_events.go, app_guards.go, app_lifecycle.go, app_pane_api.go, app_session_api.go, app_snapshot_delta.go, app_snapshot_metrics.go, app_status.go + ãƒ†ã‚¹ãƒˆ |
| tmux-shim | 7 | cmd/tmux-shim/ (command_transform, model_transform, parse, spec) |
| internal/tmux | 20 | command_router*, format, key_table, session_manager_* |
| Frontend | 16 | api.ts, components/, hooks/, stores/, styles/, types/ |
| Config/Install/IPC | 5 | internal/config, internal/install, internal/ipc |

---

## Critical Issuesï¼ˆ1ä»¶ â€” ãƒãƒ¼ã‚¸å‰ã«å¿…ãšä¿®æ­£ï¼‰

### C-1. [session_manager_windows.go] Terminal ãƒªã‚½ãƒ¼ã‚¹ãƒªãƒ¼ã‚¯ï¼ˆkill-windowæ™‚ï¼‰

**ãƒ•ã‚¡ã‚¤ãƒ«:** `myT-x/internal/tmux/session_manager_windows.go` L134-L141
**ã‚«ãƒ†ã‚´ãƒª:** ãƒªã‚½ãƒ¼ã‚¹ãƒªãƒ¼ã‚¯ / ä¸¦è¡Œå‡¦ç†

`removeWindowAtIndexLocked` ãŒ `pane.Terminal` ã‚’ nil ã«ã—ãŸ**å¾Œã«**ã€åŒã˜ `*TmuxPane` ãƒã‚¤ãƒ³ã‚¿ã‚’ `removedPanes` ã¨ã—ã¦è¿”ã—ã¦ã„ã‚‹ã€‚å‘¼ã³å‡ºã—å…ƒã§ `pane.Terminal` ã‚’é–‰ã˜ã‚ˆã†ã¨ã—ã¦ã‚‚ã€æ—¢ã« nil ã®ãŸã‚ close ãŒå®Ÿè¡Œã•ã‚Œãªã„ï¼ˆãƒ‡ãƒƒãƒ‰ã‚³ãƒ¼ãƒ‰åŒ–ï¼‰ã€‚

**å½±éŸ¿ç®‡æ‰€ï¼ˆåŒä¸€ãƒ‘ã‚¿ãƒ¼ãƒ³ï¼‰:**
- `command_router_handlers_window.go` L155-L163 (`handleKillWindow`): ã‚¿ãƒ¼ãƒŸãƒŠãƒ« close ãƒ«ãƒ¼ãƒ—ãŒãƒ‡ãƒƒãƒ‰ã‚³ãƒ¼ãƒ‰ â†’ **`kill-window` ã®ãŸã³ã«ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ãƒ—ãƒ­ã‚»ã‚¹ãŒãƒªãƒ¼ã‚¯**
- `command_router_handlers_window.go` L97-L106 (`handleNewWindow` rollback): attach-terminal å¤±æ•—æ™‚ã®ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯ã§åŒæ§˜ã®ãƒªãƒ¼ã‚¯
- `session_manager_windows.go` L60 (`RemoveWindow`): ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹æŒ‡å®šã®å‰Šé™¤ã§ã‚‚åŒä¸€ã‚³ãƒ¼ãƒ‰ãƒ‘ã‚¹

**ä¿®æ­£æ–¹é‡:** `killPaneLocked` ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ï¼ˆnilåŒ–å‰ã« `terminalCloser` å‚ç…§ã‚’ä¿å­˜ã—ã¦è¿”ã™ï¼‰ã‚’é©ç”¨ã™ã‚‹ã€‚

---

## Important Issuesï¼ˆ12ä»¶ â€” ä¿®æ­£æ¨å¥¨ï¼‰

### I-1. [app_session_api.go] å¤ã„ã‚³ãƒ¡ãƒ³ãƒˆãŒã‚³ãƒ¼ãƒ‰ã¨ä¸ä¸€è‡´

**ãƒ•ã‚¡ã‚¤ãƒ«:** `myT-x/app_session_api.go` L119-L124
**ã‚«ãƒ†ã‚´ãƒª:** ã‚³ãƒ¡ãƒ³ãƒˆç²¾åº¦

`RenameSession` ã®ã‚³ãƒ¡ãƒ³ãƒˆã«ã€ŒrequestSnapshot(true)ã¯å‘¼ã°ãªã„ã€ã¨ã‚ã‚‹ãŒã€`snapshotEventPolicies` ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°å¾Œã¯ `"tmux:session-renamed"` ã« `{trigger: true, bypassDebounce: true}` ãŒè¨­å®šã•ã‚Œã¦ãŠã‚Šã€**å®Ÿéš›ã«ã¯ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆãŒãƒˆãƒªã‚¬ãƒ¼ã•ã‚Œã‚‹**ã€‚ãƒ†ã‚¹ãƒˆã‚‚ `snapshot` ã‚¤ãƒ™ãƒ³ãƒˆç™ºè¡Œã‚’ assertion ã—ã¦ã„ã‚‹ã€‚

### I-2. [app_events.go] ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•° `snapshotEventPolicies` ã®å¯å¤‰æ€§

**ãƒ•ã‚¡ã‚¤ãƒ«:** `myT-x/app_events.go` L93-L107
**ã‚«ãƒ†ã‚´ãƒª:** å‹è¨­è¨ˆ / é˜²å¾¡çš„ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°

`var` ã¨ã—ã¦å®£è¨€ã•ã‚ŒãŸãƒãƒƒãƒ—ã€‚ç¾åœ¨ãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã§ã®å¤‰æ›´ã¯ãªã„ãŒã€ãƒ†ã‚¹ãƒˆã§ã®æ“ä½œã‚„å°†æ¥çš„ãªæ„å›³ã—ãªã„å¤‰æ›´ã®ãƒªã‚¹ã‚¯ãŒã‚ã‚‹ã€‚`// Treat as immutable after init` ã‚³ãƒ¡ãƒ³ãƒˆã®è¿½åŠ ã‚’æ¨å¥¨ã€‚

### I-3. [session_manager_windows.go] å‘½åè¦ç´„é•åï¼ˆRLock + `*Locked` é–¢æ•°å‘¼ã³å‡ºã—ï¼‰

**ãƒ•ã‚¡ã‚¤ãƒ«:** `myT-x/internal/tmux/session_manager_windows.go` L236-L247
**ã‚«ãƒ†ã‚´ãƒª:** å‘½åè¦ç´„ / ä¸¦è¡Œå‡¦ç†

`WindowIndexInSession` ãŒ `m.mu.RLock()` ã§ `getSessionByNameLocked` ã‚’å‘¼ã‚“ã§ã„ã‚‹ã€‚I-11 å‘½åè¦ç´„ï¼ˆ`*Locked` = Write Lock, `*RLocked` = Read Lockï¼‰ã«é•åã€‚å®Ÿéš›ã®ãƒ¬ãƒ¼ã‚¹ã¯ãªã„ãŒæ··ä¹±ã‚’æ‹›ãã€‚

**åŒä¸€ãƒ‘ã‚¿ãƒ¼ãƒ³ã®ç®‡æ‰€:**
- `session_manager_env.go` L65-L70 (`GetSessionEnv`)
- `session_manager_targets.go` L200-L205 (`ResolveSessionTarget`)

### I-4. [command_router.go] `paneEnvView` ã® Copy-on-Write å¥‘ç´„ãŒè„†å¼±

**ãƒ•ã‚¡ã‚¤ãƒ«:** `myT-x/internal/tmux/command_router.go` L103-L108
**ã‚«ãƒ†ã‚´ãƒª:** ä¸¦è¡Œå‡¦ç† / APIè¨­è¨ˆ

`paneEnvView` ãŒ `RLock` ä¸‹ã§ `r.opts.PaneEnv` ã¸ã®ç”Ÿå‚ç…§ã‚’è¿”ã™ã€‚å®‰å…¨æ€§ã¯ `UpdatePaneEnv` ãŒ CoWï¼ˆæ–°ãƒãƒƒãƒ—ä½œæˆå¾Œã«swapï¼‰ã™ã‚‹éæ–‡æ›¸åŒ–æ…£ç¿’ã«å®Œå…¨ä¾å­˜ã€‚å°†æ¥ in-place mutation ãŒè¿½åŠ ã•ã‚Œã‚‹ã¨ raceã€‚

### I-5. [session_manager_pane_io.go] `ListPanesByWindowTarget` ãŒ `@stableID` ã‚’æœªã‚µãƒãƒ¼ãƒˆ

**ãƒ•ã‚¡ã‚¤ãƒ«:** `myT-x/internal/tmux/session_manager_pane_io.go` L52-L53
**ã‚«ãƒ†ã‚´ãƒª:** APIä¸€è²«æ€§

`windowIdx` ãƒ‘ãƒ¼ã‚¹ãŒ `strconv.Atoi` ã®ã¿ã§ã€`resolveWindowPaneTarget` ãŒå¯¾å¿œã—ã¦ã„ã‚‹ `@stableID` æ–¹å¼ãŒä½¿ãˆãªã„ã€‚`list-panes -t session:@5` ãŒå¤±æ•—ã™ã‚‹ã€‚

### I-6. [command_router_handlers_window.go] `handleKillWindow` ã® TOCTOU

**ãƒ•ã‚¡ã‚¤ãƒ«:** `myT-x/internal/tmux/command_router_handlers_window.go` L128-L142
**ã‚«ãƒ†ã‚´ãƒª:** ä¸¦è¡Œå‡¦ç† / ãƒ­ã‚¸ãƒƒã‚¯

`fallbackWindowIDAfterRemoval` ãŒã‚¯ãƒ­ãƒ¼ãƒ³ä¸Šã§è¨ˆç®—ã•ã‚Œã€`RemoveWindowByID` ãŒ live ãƒ‡ãƒ¼ã‚¿ä¸Šã§ç‹¬ç«‹ã« `fallbackWindowIDNearIndex` ã‚’è¨ˆç®—ã™ã‚‹ã€‚2ã¤ã®æ“ä½œé–“ã§ Window ã®è¿½åŠ /å‰Šé™¤ãŒèµ·ãã‚‹ã¨ä¸ä¸€è‡´ã€‚å½±éŸ¿ã¯ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆé€šçŸ¥æ™‚ã®ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦é¸æŠï¼ˆè¦‹ãŸç›®ã®ã¿ï¼‰ã€‚

### I-7. [shim_cleanup_windows.go] `CleanupLegacyShimInstalls` ãŒå¸¸ã« nil ã‚’è¿”ã™

**ãƒ•ã‚¡ã‚¤ãƒ«:** `myT-x/internal/install/shim_cleanup_windows.go` L28
**ã‚«ãƒ†ã‚´ãƒª:** ã‚¨ãƒ©ãƒ¼å‡¦ç†

`error` è¿”ã‚Šå€¤ãŒå¸¸ã« `nil`ã€‚å‘¼ã³å‡ºã—å…ƒ `app_lifecycle.go` L169 ã¯ã‚¨ãƒ©ãƒ¼ãƒã‚§ãƒƒã‚¯ã—ã¦ã„ã‚‹ãŒå®Ÿè³ªãƒ‡ãƒƒãƒ‰ã‚³ãƒ¼ãƒ‰ã€‚ã‚¨ãƒ©ãƒ¼æˆ»ã‚Šå€¤ã‚’æ˜ç¤ºçš„ã«ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã™ã‚‹ã‹ã€å°†æ¥çš„ãªã‚¨ãƒ©ãƒ¼ä¼æ’­ã‚’æ¤œè¨ã€‚

### I-8. [shim_cleanup_windows.go] `removeLegacyDirectory` ã§ LOCALAPPDATA å†å–å¾—

**ãƒ•ã‚¡ã‚¤ãƒ«:** `myT-x/internal/install/shim_cleanup_windows.go` L115-L117
**ã‚«ãƒ†ã‚´ãƒª:** ä¸€è²«æ€§ / é˜²å¾¡çš„ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°

å‘¼ã³å‡ºã—å…ƒã§æ¤œè¨¼æ¸ˆã¿ã® `LOCALAPPDATA` ã‚’å†åº¦ `os.Getenv` ã§å–å¾—ã€‚åˆ¥ goroutine ã«ã‚ˆã‚‹ `os.Setenv` ã§ä¸æ•´åˆã®å¯èƒ½æ€§ï¼ˆç†è«–ä¸Šï¼‰ã€‚æ¤œè¨¼æ¸ˆã¿å€¤ã‚’ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã¨ã—ã¦æ¸¡ã™ã“ã¨ã‚’æ¨å¥¨ã€‚

### I-9. [shim_cleanup_windows.go] Walk-up ãƒ«ãƒ¼ãƒ—ã®ä¸Šé™ãªã—

**ãƒ•ã‚¡ã‚¤ãƒ«:** `myT-x/internal/install/shim_cleanup_windows.go` L130-L144
**ã‚«ãƒ†ã‚´ãƒª:** é˜²å¾¡çš„ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°

symlink/junction point ã®å ´åˆã€`filepath.Clean` ã®æ­£è¦åŒ–çµæœãŒç•°ãªã‚Šã€`LOCALAPPDATA` ãƒãƒƒãƒã›ãšã«ãƒ‰ãƒ©ã‚¤ãƒ–ãƒ«ãƒ¼ãƒˆã¾ã§èµ°ã‚‹å¯èƒ½æ€§ã€‚`current == filepath.Dir(current)` ã®ãƒ«ãƒ¼ãƒˆæ¤œå‡ºã‚’è¿½åŠ æ¨å¥¨ã€‚

### I-10. [protocol.go] ã‚³ãƒ¡ãƒ³ãƒˆã®å‹æƒ…å ±ãŒä¸æ­£ç¢º

**ãƒ•ã‚¡ã‚¤ãƒ«:** `myT-x/internal/ipc/protocol.go` L21
**ã‚«ãƒ†ã‚´ãƒª:** ã‚³ãƒ¡ãƒ³ãƒˆç²¾åº¦

ã‚³ãƒ¡ãƒ³ãƒˆã« `int` ã¨ã‚ã‚‹ãŒã€Go ã® `json.Unmarshal` â†’ `map[string]any` ã§ã¯ JSONæ•°å€¤ã¯ `float64` ã«ãªã‚‹ã€‚

### I-11. [model_transform.go] `slog.Warn` ã¨ `debugLog` ã®äºŒé‡å‡ºåŠ›

**ãƒ•ã‚¡ã‚¤ãƒ«:** `myT-x/cmd/tmux-shim/model_transform.go` L93-L95
**ã‚«ãƒ†ã‚´ãƒª:** ãƒ­ã‚°è¨­è¨ˆ

Config load å¤±æ•—æ™‚ã« `slog.Warn`ï¼ˆstderrï¼‰ã¨ `debugLog` ã®ä¸¡æ–¹ã«å‡ºåŠ›ã€‚shim ã¯ CLI ãƒ„ãƒ¼ãƒ«ã®ãŸã‚ã€stderr ãŒã‚ªãƒšãƒ¬ãƒ¼ã‚¿ã«æ¼ã‚Œã‚‹å¯èƒ½æ€§ã€‚`debugLog` ã®ã¿ã«çµ±ä¸€ã‚’æ¨å¥¨ã€‚

### I-12. [useTerminalSetup.ts] `fontSize` ãŒã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ— effect ã§ stale closure ã«ãªã‚‹ãƒªã‚¹ã‚¯

**ãƒ•ã‚¡ã‚¤ãƒ«:** `myT-x/frontend/src/hooks/useTerminalSetup.ts` L56
**ã‚«ãƒ†ã‚´ãƒª:** React Hooks / Stale Closure

`fontSize` ãŒãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã¨ã—ã¦æ¸¡ã•ã‚Œã‚‹ãŒã€effect ã¯ `[paneId]` ã®ã¿ã«ä¾å­˜ã€‚`useTerminalFontSize` ã§å¾Œã‹ã‚‰é©ç”¨ã•ã‚Œã‚‹ãŸã‚å®Ÿå®³ã¯ä½ã„ãŒã€æš—é»™çš„ãªçµåˆãŒè„†å¼±ã€‚`useTmuxStore.getState().fontSize` ã§ç›´æ¥å–å¾—ã‚’æ¨å¥¨ã€‚

---

## Suggestionsï¼ˆ22ä»¶ â€” æ”¹å–„æ¨å¥¨ï¼‰

### Appå±¤

| # | ãƒ•ã‚¡ã‚¤ãƒ« | å†…å®¹ |
|---|---------|------|
| S-1 | `app_guards.go` L20-L28 | `requireSessionsWithPaneID` ã¯ validate + mutate ã®å‰¯ä½œç”¨ãŒã‚ã‚‹ã€‚åå‰ã« mutation ã‚’æš—ç¤ºã™ã‚‹å‘½åï¼ˆä¾‹: `requireSessionsAndNormalizePaneID`ï¼‰ã¾ãŸã¯ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆå¼·åŒ–ã‚’æ¤œè¨ |
| S-2 | `app_snapshot_delta.go` L120-L121 | Removed ã®ã¿ã‚½ãƒ¼ãƒˆã™ã‚‹ç†ç”±ï¼ˆæ±ºå®šæ€§ã®è¨ºæ–­ãƒ¡ãƒªãƒƒãƒˆï¼‰ã‚’ Why ã‚³ãƒ¡ãƒ³ãƒˆã§è£œè¶³ |
| S-3 | `app_pane_api.go` L7-L8 | `SplitPane` ã ã‘æ‰‹å‹• TrimSpace+ç©ºãƒã‚§ãƒƒã‚¯ã§æ®‹ã£ã¦ã„ã‚‹ã€‚`requireRouterWithPaneID` ãƒ‘ã‚¿ãƒ¼ãƒ³ã®è¿½åŠ ã§ä¸€è²«æ€§å‘ä¸Š |
| S-4 | `app_pane_api_test.go` L411-L426 | ãƒ†ã‚¹ãƒˆ setup ã‚¯ãƒ­ãƒ¼ã‚¸ãƒ£å†…ã® `panic()` ã‚’ `t.Run` å†…ã«ç§»å‹•ã—ã¦ `t.Fatal` ä½¿ç”¨ã‚’æ¤œè¨ |
| S-5 | `app_status.go` L60-L65 | fallback æ™‚ã® debug ãƒ­ã‚°ãŒé«˜é »åº¦ã§ç™ºç”Ÿã™ã‚‹å¯èƒ½æ€§ã€‚é–‹ç™ºãƒ•ã‚§ãƒ¼ã‚ºå¾Œã«èª¿æ•´ |
| S-6 | `app_events_test.go` | `waitForCondition` ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆãŒ 2s ã«æ‹¡å¤§ã€‚CIå®‰å®šå¾Œã«TODOæ¤œè¨ |

### tmux-shim

| # | ãƒ•ã‚¡ã‚¤ãƒ« | å†…å®¹ |
|---|---------|------|
| S-7 | `spec.go` L118 | `new-session` spec ã« `-t` ãƒ•ãƒ©ã‚°æœªå®šç¾©ã€‚Claude Code ãŒé€ä¿¡ã™ã‚‹å¯èƒ½æ€§ã‚’ç¢ºèª |
| S-8 | `command_transform_test.go` L143-L158 | `wantChanged: true` ã®ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹è¿½åŠ ï¼ˆWindowså›ºæœ‰ãƒ‘ã‚¹ï¼‰ã‚’æ¤œè¨ |

### internal/tmux

| # | ãƒ•ã‚¡ã‚¤ãƒ« | å†…å®¹ |
|---|---------|------|
| S-9 | `format.go` L11-L17 | `#{session_created_human}` ã®äºŒæ®µå±•é–‹ã€‚`lookupFormatVariable` ã«çµ±ä¸€ã—ã¦ pre-replacement ã‚’å‰Šé™¤æ¨å¥¨ |
| S-10 | `command_router_handlers_window.go` L172-L192 | `fallbackWindowIDAfterRemoval` å¤–éƒ¨è¨ˆç®—ã‚’å»ƒæ­¢ã—ã€`RemoveWindowByID` æˆ»ã‚Šå€¤ã«æ–° ActiveWindowID ã‚’å«ã‚ã‚‹ |
| S-11 | `session_manager_test.go` | `RemoveWindowByID` å¾Œã® terminal close ãƒ†ã‚¹ãƒˆï¼ˆmock spyï¼‰ã‚’è¿½åŠ æ¨å¥¨ï¼ˆC-1 ä¿®æ­£ã®æ¤œè¨¼ç”¨ï¼‰ |

### Frontend

| # | ãƒ•ã‚¡ã‚¤ãƒ« | å†…å®¹ |
|---|---------|------|
| S-12 | `useTerminalEvents.ts` L42 | ESLint exhaustive-deps æŠ‘åˆ¶ã§ `setPrefixMode` ãŒ stale ã«ãªã‚‹ãƒªã‚¹ã‚¯ã€‚åŒãƒ‘ã‚¿ãƒ¼ãƒ³ãŒ `useTerminalResize.ts` L27, `useTerminalFontSize.ts` L48 ã«ã‚‚å­˜åœ¨ |
| S-13 | `TerminalPane.tsx` L195 | `searchAddonRef.current` ãŒåˆå› render æ™‚ nullã€‚å°†æ¥çš„ã«è‡ªå‹• search-open æ©Ÿèƒ½è¿½åŠ æ™‚ã«ã‚µã‚¤ãƒ¬ãƒ³ãƒˆå¤±æ•— |
| S-14 | `useWindowRename.ts` L82 | `getRenameInputRef` ãŒ `renamingWindowId` æ¯ã«å†ç”Ÿæˆã€‚`Map<number, HTMLInputElement>` ã§ç°¡ç´ åŒ–å¯èƒ½ |
| S-15 | `useBackendSync.ts` L109 | `GetConfigAndFlushWarnings` ã¨ `config:updated` ã‚¤ãƒ™ãƒ³ãƒˆã®å¾®å° race windowã€‚ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆè¿½åŠ æ¨å¥¨ |
| S-16 | `tmuxStore.ts` L89 | ã‚»ãƒƒã‚·ãƒ§ãƒ³ rename æ™‚ã® delta å‡¦ç†ï¼ˆremove â†’ upsert é †åºï¼‰ã®ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰å¥‘ç´„ã‚’ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆåŒ– |
| S-17 | `usePrefixKeyMode.ts` L56 | prefix mode ä¸­ã®æœªãƒãƒ³ãƒ‰ãƒ«ã‚­ãƒ¼ãŒ `preventDefault` ã§æ¶ˆè²»ã•ã‚Œã‚‹ã€‚tmuxäº’æ›ã ãŒæ„å›³ã‚’æ˜è¨˜ |
| S-18 | `ConfirmDialog.tsx` L19 | `role="dialog"` ã¨ `aria-modal="true"` ã‚’è¿½åŠ ã—ã¦ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£æ”¹å–„ |
| S-19 | `tmuxStore.ts` L71 | `activeWindowId` ãŒ `string | null` ã ãŒ `WindowSnapshot.id` ã¯ `number`ã€‚å‹ä¸ä¸€è‡´ã®ç¢ºèª |
| S-20 | `types/tmux.ts` L75 | `PaneSnapshot.id: string` vs `WindowSnapshot.active_pane: number` ã®å‹ä¸æ•´åˆ |
| S-21 | `TerminalPane.tsx` L236-L239 | `areTerminalPanePropsEqual` ãŒ 11 props ä¸­ 3 props ã®ã¿æ¯”è¼ƒã€‚æœªä½¿ç”¨ã® `onDetach` prop ã‚’ interface ã‹ã‚‰å‰Šé™¤æ¤œè¨ |

### Config/Install/IPC

| # | ãƒ•ã‚¡ã‚¤ãƒ« | å†…å®¹ |
|---|---------|------|
| S-22 | `shim_cleanup_windows_test.go` è¤‡æ•°ç®‡æ‰€ | `os.Getenv/os.Setenv/t.Cleanup` ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’ `t.Setenv()` (Go 1.17+) ã«çµ±ä¸€æ¨å¥¨ã€‚L99-101, L117-119, L138-140, L163-164, L209-211, L228-230 ã®è¨ˆ6ç®‡æ‰€ |

---

## Strengthsï¼ˆè‰¯ã„ç‚¹ï¼‰

### Appå±¤
- **`snapshotEventPolicies` ãƒ†ãƒ¼ãƒ–ãƒ«é§†å‹•è¨­è¨ˆ** â€” å®£è¨€çš„ãƒãƒƒãƒ—ã§æ•£åœ¨ã—ãŸswitch/if ã‚’çµ±ä¸€ã€‚`TestSnapshotEventPolicyConsistency` ã«ã‚ˆã‚‹ `bypassDebounce â†’ trigger` ä¸å¤‰æ¡ä»¶ãƒ†ã‚¹ãƒˆãŒå¼·åŠ›
- **`ApplyLayoutPreset` ã® TOCTOU ä¿®æ­£** â€” `ApplyLayoutPresetToActiveWindow` ã‚¢ãƒˆãƒŸãƒƒã‚¯æ“ä½œã¸ã®ç½®ãæ›ãˆã§å®Ÿéš›ã®ãƒ¬ãƒ¼ã‚¹ã‚’è§£æ¶ˆ
- **`requireSessionsWithPaneID` ã‚¬ãƒ¼ãƒ‰æŠ½å‡º** â€” 7ç®‡æ‰€ã® TrimSpace+ç©ºãƒã‚§ãƒƒã‚¯é‡è¤‡ã‚’æ’é™¤
- **ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰æ•°ã‚¬ãƒ¼ãƒ‰ã‚³ãƒ¡ãƒ³ãƒˆ** â€” equality é–¢æ•°ã« `IMPORTANT: update when fields change` + `TestSnapshotFieldCounts` å‚ç…§
- **`resolvePaneTitle` 6æ®µå„ªå…ˆåº¦ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ** â€” `Priority N:` ã‚³ãƒ¡ãƒ³ãƒˆã§ã‚³ãƒ¼ãƒ‰ã¨æ–‡æ›¸ã®è‡ªå·±æ¤œè¨¼ãƒ‘ã‚¿ãƒ¼ãƒ³
- **`t.Parallel()` è­¦å‘Šã‚³ãƒ¡ãƒ³ãƒˆ** â€” 3ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã§ä¸€è²«ã—ã¦é…ç½®

### tmux-shim
- **`runTransformSafe` ãƒ‘ãƒ‹ãƒƒã‚¯å›å¾©** â€” snapshot/restore ã§ãƒˆãƒ©ãƒ³ã‚¹ãƒ•ã‚©ãƒ¼ãƒ å¤±æ•—æ™‚ã‚‚åŸæ–‡è»¢é€ã‚’ä¿è¨¼
- **`cloneTransformRequest` ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰æ•°ã‚¬ãƒ¼ãƒ‰ãƒ†ã‚¹ãƒˆ** â€” structãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰è¿½åŠ æ™‚ã® clone æ›´æ–°æ¼ã‚Œã‚’ã‚­ãƒ£ãƒƒãƒ
- **ãƒ¢ãƒ‡ãƒ« config ã‚­ãƒ£ãƒƒã‚·ãƒ¥ï¼ˆã‚¨ãƒ©ãƒ¼éã‚­ãƒ£ãƒƒã‚·ãƒ¥ï¼‰** â€” ä¸€æ™‚çš„ãªèª­ã¿è¾¼ã¿å¤±æ•—ã‹ã‚‰ã®å›å¾©è¨­è¨ˆ
- **`validateCommandSpecConsistency()` init ãƒã‚§ãƒƒã‚¯** â€” spec ã¨ commandOrder ã®åŒæœŸãƒ‰ãƒªãƒ•ãƒˆã‚’èµ·å‹•æ™‚ã«æ¤œå‡º

### internal/tmux
- **ä¸€è²«ã—ãŸãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯ãƒ‘ã‚¿ãƒ¼ãƒ³** â€” `handleNewSession`, `splitWindowResolved`, `handleNewWindow` ã§ partial failure æ™‚ã®é©åˆ‡ãªå·»ãæˆ»ã—
- **ã‚¯ãƒ­ãƒ¼ãƒ³è¦å¾‹** â€” `cloneSessionForRead`, `copyPaneSlice`, `SessionSnapshot.Clone()` ã§å…±æœ‰çŠ¶æ…‹å¤‰æ›´é˜²æ­¢
- **`killPaneLocked` ã®ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã‚¯ãƒ­ãƒ¼ã‚ºãƒ‘ã‚¿ãƒ¼ãƒ³ãŒæ¨¡ç¯„çš„** â€” nil åŒ–å‰ã«å‚ç…§ä¿å­˜ã€ãƒ­ãƒƒã‚¯å¤–ã§ã‚¯ãƒ­ãƒ¼ã‚º
- **ç’°å¢ƒå¤‰æ•°ãƒ–ãƒ­ãƒƒã‚¯ãƒªã‚¹ãƒˆ** â€” `command_router_terminal.go` ã® defense-in-depth

### Frontend
- **å„ªã‚ŒãŸ hook åˆ†è§£** â€” terminal ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«ã‚’ setup/events/resize/fontSize ã®4 hook ã«åˆ†é›¢
- **ã‚¤ãƒ™ãƒ³ãƒˆ cleanup** â€” `EventsOn` ã®ã‚­ãƒ£ãƒ³ã‚»ãƒ«é–¢æ•°ã‚’å€‹åˆ¥ä¿æŒã€`EventsOff` ã®è½ã¨ã—ç©´ã‚’å›é¿
- **IME ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°** â€” composition ä¸­ã®å‡ºåŠ›ãƒãƒƒãƒ•ã‚¡ãƒªãƒ³ã‚°ã¨ resize é…å»¶
- **WebGL ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯** â€” module-level `webglUnavailable` ãƒ•ãƒ©ã‚°ã§å†è©¦è¡Œå›é¿
- **window rename äºŒé‡å‘¼ã³å‡ºã—ã‚¬ãƒ¼ãƒ‰** â€” `inflightWindowIdRef` ãƒ‘ã‚¿ãƒ¼ãƒ³ã§ Enter â†’ onBlur race å¯¾ç­–

### Config/Install/IPC
- **å†ªç­‰è¨­è¨ˆ** â€” `CleanupLegacyShimInstalls` ãŒç¹°ã‚Šè¿”ã—å‘¼ã³å‡ºã—å®‰å…¨
- **å®‰å…¨ãªãƒ•ã‚¡ã‚¤ãƒ« cleanup** â€” æ—¢çŸ¥ãƒ•ã‚¡ã‚¤ãƒ«ã®ã¿å‰Šé™¤ã€ä¸æ˜ãƒ•ã‚¡ã‚¤ãƒ«ä¿æŒã‚’ãƒ†ã‚¹ãƒˆã§æ¤œè¨¼
- **ãƒ‡ãƒãƒƒã‚°ãƒ­ã‚°å‘½åçµ±ä¸€** â€” `[DEBUG-SHIM]`, `[WARN-SHIM]`, `[DEBUG-CONFIG]` ãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹

---

## ã‚¿ã‚¹ã‚¯ä¸€è¦§ã¨ä¸¦åˆ—ä½œæ¥­å¯å¦

ä»¥ä¸‹ã®ã‚¿ã‚¹ã‚¯è¡¨ã¯ã€ä¸Šè¨˜ã®æŒ‡æ‘˜äº‹é …ã‚’ä¿®æ­£ä½œæ¥­ã¨ã—ã¦æ•´ç†ã—ãŸã‚‚ã®ã§ã™ã€‚**ä¸¦åˆ—ä½œæ¥­å¯å¦**ã¯ã€å„ã‚¿ã‚¹ã‚¯ãŒä»–ã®ã‚¿ã‚¹ã‚¯ã«ä¾å­˜ã—ãªã„ã‹ã©ã†ã‹ã‚’ç¤ºã—ã¦ã„ã¾ã™ã€‚

### Criticalï¼ˆå¿…é ˆä¿®æ­£ï¼‰

| # | ã‚¿ã‚¹ã‚¯ | å¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ« | æ¦‚è¦ | ä¸¦åˆ—å¯å¦ | å‚™è€ƒ |
|---|-------|------------|------|---------|------|
| T-1 | Terminal ãƒªã‚½ãƒ¼ã‚¹ãƒªãƒ¼ã‚¯ä¿®æ­£ | `session_manager_windows.go`, `command_router_handlers_window.go` | `removeWindowAtIndexLocked` ã§ nil åŒ–å‰ã« terminal å‚ç…§ã‚’ä¿å­˜ã—ã¦è¿”ã™ã‚ˆã†ã«ä¿®æ­£ | âœ… å˜ç‹¬ä½œæ¥­å¯ | `killPaneLocked` ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’å‚è€ƒã« |

### Importantï¼ˆä¿®æ­£æ¨å¥¨ï¼‰

| # | ã‚¿ã‚¹ã‚¯ | å¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ« | æ¦‚è¦ | ä¸¦åˆ—å¯å¦ | å‚™è€ƒ |
|---|-------|------------|------|---------|------|
| T-2 | RenameSession ã‚³ãƒ¡ãƒ³ãƒˆæ›´æ–° | `app_session_api.go` | policy ãƒ†ãƒ¼ãƒ–ãƒ«çµŒç”±ã§ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆãƒˆãƒªã‚¬ãƒ¼ã•ã‚Œã‚‹æ—¨ã«æ›´æ–° | âœ… å˜ç‹¬ä½œæ¥­å¯ | ã‚³ãƒ¡ãƒ³ãƒˆä¿®æ­£ã®ã¿ |
| T-3 | snapshotEventPolicies ä¸å¤‰æ€§ã‚³ãƒ¡ãƒ³ãƒˆ | `app_events.go` | `// Treat as immutable after init` ã‚³ãƒ¡ãƒ³ãƒˆè¿½åŠ  | âœ… å˜ç‹¬ä½œæ¥­å¯ | ã‚³ãƒ¡ãƒ³ãƒˆè¿½åŠ ã®ã¿ |
| T-4 | Locked/RLocked å‘½åä¿®æ­£ | `session_manager_windows.go`, `session_manager_env.go`, `session_manager_targets.go` | `getSessionByNameLocked` â†’ `getSessionByNameRLocked` ã¾ãŸã¯å®‰å…¨æ€§ã‚³ãƒ¡ãƒ³ãƒˆè¿½åŠ  | âš ï¸ è¦æ³¨æ„ | å‘¼ã³å‡ºã—å…ƒã™ã¹ã¦ã‚’å¤‰æ›´ã™ã‚‹å¿…è¦ã‚ã‚Šã€‚T-1 ã¨åŒä¸€ãƒ•ã‚¡ã‚¤ãƒ«ã ãŒç•°ãªã‚‹é–¢æ•°ãªã®ã§ä¸¦åˆ—å¯ |
| T-5 | paneEnvView CoW å¥‘ç´„ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ | `command_router.go` | Copy-on-Write å¥‘ç´„ã‚’ã‚³ãƒ¡ãƒ³ãƒˆã¨ã—ã¦æ˜æ–‡åŒ– | âœ… å˜ç‹¬ä½œæ¥­å¯ | ã‚³ãƒ¡ãƒ³ãƒˆè¿½åŠ ã®ã¿ |
| T-6 | ListPanesByWindowTarget ã® @stableID å¯¾å¿œ | `session_manager_pane_io.go` | `resolveWindowPaneTarget` ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ã§ stableID å¯¾å¿œã‚’è¿½åŠ  | âœ… å˜ç‹¬ä½œæ¥­å¯ | ãƒ­ã‚¸ãƒƒã‚¯å¤‰æ›´ã‚ã‚Šã€ãƒ†ã‚¹ãƒˆè¿½åŠ æ¨å¥¨ |
| T-7 | handleKillWindow TOCTOU è§£æ¶ˆ | `command_router_handlers_window.go`, `session_manager_windows.go` | `RemoveWindowByID` æˆ»ã‚Šå€¤ã« fallback WindowID ã‚’å«ã‚ã‚‹ | âš ï¸ T-1ã¨åŒä¸€ãƒ•ã‚¡ã‚¤ãƒ« | T-1 ã®ä¿®æ­£å¾Œã«å®Ÿæ–½æ¨å¥¨ï¼ˆåŒä¸€é–¢æ•°å‘¨è¾ºï¼‰ |
| T-8 | CleanupLegacyShimInstalls ã‚¨ãƒ©ãƒ¼æˆ»ã‚Šå€¤ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ | `shim_cleanup_windows.go` | å¸¸ã« nil ã‚’è¿”ã™æ—¨ã®ã‚³ãƒ¡ãƒ³ãƒˆè¿½åŠ  | âœ… å˜ç‹¬ä½œæ¥­å¯ | ã‚³ãƒ¡ãƒ³ãƒˆè¿½åŠ ã®ã¿ |
| T-9 | removeLegacyDirectory ã® LOCALAPPDATA ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿åŒ– | `shim_cleanup_windows.go` | `os.Getenv` å†å–å¾—ã‚’ã‚„ã‚ã€ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿æ¸¡ã—ã«å¤‰æ›´ | âœ… å˜ç‹¬ä½œæ¥­å¯ | T-8 ã¨åŒä¸€ãƒ•ã‚¡ã‚¤ãƒ«ã ãŒç•°ãªã‚‹é–¢æ•° |
| T-10 | Walk-up ãƒ«ãƒ¼ãƒ—ã®ãƒ«ãƒ¼ãƒˆæ¤œå‡ºè¿½åŠ  | `shim_cleanup_windows.go` | `current == filepath.Dir(current)` ãƒã‚§ãƒƒã‚¯è¿½åŠ  | âœ… å˜ç‹¬ä½œæ¥­å¯ | T-9 ã¨é–¢é€£ã™ã‚‹ãŒåˆ¥ãƒ­ã‚¸ãƒƒã‚¯ |
| T-11 | protocol.go ã‚³ãƒ¡ãƒ³ãƒˆå‹ä¿®æ­£ | `protocol.go` | `int` â†’ `float64` ã«ä¿®æ­£ | âœ… å˜ç‹¬ä½œæ¥­å¯ | ã‚³ãƒ¡ãƒ³ãƒˆä¿®æ­£ã®ã¿ |
| T-12 | model_transform.go ãƒ­ã‚°äºŒé‡å‡ºåŠ›ä¿®æ­£ | `model_transform.go` | `slog.Warn` ã‚’å‰Šé™¤ã— `debugLog` ã«çµ±ä¸€ | âœ… å˜ç‹¬ä½œæ¥­å¯ | |
| T-13 | useTerminalSetup fontSize stale closure å¯¾ç­– | `useTerminalSetup.ts` | `useTmuxStore.getState().fontSize` ã§ç›´æ¥å–å¾—ã«å¤‰æ›´ | âœ… å˜ç‹¬ä½œæ¥­å¯ | |

### ä¸¦åˆ—ä½œæ¥­ã‚°ãƒ«ãƒ¼ãƒ—è¡¨

ä½œæ¥­è€…ãŒåŠ¹ç‡çš„ã«ä¸¦åˆ—ä¿®æ­£ã§ãã‚‹ã‚ˆã†ã‚°ãƒ«ãƒ¼ãƒ—åŒ–ã—ã¾ã—ãŸã€‚

| ã‚°ãƒ«ãƒ¼ãƒ— | ã‚¿ã‚¹ã‚¯ | èª¬æ˜ | åŒæ™‚ä½œæ¥­å¯èƒ½æ€§ |
|---------|-------|------|--------------|
| **ã‚°ãƒ«ãƒ¼ãƒ—A: tmuxå†…éƒ¨ä¿®æ­£** | T-1 â†’ T-7 | Terminal ãƒªãƒ¼ã‚¯ã¨TOCTOUã€‚T-7 ã¯ T-1 å®Œäº†å¾Œã«å®Ÿæ–½ | ğŸ”´ **é †æ¬¡ä½œæ¥­** |
| **ã‚°ãƒ«ãƒ¼ãƒ—B: ã‚³ãƒ¡ãƒ³ãƒˆãƒ»ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆä¿®æ­£** | T-2, T-3, T-5, T-8, T-11 | å„ãƒ•ã‚¡ã‚¤ãƒ«ã®ã‚³ãƒ¡ãƒ³ãƒˆä¿®æ­£ã€‚ç‹¬ç«‹ã—ãŸãƒ•ã‚¡ã‚¤ãƒ« | ğŸŸ¢ **å…¨ã¦ä¸¦åˆ—å¯** |
| **ã‚°ãƒ«ãƒ¼ãƒ—C: å‘½åãƒ»APIæ”¹å–„** | T-4, T-6 | å‘½åè¦ç´„ä¿®æ­£ã¨ API ä¸€è²«æ€§ã€‚ç•°ãªã‚‹ãƒ•ã‚¡ã‚¤ãƒ« | ğŸŸ¢ **ä¸¦åˆ—å¯** |
| **ã‚°ãƒ«ãƒ¼ãƒ—D: Installå®‰å…¨æ€§** | T-9, T-10 | åŒä¸€ãƒ•ã‚¡ã‚¤ãƒ«ã ãŒç•°ãªã‚‹é–¢æ•° | ğŸŸ¡ **ä¸¦åˆ—å¯ã ãŒåŒä¸€ãƒ•ã‚¡ã‚¤ãƒ«æ³¨æ„** |
| **ã‚°ãƒ«ãƒ¼ãƒ—E: shim/Frontendå€‹åˆ¥ä¿®æ­£** | T-12, T-13 | ç‹¬ç«‹ã—ãŸä¿®æ­£ | ğŸŸ¢ **ä¸¦åˆ—å¯** |

### æ¨å¥¨ä½œæ¥­é †åº

```
[æœ€å„ªå…ˆ] ã‚°ãƒ«ãƒ¼ãƒ—A: T-1ï¼ˆCriticalä¿®æ­£ï¼‰â†’ T-7ï¼ˆTOCTOUè§£æ¶ˆï¼‰
    â†“ ï¼ˆä¸¦åˆ—å®Ÿè¡Œå¯èƒ½ï¼‰
[å„ªå…ˆåº¦é«˜] ã‚°ãƒ«ãƒ¼ãƒ—B: T-2, T-3, T-5, T-8, T-11 ã‚’ä¸€æ‹¬ä¿®æ­£
[å„ªå…ˆåº¦é«˜] ã‚°ãƒ«ãƒ¼ãƒ—C: T-4, T-6 ã‚’ä¸¦åˆ—ä¿®æ­£
[å„ªå…ˆåº¦é«˜] ã‚°ãƒ«ãƒ¼ãƒ—D: T-9 â†’ T-10 ã‚’é †æ¬¡ä¿®æ­£
[å„ªå…ˆåº¦é«˜] ã‚°ãƒ«ãƒ¼ãƒ—E: T-12, T-13 ã‚’ä¸¦åˆ—ä¿®æ­£
```

---

## Recommended Action

1. **T-1ï¼ˆCriticalï¼‰ã‚’æœ€å„ªå…ˆã§ä¿®æ­£** â€” kill-window ã§ã®ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ãƒ—ãƒ­ã‚»ã‚¹ãƒªãƒ¼ã‚¯
2. ã‚°ãƒ«ãƒ¼ãƒ— B/C/D/E ã® Important ã‚¿ã‚¹ã‚¯ã‚’ä¸¦åˆ—ã§å®Ÿæ–½
3. T-7 ã¯ T-1 å®Œäº†å¾Œã«å®Ÿæ–½ï¼ˆåŒä¸€ãƒ•ã‚¡ã‚¤ãƒ«ãƒ»é–¢æ•°å‘¨è¾ºï¼‰
4. Suggestions ã¯å„ªå…ˆåº¦ã«å¿œã˜ã¦å€‹åˆ¥å¯¾å¿œ
5. ä¿®æ­£å¾Œã«å†ãƒ¬ãƒ“ãƒ¥ãƒ¼å®Ÿè¡Œã‚’æ¨å¥¨
