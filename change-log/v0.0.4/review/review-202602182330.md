# çµ±åˆãƒ¬ãƒ“ãƒ¥ãƒ¼: myT-x v0.0.4

**ä½œæˆæ—¥æ™‚**: 2026-02-18 23:30  
**å¯¾è±¡**: `myT-x/` é…ä¸‹ã®å…¨å¤‰æ›´ï¼ˆ64ãƒ•ã‚¡ã‚¤ãƒ«, +7098/-2513è¡Œï¼‰  
**çµ±åˆå…ƒãƒ¬ãƒ“ãƒ¥ãƒ¼**: 6ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆé‡è¤‡æ’é™¤æ¸ˆã¿ï¼‰

| # | çµ±åˆå…ƒãƒ•ã‚¡ã‚¤ãƒ« | ãƒ¬ãƒ“ãƒ¥ãƒ¼è¦³ç‚¹ |
|---|--------------|------------|
| 1 | review-202602182056-crosscut.md | æ¨ªæ–­çš„é–¢å¿ƒäº‹ï¼ˆã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ï¼‰ |
| 2 | review-202602182149.md | 7ä¸¦åˆ—ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãƒ¬ãƒ“ãƒ¥ãƒ¼ |
| 3 | review-202602182200.md | 6ä¸¦åˆ—ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãƒ¬ãƒ“ãƒ¥ãƒ¼ |
| 4 | review-202602182210-crosscut.md | ã‚µã‚¤ãƒ¬ãƒ³ãƒˆéšœå®³ãƒ»å‹è¨­è¨ˆãƒ»å‰¯ä½œç”¨ |
| 5 | review-test-quality-202602182056.md | ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰å·®åˆ†ãƒ¬ãƒ“ãƒ¥ãƒ¼ |
| 6 | review-test-quality.md | å…¨ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«å“è³ªãƒ¬ãƒ“ãƒ¥ãƒ¼ |

---

## çµ±è¨ˆã‚µãƒãƒª

| é‡è¦åº¦ | ä»¶æ•° |
|--------|------|
| Critical | 4 |
| Important â€” ã‚³ãƒ¼ãƒ‰å“è³ª | 28 |
| Important â€” ãƒ†ã‚¹ãƒˆ | 13 |
| Missing Test Coverage | 10 |
| Suggestion â€” ã‚³ãƒ¼ãƒ‰ | 26 |
| Suggestion â€” ãƒ†ã‚¹ãƒˆ | 10 |
| Confirmed OK | 4 |

---

## Critical Issuesï¼ˆ4ä»¶ï¼‰

### C-01: `DirectionalPaneDirection` ã®ã‚¼ãƒ­å€¤ãŒ `DirPrev` ã«ãªã£ã¦ã„ã‚‹

- **ãƒ•ã‚¡ã‚¤ãƒ«**: `internal/tmux/session_manager_targets.go`
- **å‡ºå…¸**: review-202602182149

Go ã®ã‚¼ãƒ­å€¤ 0 ãŒæš—é»™çš„ã«ã€Œå‰ã®ãƒšã‚¤ãƒ³ã¸ç§»å‹•ã€ã¨ã—ã¦å‹•ä½œã™ã‚‹ã€‚æœªåˆæœŸåŒ–å¤‰æ•°ãŒæ„å›³ã—ãªã„å‹•ä½œã‚’å¼•ãèµ·ã“ã™ãƒªã‚¹ã‚¯ã€‚

```go
const (
    DirNone DirectionalPaneDirection = iota // zero value = invalid â† è¿½åŠ 
    DirPrev
    DirNext
    // ...
)
```

**ä¿®æ­£**: `DirNone` ã‚’ã‚¼ãƒ­å€¤ã¨ã—ã¦å…ˆé ­ã«è¿½åŠ ã—ã€`ResolveDirectionalPane` ã§ `DirNone` ã«ã‚¨ãƒ©ãƒ¼ã‚’è¿”ã™ã€‚

---

### C-02: `activeWindowId` ãŒ tmuxStore ã«è¿½åŠ ã•ã‚ŒãŸãŒã€ã©ã®ãƒãƒ³ãƒ‰ãƒ©ã‹ã‚‰ã‚‚ã‚»ãƒƒãƒˆã•ã‚Œãªã„

- **ãƒ•ã‚¡ã‚¤ãƒ«**: `frontend/src/stores/tmuxStore.ts`, `frontend/src/hooks/useBackendSync.ts`
- **å‡ºå…¸**: review-202602182210, review-202602182149

`activeWindowId: string | null` ã¨ `setActiveWindowId` ãŒè¿½åŠ ã•ã‚Œã¦ã„ã‚‹ãŒã€`useBackendSync.ts` ã®ã©ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©ã‹ã‚‰ã‚‚å‘¼ã°ã‚ŒãšåˆæœŸå€¤ `null` ã®ã¾ã¾ã€‚å°†æ¥å‚ç…§ã™ã‚‹ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒè¿½åŠ ã•ã‚ŒãŸå ´åˆã«å¸¸ã« `null` ã‚’è¿”ã™ã€‚

**ä¿®æ­£**: (a) snapshot/delta ãƒãƒ³ãƒ‰ãƒ©å†…ã§æ›´æ–°ã€(b) æœªä½¿ç”¨ãªã‚‰å‰Šé™¤ã€(c) TODO ã‚³ãƒ¡ãƒ³ãƒˆã‚’è¿½åŠ ã€‚

---

### C-03: `applyNewProcessTransform` ã®ãƒ†ã‚¹ãƒˆãŒæ¬ å¦‚

- **ãƒ•ã‚¡ã‚¤ãƒ«**: `cmd/tmux-shim/command_transform.go` L34
- **å‡ºå…¸**: review-test-quality CT-1, review-202602182200 M-01/I-15

`new-session`/`split-window` ã®å®Ÿè¡Œãƒ‘ã‚¹å¤‰æ›ã‚’è¡Œã†é‡è¦ãªé–¢æ•°ã«ä¸€åˆ‡ãƒ†ã‚¹ãƒˆãŒãªã„ã€‚Windows/éWindows ã®æŒ™å‹•åˆ†å²ã‚ã‚Šã€‚

**ä¿®æ­£**: ãƒ†ãƒ¼ãƒ–ãƒ«é§†å‹•ãƒ†ã‚¹ãƒˆã§ã‚³ãƒãƒ³ãƒ‰ç¨®åˆ¥ãƒ»ãƒ•ãƒ©ã‚°çµ„ã¿åˆã‚ã›ãƒ»ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ åˆ†å²ã‚’ã‚«ãƒãƒ¼ã€‚

---

### C-04: `applySendKeysTransform` ã®ãƒ†ã‚¹ãƒˆãŒæ¬ å¦‚

- **ãƒ•ã‚¡ã‚¤ãƒ«**: `cmd/tmux-shim/command_transform.go` L67
- **å‡ºå…¸**: review-test-quality CT-2, review-202602182200 M-02/I-15

send-keys ã‚³ãƒãƒ³ãƒ‰ã«å¯¾ã™ã‚‹ã‚¨ãƒ³ã‚¿ãƒ¼ä»˜åŠ å‡¦ç†ã®å°‚ç”¨ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆãŒãªã„ã€‚ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã¨ã®ä¸»è¦ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ã‚·ãƒ§ãƒ³ãƒã‚¤ãƒ³ãƒˆã€‚

**ä¿®æ­£**: ãƒ†ãƒ¼ãƒ–ãƒ«é§†å‹•ãƒ†ã‚¹ãƒˆã§æ­£å¸¸ç³»ãƒ»ç•°å¸¸ç³»ã‚’ç¶²ç¾…ã€‚

---

## Important Issues â€” ã‚³ãƒ¼ãƒ‰å“è³ªï¼ˆ28ä»¶ï¼‰

### A. ãƒ©ã‚¤ãƒ–ãƒã‚¤ãƒ³ã‚¿ / TOCTOUï¼ˆ6ä»¶ï¼‰

`ResolveTarget` ãŒè¿”ã™ãƒ©ã‚¤ãƒ–ãƒã‚¤ãƒ³ã‚¿ã‚’ãƒ­ãƒƒã‚¯å¤–ã§ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ãƒ‘ã‚¿ãƒ¼ãƒ³ãŒè¤‡æ•°ãƒãƒ³ãƒ‰ãƒ©ã«å­˜åœ¨ã™ã‚‹ã€‚kill-pane/kill-session ã®ä¸¦è¡Œå®Ÿè¡Œæ™‚ã« nil pointer dereference ã®ãƒªã‚¹ã‚¯ã€‚

| ID | æ¦‚è¦ | ãƒ•ã‚¡ã‚¤ãƒ« | å‡ºå…¸ |
|----|------|---------|------|
| I-01 | `handleSelectWindow` â€” ã‚¯ãƒ­ãƒ¼ãƒ³çµŒç”±ã®ãƒšã‚¤ãƒ³IDã§ `SetActivePane` å‘¼å‡ºï¼ˆTOCTOUï¼‰ | `command_router_handlers_window.go` | 2149 I-07, 2200 I-01 |
| I-02 | `bestEffortSendKeys` â€” ãƒ­ãƒƒã‚¯å¤–ã§ `pane.Terminal` èª­å– | `command_router.go` | 2200 I-02 |
| I-03 | `splitWindowResolved` â€” `target.Window.Session` ã‚’ãƒ­ãƒƒã‚¯å¤–ã§ãƒ‡ãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹ | `command_router_handlers_pane.go` | 2200 I-03 |
| I-04 | `handleListWindows` â€” live pointer çµŒç”±ã§ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚¢ã‚¯ã‚»ã‚¹ | `command_router_handlers_window.go` | 2200 I-04 |
| I-05 | `handleResizePane` â€” ãƒ©ã‚¤ãƒ–ãƒã‚¤ãƒ³ã‚¿ã® `Width`/`Height` ã‚’ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã¨ã—ã¦ä½¿ç”¨ | `command_router_handlers_pane.go` | 2200 I-05 |
| I-06 | `handleSendKeys` â€” ãƒ­ãƒƒã‚¯å¤–ã§ `target.Terminal` ã‚¢ã‚¯ã‚»ã‚¹ | `command_router_handlers_pane.go` | 2200 I-06 |

**æ¨å¥¨**: snapshot åŒ–ãƒ‘ã‚¿ãƒ¼ãƒ³ã§ã®çµ±ä¸€ã€ã¾ãŸã¯ã‚¢ãƒˆãƒŸãƒƒã‚¯æ“ä½œãƒ¡ã‚½ãƒƒãƒ‰ã®å°å…¥ã€‚I-02 ã¯ä½œæˆç›´å¾Œã®ãŸã‚å®Ÿè³ªå®‰å…¨ã ãŒã€å®‰å…¨æ€§ãŒæš—é»™ã®å‰æã«ä¾å­˜ â†’ doc ã‚³ãƒ¡ãƒ³ãƒˆè¿½è¨˜æ¨å¥¨ã€‚

---

### B. ãƒªã‚½ãƒ¼ã‚¹ç®¡ç†ï¼ˆ3ä»¶ï¼‰

| ID | æ¦‚è¦ | ãƒ•ã‚¡ã‚¤ãƒ« | å‡ºå…¸ |
|----|------|---------|------|
| I-07 | `KillPane` å¾Œã« `pane.Terminal.Close()` æœªå‘¼å‡º â€” Terminal ãƒªãƒ¼ã‚¯ã€‚`handleKillWindow` ã¯ Close ã™ã‚‹è¨­è¨ˆã¨ä¸æ•´åˆ | `command_router_handlers_pane.go` | 2200 I-07 |
| I-08 | `Snapshot()` ã® RLock å†…ã§ `cloneSessionSnapshots` å®Ÿè¡Œ â€” èª­ã¿å–ã‚Šãƒ­ãƒƒã‚¯ä¿æŒæ™‚é–“å¢—å¤§ | `session_manager_snapshot.go` | 2200 I-08 |
| I-09 | `cleanupStalePathEntries` ãŒæ¯èµ·å‹•æ™‚ã«ãƒ¬ã‚¸ã‚¹ãƒˆãƒªã‚¹ã‚­ãƒ£ãƒ³å®Ÿè¡Œ | `internal/install/shim_cleanup_windows.go` | 2149 I-13, 2056-crosscut S-4 |

---

### C. é˜²å¾¡çš„ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚° / å‹å®‰å…¨ï¼ˆ8ä»¶ï¼‰

| ID | æ¦‚è¦ | ãƒ•ã‚¡ã‚¤ãƒ« | å‡ºå…¸ |
|----|------|---------|------|
| I-10 | `ResolveDirectionalPane` ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ã® `panes[0]` ãŒ nil ã®å¯èƒ½æ€§ã€‚`len(panes) == 0` ã®äº‹å‰ãƒã‚§ãƒƒã‚¯å¿…è¦ | `session_manager_targets.go` | 2149 I-03 |
| I-11 | `requireSessionsWithPaneID(*string)` â€” ãƒã‚¤ãƒ³ã‚¿å¼•æ•°ã«ã‚ˆã‚‹æš—é»™çš„å‰¯ä½œç”¨ã€‚nil pointer dereference ãƒªã‚¹ã‚¯ | `app_guards.go` | 2200 I-09, 2149 S-02 |
| I-12 | `applyModelOverride` â€” `--model` ã®å€¤ãŒç©ºæ–‡å­—åˆ—æ™‚ã®æŒ™å‹•ãŒä¸æ˜ç¢º | `cmd/tmux-shim/command_transform.go` | 2149 I-06 |
| I-13 | `buildPaneEnv` ã« `isBlockedEnvironmentKey` ãƒã‚§ãƒƒã‚¯ä¸åœ¨ï¼ˆ`splitWindowResolved` ã«ã¯å®Ÿè£…æ¸ˆã¿ï¼‰ | `command_router.go`, `command_router_handlers_pane.go` | 2210 I-2 |
| I-14 | `emitWorktreeCleanupFailure` â€” `context.Background()` ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ã§ã¯ Wails ãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã«åˆ°é”ã—ãªã„å¯èƒ½æ€§ | `app_events.go` | 2149 I-01 |
| I-15 | `snapshotEventPolicies` ãŒ `var` ãƒãƒƒãƒ—ã§å®Ÿè¡Œæ™‚å¤‰æ›´å¯èƒ½ã€‚immutable intent ã®ã‚³ãƒ¡ãƒ³ãƒˆæ¬ å¦‚ | `app_events.go` | 2149 I-02 |
| I-16 | `handleNewWindow` â€” ã‚¯ãƒ­ãƒ¼ãƒ³æ™‚ã«å¤ã„ãƒšã‚¤ãƒ³ã‚µã‚¤ã‚ºã‚’ãã®ã¾ã¾ä½¿ç”¨ | `command_router_handlers_window.go` | 2149 I-08 |
| I-17 | `cloneSessionForRead` ã® nil ãƒšã‚¤ãƒ³ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ã§ ActivePN ãŒ 0 ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ã€‚ãƒ†ã‚¹ãƒˆæœªã‚«ãƒãƒ¼ | `session_manager_sessions.go` | 2210 I-6 |

---

### D. ãƒ­ãƒƒã‚¯è¨­è¨ˆ / ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆï¼ˆ4ä»¶ï¼‰

| ID | æ¦‚è¦ | ãƒ•ã‚¡ã‚¤ãƒ« | å‡ºå…¸ |
|----|------|---------|------|
| I-18 | `ListPanesByWindowTarget` â€” èª­ã¿å–ã‚Šå°‚ç”¨ã ãŒ Write Lock ä½¿ç”¨ã€‚auto-repair ãƒ‘ã‚¹ã®æœ‰ç„¡ã‚’ç¢ºèª | `session_manager_targets.go` | 2149 I-05 |
| I-19 | `RemoveWindowByID` ã® 4 æˆ»ã‚Šå€¤ãƒ‘ã‚¿ãƒ¼ãƒ³ â€” èªçŸ¥è² è·é«˜ã€‚æ¬¡å›å¤‰æ›´æ™‚ã«æ§‹é€ ä½“åŒ–æ¤œè¨ | `session_manager_windows.go` | 2149 I-04 (â€»å…¨å‘¼å‡ºå…ƒæ›´æ–°ç¢ºèªæ¸ˆ: 2210 I-3) |
| I-20 | `snapshotMu` ãŒ `shouldSyncPaneStates` ã§ `snapshotDeltaMu` å¤–ã§ç‹¬ç«‹å–å¾—ã€‚ãƒ­ãƒƒã‚¯é †åºã‚³ãƒ¡ãƒ³ãƒˆã«æœªè¨˜è¼‰ | `app_snapshot_delta.go` | 2200 I-13, 2056-crosscut I-3 |
| I-21 | `SessionSnapshotDelta.removed` ãŒ session names ã‚’å«ã‚€ã“ã¨ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆä¸è¶³ | `app_snapshot_delta.go`, `frontend/src/types/tmux.ts` | 2200 I-12, 2056-crosscut I-1 |

---

### E. ãƒ­ã‚°ãƒ¬ãƒ™ãƒ«ï¼ˆ3ä»¶ï¼‰

| ID | æ¦‚è¦ | ãƒ•ã‚¡ã‚¤ãƒ« | å‡ºå…¸ |
|----|------|---------|------|
| I-22 | `activeWindowInSessionLocked` â€” è‡ªå‹•ä¿®å¾©ã®å‰¯ä½œç”¨ãŒ Debug ãƒ¬ãƒ™ãƒ«ã€‚Info æ¨å¥¨ | `session_manager_targets.go` | 2149 I-10 |
| I-23 | `handleLegacyMapPaneOutput` â€” å‹ä¸ä¸€è‡´ãŒ Debug ãƒ¬ãƒ™ãƒ«ã€‚Warn æ¨å¥¨ | å„ãƒãƒ³ãƒ‰ãƒ© | 2149 I-11 |
| I-24 | `applyModelTransformSafe` â€” config load error ã‚’ swallow å¾Œã® unreachable error branchã€‚å‰Šé™¤ or ã‚³ãƒ¡ãƒ³ãƒˆè¿½åŠ  | `cmd/tmux-shim/model_transform.go` | 2056-crosscut I-2 |

---

### F. Shim / Installï¼ˆ2ä»¶ï¼‰

| ID | æ¦‚è¦ | ãƒ•ã‚¡ã‚¤ãƒ« | å‡ºå…¸ |
|----|------|---------|------|
| I-25 | `CleanupLegacyShimInstalls` ãŒå¸¸ã« `nil` è¿”å´ â€” å‘¼å‡ºå´ã® `if err != nil` ãŒãƒ‡ãƒƒãƒ‰ã‚³ãƒ¼ãƒ‰ | `internal/install/shim_cleanup_windows.go` | 2149 I-09 |
| I-26 | `model_transform.go` â€” `matchAll` + override miss ã§å†—é•·ãªãƒ€ãƒ–ãƒ«ã‚¹ã‚­ãƒ£ãƒ³ | `cmd/tmux-shim/model_transform.go` | 2200 I-14 |

---

### G. ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ï¼ˆ4ä»¶ï¼‰

| ID | æ¦‚è¦ | ãƒ•ã‚¡ã‚¤ãƒ« | å‡ºå…¸ |
|----|------|---------|------|
| I-27 | `useTerminalSetup` â€” `fitAddon.fit()` å¾Œã« `ResizePane` API å‘¼å‡ºæ¬ è½ã€‚ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ãŒåˆæœŸã‚µã‚¤ã‚ºéèªçŸ¥ | `frontend/src/hooks/useTerminalSetup.ts` | 2149 I-12 |
| I-28 | `useTerminalEvents.ts` â€” `enqueuePendingWrite` ã« disposed ã‚¬ãƒ¼ãƒ‰æœªå®Ÿè£…ã€‚ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—å¾Œã«term.write()å‘¼å‡ºãƒªã‚¹ã‚¯ | `frontend/src/hooks/useTerminalEvents.ts` | 2200 I-10 |
| I-29 | `searchAddonRef.current` â€” setup hook ã® effect å®Œäº†å‰ã« null ã®å¯èƒ½æ€§ã€‚state ãƒ™ãƒ¼ã‚¹ã¸ã®å¤‰æ›´æ¤œè¨ | `frontend/src/components/TerminalPane.tsx` | 2200 I-11 |
| I-30 | `BackendEventMap` â€” å…¨ãƒšã‚¤ãƒ­ãƒ¼ãƒ‰ãŒ `unknown` ã§å‹ä¿è¨¼ãªã—ã€‚æ®µéšçš„ã«å…·ä½“å‹ã‚’å®šç¾©ã™ã¹ã | `frontend/src/hooks/useBackendSync.ts` | 2210 I-1, 2200 S-14 |

---

## Important Issues â€” ãƒ†ã‚¹ãƒˆå“è³ªï¼ˆ13ä»¶ï¼‰

| ID | æ¦‚è¦ | ãƒ•ã‚¡ã‚¤ãƒ« | å‡ºå…¸ |
|----|------|---------|------|
| T-01 | `waitForCondition` ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ `2*time.Second` ã¸ã®å¤‰æ›´ç†ç”±ã‚³ãƒ¡ãƒ³ãƒˆãªã—ï¼ˆ3ç®‡æ‰€ï¼‰ | `app_events_test.go` | 2149 T-04, 2056-crosscut S-1, test-2056 S-3, test-quality I-4 |
| T-02 | `TestApplyLayoutPresetErrorPaths` â€” ãƒ†ã‚¹ãƒˆå "session has no windows" ã ãŒå®Ÿéš›ã¯ "session not found" ã‚’æ¤œè¨¼ | `app_pane_api_test.go` | 2149 T-03, test-2056 S-5 |
| T-03 | `TestResizePaneBoundaryValues` â€” å­˜åœ¨ã—ãªã„ãƒšã‚¤ãƒ³ã®ã¿ãƒ†ã‚¹ãƒˆã€‚cols=0/è² å€¤/æœ€å¤§å€¤ã®å®Ÿã‚µã‚¤ã‚ºå¢ƒç•Œå€¤ãªã— | `app_pane_api_test.go` | 2149 T-05, test-2056 S-6 |
| T-04 | `TestEmitSnapshot` â€” ã‚¤ãƒ™ãƒ³ãƒˆç™ºè¡Œæœ‰ç„¡ã®ã¿ç¢ºèªã€‚ãƒ‡ãƒ«ã‚¿ãƒšã‚¤ãƒ­ãƒ¼ãƒ‰ã®å†…å®¹ï¼ˆã‚»ãƒƒã‚·ãƒ§ãƒ³åç­‰ï¼‰æœªæ¤œè¨¼ | `app_events_test.go` | 2149 T-06 |
| T-05 | `requireSessionsWithPaneID` â€” TrimSpace å‰¯ä½œç”¨ï¼ˆãƒã‚¤ãƒ³ã‚¿çµŒç”±ã®æ›¸ãæˆ»ã—ï¼‰ãŒãƒ†ã‚¹ãƒˆã•ã‚Œã¦ã„ãªã„ | `app_guards.go` ãƒ†ã‚¹ãƒˆ | 2149 T-07 |
| T-06 | `TestCloneSessionSnapshotsIndependence` â€” Layout ãƒ„ãƒªãƒ¼å†å¸°ï¼ˆChildrenï¼‰ã®ç‹¬ç«‹æ€§ãƒ»Worktree ãƒãƒªã‚¨ãƒ¼ã‚·ãƒ§ãƒ³ä¸è¶³ | `app_snapshot_delta_test.go` | 2149 T-09, test-2056 S-7 |
| T-07 | `TestLegacyMapPaneOutputTypeMismatchLog` â€” å…±æœ‰ slog ãƒãƒƒãƒ•ã‚¡ã§ä¸¦åˆ—åŒ–æ™‚ã«ãƒ‡ãƒ¼ã‚¿ç«¶åˆãƒªã‚¹ã‚¯ | ãƒ†ã‚¹ãƒˆå„æ‰€ | 2149 T-01 |
| T-08 | `TestApplyModelTransformSkipsOnLoaderError` â€” `LOCALAPPDATA` ä¾å­˜ãƒ‘ã‚¹ï¼ˆWindows å°‚ç”¨ãªã‚‰å•é¡Œãªã—ï¼‰ | `model_transform_test.go` | test-2056 I-4, 2149 T-02 |
| T-09 | `TestApplyModelTransformSafeSwallowsLoaderError` â€” ãƒ†ã‚¹ãƒˆå "Safe" ã ãŒ "Skips/Swallows" ãŒæ­£ç¢º | `main_test.go` | test-2056 I-3 |
| T-10 | `TestParseCommandFlagEnvEqualsInValue` â€” `"PATH =/usr/bin"` ã®ã‚¹ãƒšãƒ¼ã‚¹æ··å…¥ã‚­ãƒ¼åã®ãƒˆãƒªãƒ æ¤œè¨¼ãŒæ›–æ˜§ | `main_test.go` | test-2056 I-5 |
| T-11 | `config_test.go` `TestSaveConcurrentWritesSerialized` â€” æ’ä»–åˆ¶å¾¡ã®æ­£å½“æ€§æœªæ¤œè¨¼ã€‚æœ€å¾Œã®å‹ã¡ãƒ‘ã‚¿ãƒ¼ãƒ³æ¨å¥¨ | `config_test.go` | test-quality I-2 |
| T-12 | `TestRunTransformSafePanicRecovery` â€” `Flags`/`Env`/`Args` ã®å®Œå…¨ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯æœªæ¤œè¨¼ | `main_test.go` | test-quality I-3 |
| T-13 | `copyConfigFilesToWorktree` â€” ã‚·ãƒ³ãƒœãƒªãƒƒã‚¯ãƒªãƒ³ã‚¯è„±å‡ºã®å®Ÿãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ çµ±åˆãƒ†ã‚¹ãƒˆä¸å®Œå…¨ | `app_worktree_api_test.go` | test-quality I-5 |

---

## Missing Test Coverageï¼ˆ10ä»¶ï¼‰

| ID | å¯¾è±¡ | ãƒ•ã‚¡ã‚¤ãƒ« | å‡ºå…¸ |
|----|------|---------|------|
| MC-01 | `session_manager_targets.go` â€” `ResolveDirectionalPane` å¢ƒç•Œå€¤ã€`ResolveTarget` RLockâ†’Lock ãƒ‘ã‚¹ | `session_manager_targets.go` | test-2056 I-1 |
| MC-02 | `stableWindowTarget` / `routerCommandError` â€” ãƒ˜ãƒ«ãƒ‘ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆä¸åœ¨ | `app_window_api.go` | test-quality MC-1 |
| MC-03 | `toString` / `toBytes` â€” nilãƒ»éstringå‹ã®ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ç›´æ¥ãƒ†ã‚¹ãƒˆä¸åœ¨ | `app_helpers.go` | test-quality MC-2 |
| MC-04 | `startPaneFeedWorker` â€” ãƒ‘ãƒ‹ãƒƒã‚¯ãƒªã‚«ãƒãƒªãƒ‘ã‚¹ãƒ†ã‚¹ãƒˆä¸åœ¨ | `app_pane_feed.go` | test-quality MC-3 |
| MC-05 | `startIdleMonitor` / `configureGlobalHotkey` â€” ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«ãƒ†ã‚¹ãƒˆä¸åœ¨ | `app_lifecycle.go` | test-quality MC-4 |
| MC-06 | Session/Window/Env ãƒãƒ³ãƒ‰ãƒ© â€” `handleAttachSession`, `handleShowEnvironment`, `handleSetEnvironment` ãƒ†ã‚¹ãƒˆç¢ºèªå¿…è¦ | `command_router_handlers_session.go` | test-quality MC-5, 2200 M-03/04/05 |
| MC-07 | `validateTargetFlag` / `validateRequired` / `validateNonNegativeSizeFlags` â€” å¢ƒç•Œå€¤ãƒ†ã‚¹ãƒˆä¸åœ¨ | `cmd/tmux-shim/parse.go` | test-quality MC-6, 2200 M-08 |
| MC-08 | `copySnapshotCache` â€” ãƒ‡ã‚£ãƒ¼ãƒ—ã‚³ãƒ”ãƒ¼ç‹¬ç«‹æ€§ãƒ†ã‚¹ãƒˆä¸åœ¨ | `app_snapshot_delta.go` | test-quality MC-7 |
| MC-09 | `DetachSession` â€” æ­£å¸¸ãƒ‘ã‚¹ãƒ†ã‚¹ãƒˆä¸åœ¨ã€‚`PickSessionDirectory` â€” ã‚¨ãƒ©ãƒ¼ãƒ‘ã‚¹æœªæ¤œè¨¼ | `app_config_api.go` | test-quality MC-8, 2200 M-07 |
| MC-10 | `RemoveWindowByID` â€” æˆ»ã‚Šå€¤å¤‰æ›´(3â†’4)ã«å¯¾ã™ã‚‹å…¨å‘¼å‡ºç®‡æ‰€ã®ãƒ†ã‚¹ãƒˆæ›´æ–°ç¢ºèª | `session_manager_test.go` | test-2056 I-2 |

---

## Suggestions â€” ã‚³ãƒ¼ãƒ‰ï¼ˆ26ä»¶ï¼‰

### Backend â€” Appå±¤

| ID | æ¦‚è¦ | ãƒ•ã‚¡ã‚¤ãƒ« | å‡ºå…¸ |
|----|------|---------|------|
| S-01 | `snapshotEventPolicy` ã® `trigger` ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ â€” å…¨ true ã§å†—é•·ã€‚`map[string]bool`(=bypassDebounce)ã§ååˆ† | `app_events.go` | 2149 S-01, 2200 S-01 |
| S-02 | `shutdown()` â€” `snapshotMu` ç‹¬ç«‹å–å¾—ã®æ„å›³ã‚’ã‚³ãƒ¡ãƒ³ãƒˆã§æ˜è¨˜ | `app_lifecycle.go` | 2149 S-03 |
| S-03 | IMPORTANT ã‚³ãƒ¡ãƒ³ãƒˆ x4 + `copySnapshotCache` Safety ã‚³ãƒ¡ãƒ³ãƒˆ â€” `TestSnapshotFieldCounts` ã§ä»£æ›¿å¯èƒ½ã€‚1è¡Œã«ç¸®å° | `app_snapshot_delta.go` | 2149 S-05/S-12, 2210 S-6 |
| S-04 | `snapshotMetrics` å®šæ•°ã® 13 è¡Œã‚³ãƒ¡ãƒ³ãƒˆ â€” åå‰ã‹ã‚‰è‡ªæ˜ãª 2 å®šæ•°ã¯çœç•¥å¯ | `app_snapshot_metrics.go` | 2149 S-06 |
| S-05 | `resolvePaneTitle` â€” é–¢æ•° doc ã®å„ªå…ˆåº¦è¡¨ã¨ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³ã‚³ãƒ¡ãƒ³ãƒˆã®äºŒé‡è¨˜è¼‰ | `app_status.go` | 2149 S-07 |
| S-06 | `resolveActiveWindowSnapshot` ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å®Ÿè¡Œæ™‚ãƒ­ã‚°ã‚’ Info ã¸æ˜‡æ ¼ | `app_snapshot_delta.go` | 2149 S-14 |
| S-07 | `handleLegacyMapPaneOutput` TODO ã‚’ Issue åŒ–ã—ã¦è¿½è·¡ | `app_events.go` | 2200 S-02 |
| S-08 | `paneOutputEventFromPayload` â€” å€¤å‹/ãƒã‚¤ãƒ³ã‚¿å‹ã®ä¸¡æ–¹ã‚’å—ã‘å…¥ã‚Œã‚‹ç†ç”±ã‚³ãƒ¡ãƒ³ãƒˆ | `app_events.go` | 2200 S-03 |
| S-09 | `SplitPane` NOTE ã‚³ãƒ¡ãƒ³ãƒˆã®æ­£ç¢ºæ€§å‘ä¸Š | `app_pane_api.go` | 2200 S-04 |
| S-10 | `estimateLayoutNodeSize` â€” Children ãŒå°†æ¥å¯å¤‰é•·ã«ãªã£ãŸæ™‚ã®ãƒªã‚¹ã‚¯æ³¨è¨˜ | `app_snapshot_metrics.go` | 2149 S-04 |

### Backend â€” internal/tmux

| ID | æ¦‚è¦ | ãƒ•ã‚¡ã‚¤ãƒ« | å‡ºå…¸ |
|----|------|---------|------|
| S-11 | `handleListPanes` â€” ã‚½ãƒ¼ãƒˆå‰Šé™¤å¾Œã€å‡ºåŠ›é †ãŒæš—é»™çš„ã«ã‚¹ãƒ©ã‚¤ã‚¹é †ã«ä¾å­˜ã€‚Index ãƒ™ãƒ¼ã‚¹ã‚½ãƒ¼ãƒˆè¿½åŠ æ¤œè¨ | `command_router_handlers_pane.go` | 2210 S-1 |
| S-12 | `emitLayoutChangedForSession` â€” ãƒ­ã‚°ãƒ¬ãƒ™ãƒ« Debugâ†’Warn å¤‰æ›´ã€‚æ­£å¸¸é·ç§»ãƒ‘ã‚¹ã§ Warn ãƒã‚¤ã‚ºç™ºç”Ÿã€‚Debug ç¶­æŒæ¨å¥¨ | `command_router_handlers_pane.go` | 2210 S-2, 2149 S-15 |
| S-13 | `resolveSessionTargetLocked` â€” Locked suffix ãŒ RLock ã§ã‚‚å®‰å…¨ã¨çŸ›ç›¾ã€‚å‘½åä¿®æ­£æ¤œè¨ | `session_manager_targets.go` | 2210 S-5 |
| S-14 | `activePaneInSessionRLocked` â€” å…¨ Window ãŒ nil æ™‚ã®ãƒ­ã‚°å‡ºåŠ›è¿½åŠ  | `session_manager_targets.go` | 2210 S-7 |
| S-15 | RLock/Lock ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ãƒ‘ã‚¿ãƒ¼ãƒ³ â€” ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—ã‚¢ãƒ—ãƒªã§ã¯å¸¸ã« Lock ã§ååˆ†ã€‚ç´„100è¡Œå‰Šæ¸›å¯èƒ½ | `session_manager_targets.go` | 2149 S-11 |
| S-16 | `validateTargetFlag` â€” 2ç®‡æ‰€ã‹ã‚‰3è¡ŒæŠ½å‡ºã€‚è¡Œæ•°å‰Šæ¸›ã«ãªã‚‰ãšåŠ¹æœè–„ã„ | `cmd/tmux-shim/parse.go` | 2149 S-09 |
| S-17 | `cloneSessionForRead` nil window/pane ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚° â€” invariant assertion æ¤œè¨ | `session_manager_sessions.go` | 2200 S-06 |
| S-18 | `handleAttachSession` ã‚³ãƒ¡ãƒ³ãƒˆçŸ›ç›¾ä¿®æ­£ | `command_router_handlers_session.go` | 2200 S-07 |
| S-19 | format string ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã‚’å®šæ•°åŒ– | å„ `handleListXxx` | 2200 S-09 |
| S-20 | `resolveDirectionalPane` â€” å°†æ¥ã®2æ¬¡å…ƒãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆå¯¾å¿œ TODO è¿½åŠ  | `command_router_handlers_display.go` | 2200 S-05 |
| S-21 | `applyFromToReplacement` â€” ç©ºæ–‡å­—åˆ—ã‚¹ã‚­ãƒƒãƒ—æ™‚ã« debugLog è¿½åŠ  | `cmd/tmux-shim/command_transform.go` | 2149 S-13 |

### Shim / Install

| ID | æ¦‚è¦ | ãƒ•ã‚¡ã‚¤ãƒ« | å‡ºå…¸ |
|----|------|---------|------|
| S-22 | `stalePathSubstring` â€” ãƒ†ã‚¹ãƒˆé–¢æ•°åä¾å­˜ã‚’ã‚³ãƒ¡ãƒ³ãƒˆã§æ–‡æ›¸åŒ– | `shim_cleanup_windows.go` | 2200 S-10 |
| S-23 | `strings.ToLower(stalePathSubstring)` â€” ãƒ«ãƒ¼ãƒ—å¤–ã§äº‹å‰è¨ˆç®— | `shim_cleanup_windows.go` | 2200 S-11 |
| S-24 | `resize-pane` spec ã« `-a` (adjustment) ãƒ•ãƒ©ã‚°è¿½åŠ æ¤œè¨ | `cmd/tmux-shim/spec.go` | 2200 S-13 |

### Frontend

| ID | æ¦‚è¦ | ãƒ•ã‚¡ã‚¤ãƒ« | å‡ºå…¸ |
|----|------|---------|------|
| S-25 | `ConfirmDialog` â€” `panelRef` ä¾å­˜é…åˆ—æ¬ è½ + Escape ã« `e.stopPropagation()` è¿½åŠ  | `ConfirmDialog.tsx` | 2149 S-16, 2200 S-15 |
| S-26 | `useTerminalEvents` â€” eslint-disable ã‚³ãƒ¡ãƒ³ãƒˆã«é™¤å¤– deps å…¨åˆ—æŒ™ | `useTerminalEvents.ts` | 2200 S-16 |
| S-27 | `useTerminalFontSize` â€” deps é…åˆ—ã‹ã‚‰å®‰å®š ref ã‚’é™¤å» | `useTerminalFontSize.ts` | 2200 S-17 |
| S-28 | `usePrefixKeyMode` â€” `currentIndex === -1` æ™‚ã®æŒ™å‹•ã‚³ãƒ¡ãƒ³ãƒˆè¿½åŠ  | `usePrefixKeyMode.ts` | 2200 S-18 |
| S-29 | `SearchBar` â€” ã‚¤ãƒ³ãƒ‡ãƒ³ãƒˆ 2â†’4 ã‚¹ãƒšãƒ¼ã‚¹çµ±ä¸€ | `SearchBar.tsx` | 2200 S-19 |
| S-30 | `SearchBar` â€” `safeAddonOp` ãŒå…¨ã‚¨ãƒ©ãƒ¼ã‚’ã‚­ãƒ£ãƒƒãƒã€‚å°†æ¥çš„ã«ã‚¨ãƒ©ãƒ¼å‹ã®çµã‚Šè¾¼ã¿æ¤œè¨ | `SearchBar.tsx` | 2056-crosscut S-2 |
| S-31 | TerminalPane Hook å®£è¨€é †åº â€” cleanup é †åºã®åˆ¶ç´„ã‚’ã‚³ãƒ¡ãƒ³ãƒˆã§æ˜è¨˜ | `TerminalPane.tsx` | 2056-crosscut S-5 |

---

## Suggestions â€” ãƒ†ã‚¹ãƒˆï¼ˆ10ä»¶ï¼‰

| ID | æ¦‚è¦ | ãƒ•ã‚¡ã‚¤ãƒ« | å‡ºå…¸ |
|----|------|---------|------|
| ST-01 | ãƒ†ã‚¹ãƒˆãƒ˜ãƒ«ãƒ‘ (`newTestApp`, `waitForCondition` ç­‰) ã‚’ `internal/testutil/` ã«é›†ç´„ | å…¨ãƒ†ã‚¹ãƒˆ | test-quality S-1 |
| ST-02 | struct ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚«ã‚¦ãƒ³ãƒˆã‚¬ãƒ¼ãƒ‰ãƒ†ã‚¹ãƒˆ â€” æœŸå¾…å€¤ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰åä¸€è¦§ã‚³ãƒ¡ãƒ³ãƒˆè¿½åŠ  | å„ãƒ†ã‚¹ãƒˆ | test-quality S-2 |
| ST-03 | ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸æ–‡å­—åˆ— `strings.Contains` â†’ `errors.Is` ãƒ‘ã‚¿ãƒ¼ãƒ³å°å…¥æ¤œè¨ï¼ˆé•·æœŸï¼‰ | å„ãƒ†ã‚¹ãƒˆ | test-quality S-3 |
| ST-04 | `TestLoadAgentModelConfigConcurrentAccess` â€” ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒŸã‚¹â†’ãƒ’ãƒƒãƒˆé·ç§»ã®è¦³å¯Ÿãƒ†ã‚¹ãƒˆè¿½åŠ  | `model_transform_test.go` | test-quality S-4 |
| ST-05 | `TestSnapshotDeltaConcurrentCallsRemainStable` â€” ãƒ†ã‚¹ãƒˆæ„å›³ã€Œãƒ‘ãƒ‹ãƒƒã‚¯ã—ãªã„ã“ã¨ã€ã‚’ã‚³ãƒ¡ãƒ³ãƒˆæ˜è¨˜ | `app_snapshot_delta_test.go` | test-quality S-5 |
| ST-06 | `resetModelConfigCache` ã‚¨ã‚¤ãƒªã‚¢ã‚¹ â€” `resetModelConfigLoadState` ã«çµ±ä¸€ | `model_transform_test.go` | 2200 S-12, test-2056 S-4 |
| ST-07 | `format_test.go` `newTestFixture()` â€” ãƒšã‚¤ãƒ³ Index:1 ã ãŒ Panes 1è¦ç´ ã€‚Index=0 or 2ãƒšã‚¤ãƒ³åŒ– | `format_test.go` | test-2056 S-1 |
| ST-08 | `parseControlKey` `C-[` ãƒ†ã‚¹ãƒˆåã‚’ã‚ˆã‚Šæ˜ç¢ºã«ï¼ˆãƒ†ãƒ¼ãƒ–ãƒ«å„ªå…ˆè§£æ±ºã®è¨­è¨ˆä»•æ§˜ï¼‰ | `key_table_test.go` | test-2056 S-2 |
| ST-09 | `list-sessions` â€” `CommandRouter` ãƒãƒ³ãƒ‰ãƒ©çµŒç”±ã® E2E ãƒ†ã‚¹ãƒˆè¿½åŠ  | ãƒ†ã‚¹ãƒˆå„æ‰€ | test-2056 S-8 |
| ST-10 | ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãƒ¬ãƒ™ãƒ«å¤‰æ•°ãƒ¢ãƒƒã‚­ãƒ³ã‚° â†’ DI ãƒ‘ã‚¿ãƒ¼ãƒ³ç§»è¡Œæ¤œè¨ï¼ˆ`t.Parallel()` æœ‰åŠ¹åŒ–ã®ãŸã‚ãƒ»é•·æœŸï¼‰ | å…¨ãƒ†ã‚¹ãƒˆ | test-quality I-1, 2200 S-20 |

---

## Confirmed OKï¼ˆå®‰å…¨æ€§ç¢ºèªæ¸ˆã¿ãƒ»å¯¾å¿œä¸è¦ï¼‰

| å¯¾è±¡ | çµè«– | å‡ºå…¸ |
|------|------|------|
| `handleNewSession` â€” `-d` ãƒ•ãƒ©ã‚°ã«é–¢ã‚ã‚‰ãš `session-created` ç™ºè¡Œ | âœ… æ­£ã—ã„ä¿®æ­£ã€‚`-d` ã¯ã€Œãƒ•ã‚©ã‚¢ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã«ã—ãªã„ã€ã§ã‚ã‚Šã€Œã‚¤ãƒ™ãƒ³ãƒˆã‚’æŠ‘åˆ¶ã™ã‚‹ã€ã§ã¯ãªã„ | 2210 I-5 |
| `ResolveTarget` â€” RLockâ†’Lock ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰é–“ã®ç«¶åˆ | âœ… `resolveTargetWriteLocked` ã§å®Œå…¨å†è§£æ±ºã€‚ãƒ­ã‚¸ãƒƒã‚¯å®‰å…¨ | 2210 I-7 |
| `ResolveDirectionalPane` â€” Lock ä½¿ç”¨ã®ç†ç”± | âœ… å†…éƒ¨ã§ `markStateMutationLocked` å‘¼å‡ºå¯èƒ½æ€§ã‚ã‚Šã€‚Write Lock æ­£å½“ | 2210 I-8 |
| `app.go` ãƒ­ãƒƒã‚¯é †åºãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ `snapshotDeltaMu â†’ snapshotMu` | âœ… å®£è¨€ã¨å®Ÿè£…ãŒä¸€è‡´ | 2210 I-9 |

---

## Positive Observationsï¼ˆå¥½è©•ç‚¹ã‚µãƒãƒªï¼‰

### ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ãƒ»è¨­è¨ˆ
- **`snapshotEventPolicies` ãƒ‡ãƒ¼ã‚¿é§†å‹•åŒ–**: switch æ–‡â†’ãƒãƒƒãƒ—ã€‚æ–°ã‚¤ãƒ™ãƒ³ãƒˆè¿½åŠ ãŒ1è¡Œã§æ¸ˆã‚€
- **TOCTOU ä¿®æ­£**: `ApplyLayoutPresetToActiveWindow` ã®ã‚¢ãƒˆãƒŸãƒƒã‚¯æ“ä½œåŒ–
- **`ResolveDirectionalPane` çµ±åˆ**: 3-lock TOCTOU â†’ 1 Lock ã§ã‚¢ãƒˆãƒŸãƒƒã‚¯å®Ÿè¡Œ
- **`requireSessionsWithPaneID` DRY åŒ–**: 7 ãƒ¡ã‚½ãƒƒãƒ‰ã®ãƒœã‚¤ãƒ©ãƒ¼ãƒ—ãƒ¬ãƒ¼ãƒˆçµ±ä¸€
- **`bestEffortSendKeys` / `buildPaneEnv`**: 3+2 ç®‡æ‰€ã®ãƒ­ã‚¸ãƒƒã‚¯é›†ç´„
- **ã‚¸ã‚§ãƒãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ç®¡ç†**: `generation` / `topologyGeneration` / `snapshotGeneration` ã®3å±¤ã‚­ãƒ£ãƒƒã‚·ãƒ¥
- **ãƒ­ãƒƒã‚¯é †åºãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ**: `snapshotDeltaMu â†’ snapshotMu` ã®æ˜ç¢ºãªæ–‡æ›¸åŒ–

### ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰
- **Hook è²¬å‹™åˆ†é›¢**: `useTerminalSetup` â†’ `useTerminalEvents` â†’ `useTerminalResize` â†’ `useTerminalFontSize`
- **`usePrefixKeyMode` Ref åŒæœŸå»ƒæ­¢**: `useTmuxStore.getState()` ã§ stale closure ãƒªã‚¹ã‚¯æ ¹æœ¬æ’é™¤
- **`resolveSessionState`**: ã‚¹ãƒˆã‚¢æ›´æ–°ãƒ­ã‚¸ãƒƒã‚¯ DRY åŒ–
- **`useWindowRename` äºŒé‡ç™ºç«ã‚¬ãƒ¼ãƒ‰**: `inflightWindowIdRef` + microtask reset
- **`Promise.allSettled` åˆæœŸåŒ–**: éæ±ºå®šçš„çŠ¶æ…‹æ›¸ãè¾¼ã¿æ’é™¤
- **å‹ãƒ‰ãƒªãƒ•ãƒˆè­¦å‘Š**: `tmux.ts` ã« Go struct å¤‰æ›´æ™‚ã®æ›´æ–°ãƒ«ãƒ¼ãƒ«æ˜è¨˜

### Shim
- **å¤‰æ›å¤±æ•—æ™‚ã®åŸæ–‡è»¢é€**: spec æº–æ‹ ã®å …ç‰¢è¨­è¨ˆ
- **`ALL` ãƒ¯ã‚¤ãƒ«ãƒ‰ã‚«ãƒ¼ãƒ‰**: override å„ªå…ˆåº¦ã®æ­£ç¢ºãªå®Ÿè£…
- **ãƒ¬ã‚¬ã‚·ãƒ¼ PATH ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—**: allowlist + å†ªç­‰æ€§

### ãƒ†ã‚¹ãƒˆ
- **ãƒ†ãƒ¼ãƒ–ãƒ«é§†å‹•ãƒ†ã‚¹ãƒˆ**: å…¨ãƒ•ã‚¡ã‚¤ãƒ«ã§ä¸€è²«æ¡ç”¨ï¼ˆ21ã‚³ãƒãƒ³ãƒ‰Ã—è¤‡æ•°ãƒ•ãƒ©ã‚°ç­‰ï¼‰
- **ãƒ‡ã‚£ãƒ¼ãƒ—ã‚³ãƒ”ãƒ¼ç‹¬ç«‹æ€§ãƒ†ã‚¹ãƒˆ**: 10ä»¶ä»¥ä¸Šã®è¿”å´å€¤å¤‰æ›´éæ³¢åŠãƒ†ã‚¹ãƒˆ
- **struct ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚«ã‚¦ãƒ³ãƒˆã‚¬ãƒ¼ãƒ‰**: 6ç¨®é¡ã® struct ã§ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰è¿½åŠ æ¼ã‚Œè‡ªå‹•æ¤œçŸ¥
- **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ†ã‚¹ãƒˆ**: ãƒ‘ã‚¹ãƒˆãƒ©ãƒãƒ¼ã‚µãƒ«ã€symlink è„±å‡ºã€ãƒŒãƒ«ãƒã‚¤ãƒˆæ³¨å…¥
- **EventsOn cancel ç®¡ç†**: å…¨ `useEffect` ã«åŒ…æ‹¬çš„ cleanup
- **ConPTY ãƒªãƒ¼ã‚¯é˜²æ­¢ãƒ†ã‚¹ãƒˆ**: Terminal å‚ç…§ä¿æŒæ¤œè¨¼

---

## ä¸¦åˆ—ä½œæ¥­è¡¨

ä½œæ¥­è€…ãŒåŠ¹ç‡ã‚ˆãä¿®æ­£ã«ã‚ãŸã‚Œã‚‹ã‚ˆã†ã€ãƒ•ã‚¡ã‚¤ãƒ«ç«¶åˆãƒ»ä¾å­˜é–¢ä¿‚ã‚’åŸºæº–ã«ä¸¦åˆ—ä½œæ¥­å¯å¦ã‚’æ•´ç†ã€‚

### å‡¡ä¾‹

| è¨˜å· | æ„å‘³ |
|------|------|
| âœ… | ä»–ã‚¿ã‚¹ã‚¯ã¨ç‹¬ç«‹ã—ã¦ä¸¦åˆ—å®Ÿè¡Œå¯èƒ½ |
| âš ï¸ | åŒä¸€ãƒ•ã‚¡ã‚¤ãƒ«ã®åˆ¥ã‚¿ã‚¹ã‚¯ã¨ãƒãƒ¼ã‚¸ç«¶åˆæ³¨æ„ |
| ğŸ”— | å…ˆè¡Œã‚¿ã‚¹ã‚¯ã®å®Œäº†å¾Œã«ç€æ‰‹ |

---

### Phase 1: Critical + é«˜å„ªå…ˆ Importantï¼ˆæœ€å„ªå…ˆãƒ»ä¸¦åˆ—å®Ÿè¡Œå¯èƒ½ï¼‰

| ã‚°ãƒ«ãƒ¼ãƒ— | ã‚¿ã‚¹ã‚¯ ID | æ¦‚è¦ | å¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ« | ä¸¦åˆ— | å‚™è€ƒ |
|---------|----------|------|------------|------|------|
| **P1-A** | C-01 | `DirNone` ã‚¼ãƒ­å€¤è¿½åŠ  | `session_manager_targets.go` | âœ… | å°è¦æ¨¡ |
| **P1-B** | C-02 | `activeWindowId` å‰Šé™¤ or å®Ÿè£… | `tmuxStore.ts`, `useBackendSync.ts` | âœ… | FEç‹¬ç«‹ |
| **P1-C** | C-03 + C-04 | `applyNewProcessTransform` / `applySendKeysTransform` ãƒ†ã‚¹ãƒˆè¿½åŠ  | `command_transform_test.go` | âœ… | ãƒ†ã‚¹ãƒˆè¿½åŠ ã®ã¿ |
| **P1-D** | I-07 | `KillPane` Terminal.Close() è¿½åŠ  | `command_router_handlers_pane.go` | âš ï¸ P2-A | å°è¦æ¨¡ |
| **P1-E** | I-14 | `emitWorktreeCleanupFailure` ctx nil å¯¾å¿œ | `app_events.go` | âœ… | å°è¦æ¨¡ |
| **P1-F** | I-25 | `CleanupLegacyShimInstalls` æˆ»ã‚Šå€¤ä¿®æ­£ | `shim_cleanup_windows.go` | âœ… | å°è¦æ¨¡ |
| **P1-G** | I-22 + I-23 | ãƒ­ã‚°ãƒ¬ãƒ™ãƒ«ä¿®æ­£ï¼ˆ2ç®‡æ‰€ï¼‰ | å„ãƒ•ã‚¡ã‚¤ãƒ« | âœ… | å°è¦æ¨¡ |

---

### Phase 2: ãƒ©ã‚¤ãƒ–ãƒã‚¤ãƒ³ã‚¿çµ±ä¸€ä¿®æ­£ï¼ˆ1åã§é›†ä¸­ä½œæ¥­æ¨å¥¨ï¼‰

| ã‚¿ã‚¹ã‚¯ ID | æ¦‚è¦ | å¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ« | ä¸¦åˆ— |
|----------|------|------------|------|
| I-01 | `handleSelectWindow` TOCTOU | `command_router_handlers_window.go` | âš ï¸ I-04, I-16 |
| I-03 | `splitWindowResolved` snapshotåŒ– | `command_router_handlers_pane.go` | âš ï¸ I-05, I-06, I-07 |
| I-04 | `handleListWindows` snapshotåŒ– | `command_router_handlers_window.go` | âš ï¸ I-01, I-16 |
| I-05 | `handleResizePane` snapshotåŒ– | `command_router_handlers_pane.go` | âš ï¸ I-03, I-06 |
| I-06 | `handleSendKeys` ã‚¢ãƒˆãƒŸãƒƒã‚¯åŒ– | `command_router_handlers_pane.go` | âš ï¸ I-03, I-05 |
| I-02 | `bestEffortSendKeys` docã‚³ãƒ¡ãƒ³ãƒˆ | `command_router.go` | âœ… |
| I-16 | `handleNewWindow` ãƒšã‚¤ãƒ³ã‚µã‚¤ã‚º | `command_router_handlers_window.go` | âš ï¸ I-01, I-04 |

> **æ¨å¥¨**: command_router_handlers_pane.go (I-03/05/06/07) ã¨ command_router_handlers_window.go (I-01/04/16) ã‚’åˆ†ã‘ã¦2åã§ä¸¦åˆ—ä½œæ¥­å¯èƒ½ã€‚

---

### Phase 3: é˜²å¾¡çš„ä¿®æ­£ + ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆï¼ˆå…¨ä¸¦åˆ—OKï¼‰

| ã‚°ãƒ«ãƒ¼ãƒ— | ã‚¿ã‚¹ã‚¯ ID | æ¦‚è¦ | å¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ« | ä¸¦åˆ— |
|---------|----------|------|------------|------|
| **P3-A** | I-10 | `ResolveDirectionalPane` panes[0] nil ãƒã‚§ãƒƒã‚¯ | `session_manager_targets.go` | âœ… (ğŸ”—C-01å¾Œ) |
| **P3-B** | I-11 | `requireSessionsWithPaneID` nil ã‚¬ãƒ¼ãƒ‰ + doc | `app_guards.go` | âœ… |
| **P3-C** | I-12 | `applyModelOverride` ç©º model= ã‚¬ãƒ¼ãƒ‰ | `command_transform.go` | âœ… |
| **P3-D** | I-13 | `buildPaneEnv` blockedKey ãƒ•ã‚£ãƒ«ã‚¿çµ±ä¸€ | `command_router.go` | âœ… |
| **P3-E** | I-15 + S-01 | `snapshotEventPolicies` immutableåŒ–/ç°¡ç´ åŒ– | `app_events.go` | âœ… (ğŸ”—I-14å¾Œ) |
| **P3-F** | I-20 + I-21 | `snapshotMu` ãƒ­ãƒƒã‚¯é †åº + `removed` ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ | `app_snapshot_delta.go`, `tmux.ts` | âœ… |
| **P3-G** | I-24 | `applyModelTransformSafe` unreachable branch æ•´ç† | `model_transform.go` | âœ… |
| **P3-H** | I-26 | model_transform ãƒ€ãƒ–ãƒ«ã‚¹ã‚­ãƒ£ãƒ³æœ€é©åŒ– | `model_transform.go` | âš ï¸ P3-G |

---

### Phase 4: ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ä¿®æ­£ï¼ˆãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã¨å®Œå…¨ç‹¬ç«‹ãƒ»å…¨ä¸¦åˆ—OKï¼‰

| ã‚¿ã‚¹ã‚¯ ID | æ¦‚è¦ | å¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ« | ä¸¦åˆ— |
|----------|------|------------|------|
| I-27 | åˆæœŸ ResizePane å‘¼å‡ºè¿½åŠ  | `useTerminalSetup.ts` | âœ… |
| I-28 | `enqueuePendingWrite` disposed ã‚¬ãƒ¼ãƒ‰ | `useTerminalEvents.ts` | âœ… |
| I-29 | `searchAddon` state ãƒ™ãƒ¼ã‚¹åŒ– | `TerminalPane.tsx`, `useTerminalSetup.ts` | âœ… |
| I-30 | `BackendEventMap` å‹å®šç¾©å…·ä½“åŒ– | `useBackendSync.ts` | âœ… |
| S-25ã€œS-31 | Suggestionå„ç¨® | å„ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ | âœ… |

---

### Phase 5: ãƒ†ã‚¹ãƒˆå“è³ªæ”¹å–„ï¼ˆå…¨ä¸¦åˆ—OKï¼‰

| ã‚¿ã‚¹ã‚¯ ID | æ¦‚è¦ | å¯¾è±¡ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ« | ä¸¦åˆ— |
|----------|------|------------------|------|
| T-01 | waitForCondition ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆç†ç”±ã‚³ãƒ¡ãƒ³ãƒˆ | `app_events_test.go` | âœ… |
| T-02 | TestApplyLayoutPresetErrorPaths ãƒ†ã‚¹ãƒˆåä¿®æ­£ | `app_pane_api_test.go` | âœ… |
| T-03 | TestResizePaneBoundaryValues å¢ƒç•Œå€¤è¿½åŠ  | `app_pane_api_test.go` | âš ï¸ T-02 |
| T-04 | TestEmitSnapshot ãƒšã‚¤ãƒ­ãƒ¼ãƒ‰æ¤œè¨¼è¿½åŠ  | `app_events_test.go` | âš ï¸ T-01 |
| T-05 | requireSessionsWithPaneID TrimSpace ãƒ†ã‚¹ãƒˆ | `app_guards_test.go` | âœ… |
| T-06 | TestCloneSessionSnapshotsIndependence æ‹¡å…… | ãƒ†ã‚¹ãƒˆå„æ‰€ | âœ… |
| T-07ã€œT-13 | ãã®ä»–ãƒ†ã‚¹ãƒˆæ”¹å–„ | å„ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ« | âœ… |
| MC-01ã€œMC-10 | Missing Coverage è¿½åŠ  | å„ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ« | âœ… |

---

### Phase 6: è¨­è¨ˆåˆ¤æ–­ãŒå¿…è¦ï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼ç¢ºèªå¾Œã«ç€æ‰‹ï¼‰

| ã‚¿ã‚¹ã‚¯ ID | æ¦‚è¦ | åˆ¤æ–­ãƒã‚¤ãƒ³ãƒˆ |
|----------|------|------------|
| I-08 | `Snapshot()` RLock å†…ã‚¯ãƒ­ãƒ¼ãƒ³ã‚³ã‚¹ãƒˆæœ€é©åŒ– | COW ãƒ‘ã‚¿ãƒ¼ãƒ³ã¸ã®ç§»è¡Œå¯å¦ |
| I-09 | `cleanupStalePathEntries` æ¯èµ·å‹•å®Ÿè¡Œã®æœ€é©åŒ– | ãƒ•ãƒ©ã‚°ãƒ•ã‚¡ã‚¤ãƒ«æ–¹å¼ or åˆå›ã®ã¿ |
| I-18 | `ListPanesByWindowTarget` Lockâ†’RLock å¤‰æ›´ | auto-repair ãƒ‘ã‚¹ã®æœ‰ç„¡ |
| I-19 | `RemoveWindowByID` 4æˆ»ã‚Šå€¤ â†’ æ§‹é€ ä½“åŒ– | æ¬¡å›å¤‰æ›´ã‚¿ã‚¤ãƒŸãƒ³ã‚°å¾…ã¡ã‚‚åˆç†çš„ |
| S-15 | RLock/Lock ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ç°¡ç´ åŒ– | ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹è¦ä»¶ç¢ºèªå¾Œ |
| ST-10 | DI ãƒ‘ã‚¿ãƒ¼ãƒ³ç§»è¡Œï¼ˆt.Parallel æœ‰åŠ¹åŒ–ï¼‰ | ãƒ†ã‚¹ãƒˆå®Ÿè¡Œæ™‚é–“ãŒå•é¡Œã«ãªã£ãŸæ®µéš |

---

### ä¸¦åˆ—å®Ÿè¡Œã‚µãƒãƒªï¼ˆä½œæ¥­è€…å‰²ã‚Šå½“ã¦ä¾‹ï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Phase 1 (æœ€å„ªå…ˆ â€” å…¨ã‚°ãƒ«ãƒ¼ãƒ—ä¸¦åˆ—OK)                               â”‚
â”‚  ä½œæ¥­è€…1: P1-A (C-01) + P1-D (I-07) + P1-G (ãƒ­ã‚°)              â”‚
â”‚  ä½œæ¥­è€…2: P1-B (C-02) + Phase 4 FEä¿®æ­£ å…¨ã¦                     â”‚
â”‚  ä½œæ¥­è€…3: P1-C (C-03/04) + P1-F (I-25)                         â”‚
â”‚  ä½œæ¥­è€…4: P1-E (I-14) + P3-E (snapshotEventPolicies)           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Phase 2 (ãƒ©ã‚¤ãƒ–ãƒã‚¤ãƒ³ã‚¿çµ±ä¸€ â€” 1-2åã§é›†ä¸­)                        â”‚
â”‚  ä½œæ¥­è€…1: pane handlers (I-03/05/06) + I-02 doc                 â”‚
â”‚  ä½œæ¥­è€…2: window handlers (I-01/04/16)                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Phase 3 (é˜²å¾¡çš„ä¿®æ­£ â€” å…¨ä¸¦åˆ—OK)                                  â”‚
â”‚  å„ã‚¿ã‚¹ã‚¯ç‹¬ç«‹ â†’ è¤‡æ•°åã§åˆ†æ‹…å¯èƒ½                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Phase 4 (FE) + Phase 5 (ãƒ†ã‚¹ãƒˆ) â€” Phase 1-3 ã¨ä¸¦åˆ—å®Ÿè¡Œå¯èƒ½        â”‚
â”‚  FE: Phase 1 ã® C-02 å®Œäº†å¾Œã«ç€æ‰‹                                â”‚
â”‚  ãƒ†ã‚¹ãƒˆ: C-03/04 å®Œäº†å¾Œã€è¿½åŠ ãƒ†ã‚¹ãƒˆä½œæ¥­                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Phase 6 (è¨­è¨ˆåˆ¤æ–­) â€” ãƒ¦ãƒ¼ã‚¶ãƒ¼ç¢ºèªå¾Œã«ç€æ‰‹                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```
