# Code Review: myT-x/ Pre-Commit Review

- **日付**: 2026-02-19 01:11
- **対象**: `myT-x/` 配下の差分（63ファイル、+5,686 / -2,712行）
- **レビュー方法**: カテゴリ別並列レビュー（7エージェント）

---

## サマリ

| 重要度 | 件数 | 概要 |
|--------|------|------|
| **Critical** | 1 | tmux-shim debugLog再帰リスク |
| **Important** | 18 | ワーカー通知欠如、型安全性、ロック・設計課題 |
| **Suggestion** | 22 | コメント改善、可読性向上、コード簡素化 |

---

## Critical (修正必須)

### C-01: pruneRotatedShimDebugLogs 内の debugLog 再帰リスク

- **ファイル**: `myT-x/cmd/tmux-shim/main.go` L228–L232
- **カテゴリ**: tmux-shim
- **問題**: `rotateShimDebugLogIfNeeded` → `pruneRotatedShimDebugLogs` の中のログ出力行（L322: `debugLog("skip rotated shim debug log with invalid unix timestamp: %s", name)`）が `debugLog` を呼び出し、`debugLog` は `rotateShimDebugLogIfNeeded` を呼ぶ。ローテーション → prune → 不正ファイル名 → debugLog → 再度ローテーション…の循環が理論上成立する。
- **影響**: shim-debug ディレクトリに不正名のファイルが存在する場合、無限再帰によるスタックオーバーフロー（実際には `rotateShimDebugLogIfNeeded` の `info.Size() < maxBytes` で通常は止まるが、ちょうどサイズ上限のタイミングで再帰する可能性あり）
- **修正案**: `pruneRotatedShimDebugLogs` 内のログを `debugLogFallback` に変更するか、`log.New(os.Stderr, ...)` で直接出力する。

```go
// Before
debugLog("skip rotated shim debug log with invalid unix timestamp: %s", name)

// After
log.New(os.Stderr, "[DEBUG-SHIM] ", log.LstdFlags).Printf(
    "skip rotated shim debug log with invalid unix timestamp: %s", name)
```

---

## Important (対応推奨)

### I-01: ワーカー最大リトライ到達時にフロントエンドへ通知なし

- **ファイル**: `myT-x/app_pane_feed.go` L108–L110, `myT-x/app_lifecycle.go` L245–L247
- **カテゴリ**: App層
- **問題**: `pane-feed-worker` と `idle-monitor` の両ワーカーで `maxPanicRestartRetries`（10回）到達後、`slog.Error` のみでフロントエンドに状態が通知されない。ワーカーは終了し、ユーザーはUIで問題に気づけない。
- **修正案**: 最大リトライ到達時に `tmux:worker-fatal` イベントを発行する。

```go
slog.Error("[DEBUG-PANIC] pane-feed-worker exceeded max retries, giving up",
    "maxRetries", maxPanicRestartRetries)
if ctx := a.runtimeContext(); ctx != nil {
    a.emitRuntimeEventWithContext(ctx, "tmux:worker-fatal", map[string]any{
        "worker": "pane-feed-worker",
    })
}
```

### I-02: snapshotEventPolicies の trigger フィールドが全て true

- **ファイル**: `myT-x/app_events.go` L121–L133
- **カテゴリ**: App層（設計）
- **問題**: `snapshotEventPolicies` マップの全エントリで `trigger: true`。`trigger: false` のイベントを追加すると `shouldEmitSnapshotForEvent` が `ok && policy.trigger` を返すため機能するが、現時点で `trigger` フィールドに差別化がなく、将来の追加者が `trigger: false` のエントリを追加して「マップに存在するだけで trigger される」と誤解するリスクがある。
- **修正案**: マップのキーに存在すること自体を trigger の意味とし、`trigger` フィールドを削除する。または、ドキュメントコメントで `trigger: false` の用途を記載する。

```go
// Option A: trigger フィールドを削除しキー存在で判定
type snapshotEventPolicy struct {
    bypassDebounce bool
}

// Option B: コメントで明確化（最小変更）
// trigger=false entries are intentionally supported: they register an event
// name in the policy map without triggering snapshot emission, useful for
// events that only need bypassDebounce semantics in the future.
```

### I-03: setActiveSession が activeWindowId を更新しない

- **ファイル**: `myT-x/frontend/src/stores/tmuxStore.ts` L109
- **カテゴリ**: Frontend
- **問題**: `setActiveSession` は `set({activeSession})` のみで `activeWindowId` を更新しない。`setSessions` / `applySessionDelta` は `resolveSessionState` 経由で `activeWindowId` も再計算するが、`setActiveSession` 単体呼び出しでは stale な `activeWindowId` が残る。
- **影響**: `tmux:active-session` イベント経由で `setActiveSession` が呼ばれた際、前のセッションの `activeWindowId` が残り、ウィンドウ表示が不整合になる可能性。
- **修正案**: `setActiveSession` でも `activeWindowId` を再計算する。

```typescript
setActiveSession: (activeSession) =>
    set((state) => {
        const snap = activeSession
            ? state.sessions.find((s) => s.name === activeSession) ?? null
            : null;
        const rawWindowId = snap?.active_window_id;
        const activeWindowId = typeof rawWindowId === "number"
            ? String(rawWindowId)
            : null;
        return {activeSession, activeWindowId};
    }),
```

### I-04: GetConfigAndFlushWarnings catch 後の config 状態

- **ファイル**: `myT-x/frontend/src/hooks/useBackendSync.ts` L108–L116
- **カテゴリ**: Frontend
- **問題**: `GetConfigAndFlushWarnings` の `.catch` ブロックで `notifyWarn` は呼ぶが `setConfig` を呼ばない。`config` は `null` のまま。後続の `config:updated` イベントで回復可能だが、そのイベントが来るまでコンポーネントが `config === null` で動作し続ける。
- **修正案**: 各コンポーネントが `config === null` ガードを持つことを確認するか、catch ブロックでデフォルト config を設定する。

### I-05: applySessionDelta の upserts ランタイム検証不足

- **ファイル**: `myT-x/frontend/src/stores/tmuxStore.ts` L97
- **カテゴリ**: Frontend
- **問題**: `applySessionDelta` の `upserts` 配列内の個別要素に対する null/undefined チェックがない。`session.name` が undefined の場合、`Map` のキーが `"undefined"` 文字列になる。
- **影響**: バックエンドが不正ペイロードを送信した場合にゴーストセッションが表示される可能性。
- **修正案**: `upserts.filter(s => s && typeof s.name === "string")` のフィルタ追加。

### I-06: useBackendSync の configEventVersionRef による初回 API レスポンス棄却

- **ファイル**: `myT-x/frontend/src/hooks/useBackendSync.ts` L108–L112
- **カテゴリ**: Frontend
- **問題**: `config:updated` イベントが `GetConfigAndFlushWarnings` API レスポンスより先に到着し `configEventVersionRef.current > 0` になった場合、API レスポンスが棄却される。これは意図的な設計だが、もし `config:updated` イベントのペイロードが不正（`isAppConfigPayload` 失敗）だった場合、API レスポンスが破棄されつつイベントも反映されず、`config` が `null` のままになる。
- **修正案**: コメントで「config:updated イベントのパースに失敗しても API レスポンスは棄却される」動作を明記する。

### I-07: ensureShimReady 内の err 変数上書き

- **ファイル**: `myT-x/app_lifecycle.go` L143, L168
- **カテゴリ**: App層
- **問題**: L143 の `needsShimInstallFn()` から返る `err` と、L168 の2回目の `needsShimInstallFn()` から返る `err` が同じ変数名。L153 の `needsInstallBefore && eventCtx != nil` 評価は最初の `err` を参照する意図だが、実際には `installErr` (L148) の後に `err` は使われていないため即座の実害はない。可読性の問題。
- **修正案**: L168 の変数名を `postCheckErr` 等に変更。

```go
needsInstallAfter, postCheckErr := needsShimInstallFn()
if postCheckErr != nil {
    slog.Warn("[shim] post-install check failed", "error", postCheckErr)
}
if a.router != nil {
    a.router.SetShimAvailable(!needsInstallAfter && postCheckErr == nil)
}
```

### I-08: pane-feed-worker の runtimeContext() 二重呼び出し

- **ファイル**: `myT-x/app_pane_feed.go` L92–L97
- **カテゴリ**: App層
- **問題**: L92 で `a.runtimeContext()` を nil チェックし、L97 で再度 `a.runtimeContext()` を呼ぶ。2回目の呼び出し時点で nil になる可能性（シャットダウン中）は低いが、ローカル変数に保持すべき。
- **修正案**: L92 で取得した値を L97 でも使用。

```go
if rtCtx := a.runtimeContext(); rtCtx == nil {
    slog.Info("[DEBUG-PANIC] pane-feed-worker: runtimeContext nil, stopping restart")
    return
}
// ...
a.emitRuntimeEventWithContext(rtCtx, "tmux:worker-panic", ...)
```

### I-09: ウィンドウインデックス検索パターンの重複

- **ファイル**: `myT-x/internal/tmux/session_manager_windows.go` L82–L89 (`RemoveWindowByID`), L207–L214 (`RenameWindowByID`), L239–L243 (`WindowIndexInSession`)
- **カテゴリ**: internal/tmux
- **問題**: `session.Windows` を `for i, window := range` でイテレートし `window.ID == windowID` を検索するパターンが3箇所で重複。
- **修正案**: `findWindowIndexByID(windows []*TmuxWindow, id int) int` ヘルパーを抽出。

### I-10: emitWorktreeCleanupFailure のサイレントドロップ

- **ファイル**: `myT-x/app_session_api.go` L191–L200
- **カテゴリ**: App層
- **問題**: `runtimeContext()` が nil の場合、worktree クリーンアップ失敗イベントがドロップされる。`slog.Warn` でログ記録はされるが、フロントエンドへの通知が欠落する。
- **修正案**: シャットダウン中のドロップは意図的であることをコメントに明記。

```go
// NOTE: シャットダウン中はフロントエンドへの通知は不可能かつ不要。
// ドロップをログに記録するだけで十分。
```

### I-11: removeWindowAtIndexLocked の Terminal.Close 責務委譲

- **ファイル**: `myT-x/internal/tmux/session_manager_windows.go` L130–L158
- **カテゴリ**: internal/tmux
- **問題**: `removeWindowAtIndexLocked` が `removedPanes` を返し、呼び出し元が `Terminal.Close()` を行う設計。呼び出し元が `Close()` を忘れるとリソースリーク。
- **修正案**: コメントは既に記載済み。呼び出し元（`command_router_windows.go` の `handleKillWindow` 等）で Close が漏れていないか確認するテストケース追加を推奨。

### I-12: needsInstallBefore の暗黙的 false 値

- **ファイル**: `myT-x/app_lifecycle.go` L143–L153
- **カテゴリ**: App層
- **問題**: `needsShimInstallFn()` が `err != nil` を返した場合、`needsInstallBefore` はデフォルト `false`。L153 で `needsInstallBefore && eventCtx != nil` を評価するため、`err` 時にイベントが発行されない。結果として初回インストール検出失敗時に `tmux:shim-installed` イベントが出ない。
- **影響**: 実害は薄い（エラー時は shim-installed よりも shim-install-failed が適切）が、暗黙依存がある。
- **修正案**: コメント追加で意図を明記。

### I-13: ワーカー最終リトライ到達パターンが2箇所で同一

- **ファイル**: `myT-x/app_pane_feed.go` L70–L110, `myT-x/app_lifecycle.go` L206–L247
- **カテゴリ**: App層（設計）
- **問題**: `pane-feed-worker` と `idle-monitor` の panic recovery + retry ループが構造的に同一コード。将来片方のみを修正して不整合になるリスク。
- **修正案**: 共通の `runBackgroundWorker(ctx, name, fn)` ヘルパーを抽出。ただし現時点で2箇所のみのため、コメントで相互参照を記載する最小対応でも可。

### I-14: getConfigInternalUnsafe の本番利用箇所不明

- **ファイル**: `myT-x/app_config_state.go` L14–L22
- **カテゴリ**: App層
- **問題**: `getConfigInternalUnsafe` は WARNING コメント付きの最適化メソッド。現在の diff で本番コードからの呼び出し元が確認できない。テスト専用なら test ファイルに移動すべき。
- **修正案**: 呼び出し元を確認し、本番未使用ならテストヘルパーに移動。

### I-15: DefaultPipeName の "unknown" フォールバック衝突

- **ファイル**: `myT-x/internal/ipc/protocol.go` L48–L58
- **カテゴリ**: internal/ipc
- **問題**: `USERNAME` 空 + `user.Current()` 失敗の場合、パイプ名が `\\.\pipe\myT-x-unknown` となり、複数ユーザーが同条件なら衝突する。
- **影響**: デスクトップアプリとしてはWindowsで USERNAME が空になるケースは極めて稀。実害なし。
- **修正案**: コメントで "unknown" フォールバックの仕様と衝突リスクを明記。

### I-16: requireSessionsWithPaneID の nil ポインタ引数

- **ファイル**: `myT-x/app_guards.go` L27–L37
- **カテゴリ**: App層
- **問題**: `paneID *string` が nil ポインタの場合、L28 の `*paneID = strings.TrimSpace(...)` でパニック。公開 API はフロントエンドからの呼び出しなので nil ポインタにはならないが、内部利用で `nil` を渡した場合に不親切。
- **修正案**: nil ガードを追加するか、godoc コメントに「paneID は非 nil であること」を明記。

### I-17: pane-feed-worker チャネルフルの TOCTOU

- **ファイル**: `myT-x/app_pane_feed.go` L126–L134
- **カテゴリ**: App層
- **問題**: `enqueuePaneStateFeed` で `select { case ch <- item: default: }` を使用し、チャネルフル時にダイレクトフィードにフォールバック。チャネルフル判定と `Feed()` の間にワーカーがチャネルから読み出す可能性があるが、ダイレクトフィード自体はスレッドセーフであるため実害なし。ただし、チャネルフル時のダイレクトフィードとワーカーによる通常フィードの順序が保証されない。
- **修正案**: 出力順序は xterm.js がバッファするため実質問題ないが、設計意図としてコメントを追加。

### I-18: テストの coverage gap — session_manager_targets.go

- **ファイル**: `myT-x/internal/tmux/session_manager_targets.go`
- **カテゴリ**: テスト
- **問題**: `ResolveDirectionalPane`（方向キー移動）が新規追加されたが、テストファイルでの網羅が不足。特に
  - 2ペインの上下/左右移動
  - ペインが1つのみの場合（自ペイン返却）
  - 無効な方向指定のエラーケース
- **修正案**: テーブルドリブンテストを追加。

---

## Suggestion (改善提案)

### S-01: snapshotEventPolicies のコメント改善
- **ファイル**: `myT-x/app_events.go` L115–L118
- `snapshotEventPolicies` のドキュメントコメントに「新規イベント追加時はここにエントリを追加する」旨をより目立つ形で記載。

### S-02: copySnapshotCache の安全性コメント
- **ファイル**: `myT-x/app_snapshot_delta.go` L179–L191
- IMPORTANT コメントにフィールド追加時の deep copy 要件が記載されているが、CI チェックで自動検出する方法の提案もあると良い。

### S-03: toBytes の型サポート範囲をドキュメント化
- **ファイル**: `myT-x/app_helpers.go` L17–L25
- 現在 `nil`, `[]byte`, `string` のみサポート。godoc コメントでサポート型を明記する。

### S-04: debugLogFallbackMessage の trimmed 空チェック
- **ファイル**: `myT-x/cmd/tmux-shim/main.go` L96–L107
- 空白のみの場合に `TrimSpace` 後に空文字チェックしているが、呼び出し元の `debugLog` で `fmt.Sprintf` の結果は通常空にならない。防御コードとして適切だが、到達不能パスである旨のコメント追加。

### S-05: shutdown 内の snapshotRequestGeneration リセット
- **ファイル**: `myT-x/app_lifecycle.go` L177–L180
- `snapshotRequestGeneration = 0` と `snapshotRequestDispatched = 0` をリセットしているが、再起動シナリオがない（プロセス終了）ため不要。ただし念のための防御として問題なし。

### S-06: configureGlobalHotkey の二重チェック
- **ファイル**: `myT-x/app_lifecycle.go` L288–L292
- `a.hotkeys == nil` チェックと `!cfg.QuakeMode` チェックの2つの early return が独立。コメントで両方の意図を説明すると可読性向上。

### S-07: toggleQuakeWindow の CAS ガード説明
- **ファイル**: `myT-x/app_lifecycle.go` L313–L316
- `CompareAndSwap` の使用理由コメントは良好。`currentlyVisible` の読み取りから OS 操作までの間に状態変化する可能性についてもコメントがあるとベスト。

### S-08: parseConfigUpdatedPayload の synthetic version 警告
- **ファイル**: `myT-x/frontend/src/hooks/useBackendSync.ts` L199–L206
- `version === null` 時の `configEventVersionRef.current += 1` は合成的な単調増加。コメントで「バックエンドが version を省略した場合の互換対応」と明記。

### S-09: onEvent ヘルパーの型安全性
- **ファイル**: `myT-x/frontend/src/hooks/useBackendSync.ts` L94–L99
- `BackendEventMap` の値型が全て `unknown`。型安全性を高めるため、各イベントの期待ペイロード型を定義することを推奨。

### S-10: resolveSessionState の外部公開検討
- **ファイル**: `myT-x/frontend/src/stores/tmuxStore.ts` L56–L78
- `resolveSessionState` は `setSessions` と `applySessionDelta` で共通利用される重要な関数。テスト可能性のため export を検討。

### S-11: removeLegacyDirectory の walk-up ループ
- **ファイル**: `myT-x/internal/install/shim_cleanup_windows.go` L120–L140
- `os.Remove(current)` がエラーの場合に種類（permission denied vs not empty）を区別していないが、どちらの場合もこれ以上 walk-up しても同じ結果のため現在の実装で適切。

### S-12: recoverBackgroundPanic の戻り値型
- **ファイル**: `myT-x/app_panic_recovery.go` L17–L25
- `recovered any` が `nil` でない場合のみ `true` を返す。godoc コメントに「戻り値は panic が発生したかどうか」を明記。

### S-13: findAvailableSessionName の欠如
- **ファイル**: `myT-x/app_session_api.go` L43
- `a.findAvailableSessionName(sessionName)` の実装が diff に含まれていないが、命名重複回避の重要ロジック。テストで `-2`, `-3` サフィックスの上限や境界を検証すべき。

### S-14: CleanupLegacyShimInstalls の戻り値
- **ファイル**: `myT-x/internal/install/shim_cleanup_windows.go` L30–L42
- 常に `nil` を返す関数だが、インターフェース互換のため `error` 返却を保持。この設計意図は既にコメントで説明済み。

### S-15: estimateSnapshotPayloadBytes のサンプリング率
- **ファイル**: `myT-x/app_snapshot_metrics.go` L40–L43
- `snapshotPayloadSampleEvery = 8` （12.5%）。パフォーマンスとメトリクス精度のトレードオフとしてコメントで根拠が説明されており適切。

### S-16: layoutSnapshotEqual の Children 固定サイズ
- **ファイル**: `myT-x/app_snapshot_delta.go` L124–L129
- `Children [2]*LayoutNode` の固定サイズに依存。`LayoutNode` の構造が変わった場合に自動検出するテストガード（`TestSnapshotFieldCounts` 相当）が必要。

### S-17: WindowIndexInSession の RLock 使用
- **ファイル**: `myT-x/internal/tmux/session_manager_windows.go` L239
- 読み取り専用のため `RLock` で適切。コメントの `S-43` 参照も明確。

### S-18: filterPathEntries の "." ガード
- **ファイル**: `myT-x/internal/install/shim_cleanup_windows.go` L95–L97
- `filepath.Clean("")` が `"."` を返す問題に対するガードが適切。コメントで説明済み。

### S-19: 前回のレビュー指摘からの進捗確認
- I-23 (ListSessions/GetActiveSession 並行取得), I-36 (resolveSessionState 抽出), I-37 (onEvent 型付け) が今回の差分で改善されている。

### S-20: emitWorktreeCleanupFailure の err nil 時のフォールバック
- **ファイル**: `myT-x/app_session_api.go` L185
- `err == nil` の場合に `"unknown worktree cleanup failure"` をセット。呼び出し側が err を渡し忘れた場合の防御として適切。

### S-21: activateCreatedSession の Snapshot() 全件走査
- **ファイル**: `myT-x/app_session_api.go` L267–L275
- セッション作成直後に `Snapshot()` を全件走査して名前一致を探す。セッション数が少ない前提では問題ないが、大量セッション時には `GetSession` 相当の直接取得経由が効率的。

### S-22: fallbackWindowIDNearIndex のテスト網羅
- **ファイル**: `myT-x/internal/tmux/session_manager_windows.go` L102–L119
- 新規追加ヘルパー。nil エントリスキップ、空配列、全 nil 配列の境界テストを推奨。

---

## テスト品質に関する指摘

### T-01: session_manager_targets.go のテストカバレッジ不足
- **対象**: `ResolveDirectionalPane`, `activePaneInWindow`
- **不足**: 方向移動のエッジケース（単一ペイン、3+ペインの中間ペイン選択、無効方向文字列）

### T-02: session_manager_window_test.go の RemoveWindow 境界テスト
- **対象**: `removeWindowAtIndexLocked` の4値返却
- **推奨**: survivingWindowID の検証、最終ウィンドウ削除時のセッション自動削除

### T-03: shim_cleanup_windows_test.go のレジストリ操作テスト
- **対象**: `CleanupLegacyShimInstalls` のエッジケース
- **推奨**: レジストリ読み取り失敗時の graceful degradation

### T-04: app_events_test.go の snapshotEventPolicies 網羅テスト
- **対象**: 全登録イベントに対する `shouldEmitSnapshotForEvent` / `shouldBypassSnapshotDebounceForEvent` テスト

---

## 修正タスク一覧・並列作業可否

以下の表は、作業者が修正を行う際にどのタスクを同時並行で進められるかを示します。
同じグループ（A, B, C...）内のタスクは**互いに独立**しており、別々の作業者が同時に着手可能です。
グループ間には依存関係がないため、全グループを並行して進められます。

### 並列作業グループ表

| グループ | タスク ID | 重要度 | 対象ファイル | 修正内容 | 並列可否 | 備考 |
|----------|-----------|--------|-------------|----------|----------|------|
| **A** | C-01 | Critical | `cmd/tmux-shim/main.go` | pruneRotatedShimDebugLogs 内の debugLog を直接stderr出力に変更 | ✅ 他と独立 | tmux-shim 単独変更 |
| **B** | I-01 | Important | `app_pane_feed.go`, `app_lifecycle.go` | ワーカー最大リトライ到達時にイベント発行 | ✅ 他と独立 | 2ファイル同時変更だがI-13と合わせて対応 |
| **B** | I-13 | Important | `app_pane_feed.go`, `app_lifecycle.go` | ワーカーリトライループの共通化（オプション） | ⚠️ I-01と同時 | I-01と合わせて実施推奨 |
| **C** | I-02 | Important | `app_events.go` | snapshotEventPolicies の trigger フィールド整理 | ✅ 他と独立 | |
| **D** | I-03 | Important | `frontend/src/stores/tmuxStore.ts` | setActiveSession で activeWindowId 再計算 | ✅ 他と独立 | |
| **D** | I-05 | Important | `frontend/src/stores/tmuxStore.ts` | applySessionDelta に upserts フィルタ追加 | ⚠️ I-03と同時 | 同ファイル・別関数 |
| **E** | I-04 | Important | `frontend/src/hooks/useBackendSync.ts` | GetConfig catch 後の config null 対応 | ✅ 他と独立 | |
| **E** | I-06 | Important | `frontend/src/hooks/useBackendSync.ts` | configEventVersionRef ガードのコメント追加 | ⚠️ I-04と同時 | 同ファイル |
| **F** | I-07 | Important | `app_lifecycle.go` | ensureShimReady の err 変数名変更 | ✅ 他と独立 | I-12も同ファイルだが別箇所 |
| **F** | I-12 | Important | `app_lifecycle.go` | needsInstallBefore の暗黙依存コメント追加 | ⚠️ I-07と同時 | 同ファイルの同関数内 |
| **G** | I-08 | Important | `app_pane_feed.go` | runtimeContext() をローカル変数化 | ✅ 他と独立 | I-01と同ファイルだが別箇所、並列可 |
| **H** | I-09 | Important | `internal/tmux/session_manager_windows.go` | ウィンドウID検索ヘルパー抽出 | ✅ 他と独立 | |
| **I** | I-10 | Important | `app_session_api.go` | emitWorktreeCleanupFailure のコメント追記 | ✅ 他と独立 | |
| **J** | I-14 | Important | `app_config_state.go` | getConfigInternalUnsafe の呼び出し元確認 | ✅ 他と独立 | 調査タスク |
| **K** | I-15 | Important | `internal/ipc/protocol.go` | DefaultPipeName のコメント追記 | ✅ 他と独立 | |
| **L** | I-16 | Important | `app_guards.go` | requireSessionsWithPaneID の nil ガード or コメント | ✅ 他と独立 | |
| **M** | I-17 | Important | `app_pane_feed.go` | enqueuePaneStateFeed の順序保証コメント追加 | ✅ 他と独立 | |
| **N** | I-18 | Important | テスト新規作成 | session_manager_targets.go のテスト追加 | ✅ 他と独立 | |

### 並列作業の注意事項

1. **同一ファイル変更の競合に注意**
   - `app_pane_feed.go`: I-01, I-08, I-13, I-17 → **B + G + M グループは順次実施**が安全
   - `app_lifecycle.go`: I-01, I-07, I-12, I-13 → **B + F グループは順次実施**が安全
   - `frontend/src/stores/tmuxStore.ts`: I-03, I-05 → **D グループ内は順次実施**
   - `frontend/src/hooks/useBackendSync.ts`: I-04, I-06 → **E グループ内は順次実施**

2. **推奨作業順序** 
   ```
   Phase 1 (並列) : C-01, I-02, I-09, I-10, I-14, I-15, I-16, I-18
   Phase 2 (並列) : I-03 + I-05, I-04 + I-06
   Phase 3 (順次) : I-01 → I-08 → I-13 → I-17 (app_pane_feed.go 系)
   Phase 4 (順次) : I-07 → I-12 (app_lifecycle.go 系)
   ```

---

## レビュー対象外

以下は CLAUDE.md / AGENTS.md のプロジェクト仕様に基づきレビュー対象外：

- 内部 Web 通信の外部公開リスクとしての脆弱性（アプリケーション内部通信のため）
- `go test -race` の指摘（環境セットアップが困難なため）
- 後方互換性の破壊的変更（開発中のため不要）
- tmux-shim の変換失敗時のエラー伝播（原文転送仕様）
- md ファイルの内容レビュー
