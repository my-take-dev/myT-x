# PR Review Summary â€” WebSocket Binary Streaming å°å…¥ (çµ±åˆç‰ˆ)

**ãƒ¬ãƒ“ãƒ¥ãƒ¼æ—¥æ™‚**: 2026-02-20 14:00
**ãƒ¬ãƒ“ãƒ¥ãƒ¼å¯¾è±¡**: myT-x é…ä¸‹ã®æœªã‚³ãƒŸãƒƒãƒˆå¤‰æ›´ï¼ˆWebSocket ãƒã‚¤ãƒŠãƒªã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°å°å…¥ï¼‰
**ãƒ¬ãƒ“ãƒ¥ãƒ¼æ‰‹æ³•**: è¤‡æ•°ãƒ¬ãƒ“ãƒ¥ãƒ¼çµæœã®çµ±åˆï¼ˆé‡è¤‡æ’é™¤æ¸ˆã¿ï¼‰

---

## å¤‰æ›´æ¦‚è¦

WebSocket ãƒã‚¤ãƒŠãƒªã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°ã«ã‚ˆã‚Šã€ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ãƒšã‚¤ãƒ³å‡ºåŠ›ã®é«˜ã‚¹ãƒ«ãƒ¼ãƒ—ãƒƒãƒˆé…ä¿¡ã‚’å®Ÿç¾ã€‚å¾“æ¥ã® Wails IPCï¼ˆJSONæ–‡å­—åˆ—ã‚¤ãƒ™ãƒ³ãƒˆï¼‰ã‹ã‚‰ WebSocket ãƒã‚¤ãƒŠãƒªãƒ•ãƒ¬ãƒ¼ãƒ ã¸ç§»è¡Œã—ã€ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã‚’æ”¹å–„ã€‚

### å¤‰æ›´ãƒ•ã‚¡ã‚¤ãƒ«åˆ†é¡

| ã‚«ãƒ†ã‚´ãƒª | ãƒ•ã‚¡ã‚¤ãƒ« | ç¨®åˆ¥ |
|---------|--------|------|
| **A: WebSocket ã‚µãƒ¼ãƒãƒ¼** | `internal/wsserver/hub.go` | æ–°è¦ |
| | `internal/wsserver/hub_test.go` | æ–°è¦ |
| | `internal/wsserver/protocol.go` | æ–°è¦ |
| | `internal/wsserver/protocol_test.go` | æ–°è¦ |
| **B: ãƒ‘ãƒ‹ãƒƒã‚¯å›å¾©ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£** | `internal/workerutil/recovery.go` | æ–°è¦ |
| | `internal/workerutil/recovery_test.go` | æ–°è¦ |
| **C: Appå±¤** | `app.go` | å¤‰æ›´ |
| | `app_events.go` | å¤‰æ›´ |
| | `app_events_test.go` | å¤‰æ›´ |
| | `app_lifecycle.go` | å¤‰æ›´ |
| | `app_pane_feed.go` | å¤‰æ›´ |
| | `app_panic_recovery.go` | å¤‰æ›´ |
| | `app_panic_recovery_test.go` | å¤‰æ›´ |
| **D: Config** | `internal/config/config.go` | å¤‰æ›´ |
| | `internal/config/config_test.go` | å¤‰æ›´ |
| | `config.yaml` | å¤‰æ›´ |
| | `go.mod` | å¤‰æ›´ |
| **E: Frontend** | `frontend/src/services/paneDataStream.ts` | æ–°è¦ |
| | `frontend/tests/paneDataStream.test.ts` | æ–°è¦ |
| | `frontend/src/api.ts` | å¤‰æ›´ |
| | `frontend/src/hooks/useBackendSync.ts` | å¤‰æ›´ |
| | `frontend/src/hooks/useTerminalEvents.ts` | å¤‰æ›´ |
| | `frontend/tsconfig.json` | å¤‰æ›´ |
| | `frontend/tsconfig.node.json` | å¤‰æ›´ |
| | `frontend/wailsjs/go/main/App.d.ts` | å¤‰æ›´(è‡ªå‹•ç”Ÿæˆ) |
| | `frontend/wailsjs/go/main/App.js` | å¤‰æ›´(è‡ªå‹•ç”Ÿæˆ) |
| | `frontend/wailsjs/go/models.ts` | å¤‰æ›´(è‡ªå‹•ç”Ÿæˆ) |

---

## Critical Issues (1ä»¶)

### C-1. [silent-failure-hunter] WebSocketæ¥ç¶šå¤±æ•—æ™‚ã«ãƒšã‚¤ãƒ³ãƒ‡ãƒ¼ã‚¿ãŒå®Œå…¨ã«é€”çµ¶ã™ã‚‹ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯æ¬ è½

**ãƒ•ã‚¡ã‚¤ãƒ«**: `frontend/src/hooks/useBackendSync.ts` (L132-146) / `frontend/src/hooks/useTerminalEvents.ts` (L282-288)

**å•é¡Œ**: 
- ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰å´ã¯ WebSocket æ¥ç¶šãŒãªã„å ´åˆã«æ­£ã—ã Wails IPC ã«ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ã™ã‚‹ï¼ˆ`app_events.go` ã® `wsHub == nil || !HasActiveConnection()` åˆ†å²ï¼‰
- ã—ã‹ã—ã€ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰å´ã§ã¯ `useTerminalEvents.ts` ãŒå¾“æ¥ã® `EventsOn("pane:data:" + paneId)` ã‚’ `registerPaneHandler`ï¼ˆWebSocketçµŒç”±ï¼‰ã«**å®Œå…¨ã«ç½®æ›**ã—ã¦ã„ã‚‹
- WebSocketæ¥ç¶šãŒç¢ºç«‹ã§ããªã„å ´åˆï¼ˆãƒãƒ¼ãƒˆç«¶åˆã€èµ·å‹•å¤±æ•—ï¼‰ã€ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã¯ Wails IPC ã§ãƒ‡ãƒ¼ã‚¿ã‚’é€ä¿¡ã™ã‚‹ãŒã€ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã¯ WebSocket ãƒãƒ³ãƒ‰ãƒ©ã—ã‹ç™»éŒ²ã—ã¦ãŠã‚‰ãšã€**ãƒšã‚¤ãƒ³ãƒ‡ãƒ¼ã‚¿ãŒè¡¨ç¤ºã•ã‚Œãªã„**

**å½±éŸ¿**: WebSocketã‚µãƒ¼ãƒãƒ¼èµ·å‹•å¤±æ•—æ™‚ã«ã‚¿ãƒ¼ãƒŸãƒŠãƒ«å‡ºåŠ›ãŒä¸€åˆ‡è¡¨ç¤ºã•ã‚Œãªããªã‚‹

**ä¿®æ­£æ¡ˆ**: 
1. WebSocketæ¥ç¶šå¤±æ•—æ™‚ã«ã€å¾“æ¥ã® `EventsOn("pane:data:" + paneId)` ãƒªã‚¹ãƒŠãƒ¼ã‚’ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ã¨ã—ã¦ç™»éŒ²ã™ã‚‹
2. ã¾ãŸã¯ `useTerminalEvents.ts` ã§ WebSocket ã¨ Wails IPC ä¸¡æ–¹ã«ãƒªã‚¹ãƒŠãƒ¼ã‚’æŒã¡ã€WebSocket å„ªå…ˆã§å‡¦ç†ã™ã‚‹

---

## Important Issues (15ä»¶)

### I-1. [code-reviewer] `sendError` ã« `WriteDeadline` ãŒæœªè¨­å®š
**ãƒ•ã‚¡ã‚¤ãƒ«**: `internal/wsserver/hub.go` (L243-255)
`BroadcastPaneData` ã§ã¯ `SetWriteDeadline(5s)` ã‚’è¨­å®šã—ã¦ã„ã‚‹ãŒã€`sendError` ã§ã¯è¨­å®šã—ã¦ã„ãªã„ã€‚WebView ãŒãƒ•ãƒªãƒ¼ã‚ºã—ãŸå ´åˆã€`sendError` ãŒ `writeMu` ã‚’ä¿æŒã—ãŸã¾ã¾ç„¡æœŸé™ã«ãƒ–ãƒ­ãƒƒã‚¯ã—ã€å…¨ã¦ã® `BroadcastPaneData` ã‚‚ãƒ–ãƒ­ãƒƒã‚¯ã•ã‚Œã‚‹ã€‚
**ä¿®æ­£æ¡ˆ**: `_ = conn.SetWriteDeadline(...)` ã‚’ `sendError` ã®æ›¸ãè¾¼ã¿å‰ã«è¿½åŠ ã€‚

### I-2. [code-reviewer] `api.ts` ã®æš«å®š `GetWebSocketURL` å®Ÿè£…ãŒè‡ªå‹•ç”Ÿæˆãƒã‚¤ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ã¨é‡è¤‡
**ãƒ•ã‚¡ã‚¤ãƒ«**: `frontend/src/api.ts` (L65-78)
æ‰‹å‹•å®Ÿè£…ãŒæ®‹ã£ã¦ãŠã‚Š `any` ã‚­ãƒ£ã‚¹ãƒˆãŒå‹å®‰å…¨æ€§ã‚’æãªã†ã€‚è‡ªå‹•ç”Ÿæˆã® `import { GetWebSocketURL } from "../wailsjs/go/main/App"` ã‚’ä½¿ç”¨ã™ã‚‹ã€‚

### I-3. [code-reviewer] `paneDataStream.ts` â€” `disconnect()` æ™‚ã« `paneHandlers` ãŒã‚¯ãƒªã‚¢ã•ã‚Œãªã„
**ãƒ•ã‚¡ã‚¤ãƒ«**: `frontend/src/services/paneDataStream.ts` (L63-68)
React ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒã‚¢ãƒ³ãƒã‚¦ãƒ³ãƒˆã•ã‚ŒãŸå¾Œã«å‚ç…§ãŒæ®‹ã‚ŠGCã•ã‚Œãªã„ã€‚`disconnect()` å†…ã§ `paneHandlers.clear()` ã‚’è¿½åŠ ã€‚

### I-4. [code-reviewer] `closeExisting()` å†…ã® `ws = null` ãŒ `close()` ã®å¾Œã«è¨­å®šã•ã‚Œã¦ã„ã‚‹
**ãƒ•ã‚¡ã‚¤ãƒ«**: `frontend/src/services/paneDataStream.ts` (L131-137)
åŒæœŸçš„ã« `onclose` ãŒç™ºç«ã—ãŸå ´åˆ stale guard ãŒæ©Ÿèƒ½ã—ãªã„ã€‚`ws = null` ã‚’ `close()` ã®å‰ã«ç§»å‹•ã™ã‚‹ã€‚

### I-5. [silent-failure-hunter] `api.ts` ã® `GetWebSocketURL` ãŒå…¨ã‚¨ãƒ©ãƒ¼ã‚’æ¶ˆéŸ³ã™ã‚‹
**ãƒ•ã‚¡ã‚¤ãƒ«**: `frontend/src/api.ts` (L73-83)
æ ¹æœ¬åŸå› ãŒãƒ­ã‚°ã«æ®‹ã‚‰ãªã„ãŸã‚ã€`console.warn` ç­‰ã‚’è¿½åŠ ã€‚

### I-6. [silent-failure-hunter] `SetWriteDeadline` ã®ã‚¨ãƒ©ãƒ¼ãŒ `_` ã§ç„¡è¦–ã•ã‚Œã¦ã„ã‚‹
**ãƒ•ã‚¡ã‚¤ãƒ«**: `internal/wsserver/hub.go` (L174-177)
å¤±æ•—æ™‚ã‚‚ãƒ‡ãƒƒãƒ‰ãƒ©ã‚¤ãƒ³ãªã—ã§æ›¸ãè¾¼ã¿ãŒè¡Œã‚ã‚Œãƒ•ãƒªãƒ¼ã‚ºåŸå› ã«ãªã‚‹ã€‚å¤±æ•—æ™‚ã¯ãƒ­ã‚°å‡ºåŠ›ã—ã¦æ¥ç¶šã‚’é–‰ã˜ã‚‹ã€‚

### I-7. [recovery-reviewer] `IsShutdown` æ™‚ã® `OnPanic` å‘¼ã³å‡ºã—æŠ‘åˆ¶ãŒæš—é»™çš„
**ãƒ•ã‚¡ã‚¤ãƒ«**: `internal/workerutil/recovery.go` (L123-128)
ã‚·ãƒ£ãƒƒãƒˆãƒ€ã‚¦ãƒ³ä¸­ã®panicã§ `OnPanic` ãŒå‘¼ã°ã‚Œãªã„æ„å›³ã‚’ã‚³ãƒ¡ãƒ³ãƒˆã«æ˜ç¤ºã™ã‚‹ã€‚

### I-8. [test-analyzer] `hub_test.go` ã« sendError / ä¸æ˜action ã®ãƒ†ã‚¹ãƒˆãŒä¸è¶³
**ãƒ•ã‚¡ã‚¤ãƒ«**: `internal/wsserver/hub_test.go`
ä¸æ­£JSONã‚„ä¸æ˜ãª `action` ã«å¯¾ã™ã‚‹ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ã‚’è¿½åŠ ã€‚

### I-9. [test-analyzer] `paneDataStream.test.ts` ã«ã‚¨ãƒ©ãƒ¼ãƒ‘ã‚¹ã®ãƒ†ã‚¹ãƒˆãŒä¸è¶³
**ãƒ•ã‚¡ã‚¤ãƒ«**: `frontend/tests/paneDataStream.test.ts`
WSã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ä¾‹å¤–ã‚„ `readyState !== OPEN` æ™‚ã®ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ãƒ†ã‚¹ãƒˆç­‰ã‚’è¿½åŠ ã€‚

### I-10. [test-analyzer] `waitForSubscription()` ãŒ `time.Sleep` ãƒ™ãƒ¼ã‚¹ã®åŒæœŸ
**ãƒ•ã‚¡ã‚¤ãƒ«**: `internal/wsserver/hub_test.go` (L73-75) / `app_events_test.go` (L1124)
CIã§ flaky ã«ãªã‚‹ãŸã‚ã€ãƒãƒ¼ãƒªãƒ³ã‚°ãƒ™ãƒ¼ã‚¹ã® `waitForCondition` ãƒ‘ã‚¿ãƒ¼ãƒ³ã¸ç½®æ›ã€‚

### I-11. [test-analyzer] `app_events_test.go` ã§ã‚¨ãƒ©ãƒ¼ã‚’ `_` ã§ç„¡è¦–
**ãƒ•ã‚¡ã‚¤ãƒ«**: `app_events_test.go` (L1102, L1115)
`t.Fatal` ã«ä¿®æ­£ã™ã¹ãã€‚

### I-12. [test-analyzer] `recovery_test.go` ã®ãƒãƒƒã‚¯ã‚ªãƒ•ãƒ†ã‚¹ãƒˆã® tolerance ãŒä¸è¶³
**ãƒ•ã‚¡ã‚¤ãƒ«**: `internal/workerutil/recovery_test.go` (L299)
Windows ã‚¿ã‚¤ãƒãƒ¼ç²¾åº¦ã®é–¢ä¿‚ã§ 60-80ms ã«æ‹¡å¤§ã‚’æ¨å¥¨ã€‚

### I-13. [resource-leak] `handleWS` WebSocketã®ãƒ‡ãƒƒãƒ‰ã‚³ãƒã‚¯ã‚·ãƒ§ãƒ³æ¤œçŸ¥æ¼ã‚Œ
**ãƒ•ã‚¡ã‚¤ãƒ«**: `internal/wsserver/hub.go`
ãƒªãƒ¼ãƒ‰ãƒãƒ³ãƒ—ã«ãŠã„ã¦ã€Ping/Pongãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ç­‰ã«ã‚ˆã‚‹æ­»æ´»ç›£è¦–ã‚„ `SetReadDeadline` ãŒå®Ÿè£…ã•ã‚Œã¦ã„ãªã„ã€‚ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãƒ—ãƒ­ã‚»ã‚¹ãŒä¸æ„ã«ã‚¯ãƒ©ãƒƒã‚·ãƒ¥ã—TCPã‚¯ãƒ­ãƒ¼ã‚ºãŒé€ã‚‰ã‚Œãªã‹ã£ãŸå ´åˆã€ã‚µãƒ¼ãƒå´ã®ãƒªã‚½ãƒ¼ã‚¹ãŒæ°¸ä¹…ãƒªãƒ¼ã‚¯ã™ã‚‹æã‚ŒãŒã‚ã‚‹ã€‚å®šæœŸçš„ãªPingç­‰ã¨ `SetReadDeadline` æ›´æ–°ã‚’è¿½åŠ ã€‚

### I-14. [security] `handleWS` ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚µã‚¤ã‚ºã®åˆ¶é™ (ReadLimit) ä¸åœ¨
**ãƒ•ã‚¡ã‚¤ãƒ«**: `internal/wsserver/hub.go`
`ReadLimit` ãŒç„¡è¨­å®šãªãŸã‚ã€å·¨å¤§ãªJSONãƒšã‚¤ãƒ­ãƒ¼ãƒ‰ç­‰ã«ã‚ˆã‚‹OOMãƒªã‚¹ã‚¯ãŒã‚ã‚‹ã€‚é€šä¿¡å¾Œ `conn.SetReadLimit` ã‚’è¨­å®šã€‚

### I-15. [test-analyzer] `hub_test.go` åˆ‡æ–­ã®å¼·åˆ¶ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ†ã‚¹ãƒˆä¸è¶³
**ãƒ•ã‚¡ã‚¤ãƒ«**: `internal/wsserver/hub_test.go`
`conn.Close()` ã¯WebSocketãƒ—ãƒ­ãƒˆã‚³ãƒ«ä¸Šæ­£å¸¸ãªã‚¯ãƒ­ãƒ¼ã‚ºã¨ãªã‚‹ãŸã‚ã€`conn.UnderlyingConn().Close()` ã§å³åº§ã«å¼·åˆ¶åˆ‡æ–­ï¼ˆã‚¢ãƒ–ãƒ€ãƒ—ãƒˆã‚¯ãƒ­ãƒ¼ã‚ºï¼‰ã™ã‚‹ã‚¢ãƒãƒãƒªãƒ¼ãƒ†ã‚¹ãƒˆã‚’è¿½åŠ ã€‚

---

## Suggestions (29ä»¶)

### S-1. `closed` ãƒãƒ£ãƒãƒ«ãŒæœªä½¿ç”¨ (`hub.go`)
### S-2. `BroadcastPaneData` ã®æ¥ç¶šãªã—ãƒ­ã‚°ãŒé«˜é »åº¦ã§å‡ºåŠ›ã•ã‚Œã‚‹å¯èƒ½æ€§ (`hub.go`)
### S-3. Hub ã«ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ãŒå®šç¾©ã•ã‚Œã¦ã„ãªã„ (`hub.go` / `app.go`)
### S-4. `handleSubscription` ã§ç©º PaneID ãŒãƒ•ã‚£ãƒ«ã‚¿ã•ã‚Œãªã„ (`hub.go`)
### S-5. `conn.Close()` ã®äºŒé‡ã‚¯ãƒ­ãƒ¼ã‚ºã«ã‚³ãƒ¡ãƒ³ãƒˆãŒãªã„ (`hub.go`)
### S-6. panicå€¤ã®å‹ãƒãƒªã‚¨ãƒ¼ã‚·ãƒ§ãƒ³ãŒãƒ†ã‚¹ãƒˆæœªã‚«ãƒãƒ¼ (`recovery_test.go`)
### S-7. `MaxBackoff < InitialBackoff` ã®çŸ›ç›¾ãŒæ¤œå‡ºã•ã‚Œãªã„ (`recovery.go`)
### S-8. ãƒ­ã‚°ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®é‡è¤‡ï¼ˆ`app_panic_recovery.go` vs `recovery.go`ï¼‰
### S-9. ãƒãƒ¼ãƒˆç¯„å›²ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆ0-65535ï¼‰ãŒãªã„ (`config.go`)
### S-10. config ã®ãƒãƒ¼ãƒˆç¯„å›²ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ãŒãªã„ (`config_test.go`)
### S-11. `useTerminalEvents.ts` ã® `TextDecoder` stream ãƒãƒƒãƒ•ã‚¡ãƒªãƒ¼ã‚¯æœªflush
### S-12. `useBackendSync.ts` ã® `console.warn` ã« DEV ã‚¬ãƒ¼ãƒ‰ãŒãªã„
### S-13. `paneDataStream.ts` ã§ paneIdLen === 0 ã®ã‚±ãƒ¼ã‚¹ãŒæš—é»™å‡¦ç†
### S-14. MockWebSocket ã« `CONNECTING` å®šæ•°ãŒæ¬ è½ (`paneDataStream.test.ts`)
### S-15. `onopen` å†subscribe ã®ãƒ†ã‚¹ãƒˆãŒãªã„ (`paneDataStream.test.ts`)
### S-16. WebSocket constructor ä¾‹å¤–ãƒ†ã‚¹ãƒˆãŒãªã„ (`paneDataStream.test.ts`)
### S-17. `paneDataStream.ts` å†æ¥ç¶šä¸Šé™åˆ°é”å¾Œã«ãƒªã‚«ãƒãƒªæ‰‹æ®µãŒãªã„
### S-18. `EncodePaneData` ã§ paneID ã®ç„¡è¨€åˆ‡ã‚Šè©°ã‚ (`protocol.go`)
åˆ‡è©°ã‚ã®è¡çªãƒªã‚¹ã‚¯ï¼ˆåˆ¥ãƒšã‚¤ãƒ³ãƒ‡ãƒ¼ã‚¿ãŒæ··å…¥ã™ã‚‹ãªã©å±é™ºï¼‰ãŒã‚ã‚‹ãŸã‚ `slog.Warn` ã¾ãŸã¯ã‚¨ãƒ©ãƒ¼ç­‰ã«æ ¼ä¸Šã’ãƒ»æ˜‡æ ¼æ¨å¥¨ã€‚
### S-19. `paneDataStream.ts` ã§ä¸æ­£ãƒ•ãƒ¬ãƒ¼ãƒ ãŒå®Œå…¨ã«ã‚µã‚¤ãƒ¬ãƒ³ãƒˆ
### S-20. `handleWS` ã® panicãƒªã‚«ãƒãƒªã«ã‚¹ã‚¿ãƒƒã‚¯ãƒˆãƒ¬ãƒ¼ã‚¹ãŒãªã„ (`hub.go`)
### S-21. æ¥ç¶šã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ãƒ‘ã‚¿ãƒ¼ãƒ³ã®3ç®‡æ‰€é‡è¤‡ï¼ˆDRYé•åãƒ»`clearIfCurrent` æŠ½å‡ºæœŸå¾…ï¼‰ï¼ˆ`hub.go`ï¼‰
### S-22. `upgrader` ã®ç¹°ã‚Šè¿”ã—ç”Ÿæˆã‚’ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãƒ¬ãƒ™ãƒ«å¤‰æ•°ã«ç§»å‹• (`hub.go`)
### S-23. `sendSubscribe/sendUnsubscribe` ã®éå¯¾ç§°ãªå®Ÿè£…ãƒ‘ã‚¿ãƒ¼ãƒ³ã®çµ±åˆ (`paneDataStream.ts`)
### S-24. `useTerminalEvents.ts` ã® ESLint æŠ‘åˆ¶ã‚³ãƒ¡ãƒ³ãƒˆãŒé‡è¤‡
### S-25. `defaultRecoveryOptions` ã® `OnPanic` ã‚¤ãƒ™ãƒ³ãƒˆã« `attempt` ãŒå«ã¾ã‚Œã¦ã„ãªã„ (`app_lifecycle.go`)
### S-26. `wsHub` ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®ã‚³ãƒ¡ãƒ³ãƒˆãŒã‚¢ã‚¯ã‚»ã‚¹ãƒ‘ã‚¿ãƒ¼ãƒ³ã¨ä¸æ­£ç¢º (`app.go`)
### S-27. WebSocket ãƒãƒ¼ãƒˆæŒ‡å®šå¤±æ•—æ™‚ã«ãƒ’ãƒ³ãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒãªã„ (`app_lifecycle.go`)
### S-28. `recovery.go` ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆäºŒé‡å®šç¾©
### S-29. `runRecoveryLoop` ã‚¿ã‚¤ãƒãƒ¼ãƒ‰ãƒ¬ã‚¤ãƒ³ã¸ã®ä»•æ§˜å¤‰æ›´ç•™æ„ (`recovery.go`)
Go 1.23ä»¥é™ã§ã¯ã‚¿ã‚¤ãƒãƒ¼ãƒ‰ãƒ¬ã‚¤ãƒ³ãŒä¸è¦ã«ãªã‚‹ç‚¹ã¸ã®ç•™æ„ï¼ˆå°†æ¥çš„ãªç°¡ç•¥åŒ–ãƒ»ãƒã‚°é˜²æ­¢ãƒã‚¤ãƒ³ãƒˆï¼‰ã€‚

---

## Strengthsï¼ˆè©•ä¾¡ã™ã¹ãç‚¹ï¼‰

1. **ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯è¨­è¨ˆ**: ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰å´ã® WebSocket â†’ Wails IPC ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ãŒé©åˆ‡ã«å®Ÿè£…ã•ã‚Œã¦ã„ã‚‹ã€‚
2. **shutdown é †åºã®æ­£ã—ã•**: `stopPaneFeedWorker â†’ bgWG.Wait â†’ detachAll â†’ wsHub.Stop()` ã®é †åºã§ãƒªã‚½ãƒ¼ã‚¹ãƒªãƒ¼ã‚¯ã‚’é˜²æ­¢ã€‚
3. **`workerutil.RunWithPanicRecovery` ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°**: ã‚³ãƒ¼ãƒ‰é‡ã‚’å¤§å¹…å‰Šæ¸›ã—é˜²è¡›çš„å®Ÿè£…ã‚’å®Ÿç¾ã€‚
4. **ãƒ—ãƒ­ãƒˆã‚³ãƒ«è¨­è¨ˆ**: å˜ä¸€ã‚¢ãƒ­ã‚±ãƒ¼ã‚·ãƒ§ãƒ³æœ€é©åŒ–ã€ãƒã‚¤ãƒŠãƒªãƒ•ãƒ¬ãƒ¼ãƒ è¨­è¨ˆãŒåŠ¹ç‡çš„ã€‚
5. **ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸**: IPC ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯3çµŒè·¯ç¶²ç¾…ã€‚
6. **goroutineãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«ç®¡ç†**: WaitGroupã€contexté€£æºãŒä¸å¯§ã€‚
7. **ã‚¿ã‚°çµ±ä¸€**: ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆè¦ç´„æº–æ‹ ã® `[DEBUG-xxx]` å½¢å¼æ¡ç”¨ã€‚
8. **éè‡´å‘½çš„ã‚¨ãƒ©ãƒ¼å‡¦ç†**: WebSocketèµ·å‹•å¤±æ•—æ™‚ã«ã‚¢ãƒ—ãƒªå…¨ä½“ã‚’åœæ­¢ã•ã›ãªã„æŸ”è»Ÿæ€§ã€‚
9. **è¨­è¨ˆæ„å›³ã®æ˜æ–‡åŒ–**: `hub.go` ã®ãƒ­ãƒƒã‚¯ç²å¾—é †åºæ˜ç¢ºåŒ–ãªã©ã€ãƒ‡ãƒƒãƒ‰ãƒ­ãƒƒã‚¯é˜²æ­¢æ„è­˜ãŒå®Ÿè¨¼ã•ã‚Œã¦ã„ã‚‹ã€‚
10. **é«˜åº¦ãªãƒ†ã‚¹ãƒˆè¨­è¨ˆ**: `recovery.go` ã§ã®ãƒ¬ãƒ¼ã‚¹ã‚³ãƒ³ãƒ‡ã‚£ã‚·ãƒ§ãƒ³è€ƒæ…®ã‚„éåŒæœŸå¾…æ©Ÿä¿è¨¼æ¡ç”¨ãªã©å“è³ªãŒé«˜ã„ã€‚

---

## ã‚¿ã‚¹ã‚¯ä¸€è¦§ã¨ä¸¦åˆ—ä½œæ¥­å¯å¦

ä»¥ä¸‹ã¯ã€æŒ‡æ‘˜äº‹é …ã‚’è¤‡æ•°ã®ã‚µãƒ–ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚„é–‹ç™ºè€…ãŒç«¶åˆãªãåŒæ™‚é€²è¡Œã§ãã‚‹ã‚ˆã†æ•´ç†ã—ãŸã€Œä½œæ¥­ã‚°ãƒ«ãƒ¼ãƒ—åˆ¥ã‚¿ã‚¹ã‚¯ãƒªã‚¹ãƒˆã€ã§ã™ã€‚

### ä½œæ¥­é †åºã¨ä¾å­˜ã®ã‚µãƒãƒª
- ğŸ”´ **å¿…é ˆ (Critical)**: `C-1`
- ğŸŸ¡ **æ¨å¥¨ (Important)**: `I-1` ã€œ `I-15`
- ğŸ”µ **ææ¡ˆ (Suggestion)**: `S-1` ã€œ `S-29`

| å„ªå…ˆåº¦ | ã‚¿ã‚¹ã‚¯ | å¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ« | ä¸¦åˆ—å¯å¦ | ä¾å­˜é–¢ä¿‚ãƒ»å‚™è€ƒ | ä½œæ¥­ç›®å®‰ |
|---|--------|------------|---------|---------|---------|
| ğŸ”´ **Critical** | C-1 (WSãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯æ¬ è½ã®ä¿®æ­£) | `useTerminalEvents.ts`, ç­‰ | âš ï¸ é †åºä¾å­˜ | I-2(api.tsæ•´ç†)å®Œäº†å¾Œã«å®Ÿæ–½æ¨å¥¨ | è¨­è¨ˆ+å®Ÿè£… |

### ä½œæ¥­ã‚°ãƒ«ãƒ¼ãƒ—ä¸€è¦§ï¼ˆåŒä¸€ãƒ•ã‚¡ã‚¤ãƒ«ã®ã‚¿ã‚¹ã‚¯ã‚’ã¾ã¨ã‚ä¸¦è¡Œå‡¦ç†å¯èƒ½ã«åˆ†å‰²ï¼‰

ã“ã‚Œã‚‰G1ã€œG11ã®ã‚°ãƒ«ãƒ¼ãƒ—ã¯å®Œå…¨ä¸¦åˆ—ï¼ˆåˆ¥ã®ãƒ–ãƒ©ãƒ³ãƒç­‰ï¼‰ã§ä½œæ¥­å¯èƒ½ã§ã™ã€‚

| ã‚°ãƒ«ãƒ¼ãƒ— | ãƒ•ã‚¡ã‚¤ãƒ«ç¾¤ | å«ã¾ã‚Œã‚‹ã‚¿ã‚¹ã‚¯ | ä¸¦åˆ—å¯å¦ |
|---------|--------|-------------|---------|
| **G1** | `hub.go` | I-1, I-6, I-13, I-14, S-1, S-2, S-4, S-5, S-20, S-21, S-22 | âœ… ä»–ã‚°ãƒ«ãƒ¼ãƒ—ã¨ä¸¦åˆ—OK |
| **G2** | `paneDataStream.ts` | I-3, I-4, S-13, S-17, S-19, S-23 | âœ… ä»–ã‚°ãƒ«ãƒ¼ãƒ—ã¨ä¸¦åˆ—OK |
| **G3** | `api.ts` | I-2, I-5 | âœ… ä»–ã‚°ãƒ«ãƒ¼ãƒ—ã¨ä¸¦åˆ—OK |
| **G4** | `hub_test.go` | I-8, I-10, I-15 | âœ… ä»–ã‚°ãƒ«ãƒ¼ãƒ—ã¨ä¸¦åˆ—OK |
| **G5** | `paneDataStream.test.ts` | I-9, S-14, S-15, S-16 | âœ… ä»–ã‚°ãƒ«ãƒ¼ãƒ—ã¨ä¸¦åˆ—OK |
| **G6** | `recovery.go`, `recovery_test.go` | I-7, I-12, S-6, S-7, S-8, S-28, S-29 | âœ… ä»–ã‚°ãƒ«ãƒ¼ãƒ—ã¨ä¸¦åˆ—OK |
| **G7** | `config.go`, `config_test.go` | S-9, S-10 | âœ… ä»–ã‚°ãƒ«ãƒ¼ãƒ—ã¨ä¸¦åˆ—OK |
| **G8** | Frontend hooks | S-11, S-12, S-24 | âœ… ä»–ã‚°ãƒ«ãƒ¼ãƒ—ã¨ä¸¦åˆ—OK |
| **G9** | Appå±¤ (`app*.go`) | S-25, S-26, S-27, I-11 | âœ… ä»–ã‚°ãƒ«ãƒ¼ãƒ—ã¨ä¸¦åˆ—OK |
| **G10** | ãƒ—ãƒ­ãƒˆã‚³ãƒ« (`protocol.go`) | S-18 | âœ… ä»–ã‚°ãƒ«ãƒ¼ãƒ—ã¨ä¸¦åˆ—OK |
| **G11** | ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯è¨­è¨ˆ | C-1, S-3 | âš ï¸ G3å®Œäº†å¾Œã«å®Ÿæ–½æ¨å¥¨ |

### æ¨å¥¨å¯¾å¿œãƒ•ãƒ­ãƒ¼
1. **Critical ä¿®æ­£ + ç‹¬ç«‹ã‚¿ã‚¹ã‚¯ã®ä¸¦è¡Œå‡¦ç†**:
   - ã¾ãš G3 ã‚’çµ‚ã‚ã‚‰ã›ã€C-1(G11) ã«ç€æ‰‹ã—ã¦ã‚¯ãƒªãƒ†ã‚£ã‚«ãƒ«ãªä¸å…·åˆã‚’å–ã‚Šé™¤ãã€‚
   - ãã‚Œã¨å…¨ãåŒæ™‚ã«ã€G1, G4, G6 ç­‰ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰å´ã®ã‚°ãƒ«ãƒ¼ãƒ—ã‚’åˆ¥ã®ä½œæ¥­è€…ãŒå‡¦ç†ã™ã‚‹ã€‚
2. **æ®‹å­˜ã‚¿ã‚¹ã‚¯ã®å‡¦ç†**:
   - G2, G5, G7ã€œG10 ãªã©ã‚’ç©ºã„ãŸä½œæ¥­è€…ã§é †æ¬¡å‡¦ç†ã™ã‚‹ã€‚
3. **æœ€çµ‚ç¢ºèª**:
   - å…¨ã¦ã‚’çµ±åˆå¾Œã€å†åº¦å…¨ä½“ãƒ†ã‚¹ãƒˆï¼ˆåŠã³å¿…è¦ã«å¿œã˜ãƒ¬ãƒ“ãƒ¥ãƒ¼ï¼‰ã‚’èµ°ã‚‰ã›ã‚‹ã€‚
