# PR Review — 2026-02-21 22:50:42

## レビュー対象概要

| 項目 | 内容 |
|------|------|
| ブランチ | `dev-v7` |
| 変更ファイル数 | 34ファイル（diff対象） + 6ファイル（未ステージ diff-view） |
| 変更規模 | +1,943 / -191 行 |
| テスト結果 | 全パッケージ PASS (`go test ./...`) |

### 変更カテゴリ概要

| カテゴリ | ファイル群 | 主な変更内容 |
|----------|-----------|-------------|
| A: Go Appレイヤ | `app.go`, `app_devpanel_api.go`, `app_devpanel_types.go`, `app_events.go`, `app_lifecycle.go`, `app_session_log.go`, `app_session_log_types.go` | WorkingDiff API追加、セッションログSeq採番、pingモデル化 |
| B: Go Appテスト | `app_devpanel_api_test.go`, `app_session_api_test.go`, `app_session_log_test.go` | WorkingDiff/PID/Seq/イベント名テスト追加 |
| C: internal/sessionlog | `handler.go`, `handler_test.go`, `internal/testutil/helpers.go` | TeeHandlerの引数名変更、エラー時コールバック継続対応 |
| D: internal/tmux | `session_manager_windows.go`, `command_router_handlers_window.go`, 各テストファイル | 1-windowモデル整理、rollbackSession適用、新テスト群 |
| E: Frontend | `api.ts`, `errorLogStore.ts`, `useBackendSync.ts`, viewer components, styles, wailsjs | pingモデル対応、Diff View新機能、ActivityStrip位置分類 |
| F: diff-view (未ステージ) | `DiffView.tsx`, `DiffContentViewer.tsx`, `DiffFileSidebar.tsx`, `useDiffView.ts`, `diffViewTypes.ts`, `index.ts` | Diff Viewコンポーネント新規追加 |

---

## Critical Issues（マージ前に必ず修正）

### C-1: `sessionLogFile` のミューテックス外アクセスによるデータレース
**ファイル:** `myT-x/app_session_log.go`  
**重大度:** Critical — 本番環境でのパニック（nil pointer dereference）

`needSync = true` を設定後にミューテックスを解放し、その後 `a.sessionLogFile.Sync()` を呼び出している。
`closeSessionLog()` が並行して実行された場合、`a.sessionLogFile` は nil に設定される可能性がある。

```go
// 現在のコード（問題あり）
a.sessionLogMu.Unlock()

if needSync {
    // ここで a.sessionLogFile が nil になりうる → PANIC
    if syncErr := a.sessionLogFile.Sync(); syncErr != nil {
```

コメントには "Sync() on a closed file returns an error but does not panic" とあるが、
**NILポインタ**の場合は `(*os.File)(nil).Sync()` → panic になる。

**修正方法:**
```go
// ロックを保持したままファイルポインタをローカル変数にキャプチャ
var fileToSync *os.File
a.sessionLogMu.Lock()
// ... (既存処理) ...
if needSync {
    fileToSync = a.sessionLogFile  // ロック内でキャプチャ
}
a.sessionLogMu.Unlock()

if fileToSync != nil {
    if syncErr := fileToSync.Sync(); syncErr != nil {
        fmt.Fprintf(os.Stderr, "[session-log] failed to sync log file: %v\n", syncErr)
    }
}
```

---

### C-2: `ErrorLogView.tsx` で `key={entry.seq}` が undefined 時に React キー衝突
**ファイル:** `myT-x/frontend/src/components/viewer/views/error-log/ErrorLogView.tsx`  
**重大度:** Critical — React レンダリング不正、エントリ表示の混乱

`ErrorLogEntry.seq` は TypeScript インターフェース上 `seq?: number`（オプショナル）。
`entry.seq` が `undefined` の場合、React は `key="undefined"` として全エントリに同一のキーを割り当て、
リストレンダリングが破綻する。

```tsx
// 現在のコード（問題あり）
entries.map((entry) => (
    <div key={entry.seq}    // ← seq が undefined のとき全エントリのキーが衝突
```

バックエンドは常に `seq >= 1` を割り当てるが、古いキャッシュや後方互換ペイロードで
`seq` が欠落するリスクがある。

**修正方法:**
```tsx
// mapに index を戻して、seqがない場合のfallbackを確保
entries.map((entry, i) => (
    <div
        key={entry.seq ?? `fallback-${entry.ts}-${i}`}
```

---

### C-3: `diff-view` ディレクトリが未ステージ（コミット漏れ）
**ファイル:** `myT-x/frontend/src/components/viewer/views/diff-view/` （全6ファイル）  
**重大度:** Critical — このまま diff-view なしでコミットするとフロントエンドビルド失敗

`ViewerSystem.tsx` は `import "./views/diff-view"` を追加しているが、
`diff-view/` ディレクトリ配下の全6ファイルが git untracked のまま。

```
git status myT-x/frontend/src/components/viewer/views/diff-view/
→ Untracked files:
      myT-x/frontend/src/components/viewer/views/diff-view/
```

**対処:**
```bash
git add myT-x/frontend/src/components/viewer/views/diff-view/
```

---

### C-4: `DiffContentViewer.tsx` — "Expand hidden lines" ボタンが展開コンテンツを表示しない
**ファイル:** `myT-x/frontend/src/components/viewer/views/diff-view/DiffContentViewer.tsx`  
**重大度:** Critical（機能的バグ）— UIボタンが押されても何も起きない

`toggleGap()` でフラグを立てると `!expandedGaps.has(hi)` が false になり展開バーが消える。
しかし展開状態でのコンテキスト行の表示コードが存在しない。

```tsx
// 現在のコード（問題あり）
{!expandedGaps.has(hi) && (() => {
    const gap = parsed.gaps.get(hi);
    return gap ? (
        <div className="diff-expand-bar" onClick={() => toggleGap(hi)}>
            Expand {gap.hiddenLineCount} hidden lines
        </div>
    ) : null;
})()}
// ↑ expandedGaps.has(hi) === true のとき何も表示されない！
```

**選択肢A（機能未実装として非表示）:** 展開バー自体を削除し、collapsed diff のまま表示する  
**選択肢B（未実装UI明示）:** ボタンのクリックを無効化し「展開機能は未実装」のツールチップを付与  
**選択肢C（完全実装）:** `git show` API を追加してコンテキスト行を取得し表示する

---

## Important Issues（できるだけ修正すべき）

### I-1: `DevPanelWorkingDiff` — 内部ループでサイズ上限チェックなし
**ファイル:** `myT-x/app_devpanel_api.go` — `DevPanelWorkingDiff`  
**重大度:** Important — 大量ファイルを持つディレクトリで制限を大幅超過する可能性

untracked ファイルの処理において、外側ループのチェック (`consumedSize >= devPanelMaxDiffSize`) は
1回の `buildUntrackedFileDiffs` 呼び出しで返される全エントリをそのまま追加する。
単一ディレクトリに多数のファイルが存在する場合、制限を大きく超えて追加される。

```go
// 現在のコード（問題あり）
for _, entry := range entries {
    consumedSize += len(entry.Diff)
    files = append(files, entry)  // サイズ超過していても無条件追加
}

// 修正案
for _, entry := range entries {
    if consumedSize >= devPanelMaxDiffSize {
        truncated = true
        break
    }
    consumedSize += len(entry.Diff)
    files = append(files, entry)
}
```

同様のパターンが他にあれば一括修正。

---

### I-2: `app_devpanel_api_test.go` — `os.WriteFile` / `os.MkdirAll` のエラー未チェック（複数箇所）
**ファイル:** `myT-x/app_devpanel_api_test.go`  
**重大度:** Important — テスト自体の信頼性低下（テスト失敗時に原因特定が困難）

以下の箇所でエラー戻り値が無視されている:

```go
// TestBuildUntrackedFileDiffSingle
os.WriteFile(filepath.Join(tmpDir, "new.txt"), []byte(textContent), 0o644)  // ← エラー無視
os.WriteFile(filepath.Join(tmpDir, "bin.dat"), []byte{0x00, 0x01, 0xFF}, 0o644)
os.MkdirAll(filepath.Join(tmpDir, "subdir"), 0o755)
```

類似パターンが `TestBuildUntrackedFileDiffs_SkipsBinary`、
`TestBuildUntrackedFileDiffs_ExcludedDirsSkipped` にも存在（同一指摘）。

**修正方法（全箇所統一）:**
```go
if err := os.WriteFile(filepath.Join(tmpDir, "new.txt"), []byte(textContent), 0o644); err != nil {
    t.Fatal(err)
}
```

---

### I-3: `diff-view/index.ts` — `position` フィールド未設定（error-log との配置不整合）
**ファイル:** `myT-x/frontend/src/components/viewer/views/diff-view/index.ts`  
**重大度:** Important — ActivityStrip でDiffが topViews に配置される（error-logのみ bottom）

`error-log/index.ts` は `position: "bottom"` が設定されているが、
`diff-view/index.ts` には `position` が設定されていない。
`ActivityStrip.tsx` は `position !== "bottom"` を topViews に振り分けるため、
Diffアイコンは上部に表示される。これが意図した配置なのか確認が必要。

設計意図が "Diff は bottom に置く" であれば:
```ts
registerView({
  id: "diff",
  icon: DiffIcon,
  label: "Diff",
  component: DiffView,
  shortcut: "Ctrl+Shift+D",
  position: "bottom",  // ← 追加
});
```

---

### I-4: `command_router_handlers_window.go` — `rollbackSession` の動作にコメントなし
**ファイル:** `myT-x/internal/tmux/command_router_handlers_window.go`  
**重大度:** Important — コードレビュー・デバッグ時の可読性低下

```go
// 変更後のコード（コメントなし）
if !snapOk {
    return rollbackSession("snapshot-refetch", fmt.Errorf("session disappeared after flag copy: %s", newSessionName))
}
```

`rollbackSession` が何を cleanup するか（作成したセッションの削除等）が
この変更箇所だけでは分からない。以下のようなコメント追加を推奨:

```go
if !snapOk {
    // rollbackSession cleans up the newly created session (terminal + session map entry)
    // and returns an error response. Proceeding with a nil snapshot would cause
    // resolveEnvForPaneCreation to skip the new-path and fall through to legacy behavior.
    return rollbackSession("snapshot-refetch", fmt.Errorf("session disappeared after flag copy: %s", newSessionName))
}
```

---

### I-5: `errorLogStore.ts` — バックエンド再起動時に `unreadCount` が新エントリを見逃す可能性
**ファイル:** `myT-x/frontend/src/stores/errorLogStore.ts` — `setEntries`  
**重大度:** Important（UX） — ユーザが新規エラーに気づかない可能性

```ts
const newEntryCount = merged.length - state.entries.length;
return {
    entries: merged,
    unreadCount: state.unreadCount + Math.max(0, newEntryCount),
};
```

バックエンド再起動後 (`GetSessionErrorLog` が完全に新しいエントリのみ返す場合):
- `state.entries.length = 100`（古いエントリ）
- `merged.length = 3`（新エントリのみ）
- `newEntryCount = 3 - 100 = -97` → `Math.max(0, -97) = 0`
- → unreadCount が増えない（ユーザが新規エラーを見逃す）

**改善案（正確な差分をseqで計算）:**
```ts
// existing seq のセットを作成
const existingSeqs = new Set(state.entries.map((e) => e.seq).filter(Boolean));
// merged のうち既存になかったもの = 新規エントリ数
const genuinelyNew = merged.filter((e) => e.seq == null || !existingSeqs.has(e.seq)).length;
return {
    entries: merged,
    unreadCount: state.unreadCount + genuinelyNew,
};
```

---

### I-6: `useDiffView.ts` — セッション変更時に `loadDiff` が二重呼び出しされる可能性
**ファイル:** `myT-x/frontend/src/components/viewer/views/diff-view/useDiffView.ts`  
**重大度:** Important（UX） — 不要なネットワークリクエストが発生

`loadDiff` は `[activeSession]` を deps とする useCallback で、
`activeSession` が変わると新しい関数参照が生成される。
その `loadDiff` を deps に持つ useEffect も再実行されるが、
さらに同じ `activeSession` を deps に持つ別の reset useEffect も存在する。

```ts
// セッション変更時の reset effect
useEffect(() => {
    if (prevSessionRef.current === activeSession) return;
    prevSessionRef.current = activeSession;
    setDiffResult(null);    // ← 不必要な re-render を起こす可能性
    // ...
}, [activeSession]);

// さらに loadDiff が呼ばれる
useEffect(() => {
    if (activeSession) {
        loadDiff();
    }
}, [activeSession, loadDiff]);
```

React Strict Mode では Effect が2回実行されるため、同一セッションで2回 API コールが走る。
プロダクションビルド（非Strict Mode）では問題しないが、開発中に混乱を招く。

**改善案:** `loadDiff` を `useCallback` から取り出すか、`useRef` を活用して重複実行を防ぐ。

---

### I-7: `DiffFileSidebar.tsx` — FixedSizeList の初期高さが 400px ハードコード
**ファイル:** `myT-x/frontend/src/components/viewer/views/diff-view/DiffFileSidebar.tsx`  
**重大度:** Important（UX） — 初回レンダリング時にレイアウトシフトが発生

```ts
const [height, setHeight] = useState(400);  // 初期値がハードコード
```

ResizeObserver が初回サイズを取得するまでの間、サイドバーが 400px の高さで表示される。
実際のコンテナが例えば 800px なら、初回描画後にリサイズが走り視覚的なガタつきが生じる。

**改善案:**
- `useState(0)` + `height > 0 ? <FixedSizeList ...> : null` パターン
- または `useLayoutEffect` で初期計測を行う

---

### I-8: `app_session_log.go` — `NOTE(A-0b)` コメントの説明が不正確
**ファイル:** `myT-x/app_session_log.go`  
**重大度:** Important（ドキュメント正確性） — 将来の開発者が誤解するリスク

```go
// NOTE: Reading sessionLogFile outside the lock is safe here because:
// 1. sessionLogFile is only set to nil in closeSessionLog(), which is
//    called during shutdown after all writers have stopped.
// 2. Sync() on a closed file returns an error but does not panic.
```

コメント2は「クローズされたファイル」に対するものだが、
実際のリスクは「nil ポインタ」（C-1 参照）。
C-1 の修正と合わせてコメントを更新すること。

---

## Suggestions（推奨改善）

### S-1: `app_devpanel_api.go` — WalkDir エラーにデバッグログ追加
**ファイル:** `myT-x/app_devpanel_api.go` — `buildUntrackedFileDiffs`

```go
// 現在
_ = filepath.WalkDir(absPath, func(...) error { ... })

// 改善案
if walkErr := filepath.WalkDir(absPath, func(...) error { ... }); walkErr != nil {
    slog.Debug("[DEBUG-DEVPANEL] WalkDir failed for untracked dir", "path", relPath, "error", walkErr)
}
```

---

### S-2: `app_devpanel_api.go` — 差分切り詰め時の UTF-8 境界考慮
**ファイル:** `myT-x/app_devpanel_api.go` — `DevPanelWorkingDiff`

```go
raw = raw[:devPanelMaxDiffSize]  // ← マルチバイト文字の途中で切る可能性
```

日本語ファイルパスや日本語コメントが含まれる diff では文字化けが起きうる。
`strings.SplitAfterN` や rune 境界を考慮したトリム関数の利用を検討。

---

### S-3: `session_manager_window_test.go` — 内部フィールド直接操作のヘルパー化
**ファイル:** `myT-x/internal/tmux/session_manager_window_test.go`  
**その他:** `session_manager_directional_test.go`

`AddWindow` 削除後、複数のテストが内部フィールドを直接操作してマルチウィンドウ状態を構築している。
構造変更時にテストが一斉に壊れるリスクがある。

```go
// 推奨: テスト用ヘルパーの追加
func injectWindowForTesting(t *testing.T, m *SessionManager, sessionName string) (*TmuxWindow, *TmuxPane) {
    t.Helper()
    m.mu.Lock()
    defer m.mu.Unlock()
    // ... window/pane 作成ロジック ...
}
```

同パターンが `TestRemoveWindowByID_ActiveWindowTransitions`、
`TestRemoveWindowByID_NonActiveWindowKeepsActiveID`、
`TestResolveDirectionalPane_MultipleWindowScopeIsolation` に存在（一括対応推奨）。

---

### S-4: `viewerRegistry.ts` — `position` フィールドのデフォルト動作をコメントで明示
**ファイル:** `myT-x/frontend/src/components/viewer/viewerRegistry.ts`

```ts
export interface ViewPlugin {
    // ...
    position?: "top" | "bottom";  // ← undefined のとき暗黙的に "top" 扱い
}
```

ActivityStrip の `views.filter((view) => view.position !== "bottom")` という実装により
`undefined` は "top" として扱われる。これをインターフェースのコメントで明示することで
新規 View プラグイン実装時の意図理解を助ける。

---

### S-5: `DiffContentViewer.tsx` — IIFE パターンを可読性の高い書き方に改善
**ファイル:** `myT-x/frontend/src/components/viewer/views/diff-view/DiffContentViewer.tsx`

```tsx
// 現在（IIFE + null 返却）  
{!expandedGaps.has(hi) && (() => {
    const gap = parsed.gaps.get(hi);
    return gap ? (<div>...</div>) : null;
})()}

// 改善案（変数化）
{(() => {
    if (expandedGaps.has(hi)) return null;
    const gap = parsed.gaps.get(hi);
    return gap ? (<div>...</div>) : null;
})()}
// または renderGapBar(hi) として切り出す
```

---

### S-6: `diffViewTypes.ts` と `models.ts` の型定義重複
**ファイル:** `myT-x/frontend/src/components/viewer/views/diff-view/diffViewTypes.ts`  
          `myT-x/frontend/wailsjs/go/models.ts`

`WorkingDiffFile` と `WorkingDiffResult` が両ファイルに定義されている（Wails 自動生成 vs 手動定義）。
フロントエンドコンポーネントが `diffViewTypes.ts` を参照し、`models.ts` の自動生成型を使わないことで
型の乖離が発生するリスクがある。

**推奨:** `diffViewTypes.ts` は `models.ts` の型を再エクスポートするか、
`main.WorkingDiffFile` を直接インポートすることを検討。

---

### S-7: `useBackendSync.ts` — `errorLogDebounceTimer` のスコープコメント追加
**ファイル:** `myT-x/frontend/src/hooks/useBackendSync.ts`

```ts
const ERROR_LOG_DEBOUNCE_MS = 80;
let errorLogDebounceTimer: ReturnType<typeof setTimeout> | null = null;
```

このタイマーはクリーンアップ関数内でも参照されているため、
なぜ `useRef` ではなく `let` で宣言しているかの理由をコメントで明示すると良い。
（Effectのスコープ内に閉じているため useRef 不要、という意図）

---

### S-8: `SessionLogEntry.Seq` の JSON 型 — uint64 vs number の精度問題
**ファイル:** `myT-x/app_session_log_types.go`, `myT-x/frontend/wailsjs/go/models.ts`  

`Seq uint64` は JSON では数値として出力され、TypeScript の `number` は IEEE 754 (53bit整数精度)。
セッション中に `2^53 = 9,007,199,254,740,992` を超えるログエントリが発生した場合に
精度ロスが発生する。実用上はほぼ問題ないが、将来的な永続化・累積ログ読み込みで
問題になる可能性がある。

`string` 型でシリアライズするか（Go側: `json:",string"`）、
型注釈で上限を文書化しておくことを推奨。

---

## Positive Observations（良かった点）

1. **ping + fetch モデルへの移行**: `app:error-logged` から `app:error-log-updated`（ペイロードなしping）への変更は、
   スロットリングによるデータロスを根本から解消する優れた設計変更。

2. **SeqによるReact deduplication**: `ts|level|msg|source` の複合キーは秒精度での衝突リスクがあったが、
   単調増加する `seq` により正確な重複排除が可能になった。

3. **セッションログファイル名への PID 付加**: 同一秒内の再起動でファイル名が衝突する問題を
   `session-YYYYMMDD-HHMMSS-PID.jsonl` で解決。シンプルかつ効果的。

4. **WorkingDiff の untracked ファイル対応**: `git ls-files --others --exclude-standard -z` を活用し
   NUL区切りで安全にパスを取得。スペースや特殊文字を含むパスに対応している。

5. **TeeHandler の設計変更**: ベースハンドラがエラーを返した場合でもコールバックを継続呼び出すことで、
   「ディスクフルでもUIへの通知は行う」要件を満たす設計に改善された。

6. **テストの充実度**: 全変更に対してテーブル駆動テストが追加されており、特に:
   - `TestCopyBoolPtr` で `new(true)` / `new(false)` の正確性を検証
   - `TestParseWorkingDiff_WindowsLineEndings` で Windows 改行コード対応を検証
   - `TestBuildUntrackedFileDiffs_ExcludedDirsSkipped` で `node_modules` 除外を検証

7. **1-window モデルの整理**: `AddWindow` / `WindowIndexInSession` の削除とそれに伴うコメント追加で
   意図が明確化された。

8. **`//go:fix inline` の積極活用**: Go 1.26 の新機能を活用したモダンなコード改善。
   `testutil.Ptr(v)` → `new(v)` への移行が `go fix ./...` で一括適用されている。

9. **`buildDiffTree` のツリー走査ロジック**: addedDirs による重複排除、
   親ディレクトリの展開状態に応じた可視性制御が正確に実装されている。

10. **`DiffFileSidebar` の `react-window` 採用**: 大量ファイルの差分でも
    仮想スクロールにより DOM ノード数を一定に保つ設計が適切。

---

## タスク一覧と並列作業計画

以下のタスクを **修正優先度** と **並列作業可否** で整理する。

### Critical Fixes（並列作業 OK）

| # | タスクID | 対象ファイル | 内容 | 並列可否 | 依存 |
|---|---------|------------|------|---------|------|
| 1 | C-1 | `app_session_log.go` | `sessionLogFile` をロック内でローカル変数にキャプチャ | ✅ 独立 | なし |
| 2 | C-2 | `ErrorLogView.tsx` | `key={entry.seq ?? \`fallback-...\`}` にindex復帰 | ✅ 独立 | なし |
| 3 | C-3 | `diff-view/` (6ファイル) | `git add` でステージ追加 | ✅ 独立 | なし |
| 4 | C-4 | `DiffContentViewer.tsx` | 展開バーの挙動修正（未実装明示 or 削除 or 実装） | ❌ C-3に依存 | C-3後 |

### Important Fixes（一部並列 OK）

| # | タスクID | 対象ファイル | 内容 | 並列可否 | 依存 |
|---|---------|------------|------|---------|------|
| 5 | I-1 | `app_devpanel_api.go` | inner loop でのサイズ超過チェック追加 | ✅ 独立 | なし |
| 6 | I-2 | `app_devpanel_api_test.go` | `os.WriteFile`等のエラーチェック追加（全箇所） | ✅ 独立（5と同時可） | なし |
| 7 | I-3 | `diff-view/index.ts` | `position` フィールド設定要否の確認・追加 | ✅ 独立 | C-3後 |
| 8 | I-4 | `command_router_handlers_window.go` | `rollbackSession` 呼び出しコメント追加 | ✅ 独立 | なし |
| 9 | I-5 | `errorLogStore.ts` | `unreadCount` 計算を seq ベースに改善 | ✅ 独立 | なし |
| 10 | I-6 | `useDiffView.ts` | loadDiff 二重呼び出し防止 | ✅ 独立 | C-3後 |
| 11 | I-7 | `DiffFileSidebar.tsx` | 初期高さ 400px ハードコード解消 | ✅ 独立 | C-3後 |
| 12 | I-8 | `app_session_log.go` | NOTE コメント修正（C-1 と同時対応） | ⚠️ C-1 と同ファイル | C-1 と一括 |

### Suggestions（任意）

| # | タスクID | 対象ファイル | 内容 | 並列可否 |
|---|---------|------------|------|---------|
| 13 | S-1 | `app_devpanel_api.go` | WalkDir エラーログ追加 | ✅ 独立（I-1 と同時可） |
| 14 | S-2 | `app_devpanel_api.go` | UTF-8 境界トリム | ✅ 独立 |
| 15 | S-3 | `session_manager_window_test.go` 等 | テストヘルパー `injectWindowForTesting` 作成 | ✅ 独立 |
| 16 | S-4 | `viewerRegistry.ts` | `position` デフォルト動作コメント | ✅ 独立 |
| 17 | S-5 | `DiffContentViewer.tsx` | IIFE 可読性改善 | ✅ 独立（C-4 対応後） |
| 18 | S-6 | `diffViewTypes.ts` | `models.ts` 型との重複解消 | ✅ 独立 |
| 19 | S-7 | `useBackendSync.ts` | デバウンスタイマースコープコメント | ✅ 独立 |
| 20 | S-8 | `app_session_log_types.go` 等 | uint64 精度問題の文書化 | ✅ 独立 |

---

## 推奨修正順序（作業者向けガイド）

```
第1フェーズ（並列可、最優先）:
  Worker A: C-1 + I-8（app_session_log.go 同ファイル修正）
  Worker B: C-2（ErrorLogView.tsx）
  Worker C: C-3（git add diff-view/）

第2フェーズ（C-3完了後、並列可）:
  Worker A: C-4 + I-3 + I-6 + I-7 + S-5（diff-view 関連）
  Worker B: I-1 + I-2 + S-1 + S-2（app_devpanel_api.go 関連）
  Worker C: I-4（tmux ハンドラコメント）
  Worker D: I-5 + S-7（errorLogStore / useBackendSync）

第3フェーズ（任意）:
  S-3〜S-8（推奨改善、既存テスト合格を確認しながら随時対応）
```

---

## 修正作業 競合確認表

下表で「修正時の注意点」と「同時作業で衝突するか」を示す。

| タスク | 修正ファイル | 同ファイルで衝突するタスク | 衝突リスク |
|-------|------------|--------------------------|-----------|
| C-1 | `app_session_log.go` | I-8（同ファイル） | ⚠️ 同時修正は一人で実施 |
| C-2 | `ErrorLogView.tsx` | なし | ✅ 安全 |
| C-3 | `diff-view/` (新規追加) | なし | ✅ 安全 |
| C-4 | `DiffContentViewer.tsx` | S-5 | ⚠️ S-5 は C-4 後に実施 |
| I-1 | `app_devpanel_api.go` | S-1, S-2 | ⚠️ 同ファイル、同時なら注意 |
| I-2 | `app_devpanel_api_test.go` | なし | ✅ 安全 |
| I-3 | `diff-view/index.ts` | なし | ✅ 安全（C-3 後） |
| I-4 | `command_router_handlers_window.go` | なし | ✅ 安全 |
| I-5 | `errorLogStore.ts` | なし | ✅ 安全 |
| I-6 | `useDiffView.ts` | なし | ✅ 安全（C-3 後） |
| I-7 | `DiffFileSidebar.tsx` | なし | ✅ 安全（C-3 後） |
| S-3 | `session_manager_window_test.go` 等 | なし（新規ヘルパー追加） | ✅ 安全 |
| S-6 | `diffViewTypes.ts` | C-4 | ⚠️ インターフェース変更なら C-4 後 |

---

*生成: GitHub Copilot (Claude Sonnet 4.6) / 2026-02-21 22:50*
