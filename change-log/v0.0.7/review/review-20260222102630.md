# PR Review Summary

**レビュー実施日時**: 2026-02-22 10:26:30 JST  
**対象差分ファイル数**: 35ファイル  
**レビュー方針**: `review-pr-para.prompt.md` に基づく包括レビュー  

---

## カテゴリ分類

| カテゴリ | 対象ファイル数 | 概要 |
|---------|:---:|------|
| A. バックエンド - DevPanel API | 4 | WorkingDiff機能追加、diff解析ロジック |
| B. バックエンド - セッションログ | 7 | seq番号導入、ping+fetchモデル化、TeeHandler改善 |
| C. バックエンド - アプリ基盤 | 6 | イベントポリシー、ライフサイクル、testutil |
| D. バックエンド - Tmux | 8 | 1-windowモデル整備、テスト追加 |
| E. フロントエンド - コンポーネント/ビュー | 5 | ActivityStrip位置制御、ViewerSystem動的ショートカット |
| F. フロントエンド - インフラ/ストア | 5 | errorLogStore刷新、ping+fetchモデル |
| G. フロントエンド - Wails生成コード | 3 | 型定義追加（自動生成） |

---

## Critical Issues (2件)

### C-01. `new(true)` / `new(false)` はGo 1.26でもコンパイルエラー

- **重要度**: 🔴 Critical (ビルド不可)
- **該当ファイル**:
  - `myT-x/app_session_api_test.go` (行68,69,82,90,356,364,370,371)
  - `myT-x/internal/tmux/command_router_env_test.go` (行373,743,744,875,876,896,919,964,1028,1029)
  - `myT-x/internal/tmux/command_router_handlers_window_test.go` (行606,622)
- **詳細**: `testutil.Ptr(true)` を `new(true)` に置換しているが、`new` ビルトインはリテラル値を引数に取れない。Go の `new(T)` は**型**を引数に取るため、`new(true)` はコンパイルエラーとなる。`new(bool)` はゼロ値の `*bool` を返すが `false` になるため意図した動作にならない。
- **修正案**: `go fix` による `//go:fix inline` のインライン展開結果を確認すること。Go 1.26 の `go fix` が `testutil.Ptr(true)` を正しく展開した結果を再確認する必要がある。もし `go fix` の出力が `new(true)` であれば Go 1.26 固有の新構文の可能性があるが、標準の Go 仕様には存在しない。

> **NOTE**: CLAUDE.md に「Go言語は、1.26が最新である為、変更しない事」および「Go言語に対する開発は常に`go fix ./...`を用いて、コードをモダン化してから〜」と記載あり。Go 1.26 で `new(true)` が composite literal 的に使えるようになった可能性がある。**ビルド確認が最優先**。

### C-02. `testutil.Ptr` のインライン化が不完全な置換を生む箇所の確認

- **重要度**: 🔴 Critical (ビルド不可の可能性)
- **該当ファイル**: `myT-x/internal/tmux/command_router_env_test.go`
- **詳細**: `testutil` パッケージの import が削除されているが（行3-4で `myT-x/internal/testutil` が除去）、`new(false)` も同じ問題を持つ。`testutil.Ptr(false)` → `new(false)` の置換も `false` はリテラルであり型ではない。
- **修正案**: C-01と同様、ビルド確認が必須。

---

## Important Issues (12件)

### I-01. `parseDiffHeaderPaths` のパス対称性ヒューリスティックが rename で誤作動する可能性

- **重要度**: 🟡 Important
- **該当ファイル**: `myT-x/app_devpanel_api.go` (新規追加 `parseDiffHeaderPaths`)
- **詳細**: 「パス長の対称性」で分割点を見つけるロジック（行376-383）は、同名ファイルの修正では正しく動作するが、renameで `a/old b/new` のパスが偶然同じ長さの場合、対称性チェックに引っかかって誤ったパース結果を返す可能性がある。
- **例**: `a/ab b/cd` (oldPath="ab", newPath="cd", len同じ) の場合、`content[:pathLen]` = `"ab"` と `content[pathLen+3:]` = `"cd"` は不一致なのでフォールバックに行くため**実害は無い**が、フォールバック前に不要な計算が走る。
- **修正案**: ヒューリスティック部分にコメントで「rename時はフォールバックに到達する」旨を明記すると可読性が向上する。

### I-02. `DevPanelWorkingDiff` で `git diff HEAD` がステージング済み・未ステージングの差分を正確に返さない

- **重要度**: 🟡 Important
- **該当ファイル**: `myT-x/app_devpanel_api.go` (新規追加 `DevPanelWorkingDiff`)
- **詳細**: `git diff HEAD` は「HEAD対ワーキングツリー」の差分を返すが、ステージングされた変更とステージングされていない変更の**合算**を返す。ただし、ステージした後にワーキングツリーで追加変更した場合、ステージ上の変更だけが `git diff HEAD` に含まれ、ワーキングツリー上の未ステージ変更は表示されない…ということは**無い**。`git diff HEAD` は「HEAD vs ワーキングツリー」なのでステージ状態は無視する。
- **結論**: 仕様通りであり問題無し。ただし関数コメントに「staged + unstaged」と書いてあるが、より正確には「HEAD vs working tree (staging area is transparent)」とすべき。
- **修正案**: コメントの正確化のみ。

### I-03. `buildUntrackedFileDiffSingle` でシンボリックリンクのファイルを追跡してしまう

- **重要度**: 🟡 Important
- **該当ファイル**: `myT-x/app_devpanel_api.go` (新規追加 `buildUntrackedFileDiffSingle`)
- **詳細**: `os.Stat` はシンボリックリンクを解決してターゲットの情報を返す。シンボリックリンク先が巨大ファイルや循環参照の場合、予期しない動作になる可能性がある。
- **修正案**: `os.Lstat` の使用を検討するか、シンボリックリンクをスキップするガードを追加する。ただし、CLAUDE.md に「Windows対応アプリケーション」とあるため、Windows環境ではシンボリックリンクは稀であり、優先度は低い。

### I-04. `WorkingDiffStatus` の型定義が `type alias` になっている

- **重要度**: 🟡 Important
- **該当ファイル**: `myT-x/app_devpanel_types.go` (行20)
- **詳細**: `type WorkingDiffStatus = string` は型エイリアスであり、新しい型定義（`type WorkingDiffStatus string`）ではない。型エイリアスでは `WorkingDiffStatus` 固有のメソッドを定義できず、型安全性が低下する。
- **修正案**: JSONシリアライゼーションとの互換性のために意図的にエイリアスにしている可能性がある。Wails の型バインディングでは `string` エイリアスが必要なケースがあるため、設計意図の確認を推奨。

### I-05. `errorLogStore` の `normalizeEntries` で `seq` が無効なエントリがサイレントに除外される

- **重要度**: 🟡 Important
- **該当ファイル**: `myT-x/frontend/src/stores/errorLogStore.ts` (行27-32)
- **詳細**: `isValidSeq` で `seq <= 0` のエントリは `filter` で除外される。初期化時やバックエンドからの応答が空配列の場合は問題ないが、バックエンドのバグで `seq: 0` が送られた場合にサイレントにエントリが消える。
- **修正案**: DEV環境では `console.warn` で通知するガードの追加を検討。

### I-06. `useBackendSync` のデバウンスタイマー内で `isMountedRef` チェックが不完全

- **重要度**: 🟡 Important
- **該当ファイル**: `myT-x/frontend/src/hooks/useBackendSync.ts` (行472-518)
- **詳細**: `fetchErrorLog` 内で `isMountedRef.current` をチェックしているが、`setTimeout` のコールバック（`fetchErrorLog` を呼ぶ側）では `isMountedRef` チェックが無い。アンマウント後にタイマーが発火して `GetSessionErrorLog` API が呼ばれ、その `.then` で `isMountedRef.current` = false により結果が無視される（実害は無いが無駄なAPI呼び出しが発生）。
- **修正案**: タイマー発火時にも `isMountedRef.current` をチェックしてからfetchすると、無駄なAPI呼び出しを回避できる。

### I-07. `ErrorLogView` の `useEffect` 依存配列変更の妥当性

- **重要度**: 🟡 Important
- **該当ファイル**: `myT-x/frontend/src/components/viewer/views/error-log/ErrorLogView.tsx` (行9, 19)
- **詳細**: `useEffect` の依存配列から `bodyRef` を削除して `[]` にしている。`bodyRef` は `useRef` で作成されているため React のリファレンスは安定しており、依存配列に含めても含めなくても動作に差は無い。しかし、`bodyRef.current` が `null` の状態で `useEffect` が実行される可能性がある（初回レンダリング時）。
- **修正案**: 問題無し。`bodyRef.current` の null チェックは既に内部で行われているはず。ESLint の exhaustive-deps ルール警告への対応として妥当な変更。

### I-08. `viewerRegistry` のグローバルレジストリが HMR で正しくリセットされない可能性

- **重要度**: 🟡 Important
- **該当ファイル**: `myT-x/frontend/src/components/viewer/viewerRegistry.ts`
- **詳細**: `import.meta.hot.dispose` で `registry.length = 0` としているが、各ビューの `registerView` の side-effect import が HMR で再実行されない場合、レジストリが空のままになる。Vite の HMR では side-effect import モジュールが更新されない限り再実行されないため、`viewerRegistry.ts` だけが更新された場合にビューが消える可能性がある。
- **修正案**: `import.meta.hot.accept` を追加して自身の変更を適切にハンドルするか、HMR 時のビュー再登録メカニズムを検討する。

### I-09. `TeeHandler.Handle` でコールバックの panic を recover する変更がパフォーマンスに影響

- **重要度**: 🟡 Important
- **該当ファイル**: `myT-x/internal/sessionlog/handler.go` (行49-52)
- **詳細**: 即時関数 + `defer recover` をすべての Warn/Error レベルのログ出力で実行するため、パフォーマンスオーバーヘッドがある。ただし、CLAUDE.md に記載の通りこれは Warn/Error レベル（低頻度）に限定されるため実用上の影響は軽微。
- **修正案**: 現状のまま問題無し。パフォーマンスが問題になった場合のみ最適化を検討。

### I-10. `writeSessionLogEntry` の `syncFile` 変数によるロック外 `Sync()` で TOCTOU リスク

- **重要度**: 🟡 Important
- **該当ファイル**: `myT-x/app_session_log.go` (行87-96)
- **詳細**: ロック内で `syncFile = a.sessionLogFile` を取得し、ロック外で `syncFile.Sync()` を呼ぶ設計。`closeSessionLog()` が同時に呼ばれた場合、`syncFile` が既にクローズされたファイルポインタを指す可能性がある。これに対して `os.ErrClosed` のチェックが追加されているため、**設計意図は正しい**。
- **修正案**: 問題無し。`errors.Is(syncErr, os.ErrClosed)` のガードにより安全に動作する。コメントも適切。

### I-11. `handleNewWindow` でスナップショット取得失敗時にロールバックへ変更

- **重要度**: 🟡 Important
- **該当ファイル**: `myT-x/internal/tmux/command_router_handlers_window.go` (行300-303)
- **詳細**: 従来は `nil` フォールバック（レガシーパス）だったのが、`rollbackSession` に変更されている。これは「スナップショットが取得できない＝セッションが消えた」という判定で、より厳格な動作になる。1-window モデルでは正しい判断だが、タイミングによっては正常なケースでロールバックが発生するリスクが無いか確認が必要。
- **修正案**: `CreateSession` 直後に `GetSession` しているため、間に別スレッドが `RemoveSession` しない限り安全。ロック粒度を確認したが、`CreateSession` と `GetSession` の間にロックが解放される可能性はある。ただし想定される運用上の問題は低い。

### I-12. テストでの内部状態直接操作パターンが4箇所以上で重複

- **重要度**: 🟡 Important
- **該当ファイル**: 
  - `myT-x/internal/tmux/session_manager_window_test.go` (行72-98, 150-175)
  - `myT-x/internal/tmux/session_manager_directional_test.go` (行38-61)
  - `myT-x/internal/tmux/command_router_handlers_window_test.go` (行332-349)
- **詳細**: Multi-window状態を構築するために `manager.mu.Lock()` + 内部フィールド直接操作のパターンが4箇所で重複している。コメントに「5+で共通ヘルパー抽出」とあるが、テストコードの保守性を考えると現時点で共通化を検討する価値がある。
- **修正案**: `injectWindow(manager, sessionName)` のようなテストヘルパーの抽出を推奨。ただし、CLAUDE.md の製品仕様に「1-window モデル」とあるため、これは今後マルチウィンドウ対応時に自然と解消される可能性がある。

---

## Suggestions (14件)

### S-01. `parseDiffHeaderPaths` に関するエッジケーステストの追加

- **該当ファイル**: `myT-x/app_devpanel_api_test.go`
- **詳細**: パスに `" b/"` を含むファイル名（例: `a/file b/name.txt`）のテストケースが無い。フォールバックの `strings.Index(header, " b/")` が最初の `" b/"` で分割するため、パスに `" b/"` が含まれると誤って分割される。
- **修正案**: 対称性ヒューリスティックで回避されるケースと回避されないケースのテストを追加。

### S-02. `devPanelMaxUntrackedFileSize` の定数がDevPanel全体の `devPanelMaxDiffSize` と別管理

- **該当ファイル**: `myT-x/app_devpanel_api.go`
- **詳細**: untracked ファイル個別のサイズ上限（100KB）と diff 全体の上限（500KB）が別定数で管理されている。コメントで関連性を明記するとよい。
- **修正案**: `devPanelMaxUntrackedFileSize` のコメントに「`devPanelMaxDiffSize` とは独立した制限」と明記。

### S-03. `buildUntrackedFileDiffSingle` の `OldPath` フィールドが新規ファイルなのに設定されている

- **該当ファイル**: `myT-x/app_devpanel_api.go` (行279)
- **詳細**: untracked（新規）ファイルで `OldPath: normalizedPath` を設定しているが、新規ファイルには旧パスが存在しない。`""` か `"/dev/null"` が適切。
- **修正案**: フロントエンド側で `OldPath` を使用していない場合は実害無し。ただし、フロントエンドのファイルリネーム表示ロジックに影響する可能性があるため、空文字列に変更を推奨。

### S-04. `collectUntrackedFiles` で `-z` フラグ使用時の末尾 NUL バイト処理

- **該当ファイル**: `myT-x/app_devpanel_api.go` (行140-150)
- **詳細**: `git ls-files -z` の出力は各エントリを NUL で区切るが、最後のエントリの後にも NUL が付与される。`parseNULSeparatedGitPaths` で空文字列をスキップしているため正しく処理される。
- **修正案**: 問題無し。

### S-05. `SessionLogEntry` の `Seq` フィールドが `uint64` だが JSON では数値精度の問題

- **該当ファイル**: `myT-x/app_session_log_types.go` (行13-15)
- **詳細**: コメントに「uint64 values above 2^53-1 lose precision in JavaScript」と明記されている。`sessionLogMaxEntries=10000` の範囲では問題無し。将来的に `sessionLogMaxEntries` が変更された場合の注意喚起として適切なコメント。
- **修正案**: 問題無し。

### S-06. `ViewerSystem` のショートカットマップが `useEffect` 内で毎回構築される

- **該当ファイル**: `myT-x/frontend/src/components/viewer/ViewerSystem.tsx` (行36-48)
- **詳細**: `useEffect` の依存配列 `[activeViewId, toggleView, closeView]` により、`activeViewId` が変わるたびにショートカットマップが再構築される。パフォーマンス上は微小だが、レジストリは静的なので `useMemo` でメモ化すると効率的。
- **修正案**: `getRegisteredViews()` の結果を `useMemo` でキャッシュし、ショートカットマップの構築を `useMemo` に移す。

### S-07. `ActivityStrip` で `renderViewButton` に `key` が props として渡されていない

- **該当ファイル**: `myT-x/frontend/src/components/viewer/ActivityStrip.tsx`
- **詳細**: `renderViewButton` 関数は `<button key={view.id}>` を返しているが、`map` のコールバックとして使用する場合、React は配列要素の `key` を認識する。この場合は問題無い。
- **修正案**: 問題無し。

### S-08. CSS の `--warning` 変数が新規追加だが、他のコンポーネントでの使用確認

- **該当ファイル**: `myT-x/frontend/src/styles/base.css`, `myT-x/frontend/src/styles/viewer.css`
- **詳細**: `--warning` と `--warning-10` が追加され、既存のハードコード値（`rgb(246, 173, 85)`）を置換している。これは良いリファクタリング。
- **修正案**: 他の箇所で同じ色値がハードコードされていないか横断検索を推奨。

### S-09. `ViewerSystem` に `import "./views/diff-view"` が追加されているが、差分に diff-view の実装が含まれていない

- **該当ファイル**: `myT-x/frontend/src/components/viewer/ViewerSystem.tsx` (行23)
- **詳細**: `import "./views/diff-view"` が追加されているが、`diff-view` ディレクトリの差分ファイルが review/temp に存在しない。diff-view コンポーネントが既に存在しているか、または別PRで追加されている可能性がある。
- **修正案**: `diff-view` ディレクトリの存在を確認。存在しない場合はランタイムエラーになる。

### S-10. `newSessionLogRingBuffer` のキャパシティ0クランプのテストが追加されているが、負数のテストが無い

- **該当ファイル**: `myT-x/app_session_log_test.go`
- **詳細**: `TestNewSessionLogRingBuffer_ClampsNonPositiveCapacity` で0のケースはテストされているが、負数（-1など）のケースが無い。実装は `capacity < 1` でクランプしているため負数も1にクランプされるが、テストで明示的に確認すべき。
- **修正案**: テーブル駆動テストに `capacity: -1` のケースを追加。

### S-11. Wails生成コード（`models.ts`, `App.js`, `App.d.ts`）の順序変更

- **該当ファイル**: `myT-x/frontend/wailsjs/go/main/App.d.ts`, `App.js`, `models.ts`
- **詳細**: `GetSessionErrorLog` と `GetSessionLogFilePath` の順序が変更されている。これは `wails generate` コマンドによる自動生成の結果であり、手動変更ではない。
- **修正案**: 自動生成コードのため問題無し。

### S-12. `testutil.Ptr` に `//go:fix inline` ディレクティブが追加

- **該当ファイル**: `myT-x/internal/testutil/helpers.go` (行10)
- **詳細**: Go 1.26 の `go fix` ツール向けのインライン展開指示。これにより `testutil.Ptr(true)` が呼び出し元でインライン展開される。C-01の `new(true)` 問題と連動する変更。
- **修正案**: `go fix ./...` の実行結果として `new(true)` が正しい Go 1.26 構文であることを確認。

### S-13. `removeWindowAtIndexLocked` の `removedPanes` 初期化変更

- **該当ファイル**: `myT-x/internal/tmux/session_manager_windows.go` (行106)
- **詳細**: `make([]*TmuxPane, 0)` → `var removedPanes []*TmuxPane` への変更。`nil` スライスと空スライスの違いに注意が必要だが、直後に `window != nil` の場合は `make` で再初期化されるため問題無し。
- **修正案**: 問題無し。Go best practice に沿った変更。

### S-14. `DevPanelCommitDiff` に `--` ターミネーターが追加

- **該当ファイル**: `myT-x/app_devpanel_api.go` (行473)
- **詳細**: `git diff-tree --root -p commitHash` に `--` を追加。これにより、コミットハッシュがファイル名と衝突する可能性を排除するセキュリティ強化。`commitHash` は `ValidateCommitish` でバリデーション済みだが、防御的プログラミングとして適切。
- **修正案**: 問題無し。推奨される変更。

---

## Positive Observations (良い点)

### P-01. ping + fetch モデルへの移行
イベント `app:error-logged`（ペイロード付き）から `app:error-log-updated`（ペイロード無し）への変更は、スロットリングによるデータ損失を完全に排除する優れた設計変更。フロントエンドは常に最新のフルスナップショットを取得するため、エントリの欠落が起きない。

### P-02. `seq` 番号による安定したフロントエンド重複排除
従来の弱い複合キー（ts|level|msg|source）から、サーバー側で付与される単調増加シーケンス番号に変更。秒精度のタイムスタンプによる衝突問題を根本解決。

### P-03. リングバッファのゼロ値防御
`newSessionLogRingBuffer` でキャパシティ≤0を1にクランプする変更と、`push` で `bufCap == 0` の早期リターンの追加により、modulo-by-zero パニックを防御。

### P-04. `TeeHandler.Handle` のコールバック panic 防御
コールバックでの panic が `defer recover` で捕捉され、ベースハンドラの結果を保持したまま安全に処理される。slog への再帰呼び出しリスクも適切に回避（stderr 出力）。

### P-05. テストコードの充実
新規追加された関数に対して、テーブル駆動テストが網羅的に作成されている。特に `parseWorkingDiff` のテストはエッジケース（クォートパス、Windowsの改行、リネーム等）を広くカバー。

### P-06. フィールド数ガードテスト
`WorkingDiffFile` と `WorkingDiffResult` に対するフィールド数ガードテストにより、構造体変更時のフロントエンド側の更新漏れを防止。

### P-07. セッションログファイル名に PID を付与
サブ秒での再起動時のファイル名衝突を防止する改善。

### P-08. ViewerSystem のショートカット動的バインディング
個別のハードコードされた `if` 文から、レジストリベースの動的ショートカットマップへの変更により、新しいビューの追加が容易に。

### P-09. `devPanelExcludedDirs` の再利用
untrackedファイルの walk でも `devPanelExcludedDirs` を参照して `node_modules` 等を除外しており、一貫性が保たれている。

---

## Recommended Action

1. **🔴 最優先**: C-01, C-02 の `new(true)` / `new(false)` がGo 1.26でビルド可能かを**即座に確認**する
   - `go build ./...` でビルドエラーが出る場合、`Ptr` のインライン展開結果を手動修正する
2. **🟡 重要**: I-09 の `diff-view` importの存在確認
3. **🟡 推奨**: I-03, I-06, I-12 のガード追加・リファクタリング
4. 残りの Suggestions は開発リソースに余裕がある場合に対応

---

## 並列作業可否テーブル

以下の表は、上記の指摘事項を修正する際に、**各タスクを並列で作業できるか否か**を示したものです。

| # | タスクID | 対象ファイル | 修正内容 | 並列作業 | 備考 |
|:-:|:-----:|:-----------|:---------|:-------:|:-----|
| 1 | C-01 | `app_session_api_test.go` | `new(true)` → 正しい構文への修正 | ⚠️ 条件付き可 | C-02と同一パターン。ビルド確認後に **全ファイル一括** で修正すべき |
| 2 | C-01 | `command_router_env_test.go` | `new(true)`/`new(false)` → 正しい構文への修正 | ⚠️ 条件付き可 | #1と同パターン、両方同時にやると衝突しない |
| 3 | C-01 | `command_router_handlers_window_test.go` | `new(true)` → 正しい構文への修正 | ⚠️ 条件付き可 | #1と同パターン、別ファイルなので並列可 |
| 4 | C-02 | `command_router_env_test.go` | testutil import 削除の整合性確認 | ❌ 不可 | #2と同一ファイル、#2と同時に修正する |
| 5 | I-01 | `app_devpanel_api.go` | `parseDiffHeaderPaths` へコメント追加 | ✅ 可 | 他の修正と独立 |
| 6 | I-02 | `app_devpanel_api.go` | `DevPanelWorkingDiff` コメント修正 | ❌ 不可 | #5と同一ファイル、まとめて修正 |
| 7 | I-03 | `app_devpanel_api.go` | `os.Lstat` への変更検討 | ❌ 不可 | #5, #6と同一ファイル、まとめて修正 |
| 8 | I-04 | `app_devpanel_types.go` | `WorkingDiffStatus` 型エイリアスの確認 | ✅ 可 | 他ファイルと独立 |
| 9 | I-05 | `errorLogStore.ts` | DEV環境 console.warn 追加 | ✅ 可 | 他ファイルと独立 |
| 10 | I-06 | `useBackendSync.ts` | `isMountedRef` チェック追加 | ✅ 可 | 他ファイルと独立 |
| 11 | I-07 | `ErrorLogView.tsx` | 確認済み 対応不要 | - | 対応不要 |
| 12 | I-08 | `viewerRegistry.ts` | HMR対応検討 | ✅ 可 | 他ファイルと独立 |
| 13 | I-09 | `handler.go` | パフォーマンスモニタリング（将来対応） | - | 対応不要 |
| 14 | I-10 | `app_session_log.go` | 確認済み 対応不要 | - | 対応不要 |
| 15 | I-11 | `handlers_window.go` | ロック粒度確認（将来対応） | - | 対応不要 |
| 16 | I-12 | tmux テスト4ファイル | 共通ヘルパー抽出 | ⚠️ 条件付き可 | 4ファイル跨ぎ。一括作業推奨 |
| 17 | S-01 | `app_devpanel_api_test.go` | エッジケーステスト追加 | ✅ 可 | #5-7 と別ファイル |
| 18 | S-03 | `app_devpanel_api.go` | OldPath を空文字に変更 | ❌ 不可 | #5,6,7と同一ファイル |
| 19 | S-06 | `ViewerSystem.tsx` | useMemo 追加 | ✅ 可 | 他ファイルと独立 |
| 20 | S-09 | `ViewerSystem.tsx` | diff-view 存在確認 | ❌ 不可 | #19と同一ファイル |
| 21 | S-10 | `app_session_log_test.go` | 負数テスト追加 | ✅ 可 | 他ファイルと独立 |

### 並列作業グループ一覧（作業者向け）

効率的に修正するにあたり、以下のグループに分けて並列作業することを推奨します。

| グループ | 対象タスク | 対象ファイル | 作業者 | 説明 |
|:-------:|:--------:|:-----------|:-----:|:-----|
| **G1** | C-01, C-02 (#1-4) | `app_session_api_test.go`, `command_router_env_test.go`, `command_router_handlers_window_test.go` | 1人 | `new(true)` 一括修正。ビルド確認含む |
| **G2** | I-01, I-02, I-03, S-03 (#5-7, 18) | `app_devpanel_api.go` | 1人 | DevPanel API の修正・コメント改善 |
| **G3** | I-04 (#8) | `app_devpanel_types.go` | G2と兼任可 | 型定義の確認 |
| **G4** | I-05 (#9) | `errorLogStore.ts` | 1人 | フロントエンドストア修正 |
| **G5** | I-06 (#10) | `useBackendSync.ts` | 1人 | フロントエンドフック修正 |
| **G6** | I-08 (#12) | `viewerRegistry.ts` | G4/G5と兼任可 | HMR対応 |
| **G7** | S-06, S-09 (#19,20) | `ViewerSystem.tsx` | 1人 | ViewerSystem改善 |
| **G8** | I-12, (#16) | tmux テスト4ファイル | 1人 | テストヘルパー共通化 |
| **G9** | S-01 (#17) | `app_devpanel_api_test.go` | G2と兼任可 | テスト追加 |
| **G10** | S-10 (#21) | `app_session_log_test.go` | 誰でも | テスト追加 |

> **凡例**:
> - ✅ 可: 他タスクと依存関係無し。完全に並列作業可能
> - ⚠️ 条件付き可: 同パターンの修正だが別ファイルのため並列可能。ただし修正方針を先に統一する必要あり
> - ❌ 不可: 同一ファイルへの修正のため、同グループ内で逐次作業する

### 依存関係図

```
G1 (Critical: new(true)修正)  ── ビルド確認後に他グループ着手
   │
   ├── G2 (DevPanel API)
   │   ├── G3 (types.go - 兼任可)
   │   └── G9 (テスト追加 - 兼任可)
   │
   ├── G4 (errorLogStore) ── 独立
   ├── G5 (useBackendSync) ── 独立
   ├── G6 (viewerRegistry) ── 独立
   ├── G7 (ViewerSystem) ── 独立
   ├── G8 (tmuxテスト) ── 独立
   └── G10 (session_log_test) ── 独立
```

**G1がCriticalのためまず最初に着手し、ビルドが通ることを確認してから他グループを並列で進める**のが最も効率的です。G2-G10は相互に依存関係が無いため、最大8名で完全並列作業が可能です。
