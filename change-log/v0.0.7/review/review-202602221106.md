# PR レビュー結果（統合版）

> **生成日時**: 2026-02-22 11:06 JST  
> **統合元**: review-20260222102630, review-20260222103036, review-20260222103501, review-20260222104026  
> **対象差分ディレクトリ**: `D:\myT-x\dev-myT-x\review\temp`  
> **差分ファイル数**: 35〜38 ファイル  
> **レビュー方針**: [review-pr-para.prompt.md](./.github/prompts/review-pr-para.prompt.md)  
> **レビュー手法**: 4〜5カテゴリ並列レビュー（サブエージェント同時実行）×4回

---

## 変更概要

本PRは主に以下の機能を追加・変更しています：

1. **セッションログ刷新**: `app:error-logged` → `app:error-log-updated`（Ping/Fetch モデル）へ移行、`seq` フィールドによる安定した重複排除
2. **DevPanel WorkingDiff**: 作業中のgit差分（未追跡ファイル含む）を取得する新しいAPIの追加
3. **1ウィンドウモデルの整備**: `AddWindow`/`WindowIndexInSession` の削除、ロールバック強化
4. **フロントエンドアーキテクチャ**: ビューレジストリのグローバル化・HMR対応、ActivityStripの上下分割

---

## カテゴリ別ファイル分類

| カテゴリ | 対象ファイル |
|---------|-------------|
| A. セッションログ バックエンド (Go) | `app.go`, `app_session_log.go`, `app_session_log_types.go`, `app_session_log_test.go`, `app_events.go`, `app_lifecycle.go`, `app_lifecycle_test.go`, `internal/sessionlog/handler.go`, `internal/sessionlog/handler_test.go` |
| B. DevPanel WorkingDiff バックエンド (Go) | `app_devpanel_api.go`, `app_devpanel_types.go`, `app_devpanel_api_test.go` |
| C. tmux セッション管理 (Go) | `session_manager_windows.go`, `command_router_handlers_window.go`, `command_router_handlers_window_test.go`, `session_manager_test.go`, `session_manager_directional_test.go`, `session_manager_pane_io_test.go`, `command_router_env_test.go`, `app_session_api_test.go`, `internal/testutil/helpers.go` |
| D. フロントエンド (TypeScript/React) | `errorLogStore.ts`, `useBackendSync.ts`, `viewerRegistry.ts`, `ActivityStrip.tsx`, `ViewerSystem.tsx`, `ErrorLogView.tsx`, `error-log/index.ts`, `api.ts`, CSS, Wails自動生成ファイル |

---

## レビューサマリー

| 重要度 | 件数 |
|--------|------|
| 🔴 CRITICAL（マージ前確認必須） | 1 |
| 🟡 IMPORTANT（対応推奨） | 18 |
| 🔵 SUGGESTION（提案） | 20 |
| ✅ POSITIVE（良い点） | 多数 |

---

## 🔴 CRITICAL（マージ前確認必須）

### CR-01: `new(true)` / `new(false)` の Go 文法的問題

**影響ファイル**:
- `app_session_api_test.go`
- `command_router_env_test.go`
- `command_router_handlers_window_test.go`

**詳細**: `testutil.Ptr(true)` → `new(true)` への置き換えについて、Go の `new(T)` は**型**を引数に取るため、`new(true)` という記法は標準 Go ではコンパイルエラーとなる。`new(bool)` はゼロ値（`false`）へのポインタを返すため意図した動作にもならない。

> **NOTE**: CLAUDE.md に「Go言語は 1.26 が最新」「`go fix ./...` を用いてコードをモダン化」と記載あり。Go 1.26 で `new(true)` が使えるようになった可能性がある。**ビルド確認が最優先**。

**修正案**:
- `go build ./...` でビルドエラーが出る場合、`testutil.Ptr(true)` に戻すか、正しい記法に修正
- `go fix` のインライン展開結果として正しいか確認

---

## 🟡 IMPORTANT（対応推奨）

### IMP-01: `parseDiffHeaderPaths` におけるパス名内 ` b/` 誤分割

**ファイル**: `app_devpanel_api.go` — `parseDiffHeaderPaths`

**問題**: フォールバックの `strings.Index(header, " b/")` は最初の ` b/` 出現位置で分割する。パス名自体に ` b/` が含まれる場合（例: `a/docs b/images/README.md b/README.md`）、分割点が誤り `OldPath`/`Path` が壊れる。またリネーム差分では対称長チェックが成立しないため必ずフォールバックに落ちる。

**修正案**: `rename from`/`rename to` 行からパスを先読みして上書きするロジックの追加、またはフォールバック候補を全 ` b/` 出現位置でブルートフォース検証する。最低限、ヒューリスティック部分にコメントで「rename時はフォールバックに到達する」旨を明記する。

---

### IMP-02: `isFreshRepo` 判定がロケール依存

**ファイル**: `app_devpanel_api.go` — `DevPanelWorkingDiff`

**問題**:
```go
isFreshRepo := strings.Contains(errMsg, "unknown revision") ||
    strings.Contains(errMsg, "bad revision")
```
`git` の `LC_MESSAGES` が非英語環境ではメッセージが変わり、フレッシュリポジトリで untracked ファイルが取得できなくなる。

**修正案**: `git rev-parse --verify HEAD` を事前実行してHEADの存在を確認するか、`*exec.ExitError` の終了コードで判断する。

---

### IMP-03: `buildUntrackedFileDiffSingle` — `isPathWithinBase` チェック欠落

**ファイル**: `app_devpanel_api.go`

**問題**: 同コードベース内の他のファイルアクセス関数（`resolveAndValidatePath` 等）では `isPathWithinBase` による境界チェックを行っているが、この関数では省略。`git ls-files` は理論上リポジトリ外パスを返さないが、防御的コーディング規約との不整合がある。

**修正案**:
```go
absPath := filepath.Join(workDir, filepath.FromSlash(relPath))
if !isPathWithinBase(absPath, workDir) {
    slog.Warn("[DEVPANEL] untracked path escapes workDir", "path", relPath)
    return nil
}
```

---

### IMP-04: バイト境界切り捨てで部分エントリが混入

**ファイル**: `app_devpanel_api.go` — `DevPanelWorkingDiff`

**問題**: `raw = raw[:devPanelMaxDiffSize]` で diff block 途中で切断されると、最終ブロックの `Status` が `"modified"` と誤判定される。`truncated=true` はセットされるが、壊れたエントリが Files に含まれる。

**修正案**: 切り捨て後の `raw` から末尾の不完全ブロック（最後の `"diff --git "` 以降）を除去してから `parseWorkingDiff` に渡す。

---

### IMP-05: `strings.Split(raw, "diff --git ")` によるコンテンツ内文字列との衝突

**ファイル**: `app_devpanel_api.go` — `parseWorkingDiff`

**問題**: ファイルの内容（`+` 行）が `\ndiff --git ` で始まる場合、意図しないファイル分割が発生する。実用上は非常に稀だが、ドキュメントにこの制限を記載することを推奨。

---

### IMP-06: 未追跡ファイルDiff合成時のスペース未考慮

**ファイル**: `app_devpanel_api.go` — `buildUntrackedFileDiffSingle`

**問題**: `fmt.Fprintf(&sb, "diff --git a/%s b/%s\n", normalizedPath, normalizedPath)` で出力する際、`normalizedPath` にスペースが含まれる場合、Git互換パーサーが正しく解析できない可能性がある。

**修正案**: `normalizedPath` にスペースや制御文字が含まれる場合は `strconv.Quote` を用いてクォートでパッキングする。

---

### IMP-07: リングバッファの `snapshot` におけるラップ時のデータ欠損の疑い

**ファイル**: `app_session_log_types.go`

**問題**: 差分では `head` からバッファ末尾までのコピー（`first` セグメント）は確認できるが、バッファが一周してラップしている場合の「バッファ先頭側に巻き戻った残りエントリ」を `out[first:]` にコピーする後半ロジックが差分に含まれていない。

**確認推奨**: `snapshot` の完全な実装コードを再確認してください。

---

### IMP-08: `min` 組み込み関数の Go バージョン依存

**ファイル**: `app_session_log_types.go`, `app_devpanel_api.go`

**問題**: `min` 組み込み関数は **Go 1.21 以降** でのみ利用可能。プロジェクトの `go.mod` の最低バージョンが 1.21 未満の場合はビルドエラーが発生する。

**確認推奨**: `go.mod` の最低バージョンを確認。

---

### IMP-09: `TeeHandler.Handle` — `disk-full alert` コメントと設計の矛盾

**ファイル**: `internal/sessionlog/handler.go`

**問題**: コメントに「disk-full alert」を例示しているが、`EntryCallback` に `base error` が渡されない設計のため、コールバック側は書き込み成否を区別できない。

**修正案（A）**: コメントから `"e.g. disk-full alert"` を削除し実際の意図を正確に記述。  
**修正案（B）**: `EntryCallback` のシグネチャに `baseErr error` を追加。

---

### IMP-10: panic リカバリーでスタックトレースが消失

**ファイル**: `internal/sessionlog/handler.go`

**問題**: `fmt.Fprintf(os.Stderr, "[session-log] callback panicked: %v\n", r)` では `%v` はパニック値のみ出力し、スタックトレースが欠落。

**修正案**:
```go
import "runtime/debug"
fmt.Fprintf(os.Stderr, "[session-log] callback panicked: %v\n%s\n", r, debug.Stack())
```

---

### IMP-11: `removeWindowAtIndexLocked` の nil スライス返却の影響確認

**ファイル**: `session_manager_windows.go`

**問題**: `var removedPanes []*TmuxPane` で `window == nil` の場合 nil のまま返される。JSON シリアライズ時に `[]` ではなく `null` になる。内部ロジックのみで使用の場合は問題なし。

**確認推奨**: 呼び出し側が JSON を返す場合は影響あり。

---

### IMP-12: `isValidSeq` で `seq === 0` が除外される問題

**ファイル**: `errorLogStore.ts`

**問題**: `seq > 0` の条件で、バックエンド `sessionLogSeq` は `uint64` で初期値 `0`、最初の書き込み時に `++`（→ `1`）が実行されるため、実際のseqは1以上で仕様通り。ただし設計意図（seq=0 は「未割り当て」）がコメントに明記されていないと将来の変更で誤解を招く。

**修正案**: コメントを追加：
```typescript
// seq > 0: Backend assigns seq via a.sessionLogSeq++ before copying to entry.
// Therefore the Go zero value (0) can never appear as a valid seq.
```

---

### IMP-13: `useBackendSync` の Race Condition（非同期競合）

**ファイル**: `useBackendSync.ts`

**問題**: `app:error-log-updated` Ping を受け取り非同期で `api.GetSessionErrorLog()` を呼ぶが、複数リクエストが並行した場合に古いレスポンスが新しいレスポンスを上書きする可能性がある。また、アンマウント後にタイマーが発火して無駄なAPI呼び出しが発生する。

**修正案**: `AbortController` でリクエストキャンセル、またはseqベースで「最新のレスポンスのみ適用」するガード。タイマー発火時にも `isMountedRef.current` をチェック。

---

### IMP-14: `ErrorLogView` での `bodyRef` 依存削除後のリスク

**ファイル**: `ErrorLogView.tsx`

**問題**: `useEffect` の依存配列から `bodyRef` を除去して `[]` にしている。Reactの慣習では正しいが、初回レンダリング時に `bodyRef.current === null` の場合にイベントリスナーがアタッチされないサイレント障害のリスクがある。

**修正案**: 対象要素が確実に初期レンダリング時から存在することを保証、またはCallback Refパターンの利用を検討。

---

### IMP-15: `useBackendSync` — 初回ロードとpingハンドラでfetchロジックが重複

**ファイル**: `useBackendSync.ts`

**問題**: `fetchErrorLog` 関数定義後、初回ロードでほぼ同一のPromiseチェーンを重複実装している。

**修正案**: 初回フェッチを `void fetchErrorLog();` に置換して統一。

---

### IMP-16: `useEffect` のショートカットマップ再構築の非効率

**ファイル**: `ViewerSystem.tsx`

**問題**: `activeViewId` が変化するたびにイベントリスナーの解除・再登録とショートカットマップの再構築が発生。レジストリ変更がない限りマップは不変。

**修正案**: ショートカットマップの構築を `useMemo` に切り出す。

---

### IMP-17: `viewerRegistry` — HMR で `getRegisteredViews()` が非リアクティブ

**ファイル**: `viewerRegistry.ts`, `ViewerSystem.tsx`

**問題**: `useEffect` deps に `getRegisteredViews()` が含まれないため、HMR でビュープラグインが追加されてもショートカットマップが更新されない。`dispose` 後〜再登録までの間にHMRリレンダリングが発生するとビューが一瞬消える可能性もある。

**修正案（短期）**: コメントで非リアクティブの理由と制約を明記。  
**修正案（長期）**: `useSyncExternalStore` でregistryをラップ。

---

### IMP-18: テストの品質問題（複数ファイル）

**ファイル**: `app_session_log_test.go`

- **I-05相当**: `SeqMonotonicallyIncreasing` テストで `runtimeEventsEmitFn` が未設定のためWARNノイズが出力される
- **I-06相当**: `EmptyReturnsEmptySlice` の2ケースが完全重複（`writeEntry: false, expectCount: 0` が両方同一）
- **I-07相当**: `ClampsNonPositiveCapacity` テストのSeq検証が手動Seq保存の確認に過ぎず、オートインクリメントを検証していない

**ファイル**: `session_manager_directional_test.go`
- **I-10相当**: `window2.Layout` が未初期化（`newLeafLayout()` なし）。将来 nil dereference パニックの原因になる可能性

---

## 🔵 SUGGESTION（提案）

### SUG-01: ファイル名の衝突耐性の更なる向上

**ファイル**: `app_session_log.go`

PID付加により再起動時衝突は大幅に軽減。ただし `time.Now().Format("20060102-150405")` は秒単位精度のため、同一プロセス内での極めて高速な再初期化（単体テストなど）で衝突の可能性が微小ながら残る。ミリ秒精度のタイムスタンプへの変更を検討の価値あり。

---

### SUG-02: Seq の累積特性コメントの精度向上

**ファイル**: `app_session_log_types.go`

`Seq` はリングバッファ内のインデックスではなく**累積カウンタ**。「バッファサイズ=10000」は安全性の根拠にならない。「長期稼働でも実用的な範囲（例: 毎秒100件で約3000年）では安全」に改正を推奨。

---

### SUG-03: `emitRuntimeEvent(_, nil)` コメント精度向上

**ファイル**: `app_session_log.go`

`nil` 渡しは `optionalData = []interface{}{nil}` となりフロントエンドには `null` が届く。NOTE の「ペイロードなし ping」と乖離。コメントに "null として届く" を明記推奨。

---

### SUG-04: `cleanupOldSessionLogs` — PID付きファイル名の辞書順ソート

**ファイル**: `app_session_log.go`

PID が2桁と3桁で混在すると削除対象がわずかにずれる可能性。`sort.Slice` でタイムスタンプ比較を行うとより堅牢（コメントで「approximate で十分」と説明済みのため優先度低）。

---

### SUG-05: 二重 `os.Stat` の解消

**ファイル**: `app_devpanel_api.go`

外側 `buildUntrackedFileDiffs` でも `os.Stat` を呼び、内側 `buildUntrackedFileDiffSingle` でも再度呼んでいる。`os.FileInfo` を引数渡しすることでシステムコール削減と TOCTOU 縮小が可能。

---

### SUG-06: 空ファイルのdiffヘッダー形式

**ファイル**: `app_devpanel_api.go`

空ファイル（`len(lines) == 0`）で `@@ -0,0 +1,0 @@` は標準的な unified diff 形式では意味不明確。空ファイルの場合はdiffを生成しないか別の方法を検討。

---

### SUG-07: `OldPath` フィールドが新規ファイルなのに設定されている

**ファイル**: `app_devpanel_api.go`

untracked（新規）ファイルで `OldPath: normalizedPath` を設定。新規ファイルには旧パスは存在しないため、空文字列に変更を推奨。

---

### SUG-08: `WorkingDiffStatus` type alias の意図コメント

**ファイル**: `app_devpanel_types.go`

`type WorkingDiffStatus = string`（alias）のため任意の string が型エラーなく代入可能。意図的であれば理由（Wails JSON互換性等）をコメントに明記推奨。

---

### SUG-09: `app.go` struct コメント重複整理

**ファイル**: `app.go`

`sessionLogSeq` 固有の "Protected by sessionLogMu (write side)" と、ブロック全体の "Protected by sessionLogMu" が連続して読みづらい。整理推奨。

---

### SUG-10: `source` vs `group` の命名統一

**ファイル**: `app_lifecycle.go`, `app_session_log_types.go`, `internal/sessionlog/handler.go`

`TeeHandler` のコールバック引数名は `source` → `group` に変更されたが、`SessionLogEntry.Source` フィールド名は未変更。将来的に `Source` → `Group` へのリネームも検討を。また、フィールドのインラインコメントに旧称が残っている可能性あり確認推奨。

---

### SUG-11: ロールバック `stage` 情報のエラーレスポンス包含確認

**ファイル**: `command_router_handlers_window.go`

`rollbackSession` に `stage` 引数を追加してデバッグ効率向上。この情報が `ipc.TmuxResponse` のエラーレスポンスにも含まれることを確認推奨。

---

### SUG-12: `snapshot-refetch` ロールバックパスのテスト不在

**ファイル**: `command_router_handlers_window.go`

新ロールバックパス `rollbackSession("snapshot-refetch", ...)` のテストが存在しない。将来テスト追加推奨。

---

### SUG-13: 複数テストでの内部フィールド直接操作パターンの共通化

**ファイル**: テスト複数ファイル（4箇所）

セカンドウィンドウ注入のために `manager.mu.Lock()` + 直接操作が4箇所存在。`injectTestWindow(t, manager, session, "name")` ヘルパーへの統合を推奨。

---

### SUG-14: `testutil.Ptr` の `//go:fix inline` 意図コメント追加

**ファイル**: `internal/testutil/helpers.go`

`//go:fix inline` が Go 1.26+ の機能であること、`new(T)` への移行意図がコメントに記載されておらず誤解を招く可能性。

---

### SUG-15: `runtimeEventsEmitFn` スタブパターンの統一ヘルパー化

**ファイル**: `app_session_log_test.go`

複数テストで同一の3行スタブ定型コードが繰り返されている。`stubRuntimeEventsEmit(t, fn)` ヘルパーに集約で DRY 化可能。

---

### SUG-16: テストケース追加推奨

- `app_devpanel_api_test.go`: パスに `" b/"` を含むファイル名のエッジケース、copy/modechange ケース、`.git` 除外テスト
- `app_session_log_test.go`: `newSessionLogRingBuffer` の負数(`-1`)テストケース

---

### SUG-17: ショートカット重複チェック

**ファイル**: `viewerRegistry.ts`

`registerView` 内で `shortcut` 文字列の重複はチェックされていない。DEV環境での警告ログ追加を推奨：
```ts
if (import.meta.env.DEV && view.shortcut) {
    const existing = registry.find(v => v.shortcut === view.shortcut && v.id !== view.id);
    if (existing) {
        console.warn(`[Registry] Duplicate shortcut "${view.shortcut}"`);
    }
}
```

---

### SUG-18: `ErrorLogView` フォールバックキーのコメント補強

**ファイル**: `ErrorLogView.tsx`

```tsx
key={entry.seq ?? `fallback-${entry.ts}-${i}`}
```
`normalizeEntries` で `seq > 0` フィルタ済みのためフォールバックブランチは到達不能。`key={entry.seq}` に簡素化するか、後方互換性のためであればコメントで意図を明示。

---

### SUG-19: デバッグログプレフィックスの統一

**ファイル**: `app_devpanel_api.go`

`[DEBUG-DEVPANEL]` プレフィックスが Debug ログにのみ付与。既存の他モジュール（`[DEVPANEL]` は Warn に付与）とパターンが異なる。ログ検索性のためにプレフィックス規則を統一推奨。

---

### SUG-20: `ERROR_LOG_DEBOUNCE_MS` 定数の配置

**ファイル**: `useBackendSync.ts`

`useEffect` 内のローカル定数として定義されているが、モジュール定数として定義する方が自然。

---

## ✅ POSITIVE（良い点）

### バックエンド全般
- **Ping/Fetchモデルの採用**: イベントへのペイロード廃止はWailsのIPC負荷軽減とスロットリングによるデータ欠損防止を両立する堅牢な設計
- **Seq による安定な重複排除**: 秒精度のタイムスタンプ複合キーへの依存を排除し、単調増加の `Seq` で管理
- **ディスクI/Oの最適化**: `Sync()` をロック外で実行するリファクタリング。ディスク書き込みレイテンシが他のログ操作をブロックしない
- **writeSessionLogEntry の単一ロック取得**: ring buffer append・shouldEmit判定・sessionLogSeq インクリメントを1回のロック取得内で完結
- **コールバックのパニック保護**: `TeeHandler.Handle` でコールバックを `recover()` で保護。即時実行関数でリカバリースコープをコールバック一点に絞る設計
- **`WithGroup("")` の仕様準拠**: `slog.Handler` 仕様に従ってレシーバーをそのまま返す実装
- **PID suffix**: 同一秒内の再起動でのファイル名重複を確実に回避
- **NOTE アノテーション設計**: 設計根拠がコードに埋め込まれており、将来の保守性が高い
- **newSessionLogRingBuffer のクランプ**: モジュロゼロパニックを防ぐ最小限の防御

### DevPanel WorkingDiff
- **新規リポジトリへの配慮**: `git diff HEAD` のエラー時をフレッシュリポジトリと判定し、未追跡ファイルの収集を継続
- **適切なリソース管理**: `devPanelMaxDiffSize` による切り詰め＋ループ内累積サイズチェック
- **NUL区切りによる正確なパス取得**: `ls-files -z` とNUL文字区切りパース
- **`--` セパレータの追加**: `DevPanelCommitDiff` に `--` を追加してコミットハッシュとファイルパスの曖昧さを解消
- **クロスプラットフォーム対応**: Windowsの `\` を `/` に正規化する処理が一貫
- **バイナリ検出改善**: `bytes.ContainsRune` → `bytes.IndexByte` への変更は高速かつ慣用的

### tmux セッション管理
- **フェイルファーストなロールバック**: スナップショット取得失敗時に明示的なロールバック（セッション削除）
- **ActiveWindowID の自己修復**: 古くなった `ActiveWindowID` を自動修復するパス検証テスト
- **将来への詳細なコメント（NOTEコメント）**: 1ウィンドウモデルに関する包括的コメント
- **`//go:fix inline` ディレクティブ**: `testutil.Ptr` への追加は静的解析ツールによるコード最適化を促進
- **removeWindowResult の OWNERSHIP CONTRACT**: 所有権移転・Terminal.Close義務が明記
- **copySessionFlags の設計**: 新フラグ追加時の漏れリスクを能動的に抑止

### フロントエンド
- **HMR対応の考慮**: `globalThis` ＋ `import.meta.hot.dispose` による開発時のモジュール再ロード対応
- **効率的な未読カウント計算**: `setEntries` 内で末尾から `lastReadSeq` までスキャンする実装
- **UI構造の柔軟性**: `ActivityStrip` の `position: "bottom"` 対応によるVS Codeライクな上下分割レイアウト
- **シングルソースのショートカット管理**: ハードコードif-else連鎖の解消
- **CSS変数化**: `rgba(246, 173, 85, 0.1)` → `var(--warning-10)` へのリファクタリング
- **addEntry の削除**: Ping/Fetchモデル移行に伴う適切な廃止
- **onEvent cleanup の三段構え**: eventOn解除 + debounce clearTimeout + isMountedRef guard

### テスト
- **フィールドカウントガードテスト**: `WorkingDiffFile`/`WorkingDiffResult` のフロントエンド型定義との同期を強制
- **差分ヘッダーパス解析の包括的テスト**: 空白含みパス、クォートパス、octalエスケープ、リネームなど多様なエッジケース
- **errors.Is を使ったエラー伝播検証**: error wrapping 慣例に沿った堅牢なテスト

---

## タスク一覧と並列作業可否表

以下のタスク表は、作業者が修正に着手する際の参考として作成しています。

### Important/ Critical タスク

| # | 重要度 | タスク | 対象ファイル | 並列可否 | 備考 |
|---|--------|--------|-------------|:--------:|------|
| T-01 | 🔴 | **CR-01: `new(true)` 文法検証・修正** | `*_test.go` (3ファイル) | ✅ 可能 | ビルド確認後、一括修正。**最優先** |
| T-02 | 🟡 | **IMP-01: `parseDiffHeaderPaths` ` b/` 誤分割** | `app_devpanel_api.go` | ⚠️ 同ファイル | T-03〜T-06, T-19と同ファイル |
| T-03 | 🟡 | **IMP-02: `isFreshRepo` ロケール依存修正** | `app_devpanel_api.go` | ⚠️ 同ファイル | T-02と同ファイル |
| T-04 | 🟡 | **IMP-03: `isPathWithinBase` チェック追加** | `app_devpanel_api.go` | ⚠️ 同ファイル | T-02と同ファイル |
| T-05 | 🟡 | **IMP-04: バイト境界切り捨て部分エントリ除去** | `app_devpanel_api.go` | ⚠️ 同ファイル | T-02と同ファイル |
| T-06 | 🟡 | **IMP-05: `diff --git` 文字列衝突の制限ドキュメント化** | `app_devpanel_api.go` | ⚠️ 同ファイル | コメント追加のみ |
| T-07 | 🟡 | **IMP-06: 未追跡ファイルDiffスペース未考慮** | `app_devpanel_api.go` | ⚠️ 同ファイル | T-02と同ファイル |
| T-08 | 🟡 | **IMP-07: `snapshot` ラップ処理確認** | `app_session_log_types.go` | ✅ 可能 | 差分外の既存コード確認 |
| T-09 | 🟡 | **IMP-08: `min` 組み込みGoバージョン確認** | `go.mod` | ✅ 可能 | 確認のみ |
| T-10 | 🟡 | **IMP-09: `disk-full alert` コメント修正** | `internal/sessionlog/handler.go` | ✅ 可能 | T-11と同ファイルだが独立行 |
| T-11 | 🟡 | **IMP-10: panic recovery `debug.Stack()` 追加** | `internal/sessionlog/handler.go` | ✅ 可能 | T-10と同ファイルだが独立行 |
| T-12 | 🟡 | **IMP-11: nil スライスJSON化影響確認** | `session_manager_windows.go` + 呼び出し元 | ⚠️ 要確認 | 呼び出し元がJSONを返す場合影響あり |
| T-13 | 🟡 | **IMP-12: `isValidSeq` コメント追加** | `errorLogStore.ts` | ✅ 可能 | コメントのみ |
| T-14 | 🟡 | **IMP-13: fetchErrorLog Race Condition 対策** | `useBackendSync.ts` | ✅ 可能 | 独立ファイル |
| T-15 | 🟡 | **IMP-14: `bodyRef` 依存削除後の動作確認** | `ErrorLogView.tsx` | ✅ 可能 | 実際の動作テスト |
| T-16 | 🟡 | **IMP-15: 初回フェッチロジック重複解消** | `useBackendSync.ts` | ⚠️ 同ファイル | T-14と同ファイル |
| T-17 | 🟡 | **IMP-16: ショートカットマップ `useMemo` 化** | `ViewerSystem.tsx` | ✅ 可能 | 独立ファイル |
| T-18 | 🟡 | **IMP-17: viewerRegistry 非リアクティブ対応** | `viewerRegistry.ts` | ✅ 可能 | 独立ファイル |
| T-19 | 🟡 | **IMP-18: テスト品質修正** | `app_session_log_test.go`, `session_manager_directional_test.go` | ✅ 可能 | 独立ファイル |

### Suggestion タスク

| # | 重要度 | タスク | 対象ファイル | 並列可否 | 備考 |
|---|--------|--------|-------------|:--------:|------|
| T-20 | 🔵 | **SUG-02: Seq コメント精度修正** | `app_session_log_types.go` | ✅ 可能 | コメントのみ |
| T-21 | 🔵 | **SUG-03: emitRuntimeEvent nil コメント** | `app_session_log.go` | ✅ 可能 | コメントのみ |
| T-22 | 🔵 | **SUG-05: 二重 `os.Stat` 解消** | `app_devpanel_api.go` | ⚠️ 同ファイル | T-02〜T-07完了後に実施 |
| T-23 | 🔵 | **SUG-06: 空ファイルdiffヘッダー** | `app_devpanel_api.go` | ⚠️ 同ファイル | T-02完了後 |
| T-24 | 🔵 | **SUG-07: OldPath 空文字化** | `app_devpanel_api.go` | ⚠️ 同ファイル | T-02完了後 |
| T-25 | 🔵 | **SUG-08: WorkingDiffStatus alias コメント** | `app_devpanel_types.go` | ✅ 可能 | 独立ファイル |
| T-26 | 🔵 | **SUG-09: app.go struct コメント整理** | `app.go` | ✅ 可能 | 独立ファイル |
| T-27 | 🔵 | **SUG-10: source vs group 命名統一** | `handler.go` 他 | ⚠️ 影響大 | 広範な影響、慎重に |
| T-28 | 🔵 | **SUG-13: テスト内部操作ヘルパー化** | テストファイル4件 | ✅ 可能 | `injectTestWindow()` |
| T-29 | 🔵 | **SUG-14: `//go:fix inline` コメント追加** | `testutil/helpers.go` | ✅ 可能 | コメントのみ |
| T-30 | 🔵 | **SUG-15: emitFnスタブヘルパー化** | `app_session_log_test.go` | ⚠️ | T-19完了後 |
| T-31 | 🔵 | **SUG-16: テストケース追加** | `app_devpanel_api_test.go`, `app_session_log_test.go` | ✅ 可能 | 独立行追加 |
| T-32 | 🔵 | **SUG-17: ショートカット重複チェック** | `viewerRegistry.ts` | ✅ 可能 | DEV警告ログ |
| T-33 | 🔵 | **SUG-18: フォールバックキー簡素化** | `ErrorLogView.tsx` | ✅ 可能 | コメントまたはコード修正 |
| T-34 | 🔵 | **SUG-19: ログプレフィックス統一** | `app_devpanel_api.go` | ⚠️ 同ファイル | T-02完了後 |
| T-35 | 🔵 | **SUG-20: DEBOUNCE_MS 定数配置** | `useBackendSync.ts` | ⚠️ 同ファイル | T-14,16完了後 |

---

## 並列作業グループ

作業者が複数名いる場合、以下のグループ単位で並列作業が可能です。**グループ間の依存関係はほとんどありません。**

| グループ | タスク | 担当者数 | 説明 |
|:--------:|--------|:--------:|------|
| **G1** 🔴最優先 | T-01 | 1人 | `new(true)` ビルド確認・一括修正。**他グループ着手前に完了推奨** |
| **G2** | T-02〜T-07, T-22〜T-24, T-34 | 1人 | `app_devpanel_api.go` の修正全般。同ファイルのため1人が順次対応 |
| **G3** | T-08, T-09, T-20 | 1人 | セッションログ型・Goバージョン確認 |
| **G4** | T-10, T-11, T-27 | 1人 | `internal/sessionlog/handler.go` の修正 |
| **G5** | T-12 | 1人 | tmux `nil` スライス影響確認 |
| **G6** | T-19, T-28, T-30, T-31 | 1人 | バックエンドテスト品質改善（複数テストファイル） |
| **G7** | T-13, T-32 | 1人 | フロントエンド：errorLogStore + viewerRegistry |
| **G8** | T-14, T-16, T-35 | 1人 | フロントエンド：useBackendSync |
| **G9** | T-15, T-33 | 1人 | フロントエンド：ErrorLogView |
| **G10** | T-17, T-18 | 1人 | フロントエンド：ViewerSystem + viewerRegistry |
| **G11** | T-21, T-25, T-26, T-29 | 1人 | コメント・ドキュメント系小タスク（全て独立ファイル） |

### 依存関係図

```
G1 (Critical: new(true)修正) ── ビルド確認後に他グループ着手
   │
   ├── G2 (DevPanel API — 同ファイル順次)
   ├── G3 (セッションログ型) ── 独立
   ├── G4 (sessionlog handler) ── 独立
   ├── G5 (tmux nilスライス) ── 独立
   ├── G6 (テスト品質改善) ── 独立
   ├── G7 (errorLogStore + registry) ── 独立
   ├── G8 (useBackendSync) ── 独立
   ├── G9 (ErrorLogView) ── 独立
   ├── G10 (ViewerSystem + registry) ── 独立
   └── G11 (コメント系小タスク) ── 独立
```

> **推奨**: G1 がCriticalのためまず最初に着手し、ビルドが通ることを確認してから他グループを並列で進めるのが最も効率的です。G2-G11 は相互に依存関係が無いため、最大10名で完全並列作業が可能です。  
> **注意**: G2（DevPanel API）は `app_devpanel_api.go` への変更が集中するため、必ず1人が順次対応してください。T-27（命名統一）はバックエンド〜フロントエンド間にわたるため、他作業完了後に実施することを推奨します。

---

*このレビューは 4 回の並列レビュー結果（review-20260222102630, 103036, 103501, 104026）を重複排除して統合したものです。*
