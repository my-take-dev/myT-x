# PR Review Summary — 2026-02-22 13:27

**対象**: `D:\myT-x\dev-myT-x\review\temp` 配下の差分ファイル 36件  
**レビュー方針**: `review-pr-para.prompt.md` に準拠  
**カテゴリ分類**: 6カテゴリに分割して並列レビュー実施

---

## 変更概要

本PRは主に以下の機能追加・改善を含む:

1. **Working Diff (DevPanelWorkingDiff)**: `git diff HEAD` + untracked file の合成差分を返す新API
2. **Session Log改善**: ping+fetchモデルへの移行、seqフィールド追加、Sync()のロック外移動
3. **TeeHandler堅牢化**: callback panicリカバリ、baseHandlerエラー時もcallback実行
4. **1-windowモデルドキュメント強化**: 到達不能コード/削除API のコメント整備
5. **Frontend Viewer拡張**: ActivityStrip position対応、shortcutMap動的バインディング、ErrorLog seq-based key
6. **テストヘルパー統一**: `testutil.Ptr` → `new(T)` インライン化、`stubRuntimeEventsEmit(t)` 共通化

---

## カテゴリ A: Go Backend — App層 (実装)

**対象ファイル:**
- `app.go.diff`
- `app_devpanel_api.go.diff`
- `app_devpanel_types.go.diff`
- `app_events.go.diff`
- `app_lifecycle.go.diff`
- `app_session_log.go.diff`
- `app_session_log_types.go.diff`

### Critical Issues (2件)

#### CRI-A01: `buildUntrackedFileDiffSingle` — cachedInfo引数とWalkDir経由のコールで不一致
- **ファイル**: `app_devpanel_api.go` (buildUntrackedFileDiffs関数内)
- **行**: diff行 266付近
- **説明**: `buildUntrackedFileDiffs`の `WalkDir` ループ内で `buildUntrackedFileDiffSingle(workDir, normalized)` を呼んでいるが、`cachedInfo` を渡していない。一方で単一ファイルパス（非ディレクトリ）からの呼び出し(diff行237)では `buildUntrackedFileDiffSingle(workDir, relPath, info)` と `info` を渡している。WalkDir内でも `d.Info()` で `FileInfo` を取得できるため、`os.Stat` の二重呼び出しが発生している。性能面は直接的問題ではないが、**WalkDir経由で `d.Info()` が返すエラー**をハンドリングしないまま `os.Stat` が再実行されるため、ファイルが消失した場合にエラーログが二重に出る。
- **対応推奨**: WalkDir内でも `fi, fiErr := d.Info()` を取得し、成功時は `cachedInfo` として渡す。あるいはSUG-05コメントを修正してWalkDir経路は意図的にcacheしない旨を明記する。

#### CRI-A02: `parseWorkingDiff` — `strings.Split` による `diff --git ` 境界分割の脆弱性（ドキュメント化済みだが影響範囲が大きい）
- **ファイル**: `app_devpanel_api.go` (parseWorkingDiff関数)
- **行**: diff行 396付近
- **説明**: コメント (IMP-05) で「ファイル内容に `diff --git ` が含まれると誤分割する」と記載済みだが、このパーサーは `DevPanelWorkingDiff` を通じてフロントエンドへ直接diff全体を返す。ユーザーのリポジトリにpatchファイルやdiff出力を含むテキストファイルがある場合、**silent data corruption**（diffブロックの誤分割）が発生する。バイナリファイルは除外されているが、テキストベースの`.patch`ファイルは除外されない。
- **対応推奨**: より堅牢な行ベースパーサーへの移行を検討（行頭の `diff --git ` を検出する方式）。最低限、`strings.Split` ではなく行スキャンで `\ndiff --git ` を境界とするべき。

### Important Issues (5件)

#### IMP-A01: `isPathWithinBase` が未定義
- **ファイル**: `app_devpanel_api.go` (buildUntrackedFileDiffSingle関数)
- **行**: diff行 287
- **説明**: `isPathWithinBase(absPath, workDir)` が呼ばれているが、本PRの差分には定義が含まれていない。既存コードに存在する前提でレビューするが、**シンボリックリンク解決 (filepath.EvalSymlinks)** を内部で行っているか確認が必要。`os.Stat` は symlink を辿るため、`absPath` が `workDir` 内に見えても実際のファイルが外部にある可能性がある。
- **対応推奨**: `isPathWithinBase` の実装で `filepath.EvalSymlinks` または `os.Readlink` によるシンボリック先の検証を確認する。

#### IMP-A02: `parseDiffHeaderPaths` — symmetry heuristic のオフバイワンリスク
- **ファイル**: `app_devpanel_api.go` (parseDiffHeaderPaths関数)
- **行**: diff行 478-486
- **説明**: パス長の対称性チェック `2*pathLen+3 == len(content)` は `a/P b/P` 形式を前提としているが、パスが1文字の場合（例: `a/x b/x`）、`content = "x b/x"` → `len = 5` → `pathLen = (5-3)/2 = 1` → `2*1+3 = 5` → OK。ただし、**パス名が奇数長**の場合のみこの分岐に入る。パス名が偶数長の場合は `(len(content)-3)/2` の整数除算で切り捨てが発生し、常に対称性チェックが失敗して fallback に流れる。これは意図的な設計かもしれないが、コメントに明記すべき。
- **対応推奨**: 偶数長パスが常にfallbackに流れることをコメントで明記。もしくは `strings.LastIndex(content, " b/")` を用いた逆方向マッチに変更。

#### IMP-A03: `writeSessionLogEntry` — syncFile のレース条件
- **ファイル**: `app_session_log.go`
- **行**: diff行 86-95
- **説明**: ロック外で `syncFile.Sync()` を実行する設計(A-0b)だが、`closeSessionLog()` が `sessionLogFile.Close()` を呼んだ後にこの `Sync()` が走る可能性がある。コメントで `os.ErrClosed` のチェックを入れているが、Windows環境では `os.ErrClosed` ではなく `syscall.EINVAL` やWindows固有のエラーが返される場合がある。
- **対応推奨**: `errors.Is(syncErr, os.ErrClosed)` に加えて、Windows環境での `file already closed` 相当のエラーもハンドリングする。もしくは、syncFile のキャプチャ時に `sessionLogFile` のclose状態フラグを確認する。

#### IMP-A04: `WorkingDiffStatus` — type alias の設計判断
- **ファイル**: `app_devpanel_types.go`
- **行**: diff行 25
- **説明**: `type WorkingDiffStatus = string` はtype aliasであり、コンパイル時の型安全性がない。コメントでWails互換性のためと説明済みだが、Go側で不正なstatus文字列が混入するリスクがある。定数以外の文字列もコンパイルエラーなしで代入可能。
- **対応推奨**: `parseWorkingDiff` 内でステータスが5つの定数のいずれかであることを検証するバリデーション関数の追加を検討。

#### IMP-A05: `DevPanelWorkingDiff` — isFreshRepo時にuntrackedファイルのみ返すが、ディレクトリサイズ制限なし
- **ファイル**: `app_devpanel_api.go` (DevPanelWorkingDiff関数)
- **行**: diff行 125-136
- **説明**: 新規リポジトリ（HEADなし）の場合、`git diff HEAD` はスキップされuntrackedファイルのみ収集される。しかし、新規リポジトリには大量のuntrackedファイルが存在しうる（例: `node_modules` が `.gitignore` される前のケースなど）。`collectUntrackedFiles` は `--exclude-standard` を使用するが、`.gitignore` がまだ作成されていない場合はすべてのファイルが対象になる。`devPanelMaxDiffSize` による制限はあるが、`collectUntrackedFiles` 自体のリスト取得には制限がない。
- **対応推奨**: `collectUntrackedFiles` 側でも返すファイル数に上限を設ける（例: 1000件）。

### Suggestions (4件)

#### SUG-A01: ログプレフィックス `[DEBUG-DEVPANEL]` → `[DEVPANEL]` の統一作業が不完全
- **ファイル**: `app_devpanel_api.go`
- **説明**: 本PRで多くの `[DEBUG-DEVPANEL]` が `[DEVPANEL]` に統一されている。しかし他の既存ファイルに `[DEBUG-DEVPANEL]` が残っている可能性がある。PR全体で統一することを推奨。

#### SUG-A02: `needsGitQuoting` — タブ文字 `\t` の判定
- **ファイル**: `app_devpanel_api.go`
- **行**: diff行 578
- **説明**: `b < 0x20` のチェックでタブ(`\t` = 0x09)は含まれるが、CR (`\r` = 0x0D) やLF (`\n` = 0x0A) もquoting対象になる。ファイル名にCR/LFが含まれるケースは極めて稀だが、テストケースでカバーされていない。

#### SUG-A03: `sessionLogSeq` の初期値
- **ファイル**: `app.go` / `app_session_log.go`
- **説明**: `sessionLogSeq` はuint64のゼロ値から始まり、`writeSessionLogEntry` で `a.sessionLogSeq++` → 最初のseqは1。これは正しいが、`initSessionLog` でseqを明示的にリセットしないため、もしアプリ再起動なしでinitSessionLogが再呼出される場合（テスト等）、seqが前回の値から継続する。テストでは問題ないが、ドキュメントに「累積カウンター、リセットしない」と明記すべき。
- **該当箇所**: `app_session_log_types.go` diff行 13-17 にコメントあり（適切）。

#### SUG-A04: `devPanelMaxUntrackedFileSize` の100KBは小さい可能性
- **ファイル**: `app_devpanel_api.go`
- **行**: diff行 98
- **説明**: 100KBで切ると、中規模のJSONファイルやCSVファイルがskipされる。ユーザーが新規追加したファイルのdiffが見えない可能性がある。256KBや512KBへの引き上げを検討。

---

## カテゴリ B: Go Backend — Internal層 (実装)

**対象ファイル:**
- `internal/sessionlog/handler.go.diff`
- `internal/tmux/command_router_handlers_window.go.diff`
- `internal/tmux/session_manager_windows.go.diff`
- `internal/testutil/helpers.go.diff`

### Critical Issues (0件)

### Important Issues (3件)

#### IMP-B01: `TeeHandler.Handle` — callbackパニック時にbase handler errorが上書きされない保証
- **ファイル**: `internal/sessionlog/handler.go`
- **行**: diff行 57-67
- **説明**: `defer recover()` によりcallbackパニックは捕捉されるが、base handlerの `err` はそのまま返される。これは正しい設計だが、callbackパニックの情報を呼び出し元に通知する手段がない（stderrのみ）。本番運用でcallbackパニックが発生した場合、ログファイルを確認しないと気づけない。
- **対応推奨**: DATADOGやSentryなどの監視ツールへのフック追加、または `context.Context` にエラーを伝搬する仕組みを将来的に検討。現時点ではstderrログで許容可。

#### IMP-B02: `handleNewWindow` — snapshot refetchの失敗時にrollbackする変更
- **ファイル**: `internal/tmux/command_router_handlers_window.go`
- **行**: diff行 25-28
- **説明**: 以前は snapshot取得失敗時にnil fallback（legacy path）へ流していたが、本PRでは `rollbackSession` でセッションを削除する。これは堅牢性向上だが、**一時的なレースコンディション**（CreateSession直後のGetSession失敗）がrollback（セッション削除）を引き起こす可能性がある。
- **対応推奨**: `GetSession` が失敗するシナリオはSessionManager内部のバグに限られるため、rollbackは妥当だが、テストで明示的にこのパスをカバーすべき。

#### IMP-B03: `removeWindowAtIndexLocked` — `removedPanes` の初期化変更
- **ファイル**: `internal/tmux/session_manager_windows.go`
- **行**: diff行 32-38
- **説明**: `var removedPanes []*TmuxPane` は `nil` であり、`window != nil && len(window.Panes) > 0` が false の場合に `removedPanes = make([]*TmuxPane, 0)` で空スライスを確保する。コメントで「nilではなく空スライスを返す」と記載されているが、if-else構文の冗長さが気になる。
- **対応推奨**: `removedPanes := make([]*TmuxPane, 0)` を冒頭で初期化し、条件分岐内では `removedPanes = make([]*TmuxPane, len(window.Panes))` + `copy` のみにする方が可読性向上。

### Suggestions (2件)

#### SUG-B01: `WithGroup("")` のガード追加は正しい
- **ファイル**: `internal/sessionlog/handler.go`
- **行**: diff行 79-81
- **説明**: slog.Handler仕様に準拠した変更。空文字列の場合はレシーバをそのまま返す。テスト (`TestTeeHandler_WithGroupEmpty`) も追加されており、適切。

#### SUG-B02: `testutil.Ptr` への `//go:fix inline` ディレクティブ
- **ファイル**: `internal/testutil/helpers.go`
- **行**: diff行 15
- **説明**: Go 1.24+ の `go fix` でインライン化される設計。CLAUDE.mdの「Go 1.26最新」記載と整合する。`app_session_api_test.go.diff` で `testutil.Ptr(true)` → `new(true)` への置換が進行中。

---

## カテゴリ C: Go Backend — テスト

**対象ファイル:**
- `app_devpanel_api_test.go.diff`
- `app_lifecycle_test.go.diff`
- `app_session_api_test.go.diff`
- `app_session_log_test.go.diff`
- `internal/sessionlog/handler_test.go.diff`
- `internal/tmux/command_router_env_test.go.diff`
- `internal/tmux/command_router_handlers_window_test.go.diff`
- `internal/tmux/command_router_test_helpers_test.go.diff`
- `internal/tmux/session_manager_directional_test.go.diff`
- `internal/tmux/session_manager_pane_io_test.go.diff`
- `internal/tmux/session_manager_test.go.diff`
- `internal/tmux/session_manager_window_test.go.diff`

### Critical Issues (1件)

#### CRI-C01: `new(true)` / `new(false)` — Go言語でコンパイルエラー
- **ファイル**: 複数 (`app_session_api_test.go`, `command_router_env_test.go`, `command_router_handlers_window_test.go` 等)
- **行**: 多数
- **説明**: `testutil.Ptr(true)` を `new(true)` に置換しているが、**Go言語の `new` built-in関数は型名を引数に取る**（`new(bool)` は有効）。`new(true)` は**コンパイルエラー**になる。正しくは `new(bool)` で `*bool` を得た後にデリファレンスして値を設定するか、`func() *bool { v := true; return &v }()` のようなリテラルパターンを使う必要がある。
  ただし、Go 1.26の `go fix` が `testutil.Ptr(true)` → `new(true)` パターンを出力している可能性があるため、Go 1.26の `new` 仕様拡張を確認する必要がある。CLAUDE.mdの記載「Go言語は1.26が最新」から、Go 1.26で `new(true)` が有効な言語拡張が入っている可能性がある。
- **対応推奨**: Go 1.26の `new` built-inの仕様変更を確認。Go 1.26で `new(value)` パターンが有効でない場合、全ての `new(true)` / `new(false)` をコンパイル可能な形に修正する必要がある。置換箇所が多数あるため漏れなく修正が必要。

  **影響ファイル一覧（`new(true)` / `new(false)` 使用箇所）:**
  - `myT-x/app_session_api_test.go`: 7箇所
  - `myT-x/internal/tmux/command_router_env_test.go`: 14箇所
  - `myT-x/internal/tmux/command_router_handlers_window_test.go`: 2箇所

### Important Issues (2件)

#### IMP-C01: `stubRuntimeEventsEmit(t)` が本PRの差分に含まれていない
- **ファイル**: `app_session_log_test.go`
- **行**: diff行 21, 33, 63 等（多数）
- **説明**: 以前の `runtimeEventsEmitFn` の手動スタブが `stubRuntimeEventsEmit(t)` に置き換えられているが、この関数の定義が本PRの差分に含まれていない。テストヘルパーとして別の差分ファイルまたは既存コードに存在する前提だが、確認が必要。
- **対応推奨**: `stubRuntimeEventsEmit(t)` の定義がコードベースに存在することを確認。

#### IMP-C02: `injectTestWindow` — ロック直接操作のリスク
- **ファイル**: `internal/tmux/command_router_test_helpers_test.go`
- **行**: diff行 28-65
- **説明**: テストヘルパーが `manager.mu.Lock()` を直接呼んでSessionManagerの内部構造を操作している。これは1-windowモデルで `AddWindow` APIが削除されたことへの対応として妥当だが、SessionManagerの内部実装が変更された場合にテストが壊れやすい。
- **対応推奨**: 将来の内部構造変更時にこのヘルパーの更新を忘れないよう、ヘルパー冒頭にフィールドカウントガードコメントを追加。

### Suggestions (3件)

#### SUG-C01: テストケースの重複 — `TestInitSessionLog_CreatesJSONLFile` と `TestInitSessionLog_FilenameContainsPID`
- **ファイル**: `app_session_log_test.go`
- **説明**: 両テストとも「ファイル名にPIDが含まれること」を検証している。`TestInitSessionLog_CreatesJSONLFile` 内でPIDパターンチェックが追加された(diff行48-51)ため、`TestInitSessionLog_FilenameContainsPID` は冗長。テストの意図を明確に分離するか統合を検討。

#### SUG-C02: `TestWriteSessionLogEntry_EmitsCorrectEventName` — テーブル駆動だが1ケースのみ
- **ファイル**: `app_session_log_test.go`
- **行**: diff行 266-314
- **説明**: テーブル駆動テストだがケースが1つのみ。将来的にイベント名変更のレグレッション防止として妥当だが、テーブル化する必要性が薄い。

#### SUG-C03: `TestBuildUntrackedFileDiffs_ExcludedDirsSkipped` — 除外ディレクトリの一致確認
- **ファイル**: `app_devpanel_api_test.go`
- **行**: diff行 590-619
- **説明**: `devPanelExcludedDirs` に `node_modules` が含まれることを前提としたテスト。`devPanelExcludedDirs` の定義が変更された場合にテストが壊れる。定数を直接参照するか、テスト内で確認を追加すべき。

---

## カテゴリ D: Frontend — コンポーネント/ビュー/ストア

**対象ファイル:**
- `frontend/src/api.ts.diff`
- `frontend/src/components/viewer/ActivityStrip.tsx.diff`
- `frontend/src/components/viewer/ViewerSystem.tsx.diff`
- `frontend/src/components/viewer/viewerRegistry.ts.diff`
- `frontend/src/components/viewer/views/error-log/ErrorLogView.tsx.diff`
- `frontend/src/components/viewer/views/error-log/index.ts.diff`
- `frontend/src/hooks/useBackendSync.ts.diff`
- `frontend/src/stores/errorLogStore.ts.diff`
- `frontend/src/styles/base.css.diff`
- `frontend/src/styles/viewer.css.diff`

### Critical Issues (0件)

### Important Issues (4件)

#### IMP-D01: `errorLogStore` — `setEntries` のunreadCount計算がlastReadSeqに依存
- **ファイル**: `frontend/src/stores/errorLogStore.ts`
- **行**: diff行 70-77
- **説明**: `setEntries` の unreadCount 計算は `entries` が seq 昇順でソートされている前提で末尾から `state.lastReadSeq` を超えるエントリ数をカウントする。これ自体は正しいが、**初回ロード時** (`lastReadSeq = 0`) に**全エントリがunread**として扱われる。アプリ起動時に既存のログエントリが大量にある場合、バッジが大きな数値を表示し、ユーザーが既読であるべきログを未読として表示する問題がある。
- **対応推奨**: 初回 `setEntries` （アプリ起動直後）では `lastReadSeq` を最大seqに設定して「既存ログは既読」とする処理の検討。あるいは `markAllRead` を初回ロード後に自動呼出し。

#### IMP-D02: `viewerRegistry` — globalThis汚染
- **ファイル**: `frontend/src/components/viewer/viewerRegistry.ts`
- **行**: diff行 25-39
- **説明**: `globalThis.__mytx_view_registry__` にViewPlugin配列を保存するグローバルレジストリパターンは、HMR対応として妥当だが、`globalThis` への汚染が発生する。テスト環境やSSR環境（該当しない可能性が高いが）で意図しない共有が起きうる。
- **対応推奨**: 本アプリはWindowsデスクトップアプリ（Wails）であり、SSR環境リスクはない。テスト環境でのイシューのみ注意。現時点では許容可。

#### IMP-D03: `ErrorLogView` — bodyRefCallback のcleanup漏れ（Reactのunmount時）
- **ファイル**: `frontend/src/components/viewer/views/error-log/ErrorLogView.tsx`
- **行**: diff行 32-63
- **説明**: callback refパターンで `cleanupRef.current` にクリーンアップ関数を保存しているが、Reactの callback ref は**unmount時に `null` を引数として呼ばれる**。このとき `cleanupRef.current()` が呼ばれてクリーンアップされるが、`bodyRefCallback` の戻り値がないため、**Strict Mode（開発環境）での二重マウント**時に前のリスナーが残る可能性がある。
- **対応推奨**: callback ref実装は正しく、`el` が `null` の場合に `cleanupRef.current()` を呼んでいるため問題なし。ただし、Strict Modeでの動作確認を推奨。

#### IMP-D04: `useBackendSync` — errorLogDebounceTimer のクリーンアップ不完全
- **ファイル**: `frontend/src/hooks/useBackendSync.ts`
- **行**: diff行 110-113
- **説明**: cleanup関数で `clearTimeout(errorLogDebounceTimer)` + `errorLogDebounceTimer = null` が実行されるが、`fetchErrorLog` 内の `void api.GetSessionErrorLog().then(...)` は既に発火している場合がある。`isMountedRef.current = false` でガードされているが、**Promise の `.then` コールバック内での `useErrorLogStore.getState().setEntries()` は unmount後も実行可能**（Zustand は React外でも動作するため）。データ不整合にはならないが、不要な状態更新が走る。
- **対応推奨**: `seq !== errorLogFetchSeq` チェックで最新fetchのみ適用しているので実害なし。ドキュメントコメントとして「unmount後もZustand storeへの書き込みは安全」と明記すると良い。

### Suggestions (5件)

#### SUG-D01: `BackendEventMap` — `app:error-log-updated` のペイロード型
- **ファイル**: `frontend/src/hooks/useBackendSync.ts`
- **行**: diff行 27-28
- **説明**: `"app:error-log-updated": Record<string, never>` は空オブジェクト型だが、バックエンドは `nil` を送信する。`null` に対して `Record<string, never>` としてマッチするかは微妙。`null` or `undefined` を明示する方が正確。
- **対応推奨**: `"app:error-log-updated": null` に変更を検討。

#### SUG-D02: `normalizeEntries` — `.sort()` はin-place変更
- **ファイル**: `frontend/src/stores/errorLogStore.ts`
- **行**: diff行 30-33
- **説明**: `.filter().sort().slice()` チェーンはフィルタ後に `.sort()` が新しい配列をin-placeでソートする。ES2023+ では `.toSorted()` が利用可能で、元配列を変更しない。ただしfilter済み配列なのでin-placeでも問題ない。

#### SUG-D03: `ActivityStrip` — `position` プロパティのデフォルト値
- **ファイル**: `frontend/src/components/viewer/ActivityStrip.tsx`
- **行**: diff行 23-24
- **説明**: `view.position !== "bottom"` でフィルタリングしているため、`position` が未定義の ViewPlugin は自動的に上部に配置される。これは意図的だが、`position` のデフォルト値を `"top"` として明示したほうが可読性が向上する。

#### SUG-D04: CSS変数 `--warning` の追加
- **ファイル**: `frontend/src/styles/base.css`
- **行**: diff行 9-10
- **説明**: `--warning` と `--warning-10` が追加され、`viewer.css` の `error-log-level.warn` でハードコード値から変数参照へ変更された。カラー体系の統一として良い変更。

#### SUG-D05: `registerView` のidempotent更新
- **ファイル**: `frontend/src/components/viewer/viewerRegistry.ts`
- **行**: diff行 59-63
- **説明**: 既存IDのプラグインを上書き (`registry[index] = plugin`) する変更は HMR 対応として正しい。ただし、上書き時にshortcut重複チェックが走らない（既存エントリの `shortcut` は古い値のままチェックされる可能性）。

---

## カテゴリ E: Frontend — 自動生成 (Wails)

**対象ファイル:**
- `frontend/wailsjs/go/main/App.d.ts.diff`
- `frontend/wailsjs/go/main/App.js.diff`
- `frontend/wailsjs/go/models.ts.diff`

### Critical Issues (0件)

### Important Issues (1件)

#### IMP-E01: `models.ts` — `WorkingDiffResult.convertValues` の重複定義
- **ファイル**: `frontend/wailsjs/go/models.ts`
- **行**: diff行 103-119
- **説明**: `WorkingDiffResult` クラスに `convertValues` メソッドが定義されているが、同じメソッドが他のモデルクラスにも存在する可能性がある。Wails自動生成コードであるため手動修正は不要だが、`convertValues` のロジック（`a.slice && a.map` による配列判定）は `Array.isArray()` の方が安全。
- **対応推奨**: Wails自動生成のため修正不要。自動生成ツールのバージョンアップで改善される可能性あり。

### Suggestions (1件)

#### SUG-E01: `App.d.ts` / `App.js` — 関数定義の並び順変更
- **説明**: `GetSessionErrorLog` / `GetSessionLogFilePath` の定義位置がアルファベット順に移動している。これはWailsの自動生成によるもので、機能的影響なし。

---

## カテゴリ F: Side Effects（他モジュールへの影響）

### Important Issues (2件)

#### IMP-F01: イベント名変更 `app:error-logged` → `app:error-log-updated` の全箇所統一
- **影響範囲**: バックエンド・フロントエンド両方
- **説明**: バックエンド (`app_session_log.go`) で `"app:error-log-updated"` に変更、フロントエンド (`useBackendSync.ts`) で受信イベント名を変更済み。ただし、**他のフロントエンドコンポーネントやテストで旧イベント名 `app:error-logged` を使用している箇所**がないか確認が必要。
- **対応推奨**: コードベース全体で `app:error-logged` をgrepし、残存箇所がないことを確認。

#### IMP-F02: `errorLogStore` の `addEntry` メソッド削除
- **影響範囲**: フロントエンド全体
- **説明**: `errorLogStore` から `addEntry` メソッドが削除され、`setEntries` のみになった。他のフロントエンドコンポーネントが `useErrorLogStore.getState().addEntry()` を呼んでいた場合、コンパイルエラーになる。
- **対応推奨**: コードベース全体で `addEntry` の参照を確認。本PR内の変更で `useBackendSync.ts` は修正済み。

---

## Strengths (良い点)

1. **ping+fetchモデル**: データロスのリスクを排除する堅牢な設計。スロットリングされてもfetch時に最新スナップショットを取得できる。
2. **seqフィールド**: フロントエンドのデduplication強化。弱い複合キー (`ts|level|msg|source`) からモノトニックカウンターへの移行は正しい判断。
3. **TeeHandler堅牢化**: callback panicリカバリ、base handler errorとの独立性確保は、本番運用安定性に寄与。
4. **テスト網羅性**: 新規API (`DevPanelWorkingDiff`) に対して包括的なテスト追加。パスパース、バイナリ判定、ディレクトリ再帰、除外ディレクトリ、空ファイルなど広範なケースをカバー。
5. **コメント品質**: IMP-01〜IMP-06, SUG-05〜SUG-07 などの識別子付きコメントにより、設計判断の背景が明確。
6. **HMR対応**: viewerRegistryの `globalThis` パターン + `dispose` フック + idempotent `registerView` による堅牢なHMR対応。
7. **ショートカット動的バインディング**: ハードコードされたキーバインディングから `shortcutMap` による動的バインディングへの移行は拡張性向上。

---

## Recommended Action

1. **CRI-C01** を最優先で確認・修正（`new(true)` のGo 1.26互換性）
2. **CRI-A01, CRI-A02** の対応判断
3. **IMP-F01, IMP-F02** のコードベース全体grep
4. **IMP-D01** の初回ロード時unread問題への対応判断
5. Suggestion項目は次回PR以降で順次対応

---

## 並列作業可否テーブル

以下のテーブルは、各指摘事項を修正する際に**他の指摘事項と並列で修正可能か**を示します。
「並列OK」は他の修正と同時作業しても衝突しないことを意味します。

| ID | 重要度 | 対象ファイル | 概要 | 並列OK? | 備考 |
|---|---|---|---|---|---|
| **CRI-C01** | Critical | `app_session_api_test.go`, `command_router_env_test.go`, `command_router_handlers_window_test.go` | `new(true)` / `new(false)` のGo 1.26互換性確認 | ✅ 並列OK | テストファイルのみの修正。各テストファイルは独立。他の実装修正と衝突しない |
| **CRI-A01** | Critical | `app_devpanel_api.go` | `buildUntrackedFileDiffs` WalkDir内のcachedInfo未使用 | ⚠️ 注意 | CRI-A02と同じファイル。同時修正時はマージコンフリクト注意 |
| **CRI-A02** | Critical | `app_devpanel_api.go` | `parseWorkingDiff` の分割方式改善 | ⚠️ 注意 | CRI-A01と同じファイル。同時修正時はマージコンフリクト注意 |
| **IMP-A01** | Important | `app_devpanel_api.go` (参照先確認) | `isPathWithinBase` のsymlink対応確認 | ✅ 並列OK | 確認作業のみ。他ファイルの修正は不要 |
| **IMP-A02** | Important | `app_devpanel_api.go` | `parseDiffHeaderPaths` の対称性チェックコメント改善 | ⚠️ 注意 | CRI-A01/A02と同じファイル |
| **IMP-A03** | Important | `app_session_log.go` | Sync()のWindows環境エラーハンドリング | ✅ 並列OK | 独立したファイル。他の修正と衝突しない |
| **IMP-A04** | Important | `app_devpanel_types.go` or `app_devpanel_api.go` | `WorkingDiffStatus` バリデーション追加 | ⚠️ 注意 | CRI-A01/A02と同じファイルの可能性 |
| **IMP-A05** | Important | `app_devpanel_api.go` | `collectUntrackedFiles` ファイル数上限 | ⚠️ 注意 | CRI-A01/A02と同じファイル |
| **IMP-B01** | Important | `internal/sessionlog/handler.go` | callbackパニック通知の改善検討 | ✅ 並列OK | 独立ファイル |
| **IMP-B02** | Important | `internal/tmux/command_router_handlers_window.go` | snapshot refetch失敗のテスト追加 | ✅ 並列OK | テストファイルの追加のみ |
| **IMP-B03** | Important | `internal/tmux/session_manager_windows.go` | `removedPanes` 初期化の可読性改善 | ✅ 並列OK | 独立ファイル |
| **IMP-C01** | Important | テストヘルパー確認 | `stubRuntimeEventsEmit(t)` 存在確認 | ✅ 並列OK | 確認作業のみ |
| **IMP-C02** | Important | `command_router_test_helpers_test.go` | `injectTestWindow` フィールドガード | ✅ 並列OK | テストヘルパーの変更のみ |
| **IMP-D01** | Important | `frontend/src/stores/errorLogStore.ts` | 初回ロード時のunread問題 | ✅ 並列OK | フロントエンドのみ。バックエンド修正と衝突しない |
| **IMP-D02** | Important | `frontend/src/components/viewer/viewerRegistry.ts` | globalThis汚染の確認 | ✅ 並列OK | 確認のみ |
| **IMP-D03** | Important | `frontend/src/components/viewer/views/error-log/ErrorLogView.tsx` | Strict Mode動作確認 | ✅ 並列OK | 確認のみ |
| **IMP-D04** | Important | `frontend/src/hooks/useBackendSync.ts` | unmount後のstore更新コメント | ✅ 並列OK | コメント追加のみ |
| **IMP-E01** | Important | `frontend/wailsjs/go/models.ts` | Wails自動生成の確認 | ✅ 並列OK | 対応不要（自動生成） |
| **IMP-F01** | Important | コードベース全体 | 旧イベント名 `app:error-logged` のgrep | ✅ 並列OK | 確認作業。並行して実施可能 |
| **IMP-F02** | Important | コードベース全体 | `addEntry` メソッド参照のgrep | ✅ 並列OK | 確認作業。並行して実施可能 |
| **SUG-A01** | Suggestion | コードベース全体 | `[DEBUG-DEVPANEL]` → `[DEVPANEL]` 統一 | ✅ 並列OK | ログプレフィックス変更のみ |
| **SUG-A02** | Suggestion | `app_devpanel_api.go` | `needsGitQuoting` テストケース追加 | ⚠️ 注意 | CRI-A01/A02と同じファイル |
| **SUG-A03** | Suggestion | ドキュメント | seqリセット仕様のドキュメント | ✅ 並列OK | コメント追加のみ |
| **SUG-A04** | Suggestion | `app_devpanel_api.go` | `devPanelMaxUntrackedFileSize` 引き上げ | ⚠️ 注意 | CRI-A01/A02と同じファイル |
| **SUG-B01** | Suggestion | - | (確認済み、対応不要) | - | - |
| **SUG-B02** | Suggestion | - | (確認済み、対応不要) | - | - |
| **SUG-C01** | Suggestion | `app_session_log_test.go` | テスト統合検討 | ✅ 並列OK | テストファイルのみ |
| **SUG-C02** | Suggestion | `app_session_log_test.go` | テーブル駆動の妥当性 | ✅ 並列OK | テストファイルのみ |
| **SUG-C03** | Suggestion | `app_devpanel_api_test.go` | 除外ディレクトリ定数参照 | ✅ 並列OK | テストファイルのみ |
| **SUG-D01** | Suggestion | `useBackendSync.ts` | イベントペイロード型修正 | ✅ 並列OK | フロントエンドのみ |
| **SUG-D02** | Suggestion | `errorLogStore.ts` | `.toSorted()` 検討 | ✅ 並列OK | フロントエンドのみ |
| **SUG-D03** | Suggestion | `ActivityStrip.tsx` or `viewerRegistry.ts` | position デフォルト値明示 | ✅ 並列OK | フロントエンドのみ |
| **SUG-D04** | Suggestion | - | (確認済み、対応不要) | - | - |
| **SUG-D05** | Suggestion | `viewerRegistry.ts` | 上書き時のshortcut重複チェック | ✅ 並列OK | フロントエンドのみ |
| **SUG-E01** | Suggestion | - | (確認済み、対応不要) | - | - |

### 並列作業のガイドライン

| グループ | 含まれるタスク | 作業者 | 注意事項 |
|---|---|---|---|
| **グループ1: app_devpanel_api.go集約** | CRI-A01, CRI-A02, IMP-A02, IMP-A04, IMP-A05, SUG-A02, SUG-A04 | 1名で順次対応 | 同一ファイルの変更が集中。並列不可 |
| **グループ2: テストファイル修正** | CRI-C01 (3ファイル分散), SUG-C01, SUG-C02, SUG-C03 | 1名で順次対応。テストファイル間は並列可 | CRI-C01は3ファイルに分散しているが、各ファイルは独立 |
| **グループ3: Internal Go実装** | IMP-B01, IMP-B02, IMP-B03 | グループ1, 2と**並列OK** | 各ファイルが独立 |
| **グループ4: Frontend修正** | IMP-D01, IMP-D03, IMP-D04, SUG-D01, SUG-D02, SUG-D03, SUG-D05 | グループ1〜3と**並列OK** | フロントエンドファイルは独立 |
| **グループ5: コードベース全体確認** | IMP-A01, IMP-F01, IMP-F02, SUG-A01, IMP-C01 | 全グループと**並列OK** | 確認・grep作業のみ |
| **グループ6: session_log.go** | IMP-A03 | グループ1と**並列OK** | 独立ファイル |
