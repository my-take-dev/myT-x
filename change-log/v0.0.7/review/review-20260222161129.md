# PR Review Summary (æœ¬ç•ªã‚³ãƒ¼ãƒ‰æ¤œè¨¼æ¸ˆã¿ãƒ»ç¬¬2ç‰ˆ)

**ãƒ¬ãƒ“ãƒ¥ãƒ¼æ—¥æ™‚**: 2026-02-22 16:17  
**å¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«æ•°**: 38ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆå·®åˆ†ï¼‰ + æœ¬ç•ªã‚³ãƒ¼ãƒ‰å…¨ä½“  
**ãƒ¬ãƒ“ãƒ¥ãƒ¼æ–¹é‡**: review-pr-para.prompt.md æº–æ‹ ï¼ˆcode / errors / types / tests / comments / simplify ã®å…¨è¦³ç‚¹ï¼‰  
**æœ¬ç‰ˆã®ç‰¹å¾´**: å·®åˆ†ã ã‘ã§ãªãæœ¬ç•ªã‚³ãƒ¼ãƒ‰å…¨ä½“ã‚’èª­ã¿è¾¼ã¿ã€å‘¨è¾ºã®å½±éŸ¿ç¯„å›²ãƒ»å‡¦ç†ã®å·®ç•°ãƒ»å‘¼ã³å‡ºã—é–¢ä¿‚ã‚’æ¤œè¨¼æ¸ˆã¿

---

## ã‚«ãƒ†ã‚´ãƒªåˆ†é¡

| ã‚«ãƒ†ã‚´ãƒª | ãƒ•ã‚¡ã‚¤ãƒ«æ•° | å¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ« |
|---------|--------:|------------|
| A. ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ - DevPanel API | 4 | `app_devpanel_api.go`, `app_devpanel_api_test.go`, `app_devpanel_types.go`, `app.go` |
| B. ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ - SessionLog | 4 | `app_session_log.go`, `app_session_log_test.go`, `app_session_log_types.go`, `internal/sessionlog/handler.go` |
| C. ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ - SessionLog ãƒ†ã‚¹ãƒˆ | 1 | `internal/sessionlog/handler_test.go` |
| D. ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ - Events/Lifecycle/PaneAPI | 5 | `app_events.go`, `app_events_test.go`, `app_lifecycle.go`, `app_lifecycle_test.go`, `app_pane_api.go` |
| E. ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ - Internal/Tmux | 8 | `session_manager_windows.go`, `command_router_handlers_window.go`, `command_router_handlers_window_test.go`, `command_router_test_helpers_test.go`, `session_manager_test.go`, `session_manager_window_test.go`, `session_manager_directional_test.go`, `session_manager_pane_io_test.go` |
| F. ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ - ãã®ä»– | 2 | `internal/testutil/helpers.go`, `internal/tmux/command_router_env_test.go` |
| G. ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ - ãƒ“ãƒ¥ãƒ¼ã‚¢/ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ | 6 | `ViewerSystem.tsx`, `ActivityStrip.tsx`, `viewerRegistry.ts`, `ErrorLogView.tsx`, `error-log/index.ts`, `error-log/useErrorLog.ts` |
| H. ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ - ã‚¹ãƒˆã‚¢/ãƒ•ãƒƒã‚¯/API | 3 | `errorLogStore.ts`, `useBackendSync.ts`, `api.ts` |
| I. ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ - ã‚¹ã‚¿ã‚¤ãƒ« | 2 | `base.css`, `viewer.css` |
| J. ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ - Wailsç”Ÿæˆãƒ•ã‚¡ã‚¤ãƒ« | 3 | `App.d.ts`, `App.js`, `models.ts` |

---

## ç¬¬1ç‰ˆã‹ã‚‰ã®å¤‰æ›´ç‚¹

| ç¬¬1ç‰ˆID | å¤‰æ›´ | ç†ç”± |
|---------|------|------|
| CRI-01 | **å–ã‚Šæ¶ˆã— â†’ SUG-03b** | æœ¬ç•ªã‚³ãƒ¼ãƒ‰ç¢ºèªã«ã‚ˆã‚Šã€ãƒã‚¸ã‚§ãƒƒãƒˆãƒã‚§ãƒƒã‚¯ã¯å‘¼ã³å‡ºã—å…ƒ `DevPanelWorkingDiff` (è¡Œ563-568) ã§ `remainingBudget <= 0` ã‚’äº‹å‰ãƒã‚§ãƒƒã‚¯æ¸ˆã¿ã€‚`buildUntrackedFileDiffsWithBudget` ã®687è¡Œ `if remainingBudget >= 0 && remainingBudget <= 0` ã¯åˆå›å‘¼ã³å‡ºã—æ™‚ã®ã€Œãƒã‚¸ã‚§ãƒƒãƒˆãŒã¡ã‚‡ã†ã©0ã§å§‹ã¾ã£ãŸãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªWalkã€ã®ã¿è©²å½“ã™ã‚‹ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹ã ãŒã€å‘¼ã³å‡ºã—å…ƒã§ `remainingBudget <= 0` ã‚’å…ˆã«ãƒã‚§ãƒƒã‚¯ã—ã¦ã„ã‚‹ãŸã‚ã€ã“ã®é–¢æ•°ã« `remainingBudget == 0` ã§åˆ°é”ã™ã‚‹ã‚±ãƒ¼ã‚¹ã¯æ­£å¸¸ãƒ•ãƒ­ãƒ¼ã§ã¯ç™ºç”Ÿã—ãªã„ã€‚Criticalã‹ã‚‰ã®é™æ ¼ãŒå¦¥å½“ã€‚ |
| CRI-02 | **Important â†’ IMP-10** | æœ¬ç•ªã‚³ãƒ¼ãƒ‰ç¢ºèªã«ã‚ˆã‚Šã€`buildUntrackedFileDiffSingle` è¡Œ752ã® `os.Lstat` ã¯ã‚·ãƒ³ãƒœãƒªãƒƒã‚¯ãƒªãƒ³ã‚¯æ¤œå‡ºå°‚ç”¨ã€‚è¡Œ647ã®å‘¼ã³å‡ºã—å…ƒã® `os.Lstat` ã¯ `info.IsDir()` åˆ¤å®šã¨ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºæƒ…å ±ã‚­ãƒ£ãƒƒã‚·ãƒ¥ç›®çš„ã€‚å½¹å‰²ãŒç•°ãªã‚‹ãŸã‚äºŒé‡å‘¼ã³å‡ºã—ã§ã¯ãªãã€æ„å›³çš„ãªå¤šå±¤é˜²å¾¡ã€‚ãŸã ã—å‘¼ã³å‡ºã—å…ƒãŒ `info` ã‚’æ¸¡ã—ã¦ã„ã‚‹ã«ã‚‚é–¢ã‚ã‚‰ãšã€è¡Œ752ã§å†åº¦Lstatã—ã¦ã„ã‚‹ç‚¹ã¯ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–ã®ä½™åœ°ãŒã‚ã‚‹ã€‚ |
| CRI-03 | **ç¶­æŒï¼ˆæ–‡å­—åŒ–ã‘ç¢ºèªæ¸ˆã¿ï¼‰** | æœ¬ç•ªã‚³ãƒ¼ãƒ‰ `app_events.go` ã‚’ç›´æ¥ç¢ºèªã—ãŸçµæœã€è¡Œ134 `çª¶ãƒ»`ã€è¡Œ219 `ç«•ï½¤`ã€è¡Œ222 `çª¶ãƒ»` ç­‰ã®æ–‡å­—åŒ–ã‘ãŒ**å®Ÿéš›ã®ãƒ•ã‚¡ã‚¤ãƒ«å†…ã«å­˜åœ¨**ã™ã‚‹ã“ã¨ã‚’ç¢ºèªã€‚å·®åˆ†ç”Ÿæˆæ™‚ã®å•é¡Œã§ã¯ãªãã€æœ¬ç•ªã‚³ãƒ¼ãƒ‰è‡ªä½“ã®å•é¡Œã€‚ |
| - | **æ–°è¦è¿½åŠ : CRI-04** | æœ¬ç•ªã‚³ãƒ¼ãƒ‰æ¤œè¨¼ã§æ–°ãŸã«ç™ºè¦‹ |
| - | **æ–°è¦è¿½åŠ : IMP-10ã€œIMP-15** | æœ¬ç•ªã‚³ãƒ¼ãƒ‰æ¤œè¨¼ã§æ–°ãŸã«ç™ºè¦‹ |

---

## Critical Issues (2ä»¶)

### CRI-03: [comments] `app_events.go` ã®æ–‡å­—åŒ–ã‘ãŒæœ¬ç•ªã‚³ãƒ¼ãƒ‰ã«å­˜åœ¨
**ãƒ•ã‚¡ã‚¤ãƒ«**: `app_events.go` è¡Œ134, 153, 219, 222
```go
// è¡Œ134: NOTE(1-window model): Currently unreachable çª¶ãƒ»retained for ...
// è¡Œ140: multi-window extension only needs to start emitting the events çª¶ãƒ»no policy
// è¡Œ143: INVARIANT: immutable after init çª¶ãƒ»do not modify at runtime.
// è¡Œ153: // NOTE(1-window model): è¿´ï½¾è¨ï½¨ç¸ºï½®ç¹§ï½¢ç¹ï½¼ç¹§ï½­ç¹ãƒ»ã‘ç¹âˆšÎ•ç¸ºï½¯ 1 ç¹§ï½»ç¹ãƒ»ã™ç¹ï½§ç¹ï½³ ... ï¼ˆå®Œå…¨ã«åŒ–ã‘ï¼‰
// è¡Œ219: for this flush window (ç«•ï½¤ outputFlushInterval = 16 ms) is lost.
// è¡Œ222: is at most one flush interval worth of data çª¶ãƒ»invisible to users.
```
**æœ¬ç•ªã‚³ãƒ¼ãƒ‰ç¢ºèªçµæœ**: `view_file` ã§å–å¾—ã—ãŸæœ¬ç•ªã‚³ãƒ¼ãƒ‰è¡Œ134, 153, 219, 222ã§æ–‡å­—åŒ–ã‘ã‚’ç›´æ¥ç¢ºèªæ¸ˆã¿ã€‚
- `çª¶ãƒ»` = em-dashï¼ˆâ€”ï¼‰ã®Shift_JISèª¤è§£é‡ˆ
- `ç«•ï½¤` = æ•°å­¦è¨˜å·ï¼ˆâ‰¤ï¼‰ã®Shift_JISèª¤è§£é‡ˆ
- è¡Œ153ã®ã‚³ãƒ¡ãƒ³ãƒˆã¯ **å®Œå…¨ã«Shift_JISæ–‡å­—åŒ–ã‘**ï¼ˆæ—¥æœ¬èªã‚³ãƒ¡ãƒ³ãƒˆãŒUTF-8ä»¥å¤–ã§ä¿å­˜ã•ã‚ŒãŸå¯èƒ½æ€§ï¼‰

**CLAUDE.mdæº–æ‹ **: ã€Œå…¨ã¦UTF8ã§BOMç„¡ã—ã¨ã™ã‚‹ã€(CLAUDE.mdè¡Œ42ç›¸å½“) ã«é•åã€‚  
**å½±éŸ¿ç¯„å›²**: ã‚³ãƒ¼ãƒ‰ã®å‹•ä½œã«ã¯å½±éŸ¿ã—ãªã„ãŒã€ã‚³ãƒ¡ãƒ³ãƒˆã®å¯èª­æ€§ãŒå®Œå…¨ã«å¤±ã‚ã‚Œã¦ã„ã‚‹ã€‚  
**ä¿®æ­£æ¡ˆ**: 
1. è¡Œ134, 140, 143: `çª¶ãƒ»` â†’ `â€”` (em-dash) ã«ç½®æ›
2. è¡Œ219: `ç«•ï½¤` â†’ `â‰¤` ã«ç½®æ›  
3. è¡Œ153: Git historyã‹ã‚‰å…ƒã®æ—¥æœ¬èªã‚³ãƒ¡ãƒ³ãƒˆã‚’å¾©å…ƒï¼ˆShift_JIS â†’ UTF-8å¤‰æ›ï¼‰

---

### CRI-04: [code] `handleNewWindow` ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯å¾Œã« `tmux:session-created` ã‚¤ãƒ™ãƒ³ãƒˆãŒç™ºè¡Œã•ã‚Œãªã„ãŒã€CreateSessionå´ã§å†…éƒ¨IDãŒæ¶ˆè²»ã•ã‚Œã‚‹
**ãƒ•ã‚¡ã‚¤ãƒ«**: `command_router_handlers_window.go` è¡Œ269-362
**æœ¬ç•ªã‚³ãƒ¼ãƒ‰ç¢ºèªçµæœ**: 
```go
// è¡Œ269: session, pane, err := r.sessions.CreateSession(newSessionName, "0", width, height)
// ... (ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯å¯èƒ½ãªã‚¹ãƒ†ãƒƒãƒ—) ...
// è¡Œ308-309: if !snapOk { return rollbackSession("snapshot-refetch", ...) }
// ... 
// è¡Œ346: r.emitter.Emit("tmux:session-created", ...)  // â† ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯æ™‚ã¯åˆ°é”ã—ãªã„
```
**å•é¡Œ**: `CreateSession` (è¡Œ269) ã¯æˆåŠŸã™ã‚‹ãŒã€å¾Œç¶šã‚¹ãƒ†ãƒƒãƒ—ï¼ˆè¡Œ294 flag copy, è¡Œ300 pane context, è¡Œ308 snapshot refetch, è¡Œ317 attach terminalï¼‰ã®ã„ãšã‚Œã‹ãŒå¤±æ•—ã™ã‚‹ã¨ `rollbackSession` ãŒå‘¼ã°ã‚Œã‚‹ã€‚ã—ã‹ã—:

1. `rollbackSession` ã¯ `RemoveSession` ã®ã¿å®Ÿè¡Œã—ã€`tmux:session-destroyed` ã‚¤ãƒ™ãƒ³ãƒˆã‚’ç™ºè¡Œã—ãªã„
2. `tmux:session-created` ã¯step 12ï¼ˆè¡Œ346ï¼‰ã§ç™ºè¡Œã•ã‚Œã‚‹ãŸã‚ã€ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯æ™‚ã¯ç™ºè¡Œã•ã‚Œãªã„
3. ã—ãŸãŒã£ã¦ã€ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã¯ã‚»ãƒƒã‚·ãƒ§ãƒ³ä½œæˆã‚’çŸ¥ã‚‰ãªã„ãŸã‚ä¸æ•´åˆã¯ç™ºç”Ÿã—ãªã„ â† **å•é¡Œãªã—**

**ãŸã ã—**ã€å·®åˆ†ã§å¤‰æ›´ã•ã‚ŒãŸè¡Œ308-309ã®æŒ™å‹•å¤‰æ›´ã«ã¯é‡è¦ãªå½±éŸ¿ãŒã‚ã‚‹:
```go
// Before (å·®åˆ†): fallback to legacy path with nil session
newSessionSnap = nil
slog.Warn("[WARN-ENV] handleNewWindow: session not found for snapshot after flag copy, falling back to legacy path", ...)

// After (æœ¬ç•ª): ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯
if !snapOk {
    return rollbackSession("snapshot-refetch", fmt.Errorf("session disappeared after flag copy: %s", newSessionName))
}
```
**å½±éŸ¿**: ä»¥å‰ã¯ã€Œã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆå–å¾—å¤±æ•— â†’ nil envã§ç¶šè¡Œï¼ˆãƒ‡ã‚°ãƒ¬ãƒ¼ãƒ‰ãƒ¢ãƒ¼ãƒ‰ï¼‰ã€ã ã£ãŸãŒã€ä»Šå›ã¯ã€Œã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆå–å¾—å¤±æ•— â†’ ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼ˆã‚»ãƒƒã‚·ãƒ§ãƒ³æ¶ˆæ»…ï¼‰ã€ã«å¤‰æ›´ã€‚ã“ã‚Œã¯æ­£ã—ã„æ–¹å‘ã®æ”¹å–„ï¼ˆåŠç«¯ãªçŠ¶æ…‹ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’æ®‹ã•ãªã„ï¼‰ã ãŒã€**CreateSessionãŒæˆåŠŸã—ãŸç›´å¾Œã®GetSessionãŒå¤±æ•—ã™ã‚‹çŠ¶æ³ã¯é€šå¸¸ã‚ã‚Šå¾—ãªã„**ï¼ˆåŒä¸€goroutineå†…ã§ãƒ­ãƒƒã‚¯å–å¾—â†’è§£æ”¾â†’å†å–å¾—ã®ãŸã‚ï¼‰ã€‚ã‚‚ã—ç™ºç”Ÿã—ãŸå ´åˆã¯æ·±åˆ»ãªå†…éƒ¨ãƒ­ã‚¸ãƒƒã‚¯ã‚¨ãƒ©ãƒ¼ã‚’ç¤ºã™ãŸã‚ã€ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯ + ã‚¨ãƒ©ãƒ¼returnã¯å¦¥å½“ã€‚

**çµè«–**: ãƒ­ã‚¸ãƒƒã‚¯è‡ªä½“ã¯æ­£ã—ã„ãŒã€ã“ã®å¤‰æ›´ã¯**å‹•ä½œã®å¤§å¹…ãªå¤‰æ›´**ã§ã‚ã‚Šã€ãƒ†ã‚¹ãƒˆãŒå­˜åœ¨ã™ã‚‹ã‹ç¢ºèªãŒå¿…è¦ã€‚å·®åˆ†ã® `command_router_handlers_window_test.go` ã«ã¯ã“ã®ãƒ‘ã‚¹ã®ãƒ†ã‚¹ãƒˆãŒå«ã¾ã‚Œã¦ã„ãªã„ã€‚
**ä¿®æ­£æ¡ˆ**: `TestHandleNewWindow_SnapshotRefetchFailure` ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ã®è¿½åŠ ã‚’æ¨å¥¨ã€‚

---

## Important Issues (15ä»¶)

### IMP-01: [code] `parseWorkingDiff` ã® addition/deletion ã‚«ã‚¦ãƒ³ãƒˆãŒhunkãƒ˜ãƒƒãƒ€å¤–ã®è¡Œã‚‚ã‚¹ã‚­ãƒ£ãƒ³
**ãƒ•ã‚¡ã‚¤ãƒ«**: `app_devpanel_api.go` è¡Œ889-908
```go
for _, line := range lines {
    if strings.HasPrefix(line, "new file mode") {
        file.Status = WorkingDiffStatusAdded
    } else if strings.HasPrefix(line, "deleted file mode") {
        // ...
    } else if strings.HasPrefix(line, "+") && !strings.HasPrefix(line, "+++") {
        file.Additions++
    } else if strings.HasPrefix(line, "-") && !strings.HasPrefix(line, "---") {
        file.Deletions++
    }
}
```
**æœ¬ç•ªã‚³ãƒ¼ãƒ‰ç¢ºèªçµæœ**: `splitUnifiedDiffBlocks` (è¡Œ917-946) ã§å„ãƒ–ãƒ­ãƒƒã‚¯ã«åˆ†å‰²å¾Œã€ãƒ–ãƒ­ãƒƒã‚¯å…¨ä½“ã‚’ã‚¹ã‚­ãƒ£ãƒ³ã—ã¦ã„ã‚‹ã€‚ãƒ˜ãƒƒãƒ€è¡Œï¼ˆ`diff --git`, `index`, `new file mode`, `---`, `+++`ï¼‰ã¯ `+` ã§å§‹ã¾ã‚‰ãªã„ãŸã‚é™¤å¤–ã•ã‚Œã‚‹ã€‚`@@ ... @@` hunkãƒ˜ãƒƒãƒ€è¡Œã‚‚ `@` ã§å§‹ã¾ã‚‹ãŸã‚é™¤å¤–ã•ã‚Œã‚‹ã€‚  
**çµè«–**: å®Ÿéš›ã«ã¯hunkãƒ˜ãƒƒãƒ€å¤–ã®è¡ŒãŒ `+` / `-` ã§å§‹ã¾ã‚‹ã‚±ãƒ¼ã‚¹ã¯Gitã®æ­£è¦diffãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã§ã¯ç™ºç”Ÿã—ãªã„ã€‚**å®Ÿè³ªçš„ã«å•é¡Œãªã—**ã ãŒã€æ„å›³ã‚’ã‚³ãƒ¡ãƒ³ãƒˆã§æ˜ç¢ºã«ã™ã‚‹ã¨ä¿å®ˆæ€§ãŒå‘ä¸Šã™ã‚‹ã€‚  
**ä¿®æ­£æ¡ˆ**: ã‚³ãƒ¡ãƒ³ãƒˆè¿½åŠ ã®ã¿ï¼ˆã‚³ãƒ¼ãƒ‰å¤‰æ›´ä¸è¦ï¼‰ã€‚

### IMP-02: [code] `initSessionLog` ã§Lockã®ä½ç½®ã¨cleanupã®é †åº
**ãƒ•ã‚¡ã‚¤ãƒ«**: `app_session_log.go` è¡Œ43-51
```go
a.sessionLogMu.Lock()
a.sessionLogFile = f
a.sessionLogPath = fullPath
a.sessionLogMu.Unlock()

a.cleanupOldSessionLogs()   // â† Lockå¤–ã§cleanupå®Ÿè¡Œ
slog.Info("[session-log] initialized", "path", fullPath)
```
**æœ¬ç•ªã‚³ãƒ¼ãƒ‰ç¢ºèªçµæœ**: `cleanupOldSessionLogs` (è¡Œ53-101) ã¯å†…éƒ¨ã§ `a.sessionLogMu.RLock()` ã‚’å–å¾—ã—ã¦ãƒ‘ã‚¹ã‚’èª­ã¿å–ã‚‹ã€‚`initSessionLog` ã¯startupä¸­ã«ã®ã¿å‘¼ã°ã‚Œã‚‹ãŸã‚ï¼ˆ`app_lifecycle.go` ã‹ã‚‰ï¼‰ã€ä¸¦è¡Œæ€§ã®å•é¡Œã¯ãªã„ã€‚  
**å½±éŸ¿ç¯„å›²ç¢ºèª**: `app.go` ã® `App` æ§‹é€ ä½“å®šç¾© (è¡Œ102-109) ã§sessionLogé–¢é€£ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã¯ã™ã¹ã¦ `sessionLogMu` ã§ä¿è­·ã•ã‚Œã‚‹ã“ã¨ãŒæ–‡æ›¸åŒ–ã•ã‚Œã¦ã„ã‚‹ã€‚  
**çµè«–**: å•é¡Œãªã—ã€‚é †åºã‚‚æ­£ç¢ºï¼ˆLockä¸‹ã§ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰è¨­å®š â†’ Unlock â†’ cleanupå®Ÿè¡Œï¼‰ã€‚

### IMP-03: [code] `cleanupOldSessionLogs` ã®currentFileã‚¹ã‚­ãƒƒãƒ—æ™‚ã«excessè¶…é
**ãƒ•ã‚¡ã‚¤ãƒ«**: `app_session_log.go` è¡Œ89-100
```go
for _, name := range logFiles[:excess] {
    if name == currentFile {
        // Never delete the active session log file for this process.
        continue
    }
    // ... os.Remove ...
}
```
**æœ¬ç•ªã‚³ãƒ¼ãƒ‰ç¢ºèªçµæœ**: `logFiles[:excess]` ã®ä¸­ã«currentFileãŒå«ã¾ã‚Œã¦ã„ã‚‹å ´åˆã€ãã®ãƒ•ã‚¡ã‚¤ãƒ«ãŒã‚¹ã‚­ãƒƒãƒ—ã•ã‚Œã€çµæœã¨ã—ã¦ `sessionLogMaxFiles + 1` ãƒ•ã‚¡ã‚¤ãƒ«ãŒæ®‹ã‚‹ã€‚  
**å½±éŸ¿ç¯„å›²**: `sessionLogMaxFiles = 100` (è¡Œ18) ãªã®ã§ã€æœ€å¤§101ãƒ•ã‚¡ã‚¤ãƒ«ãŒæ®‹ã‚‹ã‚±ãƒ¼ã‚¹ã€‚ãƒ‡ã‚£ã‚¹ã‚¯å®¹é‡ã¸ã®å½±éŸ¿ã¯å¾®å°ã€‚  
**ä¿®æ­£æ¡ˆ**: `logFiles` ã‹ã‚‰currentFileã‚’äº‹å‰ã«ãƒ•ã‚£ãƒ«ã‚¿ã—ã¦ã‹ã‚‰excessã‚’è¨ˆç®—ã™ã‚‹ã€‚ãŸã ã—å„ªå…ˆåº¦ã¯ä½ã„ã€‚

### IMP-04: [errors] `DevPanelWorkingDiff` fresh repoã‚¨ãƒ©ãƒ¼å‡¦ç†ã®éå¯¾ç§°æ€§
**ãƒ•ã‚¡ã‚¤ãƒ«**: `app_devpanel_api.go` è¡Œ520-541
```go
if isFreshRepo {
    // git diff --cached å¤±æ•— â†’ diffLoadIncomplete = true â†’ å‡¦ç†ç¶™ç¶š
} else {
    // git diff HEAD å¤±æ•— â†’ return ã‚¨ãƒ©ãƒ¼ï¼ˆå‡¦ç†ä¸­æ–­ï¼‰
}
```
**æœ¬ç•ªã‚³ãƒ¼ãƒ‰ç¢ºèªçµæœ**: `isFreshRepo` æ™‚ã®ã‚¨ãƒ©ãƒ¼ã¯ `diffLoadIncomplete = true` ã§å‡¦ç†ç¶™ç¶šã—ã€untracked filesã®ã¿è¿”ã™ã€‚éfreshRepoã®ã‚¨ãƒ©ãƒ¼ã¯å³åº§ã«returnã€‚ã“ã®éå¯¾ç§°æ€§ã¯æ„å›³çš„ï¼šfresh repoã§ã¯ `git diff --cached` ãŒå¤±æ•—ã—ã¦ã‚‚untracked filesã®è¡¨ç¤ºã«ä¾¡å€¤ãŒã‚ã‚‹ï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯æ–°è¦ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç¢ºèªã—ãŸã„ï¼‰ã€‚é€šå¸¸repoã§ã¯ `git diff HEAD` å¤±æ•—ã¯è‡´å‘½çš„ï¼ˆãƒ¯ãƒ¼ã‚­ãƒ³ã‚°ãƒ„ãƒªãƒ¼ã®çŠ¶æ…‹ãŒä¸æ˜ï¼‰ã€‚  
**çµè«–**: æ„å›³çš„ãªè¨­è¨ˆã€‚å•é¡Œãªã—ã€‚

### IMP-05: [types] `WorkingDiffStatus` ã®å‹alias
**ãƒ•ã‚¡ã‚¤ãƒ«**: `app_devpanel_types.go` è¡Œ42-57
**æœ¬ç•ªã‚³ãƒ¼ãƒ‰ç¢ºèªçµæœ**: å‹aliasã¯ `type WorkingDiffStatus = string` (è¡Œ49)ã§ã€5ã¤ã®å®šæ•°ãŒå®šç¾© (è¡Œ51-57)ã€‚Wails TypeScript bindingäº’æ›æ€§ã®ãŸã‚ã®ãƒˆãƒ¬ãƒ¼ãƒ‰ã‚ªãƒ•ã¨ã—ã¦æ–‡æ›¸åŒ–æ¸ˆã¿ã€‚  
**å½±éŸ¿ç¯„å›²ç¢ºèª**: `parseWorkingDiff` (è¡Œ881-911) ã¨ `buildUntrackedFileDiffSingle` (è¡Œ818-842) ã§å®šæ•°ã‚’ä½¿ç”¨ã€‚ç›´æ¥string literalã¯ä½¿ç”¨ã•ã‚Œã¦ã„ãªã„ã€‚  
**çµè«–**: è¨±å®¹ç¯„å›²ã€‚ç¾çŠ¶ã®ã‚³ãƒ¼ãƒ‰å“è³ªã§å•é¡Œãªã—ã€‚

### IMP-06: [code] `normalizeEntries` ã®ã‚µã‚¤ãƒ¬ãƒ³ãƒˆé™¤å¤–ã¨ `isValidSeq` ã®é˜²å¾¡ç¯„å›²
**ãƒ•ã‚¡ã‚¤ãƒ«**: `errorLogStore.ts` è¡Œ15-31
**æœ¬ç•ªã‚³ãƒ¼ãƒ‰ç¢ºèªçµæœ**: ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã® `writeSessionLogEntry` (app_session_log.goè¡Œ129) ã§ `a.sessionLogSeq++` ã—ã¦ã‹ã‚‰ `entry.Seq = a.sessionLogSeq` ã‚’è¨­å®šã€‚Go uint64ã®åˆæœŸå€¤0ã‹ã‚‰ã‚¤ãƒ³ã‚¯ãƒªãƒ¡ãƒ³ãƒˆã™ã‚‹ãŸã‚ã€Seqã¯å¸¸ã«1ä»¥ä¸Šã€‚  
**å½±éŸ¿ç¯„å›²ç¢ºèª**: `GetSessionErrorLog` (è¡Œ211-221) ã¯ `a.sessionLogEntries.snapshot()` ã§æ—¢ã«SeqãŒè¨­å®šã•ã‚ŒãŸçŠ¶æ…‹ã®ã‚¨ãƒ³ãƒˆãƒªã‚’è¿”ã™ã€‚`models.ts` ã® `SessionLogEntry` ã‚¯ãƒ©ã‚¹ (diffè¡Œ49) ã§ `this.seq = source["seq"]` ã¨ã—ã¦ãƒ‡ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚ºã€‚  
**çµè«–**: ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ãŒæ­£ã—ãå‹•ä½œã—ã¦ã„ã‚‹é™ã‚Š `isValidSeq` ã§ãƒ•ã‚£ãƒ«ã‚¿ã•ã‚Œã‚‹ã‚¨ãƒ³ãƒˆãƒªã¯å­˜åœ¨ã—ãªã„ã€‚é˜²å¾¡çš„ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã¨ã—ã¦é©åˆ‡ã€‚

### IMP-07: [code] `useBackendSync.ts` ã®ãƒ‡ãƒã‚¦ãƒ³ã‚¹ã¨fetchSequenceã®å¤šå±¤é˜²å¾¡
**ãƒ•ã‚¡ã‚¤ãƒ«**: `useBackendSync.ts` è¡Œ482-528
**æœ¬ç•ªã‚³ãƒ¼ãƒ‰ç¢ºèªçµæœ**: 
1. `isMountedRef` ã‚¬ãƒ¼ãƒ‰ï¼ˆè¡Œ489, 494, 506ï¼‰
2. `errorLogFetchSeq` ã‚«ã‚¦ãƒ³ã‚¿ï¼ˆè¡Œ490, 494ï¼‰ã§ä¸¦è¡Œãƒ•ã‚§ãƒƒãƒã®å¤ã„çµæœã‚’ç ´æ£„
3. `errorLogDebounceTimer` ã®cleanupï¼ˆè¡Œ525-528ï¼‰
4. `cleanupFns` ã®é€†é †å‘¼ã³å‡ºã—ï¼ˆè¡Œ529-537ï¼‰

**å½±éŸ¿ç¯„å›²ç¢ºèª**: `EventsOn` (wailsjs) ã¯ `cleanupFns` ã«ç™»éŒ²ã•ã‚Œã€unmountæ™‚ã«å…¨ã¦è§£é™¤ã•ã‚Œã‚‹ã€‚  
**çµè«–**: å¤šå±¤é˜²å¾¡ãŒé©åˆ‡ã«å®Ÿè£…ã•ã‚Œã¦ã„ã‚‹ã€‚å•é¡Œãªã—ã€‚

### IMP-08: [code] `handleNewWindow` snapshotæ¶ˆå¤±æ™‚ã®ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯å¤‰æ›´
â†’ CRI-04 ã«çµ±åˆã€‚

### IMP-09: [code] TeeHandlerã®å‹•ä½œå¤‰æ›´ã¨panicãƒªã‚«ãƒãƒª
**ãƒ•ã‚¡ã‚¤ãƒ«**: `internal/sessionlog/handler.go` è¡Œ54-80
**æœ¬ç•ªã‚³ãƒ¼ãƒ‰ç¢ºèªçµæœ**: 
1. ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ã‚’base handleræˆåŠŸ/å¤±æ•—ã«é–¢ã‚ã‚‰ãšå‘¼ã¶ï¼ˆè¡Œ63ï¼‰
2. panic recoveryè¿½åŠ ï¼ˆè¡Œ65-72ï¼‰  
3. `WithAttrs(nil)` â†’ `return h` çŸ­çµ¡ï¼ˆè¡Œ85-86ï¼‰
4. `WithGroup("")` â†’ `return h` çŸ­çµ¡ï¼ˆè¡Œ100-101ï¼‰

**å½±éŸ¿ç¯„å›²ç¢ºèª**: `app_lifecycle.go` (å·®åˆ†) ã§TeeHandlerã‚’ä½¿ç”¨ã€‚ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ã¯ `a.writeSessionLogEntry` ã‚’å‘¼ã¶ã€‚`writeSessionLogEntry` å†…ã§ `sessionLogMu.Lock()` ã‚’å–å¾—ã™ã‚‹ãŸã‚ã€ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ãŒpanicã—ãŸå ´åˆã«lockãŒãƒªãƒ¼ã‚¯ã™ã‚‹å±é™ºãŒã‚ã‚‹ã€‚**ã—ã‹ã—**ã€panic recovery (è¡Œ66) ãŒ `recover()` ã‚’å‘¼ã¶ã“ã¨ã§lockãƒªãƒ¼ã‚¯ã¯ç™ºç”Ÿã—ãªã„ï¼ˆGoä»•æ§˜: deferã¯panicã‚¹ã‚¿ãƒƒã‚¯å·»ãæˆ»ã—æ™‚ã«å®Ÿè¡Œã•ã‚Œã‚‹ã€‚`writeSessionLogEntry` å†…ã®deferã‚‚å®Ÿè¡Œã•ã‚Œã‚‹ï¼‰ã€‚  
**çµè«–**: æ­£æ–¹å‘ã®æ”¹å–„ã€‚å•é¡Œãªã—ã€‚

### IMP-10: [code] `buildUntrackedFileDiffSingle` ã®å¤šæ®µã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒã‚§ãƒƒã‚¯ï¼ˆæ–°è¦ï¼‰
**ãƒ•ã‚¡ã‚¤ãƒ«**: `app_devpanel_api.go` è¡Œ726-777
**æœ¬ç•ªã‚³ãƒ¼ãƒ‰ç¢ºèªçµæœ**: 3æ®µéšã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒã‚§ãƒƒã‚¯:
1. **è¡Œ730**: `isPathWithinBase(absPath, workDir)` â€” lexical guardï¼ˆEvalSymlinkså‰ï¼‰
2. **è¡Œ737-750**: `EvalSymlinks` å¾Œã«ã‚‚ã†ä¸€åº¦ `isPathWithinBase` â€” symlink resolutionå¾Œã®ã‚¬ãƒ¼ãƒ‰
3. **è¡Œ752-760**: `os.Lstat` ã§ã‚·ãƒ³ãƒœãƒªãƒƒã‚¯ãƒªãƒ³ã‚¯æ¤œå‡º

**å½±éŸ¿ç¯„å›²ç¢ºèª**: `isPathWithinBase` ã¯ `app_worktree_api.go` è¡Œ645ã§å®šç¾©ã€‚`filepath.Rel` ã§ãƒ™ãƒ¼ã‚¹ã‹ã‚‰ã®ç›¸å¯¾ãƒ‘ã‚¹ã‚’è¨ˆç®—ã—ã€`..` ã‚’å«ã¾ãªã„ã“ã¨ã‚’æ¤œè¨¼ã€‚  
**å•é¡Œ**: è¡Œ752ã® `os.Lstat` ã¯è¡Œ737ã® `filepath.EvalSymlinks(absPath)` ã®**å¾Œã«**å‘¼ã°ã‚Œã¦ã„ã‚‹ã€‚`EvalSymlinks` ãŒæˆåŠŸã—ãŸæ™‚ç‚¹ã§ `absPath` ã¯æœ‰åŠ¹ãªãƒ‘ã‚¹ã§ã‚ã‚Šã€ã‚·ãƒ³ãƒœãƒªãƒƒã‚¯ãƒªãƒ³ã‚¯ã®è§£æ±ºã‚‚å®Œäº†ã—ã¦ã„ã‚‹ã€‚ãã®ãŸã‚è¡Œ752ã® `os.Lstat` ã§å†åº¦ã‚·ãƒ³ãƒœãƒªãƒƒã‚¯ãƒªãƒ³ã‚¯ã‚’æ¤œå‡ºã™ã‚‹å¿…è¦æ€§ã¯è«–ç†çš„ã«ãªããªã£ã¦ã„ã‚‹ã‚ˆã†ã«è¦‹ãˆã‚‹ã€‚  
**ãŸã ã—**: `EvalSymlinks` ã¯ãƒ‘ã‚¹ã®å„ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’è§£æ±ºã™ã‚‹ãŒã€ã‚¿ãƒ¼ã‚²ãƒƒãƒˆãŒå‰Šé™¤ãƒ»å†ä½œæˆã•ã‚ŒãŸå ´åˆã®TOCTOUå•é¡ŒãŒã‚ã‚‹ã€‚è¡Œ752ã®Lstatã¯ `EvalSymlinks` å¾Œã®è¿½åŠ ç¢ºèªã¨ã—ã¦é˜²å¾¡çš„ã«æ©Ÿèƒ½ã™ã‚‹ã€‚  
**çµè«–**: å¤šå±¤é˜²å¾¡ã¨ã—ã¦è¨±å®¹ç¯„å›²ã€‚ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹å½±éŸ¿ã¯å°ã•ã„ï¼ˆãƒ•ã‚¡ã‚¤ãƒ«ã”ã¨ã«1å›ã®syscallè¿½åŠ ï¼‰ã€‚ã‚³ãƒ¡ãƒ³ãƒˆã®æ˜ç¢ºåŒ–ã‚’æ¨å¥¨ã€‚

### IMP-11: [code] `removeWindowAtIndexLocked` ã®removedPanesã‚¹ãƒ©ã‚¤ã‚¹ã®äºŒé‡å‰²ã‚Šå½“ã¦ï¼ˆæ–°è¦ï¼‰
**ãƒ•ã‚¡ã‚¤ãƒ«**: `session_manager_windows.go` è¡Œ109-117
```go
removedPanes := make([]*TmuxPane, 0)           // æœ€åˆ: ç©ºã‚¹ãƒ©ã‚¤ã‚¹å‰²ã‚Šå½“ã¦
if window != nil && len(window.Panes) > 0 {
    removedPanes = make([]*TmuxPane, len(window.Panes))  // ä¸Šæ›¸ã: ãƒšã‚¤ãƒ³ã‚ã‚Šã®å ´åˆ
    copy(removedPanes, window.Panes)
}
```
**æœ¬ç•ªã‚³ãƒ¼ãƒ‰ç¢ºèªçµæœ**: å·®åˆ†ã§è¿½åŠ ã•ã‚ŒãŸã‚³ãƒ¡ãƒ³ãƒˆ (è¡Œ109-112) ã¯ã€Œå¸¸ã«nilä»¥å¤–ã®ã‚¹ãƒ©ã‚¤ã‚¹ã‚’è¿”ã™ãŸã‚ã€ã¨èª¬æ˜ã€‚ã—ã‹ã—ã€`window != nil && len(window.Panes) > 0` ãŒçœŸã®å ´åˆã€æœ€åˆã® `make([]*TmuxPane, 0)` ã¯å³åº§ã«æ¨ã¦ã‚‰ã‚Œã‚‹ã€‚  
**å½±éŸ¿**: å°ã•ãªãƒ’ãƒ¼ãƒ—å‰²ã‚Šå½“ã¦ãŒç„¡é§„ã«ãªã‚‹ã€‚hot pathã§ã¯ãªã„ãŸã‚å®Ÿå®³ãªã—ã€‚  
**ä¿®æ­£æ¡ˆ**: æ¡ä»¶åˆ†å²ã‚’æœ€åˆã®makeã¨çµ±åˆã™ã‚‹ã‹ã€`var removedPanes []*TmuxPane` + æ¡ä»¶å†…ã§ `make` + else ã§ `removedPanes = []*TmuxPane{}` ã«ã™ã‚‹ã€‚

### IMP-12: [code] `viewerRegistry.ts` ã®HMR dispose ã§registryã‚’ç©ºã«ã™ã‚‹ãŒã€å†ç™»éŒ²ã®ä¿è¨¼ãŒãªã„ï¼ˆæ–°è¦ï¼‰
**ãƒ•ã‚¡ã‚¤ãƒ«**: `viewerRegistry.ts` è¡Œ29-33
```typescript
if (import.meta.hot) {
    import.meta.hot.dispose(() => {
        registry.length = 0;
    });
}
```
**æœ¬ç•ªã‚³ãƒ¼ãƒ‰ç¢ºèªçµæœ**: `registry.length = 0` ã§å…¨ã‚¨ãƒ³ãƒˆãƒªã‚’å‰Šé™¤ã€‚HMRå¾Œã«å„viewãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã® `registerView` å‘¼ã³å‡ºã—ãŒå†å®Ÿè¡Œã•ã‚Œã‚‹ã“ã¨ã‚’å‰æã¨ã—ã¦ã„ã‚‹ã€‚  
**å½±éŸ¿ç¯„å›²ç¢ºèª**: `error-log/index.ts` (å·®åˆ†) ã§ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒˆãƒƒãƒ—ãƒ¬ãƒ™ãƒ«ã§ `registerView(...)` ã‚’å‘¼ã‚“ã§ã„ã‚‹ã€‚Viteã®HMRã¯ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’å†å®Ÿè¡Œã™ã‚‹ãŸã‚ã€å†ç™»éŒ²ã•ã‚Œã‚‹ã€‚  
**çµè«–**: Viteã®ä»•æ§˜ã«ä¾å­˜ã™ã‚‹ãŒã€æ­£ã—ã„å‹•ä½œãŒæœŸå¾…ã§ãã‚‹ã€‚ãŸã ã—ã€**registryæ¶ˆå»ã¨å†ç™»éŒ²ã®é–“ã«ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ãŒç™ºç”Ÿã—ãŸå ´åˆ**ã€ç©ºã®registryãŒè¡¨ç¤ºã•ã‚Œã‚‹ä¸€ç¬ãŒã‚ã‚Šã†ã‚‹ã€‚HMRé–‹ç™ºæ™‚ã®ã¿ã®å•é¡Œã§ã‚ã‚Šã€æœ¬ç•ªå½±éŸ¿ãªã—ã€‚

### IMP-13: [code] `ErrorLogView.tsx` ã® `useEffect` ã§ `entries` ã‚’ä¾å­˜é…åˆ—ã«å«ã‚€å½±éŸ¿ï¼ˆæ–°è¦ï¼‰
**ãƒ•ã‚¡ã‚¤ãƒ«**: `ErrorLogView.tsx` è¡Œ13-15
```tsx
useEffect(() => {
    markAllRead();
}, [entries, markAllRead]);
```
**æœ¬ç•ªã‚³ãƒ¼ãƒ‰ç¢ºèªçµæœ**: `entries` ãŒå¤‰ã‚ã‚‹ãŸã³ã« `markAllRead()` ãŒå‘¼ã°ã‚Œã‚‹ã€‚`markAllRead` ã¯ `useErrorLogStore` ã® `set` ã‚’å‘¼ã¶ã€‚  
**å½±éŸ¿ç¯„å›²ç¢ºèª**: `errorLogStore.ts` ã® `markAllRead` (è¡Œ68-72) ã¯ `lastReadSeq` ã‚’æ›´æ–°ã— `unreadCount: 0` ã‚’è¨­å®šã€‚  
**å•é¡Œ**: ErrorLogViewãŒé–‹ã„ã¦ã„ã‚‹é™ã‚Šã€æ–°ã—ã„ã‚¨ãƒ³ãƒˆãƒªãŒåˆ°ç€ã™ã‚‹ãŸã³ã« `markAllRead` ãŒå‘¼ã°ã‚Œã€unread badgeãŒå³åº§ã«ãƒªã‚»ãƒƒãƒˆã•ã‚Œã‚‹ã€‚ã“ã‚Œã¯æ„å›³çš„ãªå‹•ä½œï¼ˆãƒ“ãƒ¥ãƒ¼ã‚’é–‹ã„ã¦ã„ã‚‹ï¼ã‚¨ãƒ³ãƒˆãƒªã‚’è¦‹ã¦ã„ã‚‹ï¼‰ã ãŒã€ä»¥ä¸‹ã®ã‚±ãƒ¼ã‚¹ã§å•é¡Œ:
- ãƒ“ãƒ¥ãƒ¼ãŒé–‹ã„ã¦ã„ã¦ã‚‚ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã—ã¦å¤ã„ã‚¨ãƒ³ãƒˆãƒªã‚’è¦‹ã¦ã„ã‚‹å ´åˆã€æ–°ã—ã„ã‚¨ãƒ³ãƒˆãƒªã¯æœªèª­ã®ã¾ã¾ä¿æŒã•ã‚Œã‚‹ã¹ãã‹ã‚‚ã—ã‚Œãªã„
**çµè«–**: ç¾åœ¨ã®UXè¦ä»¶ã¨ã—ã¦ã¯ã€Œãƒ“ãƒ¥ãƒ¼ãŒé–‹ã„ã¦ã„ã‚‹ï¼å…¨ã¦æ—¢èª­ã€ã§æ­£ã—ã„ã¨æ¨å®šã€‚ãŸã ã—å°†æ¥çš„ã«ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ä½ç½®ãƒ™ãƒ¼ã‚¹ã®æœªèª­ç®¡ç†ã«ç§»è¡Œã™ã‚‹å ´åˆã¯å¤‰æ›´ãŒå¿…è¦ã€‚

### IMP-14: [code] `ErrorLogView.tsx` ã® callback ref unmountæ™‚ã®ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ï¼ˆæ–°è¦ï¼‰
**ãƒ•ã‚¡ã‚¤ãƒ«**: `ErrorLogView.tsx` è¡Œ22-77
**æœ¬ç•ªã‚³ãƒ¼ãƒ‰ç¢ºèªçµæœ**: 
```tsx
const bodyRefCallback = useCallback((el: HTMLDivElement | null) => {
    if (cleanupRef.current) {
        cleanupRef.current();
        cleanupRef.current = null;
    }
    registerBodyElement(el);
    if (!el) return;
    // ... ãƒªã‚¹ãƒŠãƒ¼ç™»éŒ² ...
    cleanupRef.current = () => { /* ãƒªã‚¹ãƒŠãƒ¼è§£é™¤ */ };
}, [registerBodyElement]);
```
**å½±éŸ¿ç¯„å›²ç¢ºèª**: Reactã®callback refã®ä»•æ§˜ã§ã¯:
1. ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆmountæ™‚: `bodyRefCallback(element)` ãŒå‘¼ã°ã‚Œã‚‹
2. ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆunmountæ™‚: `bodyRefCallback(null)` ãŒå‘¼ã°ã‚Œã‚‹
3. re-renderæ™‚ã«refãŒå¤‰ã‚ã£ãŸå ´åˆ: `bodyRefCallback(null)` â†’ `bodyRefCallback(newElement)`

**çµè«–**: unmountæ™‚ã« `bodyRefCallback(null)` ãŒå‘¼ã°ã‚Œã€ãã®ä¸­ã§ `cleanupRef.current()` ãŒå®Ÿè¡Œã•ã‚Œã‚‹ã€‚æ­£ã—ãå‹•ä½œã™ã‚‹ã€‚å•é¡Œãªã—ã€‚

### IMP-15: [code] `app.go` ã®Debugãƒ­ã‚°ãƒ—ãƒ¬ãƒ•ã‚£ã‚¯ã‚¹æœªå¤‰æ›´ï¼ˆæ–°è¦ï¼‰
**ãƒ•ã‚¡ã‚¤ãƒ«**: `app.go` è¡Œ141
```go
slog.Debug("[DEBUG-WS] wsHub is nil, WebSocket URL unavailable")
```
**æœ¬ç•ªã‚³ãƒ¼ãƒ‰ç¢ºèªçµæœ**: ä»–ã®ãƒ•ã‚¡ã‚¤ãƒ«ã§ã¯ `[DEBUG-*]` â†’ `[*]` ã«çµ±ä¸€ã•ã‚Œã¦ã„ã‚‹ãŒã€`app.go` ã® `GetWebSocketURL` ãƒ¡ã‚½ãƒƒãƒ‰å†…ã§ã¯ã¾ã  `[DEBUG-WS]` ã®ã¾ã¾ã€‚  
**å½±éŸ¿ç¯„å›²ç¢ºèª**: å·®åˆ†ã«ã¯ `app.go` ã®å¤‰æ›´ãŒå«ã¾ã‚Œã¦ã„ã‚‹ãŒã€ã“ã®ãƒ­ã‚°è¡Œã¯å¤‰æ›´å¯¾è±¡å¤–ã€‚  
**çµè«–**: ãƒ­ã‚°ãƒ—ãƒ¬ãƒ•ã‚£ã‚¯ã‚¹çµ±ä¸€ã®å¤‰æ›´ãŒä¸å®Œå…¨ã€‚ä»–ã®ãƒ•ã‚¡ã‚¤ãƒ«ã¨çµ±ä¸€ã™ã¹ãã€‚

---

## Suggestions (16ä»¶)

### SUG-01: [simplify] `buildUntrackedFileDiffSingle` ã®ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒã‚§ãƒƒã‚¯ã®ã‚³ãƒ¡ãƒ³ãƒˆæ˜ç¢ºåŒ–
**ãƒ•ã‚¡ã‚¤ãƒ«**: `app_devpanel_api.go` è¡Œ726-760
**æœ¬ç•ªã‚³ãƒ¼ãƒ‰ç¢ºèª**: 3æ®µéšã®ãƒã‚§ãƒƒã‚¯ï¼ˆlexical guard â†’ EvalSymlinks guard â†’ Lstat guardï¼‰ãŒå„ã€…ã®å½¹å‰²ã‚’æŒã¤ãŒã€ã‚³ãƒ¡ãƒ³ãƒˆãŒ `// Filesystem guard` ç¨‹åº¦ã§ç°¡ç´ ã€‚  
**ææ¡ˆ**: å„ãƒã‚§ãƒƒã‚¯ã®é˜²å¾¡å¯¾è±¡ï¼ˆsymlink traversal, TOCTOU, dangling symlinkç­‰ï¼‰ã‚’æ˜è¨˜ã€‚

### SUG-02: [comments] `parseDiffHeaderPaths` ã®å¯¾ç§°æ€§ãƒ’ãƒ¥ãƒ¼ãƒªã‚¹ãƒ†ã‚£ãƒƒã‚¯ã®ã‚³ãƒ¡ãƒ³ãƒˆæ”¹å–„
**ãƒ•ã‚¡ã‚¤ãƒ«**: `app_devpanel_api.go` è¡Œ969-982
**æœ¬ç•ªã‚³ãƒ¼ãƒ‰ç¢ºèª**: symmetry heuristicã¯ `len(content)` ãŒå¥‡æ•°ã®å ´åˆã®ã¿æœ‰åŠ¹ï¼ˆãƒ‘ã‚¹ã®é•·ã•ãŒåŒã˜å ´åˆã®ã¿æ¤œå‡ºå¯èƒ½ï¼‰ã€‚  
**ææ¡ˆ**: å…·ä½“ä¾‹ã‚’å«ã‚€ã‚³ãƒ¡ãƒ³ãƒˆï¼ˆä¾‹: `a/foo.go b/foo.go` â†’ content = `foo.go b/foo.go` â†’ pathLen=3 â†’ `foo` + ` b/` + `foo` â†’ ä¸€è‡´ â†’ OKï¼‰

### SUG-03: [code] `parseNULSeparatedGitPaths` ã®ã‚­ãƒ£ãƒ‘ã‚·ãƒ†ã‚£æœ€é©åŒ–
**ãƒ•ã‚¡ã‚¤ãƒ«**: `app_devpanel_api.go` è¡Œ620
```go
paths := make([]string, 0, len(entries))
```
**æœ¬ç•ªã‚³ãƒ¼ãƒ‰ç¢ºèª**: `devPanelMaxUntrackedFilePaths = 10000` (è¡Œ34) ãŒãƒªãƒŸãƒƒãƒˆã€‚`len(entries)` ãŒ10000ã‚’å¤§å¹…ã«è¶…ãˆã‚‹å ´åˆã«ãƒ¡ãƒ¢ãƒªå‰²ã‚Šå½“ã¦ãŒéå‰°ã«ãªã‚‹ã€‚  
**ææ¡ˆ**: `min(len(entries), devPanelMaxUntrackedFilePaths)` ã‚’ã‚­ãƒ£ãƒ‘ã‚·ãƒ†ã‚£ã«ä½¿ç”¨ã€‚

### SUG-03b: [code] `buildUntrackedFileDiffsWithBudget` ã®Walkå†…ãƒã‚¸ã‚§ãƒƒãƒˆãƒã‚§ãƒƒã‚¯ã®ç°¡ç´ åŒ–ï¼ˆæ—§CRI-01ï¼‰
**ãƒ•ã‚¡ã‚¤ãƒ«**: `app_devpanel_api.go` è¡Œ687-690
```go
if remainingBudget >= 0 && remainingBudget <= 0 {
    budgetExceeded = true
    return fs.SkipAll
}
```
**æœ¬ç•ªã‚³ãƒ¼ãƒ‰ç¢ºèª**: ã“ã®æ¡ä»¶ã¯ `remainingBudget == 0` ã¨ç­‰ä¾¡ã€‚å‘¼ã³å‡ºã—å…ƒ `DevPanelWorkingDiff` (è¡Œ564-568) ã§ `remainingBudget <= 0` ã‚’äº‹å‰ãƒã‚§ãƒƒã‚¯ã—ã¦ã„ã‚‹ãŸã‚ã€ã“ã®é–¢æ•°ã« `remainingBudget == 0` ã§æ¸¡ã•ã‚Œã‚‹ã‚±ãƒ¼ã‚¹ã¯æ­£å¸¸ãƒ•ãƒ­ãƒ¼ã§ã¯ç™ºç”Ÿã—ãªã„ã€‚  
**ãŸã ã—**: `buildUntrackedFileDiffs` (è¡Œ639-641) ã¯ `remainingBudget = -1` ã§å‘¼ã³å‡ºã™ãŸã‚ã€`-1 >= 0` ã¯å½ã¨ãªã‚Šã“ã®åˆ†å²ã«ã¯å…¥ã‚‰ãªã„ã€‚  
**ææ¡ˆ**: `remainingBudget >= 0 && remainingBudget <= 0` â†’ `remainingBudget == 0` ã«ç°¡ç•¥åŒ–ã€‚ç¾çŠ¶ã§ã‚‚å‹•ä½œä¸Šã¯æ­£ã—ã„ã€‚

### SUG-04: [tests] `stubRuntimeEventsEmit` ã®å®šç¾©å ´æ‰€ã¯session_log ãƒ†ã‚¹ãƒˆã§ã‚¤ãƒ³ãƒãƒ¼ãƒˆå¯èƒ½ã‹ç¢ºèª
**æœ¬ç•ªã‚³ãƒ¼ãƒ‰ç¢ºèªçµæœ**: `app_worktree_api_test.go` è¡Œ35ã«å®šç¾©ãŒå­˜åœ¨ï¼ˆgrepçµæœç¢ºèªæ¸ˆã¿ï¼‰ã€‚åŒä¸€ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ï¼ˆ`package main`ï¼‰å†…ã®ãŸã‚ã€`app_session_log_test.go` ã‹ã‚‰ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½ã€‚  
**çµè«–**: å•é¡Œãªã—ã€‚

### SUG-05: [code] `errorLogStore.ts` ã®ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ãƒªã‚¹ã‚¿ãƒ¼ãƒˆæ¤œå‡ºã®UXæ¤œè¨
**ãƒ•ã‚¡ã‚¤ãƒ«**: `errorLogStore.ts` è¡Œ51-54
**æœ¬ç•ªã‚³ãƒ¼ãƒ‰ç¢ºèª**: `state.entries.length === 0 && state.lastReadSeq === 0 && maxNewSeq > 0` (è¡Œ56) ã®æ¡ä»¶ã§åˆå›ãƒ­ãƒ¼ãƒ‰æ™‚ã¯å…¨ã‚¨ãƒ³ãƒˆãƒªã‚’æ—¢èª­æ‰±ã„ã€‚ãƒªã‚¹ã‚¿ãƒ¼ãƒˆæ¤œå‡º (è¡Œ52) æ™‚ã¯ `lastReadSeq = 0` ã«ãƒªã‚»ãƒƒãƒˆã—ã€å…¨ã‚¨ãƒ³ãƒˆãƒªã‚’æœªèª­æ‰±ã„ã«ã™ã‚‹ã€‚  
**å½±éŸ¿**: ãƒªã‚¹ã‚¿ãƒ¼ãƒˆå¾Œã¯é€šå¸¸ã‚¨ãƒ³ãƒˆãƒªæ•°ãŒå°‘ãªã„ãŸã‚ã€å…¨æœªèª­è¡¨ç¤ºã§ã‚‚UXã¸ã®æ‚ªå½±éŸ¿ã¯å°ã•ã„ã€‚  
**çµè«–**: ç¾çŠ¶ã®ãƒ­ã‚¸ãƒƒã‚¯ã§å¦¥å½“ã€‚

### SUG-06: [simplify] `viewerRegistry.ts` ã®ã‚°ãƒ­ãƒ¼ãƒãƒ«ãƒ¬ã‚¸ã‚¹ãƒˆãƒªã‚­ãƒ¼
**æœ¬ç•ªã‚³ãƒ¼ãƒ‰ç¢ºèª**: `"__mytx_view_registry__"` æ–‡å­—åˆ—ã‚’ã‚­ãƒ¼ã¨ã—ã¦ `globalThis` ã«ä¿å­˜ã€‚  
**ææ¡ˆ**: `Symbol.for("mytx_view_registry")` ã‚’ä½¿ã†ã¨åå‰è¡çªã®ãƒªã‚¹ã‚¯ãŒä½æ¸›ã€‚ãŸã ã—ç¾çŠ¶ã§ã‚‚å®Ÿè³ªå•é¡Œãªã—ã€‚

### SUG-07: [code] `ErrorLogView.tsx` ã®callback ref â†’ å•é¡Œãªã—ç¢ºèªæ¸ˆã¿
â†’ IMP-14ã«ã¦å•é¡Œãªã—ã¨ç¢ºèªæ¸ˆã¿ã€‚è¿½åŠ å¯¾å¿œä¸è¦ã€‚

### SUG-08: [code] `ActivityStrip.tsx` ã®filteringãƒ¡ãƒ¢åŒ–
**æœ¬ç•ªã‚³ãƒ¼ãƒ‰ç¢ºèª**: `views` ã¯ `getRegisteredViews()` ã®çµæœã€‚registryã¯ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚¹ã‚³ãƒ¼ãƒ—ã§ä¸å¤‰ï¼ˆHMRæ™‚ä»¥å¤–ï¼‰ã€‚`views.filter()` ã¯ãƒ¬ãƒ³ãƒ€ãƒ¼ã®ãŸã³ã«å®Ÿè¡Œã•ã‚Œã‚‹ãŒã€viewsã®è¦ç´ æ•°ã¯é€šå¸¸5å€‹æœªæº€ã§ã‚ã‚Šã€ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã¸ã®å½±éŸ¿ã¯ç„¡è¦–ã§ãã‚‹ã€‚  
**çµè«–**: useMemoã¯ä¸è¦ï¼ˆéå‰°æœ€é©åŒ–ã«ãªã‚‹ï¼‰ã€‚

### SUG-09: [types] `SessionLogEntry.Seq` ã®uint64ä¸Šé™
**æœ¬ç•ªã‚³ãƒ¼ãƒ‰ç¢ºèª**: `app_session_log_types.go` è¡Œ9-12ã®ã‚³ãƒ¡ãƒ³ãƒˆã§ `~3000 years` ã¨æ˜è¨˜ã€‚å•é¡Œãªã—ã€‚

### SUG-10: [tests] ãƒ†ãƒ¼ãƒ–ãƒ«é§†å‹•ãƒ†ã‚¹ãƒˆã®1è¡Œãƒ†ãƒ¼ãƒ–ãƒ«
**å½±éŸ¿**: ãƒ†ã‚¹ãƒˆã®å¯èª­æ€§ã®ã¿ã€‚å°†æ¥ã®ã‚±ãƒ¼ã‚¹è¿½åŠ ã‚’è¦‹è¶Šã—ãŸè¨­è¨ˆã¨ã—ã¦å•é¡Œãªã—ã€‚

### SUG-11: [code] `viewer.css` ã®CSSå¤‰æ•°ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
**ãƒ•ã‚¡ã‚¤ãƒ«**: `viewer.css` diffè¡Œ140
```css
background: var(--surface-3, var(--accent-10));
```
**æœ¬ç•ªã‚³ãƒ¼ãƒ‰ç¢ºèª**: `base.css` ã« `--surface-3` ãŒå®šç¾©ã•ã‚Œã¦ã„ã‚‹ï¼ˆdiffè¡Œ9ï¼‰ã€‚  
**çµè«–**: ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ã¯ä¸è¦ã ãŒã€ä»–ã®CSSãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰ã®importé †åºã«ä¾å­˜ã—ãªã„é˜²å¾¡çš„è¨˜è¿°ã¨ã—ã¦æœ‰åŠ¹ã€‚

### SUG-12: [tests] `injectTestWindow` ã§Terminal=nil
**æœ¬ç•ªã‚³ãƒ¼ãƒ‰ç¢ºèª**: `handleKillWindow` è¡Œ381 `if pane == nil || pane.Terminal == nil { continue }` ã§nilãƒã‚§ãƒƒã‚¯æ¸ˆã¿ã€‚å•é¡Œãªã—ã€‚

### SUG-13: [code] `bytes.IndexByte` ã¸ã®å¤‰æ›´ã¯è‰¯ã„æ”¹å–„
**æœ¬ç•ªã‚³ãƒ¼ãƒ‰ç¢ºèª**: `app_devpanel_api.go` è¡Œ785ã§ä½¿ç”¨ã€‚NULãƒã‚¤ãƒˆæ¤œå‡ºã«æœ€é©ã€‚

### SUG-14: [code] end-of-options `--` ã®è¿½åŠ ã¯è‰¯ã„æ”¹å–„
**æœ¬ç•ªã‚³ãƒ¼ãƒ‰ç¢ºèª**: `app_devpanel_api.go` è¡Œ478ã§ä½¿ç”¨ã€‚defense-in-depthã€‚

### SUG-15: [code] `command_router_env_test.go` ã®ãƒ“ãƒ«ãƒˆã‚¤ãƒ³é–¢æ•°å `copy` â†’ `got` ã¸ã®ãƒªãƒãƒ¼ãƒ ï¼ˆæ–°è¦ï¼‰
**ãƒ•ã‚¡ã‚¤ãƒ«**: `command_router_env_test.go` å·®åˆ†è¡Œ9-37
**æœ¬ç•ªã‚³ãƒ¼ãƒ‰ç¢ºèª**: Goçµ„ã¿è¾¼ã¿é–¢æ•° `copy` ã‚’å¤‰æ•°åã¨ã—ã¦ä½¿ã†ã®ã¯ã‚¨ãƒ©ãƒ¼ã«ã¯ãªã‚‰ãªã„ãŒã€å¯èª­æ€§ã¨æ½œåœ¨çš„ãªãƒã‚°ãƒªã‚¹ã‚¯ã‚’ä½æ¸›ã™ã‚‹è‰¯ã„ãƒªãƒãƒ¼ãƒ ã€‚
**çµè«–**: å•é¡Œãªã—ã€‚è‰¯ã„æ”¹å–„ã€‚

### SUG-16: [code] `handleKillWindow` ã®emitLayoutChangedForSessionå‘¼ã³å‡ºã—ã®ãƒ­ã‚°ãƒ—ãƒ¬ãƒ•ã‚£ã‚¯ã‚¹ï¼ˆæ–°è¦ï¼‰
**ãƒ•ã‚¡ã‚¤ãƒ«**: `command_router_handlers_window.go` è¡Œ404
```go
r.emitLayoutChangedForSession(sessionName, result.SurvivingWindowID, "DEBUG-KILLWINDOW")
```
**æœ¬ç•ªã‚³ãƒ¼ãƒ‰ç¢ºèª**: ä»–ã®ç®‡æ‰€ã§ã¯ `[DEBUG-*]` â†’ `[*]` ã«çµ±ä¸€ã•ã‚Œã¦ã„ã‚‹ãŒã€`emitLayoutChangedForSession` ã®ç¬¬3å¼•æ•°ã« `"DEBUG-KILLWINDOW"` ãŒæ¸¡ã•ã‚Œã¦ã„ã‚‹ã€‚  
**ææ¡ˆ**: `"KILLWINDOW"` ã«å¤‰æ›´ã—ã¦çµ±ä¸€ã€‚

---

## Strengths (è‰¯ã„ç‚¹)

### STR-01: ãƒ­ã‚°ãƒ—ãƒ¬ãƒ•ã‚£ã‚¯ã‚¹ã®çµ±ä¸€ï¼ˆ`[DEBUG-*]` â†’ `[*]`ï¼‰
å…¨ä½“ã«ã‚ãŸã‚Šä¸€è²«ã—ã¦æ›´æ–°ã€‚ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰ã‚‚åŒæœŸã€‚CLAUDE.mdæº–æ‹ ã€‚  
**ãŸã ã—**: `app.go` è¡Œ141ã® `[DEBUG-WS]` ã¨ `command_router_handlers_window.go` è¡Œ404ã® `"DEBUG-KILLWINDOW"` ãŒæœªæ›´æ–°ï¼ˆIMP-15, SUG-16å‚ç…§ï¼‰ã€‚

### STR-02: ping + fetch ãƒ¢ãƒ‡ãƒ«ã¸ã®ç§»è¡Œ
**æœ¬ç•ªã‚³ãƒ¼ãƒ‰æ¤œè¨¼**: ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ï¼ˆ`writeSessionLogEntry`ï¼‰â†’ ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ï¼ˆ`useBackendSync.ts`ï¼‰â†’ ã‚¹ãƒˆã‚¢ï¼ˆ`errorLogStore.ts`ï¼‰ã®å…¨ãƒ‘ã‚¹ã‚’æ¤œè¨¼ã€‚  
- ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰: `app:error-log-updated` ã‚¤ãƒ™ãƒ³ãƒˆã¯ `nil` ãƒšã‚¤ãƒ­ãƒ¼ãƒ‰ï¼ˆè¡Œ192ï¼‰
- ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰: ãƒ‡ãƒã‚¦ãƒ³ã‚¹ä»˜ããƒ•ã‚§ãƒƒãƒ + fetchSeqã‚«ã‚¦ãƒ³ã‚¿ï¼ˆè¡Œ482-511ï¼‰
- ã‚¹ãƒˆã‚¢: `setEntries` ã§seqãƒ™ãƒ¼ã‚¹ã®æ­£è¦åŒ–+ã‚½ãƒ¼ãƒˆï¼ˆè¡Œ26-31ï¼‰
**çµè«–**: E2Eã§æ•´åˆæ€§ãŒå–ã‚Œã¦ã„ã‚‹ã€‚ãƒ‡ãƒ¼ã‚¿ãƒ­ã‚¹ã®æ¸©åºŠãŒåŸç†çš„ã«æ’é™¤ã•ã‚Œã¦ã„ã‚‹ã€‚

### STR-03: `sessionLogSeq` ã«ã‚ˆã‚‹ãƒ¢ãƒãƒˆãƒ‹ãƒƒã‚¯ã‚«ã‚¦ãƒ³ã‚¿å°å…¥
**æœ¬ç•ªã‚³ãƒ¼ãƒ‰æ¤œè¨¼**: 
- Goå´: `app.go` è¡Œ108 ã§ `sessionLogSeq uint64` ã‚’å®šç¾©ã€‚`writeSessionLogEntry` ã§ `a.sessionLogSeq++` â†’ `entry.Seq = a.sessionLogSeq` (è¡Œ129-130)
- TypeScriptå´: `errorLogStore.ts` ã§ `isValidSeq(entry.seq)` ãŒseq > 0ã‚’æ¤œè¨¼ (è¡Œ15-18)
- Wails binding: `models.ts` ã§ `SessionLogEntry` ã« `seq: number` ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰è¿½åŠ 
**çµè«–**: Go â†’ JSON â†’ TypeScript ã®å…¨å±¤ã§æ•´åˆæ€§ãŒç¢ºèªã§ããŸã€‚

### STR-04: ãƒªãƒ³ã‚°ãƒãƒƒãƒ•ã‚¡ã®é˜²å¾¡çš„ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°æ”¹å–„
**æœ¬ç•ªã‚³ãƒ¼ãƒ‰æ¤œè¨¼**: `app_session_log_types.go` ã® `push` ãƒ¡ã‚½ãƒƒãƒ‰ (è¡Œ41-57) ã‚’ç¢ºèª:
- `bufCap := len(rb.buf)` ã§shadowingã‚’å›é¿
- `bufCap == 0` ã‚¬ãƒ¼ãƒ‰ã§ `%` ã®ã‚¼ãƒ­é™¤ç®—ãƒ‘ãƒ‹ãƒƒã‚¯ã‚’é˜²æ­¢
- `newSessionLogRingBuffer` (è¡Œ30-39) ã§ `capacity < 1` ã‚’clamp

### STR-05: TeeHandler ã®ãƒ‘ãƒ‹ãƒƒã‚¯å›å¾©ã¨çŸ­çµ¡ãƒªã‚¿ãƒ¼ãƒ³
**æœ¬ç•ªã‚³ãƒ¼ãƒ‰æ¤œè¨¼**: `handler.go` ã® `Handle` (è¡Œ60-80), `WithAttrs` (è¡Œ84-94), `WithGroup` (è¡Œ99-114) ã‚’ç¢ºèªã€‚slog.Handlerä»•æ§˜ã«æº–æ‹ ã—ãŸç©ºãƒã‚§ãƒƒã‚¯çŸ­çµ¡ãƒªã‚¿ãƒ¼ãƒ³ãŒè¿½åŠ ã•ã‚Œã¦ã„ã‚‹ã€‚`debug.Stack()` ã«ã‚ˆã‚‹ã‚¹ã‚¿ãƒƒã‚¯ãƒˆãƒ¬ãƒ¼ã‚¹å‡ºåŠ›ã‚‚troubleshootingèƒ½åŠ›ã‚’å‘ä¸Šã€‚

### STR-06: ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸ã®å¤§å¹…å¢—åŠ 
**æœ¬ç•ªã‚³ãƒ¼ãƒ‰æ¤œè¨¼**: æ–°è¦ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ç¾¤ã®å“è³ª:
- `injectTestWindow` ãƒ˜ãƒ«ãƒ‘ãƒ¼: æœ¬ç•ªAPIã‚’æ±šã•ãšãƒãƒ«ãƒã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ãƒ†ã‚¹ãƒˆã‚’å®Ÿç¾
- `TestResolveDirectionalPane_MultipleWindowScopeIsolation`: ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦é–“ã®ãƒšã‚¤ãƒ³ç§»å‹•ç¦æ­¢ã‚’æ¤œè¨¼
- `TestResolveTargetRepairsStaleActiveWindowID`: è‡ªå‹•ä¿®å¾©ãƒ‘ã‚¹ã®æ¤œè¨¼
- `TestRemoveWindowByID_ActiveWindowTransitions`: ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦å‰Šé™¤å¾Œã®ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯æ¤œè¨¼

### STR-07: viewerRegistryã®HMRå¯¾å¿œ
**æœ¬ç•ªã‚³ãƒ¼ãƒ‰æ¤œè¨¼**: `viewerRegistry.ts` ã® `resolveRegistry` (è¡Œ19-25) â†’ `globalThis` ã«ä¿å­˜ â†’ `import.meta.hot.dispose` ã§æ¶ˆå»ï¼ˆè¡Œ30-32ï¼‰â†’ Viteã®HMRã§ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«å†å®Ÿè¡Œ â†’ `registerView` å†å‘¼ã³å‡ºã—ã€‚

### STR-08: `handleNewWindow` ã®ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯æ”¹å–„
**æœ¬ç•ªã‚³ãƒ¼ãƒ‰æ¤œè¨¼**: è¡Œ284-291ã® `rollbackSession` ã‚¯ãƒ­ãƒ¼ã‚¸ãƒ£ãŒcomprehensiveã«ä½¿ç”¨ã•ã‚Œã¦ã„ã‚‹ï¼ˆ7, 8, 8b, 9ã®ã‚¹ãƒ†ãƒƒãƒ—ã§åˆ©ç”¨å¯èƒ½ï¼‰ã€‚ä»¥å‰ã®nilã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆã§ã®ç¶šè¡Œã‚ˆã‚Šã‚‚å®‰å…¨ã€‚

### STR-09: `go:fix inline` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒ†ã‚£ãƒ–ã®æ´»ç”¨
**æœ¬ç•ªã‚³ãƒ¼ãƒ‰æ¤œè¨¼**: `testutil/helpers.go` ã® `Ptr[T]` ã«è¿½åŠ ã€‚Go 1.24+ã§ `go fix ./...` ã«ã‚ˆã‚Šè‡ªå‹•ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³åŒ–ã•ã‚Œã€ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°ã®æ®µéšçš„å»ƒæ­¢ãŒå¯èƒ½ã€‚

---

## Recommended Action

| å„ªå…ˆåº¦ | ã‚¿ã‚¹ã‚¯ID | æ¦‚è¦ |
|:------:|---------|------|
| ğŸ”´ é«˜ | CRI-03 | `app_events.go` ã®Shift_JISæ–‡å­—åŒ–ã‘ã‚’ä¿®æ­£ï¼ˆã‚³ãƒ¡ãƒ³ãƒˆã®å¯èª­æ€§å›å¾©ï¼‰ |
| ğŸŸ¡ ä¸­ | CRI-04 | `handleNewWindow` snapshot-refetchãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯ãƒ‘ã‚¹ã®ãƒ†ã‚¹ãƒˆè¿½åŠ  |
| ğŸŸ¡ ä¸­ | IMP-15 | `app.go` ã® `[DEBUG-WS]` ãƒ­ã‚°ãƒ—ãƒ¬ãƒ•ã‚£ã‚¯ã‚¹çµ±ä¸€æ¼ã‚Œä¿®æ­£ |
| ğŸŸ¡ ä¸­ | SUG-16 | `handleKillWindow` ã® `DEBUG-KILLWINDOW` ãƒ—ãƒ¬ãƒ•ã‚£ã‚¯ã‚¹ä¿®æ­£ |
| ğŸŸ¢ ä½ | IMP-03 | `cleanupOldSessionLogs` ã®excesså†è¨ˆç®—ï¼ˆå½±éŸ¿å¾®å°ï¼‰ |
| ğŸŸ¢ ä½ | IMP-11 | `removeWindowAtIndexLocked` ã®ã‚¹ãƒ©ã‚¤ã‚¹äºŒé‡å‰²ã‚Šå½“ã¦æ•´ç† |
| ğŸŸ¢ ä½ | SUG-03 | `parseNULSeparatedGitPaths` ã®ã‚­ãƒ£ãƒ‘ã‚·ãƒ†ã‚£æœ€é©åŒ– |
| ğŸŸ¢ ä½ | SUG-03b | `buildUntrackedFileDiffsWithBudget` ã®ãƒã‚¸ã‚§ãƒƒãƒˆãƒã‚§ãƒƒã‚¯ç°¡ç´ åŒ– |

---

## ä¸¦åˆ—ä½œæ¥­å¯å¦è¡¨

### ä¸¦åˆ—ä½œæ¥­ã‚°ãƒ«ãƒ¼ãƒ—

| ã‚°ãƒ«ãƒ¼ãƒ— | æ‹…å½“ã‚¿ã‚¹ã‚¯ | å¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«ç¾¤ | ç†ç”± |
|---------|-----------|-------------|------|
| **Worker A** | CRI-03 | `app_events.go` | ç‹¬ç«‹ã—ãŸã‚³ãƒ¡ãƒ³ãƒˆä¿®æ­£ã€‚å³æ™‚å¯¾å¿œå¯èƒ½ |
| **Worker B** | CRI-04 | `command_router_handlers_window_test.go` | ãƒ†ã‚¹ãƒˆè¿½åŠ ã®ã¿ã€‚æœ¬ç•ªã‚³ãƒ¼ãƒ‰å¤‰æ›´ãªã— |
| **Worker C** | IMP-15 + SUG-16 | `app.go`, `command_router_handlers_window.go` | ãƒ­ã‚°ãƒ—ãƒ¬ãƒ•ã‚£ã‚¯ã‚¹çµ±ä¸€ã€‚ç‹¬ç«‹ãƒ•ã‚¡ã‚¤ãƒ« |
| **Worker D** | IMP-03 + IMP-11 | `app_session_log.go`, `session_manager_windows.go` | ç‹¬ç«‹ã—ãŸãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ãƒ•ã‚¡ã‚¤ãƒ«ç¾¤ |
| **Worker E** | SUG-03 + SUG-03b | `app_devpanel_api.go` | åŒä¸€ãƒ•ã‚¡ã‚¤ãƒ«ã€‚é †æ¬¡å¯¾å¿œå¿…é ˆ |

### è©³ç´°ã‚¿ã‚¹ã‚¯Ã—ä¸¦åˆ—å¯å¦ãƒãƒˆãƒªã‚¯ã‚¹

| ã‚¿ã‚¹ã‚¯ID | ã‚¿ã‚¹ã‚¯æ¦‚è¦ | å¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ« | ä¾å­˜å…ˆ | ä¸¦åˆ— | è£œè¶³ |
|---------|-----------|------------|--------|:----:|------|
| CRI-03 | æ–‡å­—åŒ–ã‘ä¿®æ­£ | `app_events.go` | ãªã— | âœ… | ã‚³ãƒ¡ãƒ³ãƒˆä¿®æ­£ã®ã¿ |
| CRI-04 | ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯ãƒ†ã‚¹ãƒˆè¿½åŠ  | `..._window_test.go` | ãªã— | âœ… | ãƒ†ã‚¹ãƒˆè¿½åŠ ã®ã¿ |
| IMP-03 | cleanupOldSessionLogsä¿®æ­£ | `app_session_log.go` | ãªã— | âœ… | ç‹¬ç«‹ãƒ•ã‚¡ã‚¤ãƒ« |
| IMP-11 | ã‚¹ãƒ©ã‚¤ã‚¹äºŒé‡å‰²ã‚Šå½“ã¦ä¿®æ­£ | `session_manager_windows.go` | ãªã— | âœ… | ç‹¬ç«‹ãƒ•ã‚¡ã‚¤ãƒ« |
| IMP-15 | ãƒ­ã‚°ãƒ—ãƒ¬ãƒ•ã‚£ã‚¯ã‚¹çµ±ä¸€ | `app.go` | ãªã— | âœ… | 1è¡Œä¿®æ­£ |
| SUG-03 | pathsã‚­ãƒ£ãƒ‘ã‚·ãƒ†ã‚£æœ€é©åŒ– | `app_devpanel_api.go` | ãªã— | âœ… | ç‹¬ç«‹è¡Œ |
| SUG-03b | ãƒã‚¸ã‚§ãƒƒãƒˆãƒã‚§ãƒƒã‚¯ç°¡ç´ åŒ– | `app_devpanel_api.go` | SUG-03 | âŒ | åŒä¸€ãƒ•ã‚¡ã‚¤ãƒ« |
| SUG-16 | DEBUGãƒ—ãƒ¬ãƒ•ã‚£ã‚¯ã‚¹ä¿®æ­£ | `..._handlers_window.go` | ãªã— | âœ… | æ–‡å­—åˆ—å®šæ•°ä¿®æ­£ |
