# PR Review Summary — 統合版

**レビュー日時**: 2026-02-22 16:35  
**対象**: `D:\myT-x\dev-myT-x\review\temp` 配下の差分ファイル38件 + 新規ファイル（diff-view 等）  
**レビュー方式**: 差分レビュー → 本番コード全文確認 → 影響範囲・処理差異の精査  
**レビュー方針**: `review-pr-para.prompt.md` 準拠 + `CLAUDE.md` 製品仕様遵守  
**統合元**: `review-20260222160815.md`, `review-20260222161129.md`, `review-20260222161145.md`, `review-20260222161308.md`, `review-20260222161552.md`

---

## 変更概要

本PRは以下の主要な変更を含む:

1. **DevPanel WorkingDiff 機能追加** — `DevPanelWorkingDiff` APIの新規追加（`git diff HEAD` + untracked files の合成diff）
2. **SessionLog ping+fetch モデルへの移行** — イベントモデルを `app:error-logged`（ペイロード付き）から `app:error-log-updated`（pingのみ）に変更
3. **SessionLogEntry に `Seq` フィールド追加** — フロントエンドの重複排除をseqベースに変更
4. **TeeHandler の改善** — コールバックpanic保護、base handler error時もコールバック実行
5. **viewerRegistry のHMR対応・position サポート** — グローバルレジストリ＋position:"bottom"
6. **ログプレフィックスの統一** — `[DEBUG-*]` → `[*]` への一括リネーム
7. **tmux 1-window model 関連テスト・コメント強化** — `injectTestWindow` ヘルパー追加、マルチウィンドウテスト補完
8. **リングバッファ防御的改善** — `cap` → `bufCap` リネーム、0/負値クランプ
9. **testutil.Ptr の `go:fix inline` ディレクティブ追加**
10. **Diff ビュー機能全体の新規追加** — `DiffView`, `DiffContentViewer`, `DiffFileSidebar` 等

---

## カテゴリ分類

| カテゴリ | ファイル数 | 対象ファイル |
|---------|--------:|------------|
| A. バックエンド - DevPanel API | 4 | `app_devpanel_api.go`, `app_devpanel_api_test.go`, `app_devpanel_types.go`, `app.go` |
| B. バックエンド - SessionLog | 4 | `app_session_log.go`, `app_session_log_test.go`, `app_session_log_types.go`, `internal/sessionlog/handler.go` |
| C. バックエンド - SessionLog テスト | 1 | `internal/sessionlog/handler_test.go` |
| D. バックエンド - Events/Lifecycle/PaneAPI | 5 | `app_events.go`, `app_events_test.go`, `app_lifecycle.go`, `app_lifecycle_test.go`, `app_pane_api.go` |
| E. バックエンド - Internal/Tmux | 8 | `session_manager_windows.go`, `command_router_handlers_window.go`, `command_router_handlers_window_test.go`, `command_router_test_helpers_test.go`, `session_manager_test.go`, `session_manager_window_test.go`, `session_manager_directional_test.go`, `session_manager_pane_io_test.go` |
| F. バックエンド - その他 | 2 | `internal/testutil/helpers.go`, `internal/tmux/command_router_env_test.go` |
| G. フロントエンド - ビューア/コンポーネント | 6+ | `ViewerSystem.tsx`, `ActivityStrip.tsx`, `viewerRegistry.ts`, `ErrorLogView.tsx`, `error-log/index.ts`, `error-log/useErrorLog.ts` |
| H. フロントエンド - ストア/フック/API | 3 | `errorLogStore.ts`, `useBackendSync.ts`, `api.ts` |
| I. フロントエンド - スタイル | 2 | `base.css`, `viewer.css` |
| J. フロントエンド - Wails生成ファイル | 3 | `App.d.ts`, `App.js`, `models.ts` |
| K. フロントエンド - DiffView (新規) | 7 | `DiffIcon.tsx`, `DiffView.tsx`, `DiffContentViewer.tsx`, `DiffFileSidebar.tsx`, `diffViewTypes.ts`, `useDiffView.ts`, `index.ts` |

---

## Critical Issues (4 件)

### C-1: `app_events.go` — コメントの文字化け (CLAUDE.md UTF-8仕様違反)

- **ファイル**: `app_events.go` L134, L140, L143, L153, L219, L222
- **深刻度**: 🔴 Critical

**本番コード確認済み（複数レビューアで一致）**:
```go
// L134: NOTE(1-window model): Currently unreachable 窶・retained for ...
// L140: multi-window extension only needs to start emitting the events 窶・no policy
// L143: INVARIANT: immutable after init 窶・do not modify at runtime.
// L153: 迴ｾ蝨ｨ縺ｮ繧｢繝ｼ繧ｭ繝・け繝√Ε縺ｯ 1 繧ｻ繝・す繝ｧ繝ｳ...（完全に文字化け）
// L219: for this flush window (竕､ outputFlushInterval = 16 ms) is lost.
// L222: is at most one flush interval worth of data 窶・invisible to users.
```

- `窶・` = em-dash (`—`) のShift_JIS誤解釈
- `竕､` = `≤` のShift_JIS誤解釈
- L153 は完全にShift_JIS文字化け（日本語コメント）

**CLAUDE.md**: 「全てUTF8でBOM無しとする」に違反。  
**影響範囲**: コード動作には影響しないが、コメントの可読性が完全に失われている。  
**周辺確認**: `app_lifecycle.go`, `command_router_handlers_window.go` は正常。文字化けは `app_events.go` のみに限局。

**修正案**:
1. L134, L140, L143: `窶・` → `—` に置換
2. L219: `竕､` → `≤` に置換
3. L153: Git historyから元の日本語コメントを復元

---

### C-2: `buildUntrackedFileDiffsWithBudget` — 予算チェック条件が `== 0` にしかマッチしない (論理バグ)

- **ファイル**: `app_devpanel_api.go` L687
- **深刻度**: 🔴 Critical (バグ)

**本番コード確認済み（複数レビューアで一致）**:
```go
if remainingBudget >= 0 && remainingBudget <= 0 {
    budgetExceeded = true
    return fs.SkipAll
}
```

`>= 0 && <= 0` は数学的に `== 0` と等価。

**呼び出し元の保護確認** (L562-577):
- `DevPanelWorkingDiff` で `remainingBudget <= 0` を事前チェックしており、この関数に渡される時点では `remainingBudget > 0` が保証されている
- L705 で `len(entry.Diff) > remainingBudget` による個別ファイルチェックがある

**実際のリスク**: WalkDir内で複数の小ファイルが累積して予算を超えた場合（`remainingBudget` が負値になった場合）、`>= 0` が `false` となり予算超過を検知できない。ただし呼び出し元でファイル単位の保護があるため、実害は限定的。

**`remainingBudget = -1` （無制限モード）への配慮**:
- `buildUntrackedFileDiffs` (L640) は `-1` で呼び出すため、`<= 0` に変更すると無制限モードが壊れる

**修正案**:
```go
// 修正前
if remainingBudget >= 0 && remainingBudget <= 0 {
// 修正後（推奨）
if remainingBudget == 0 {
```
これで `-1`（無制限モード）では `false`、`0`（予算消費完了）では `true` になる。

もしくは、L710-712の `remainingBudget -= len(entry.Diff)` 後に追加チェック:
```go
if remainingBudget < 0 {
    budgetExceeded = true
    return fs.SkipAll
}
```

---

### C-3: `DiffContentViewer.tsx` — ハンクヘッダーのregexマッチ失敗時に不正なhunkが生成される

- **ファイル**: `frontend/src/components/viewer/views/diff-view/DiffContentViewer.tsx`
- **深刻度**: 🔴 Critical

**問題箇所**:
```ts
if (line.startsWith("@@")) {
    const match = line.match(/@@ -(\d+)(?:,\d+)? \+(\d+)(?:,\d+)? @@/);
    if (match) {
        oldLine = parseInt(match[1], 10);
        newLine = parseInt(match[2], 10);
    }
    // ↓ match が null でも currentHunk が必ず生成される
    currentHunk = {header: line, lines: [], startOldLine: oldLine, startNewLine: newLine};
    hunks.push(currentHunk);
    continue;
}
```

**問題**: `match` が null の場合、`oldLine`/`newLine` は前回ハンク終了時の値（または初期値 0）を引き継ぎ、不正なハンクが hunks 配列に追加される。

**修正案**:
```ts
if (line.startsWith("@@")) {
    const match = line.match(/@@ -(\d+)(?:,\d+)? \+(\d+)(?:,\d+)? @@/);
    if (!match) continue; // ← 不正なハンクヘッダーはスキップ
    oldLine = parseInt(match[1], 10);
    newLine = parseInt(match[2], 10);
    currentHunk = {header: line, lines: [], startOldLine: oldLine, startNewLine: newLine};
    hunks.push(currentHunk);
    continue;
}
```

---

### C-4: `handleNewWindow` — ロールバック後のテストカバレッジ不足

- **ファイル**: `command_router_handlers_window.go` L269-362
- **深刻度**: 🔴 Critical (動作の大幅変更にテスト不足)

**本番コード確認済み**:
```go
// 旧コード: snapOk == false → newSessionSnap = nil → legacyパスで続行
// 新コード: snapOk == false → rollbackSession()でセッション削除
```

この変更は**安全方向への改善**（部分初期化セッションを残さない）だが、動作の大幅な変更であるにもかかわらず `command_router_handlers_window_test.go` にこのパスのテストが含まれていない。

**修正案**: `TestHandleNewWindow_SnapshotRefetchFailure` テストケースの追加を推奨。

---

## Important Issues (12 件)

### I-1: `buildUntrackedFileDiffSingle` — 冗長な `os.Lstat` とセキュリティチェック順序

- **ファイル**: `app_devpanel_api.go` L726-777
- **深刻度**: 🟡 Important

**本番コード確認済み**: 3段階のセキュリティチェック:
1. **L730**: `isPathWithinBase(absPath, workDir)` — lexical guard
2. **L737-750**: `EvalSymlinks` 後にもう一度 `isPathWithinBase` — symlink resolution後のガード
3. **L752-760**: `os.Lstat` でシンボリックリンク検出

`EvalSymlinks` 成功後の `Lstat` は論理的には冗長だが、TOCTOU防御として意図的な多層防御。`cachedInfo` は `d.Info()` = Lstat相当であり不整合はない（前回Critical指摘は降格済み）。

**修正案**:
- 現状維持でも可。各チェックの防御対象をコメントで明記すると保守性向上
- パフォーマンス最適化として、`Lstat` を `EvalSymlinks` の前に移動しシンボリックリンクを早期スキップすることも検討可

---

### I-2: `useBackendSync.ts` — `errorLogFetchSeq` がクリーンアップ時にリセットされない

- **ファイル**: `useBackendSync.ts`
- **深刻度**: 🟡 Important

**問題**: React StrictMode（開発環境）では useEffect が2回実行される。1回目のcleanup後も `errorLogFetchSeq` が `0` にリセットされないため、2回目の実行でseqが前回の値を引き継ぐ。`isMountedRef.current = false` で後続fetchは破棄されるため実害は限定的。

**修正案**:
```ts
return () => {
    isMountedRef.current = false;
    errorLogFetchSeq = 0; // ← クリーンアップ時にリセット
    // ...
};
```

---

### I-3: `errorLogStore.ts` — 初回ロード時の「全既読」挙動

- **ファイル**: `errorLogStore.ts` L56-58
- **深刻度**: 🟡 Important (設計判断)

**本番コード確認済み**:
```ts
if (state.entries.length === 0 && state.lastReadSeq === 0 && maxNewSeq > 0) {
    lastReadSeq = maxNewSeq;
}
```

アプリ起動時の既存エラーが全て既読扱いになる。Wailsアプリのリロード時も初期状態から始まるため、セッション中に蓄積されたエラーが全て既読になる。

**設計意図推測**: 起動前の既存ログをバッジ表示しない方針は合理的。  
**推奨**: 設計判断のコメント追加（「起動前の既存ログは既読扱い: 新規エラーのみ通知する方針」）。将来的に `lastReadSeq` のローカルストレージ永続化も検討可。

---

### I-4: `app_session_log.go` — `closeSessionLog` でのSync後Close競合のEINVAL抑制

- **ファイル**: `app_session_log.go` L159-170
- **深刻度**: 🟡 Important

**本番コード確認済み**: `errors.Is(syncErr, os.ErrClosed) || errors.Is(syncErr, syscall.EINVAL)` でガード。Windows固有の `EINVAL` 対応。Go ランタイムが `EBADF` を `os.ErrClosed` にラップするため Linux でも対応済み。

**修正案（オプション）**: Windows固有ケースを絞り込む:
```go
isExpectedCloseRace := errors.Is(syncErr, os.ErrClosed) ||
    (runtime.GOOS == "windows" && errors.Is(syncErr, syscall.EINVAL))
```

→ 現状の実装でも正しく動作。対応は低優先度。

---

### I-5: `cleanupOldSessionLogs` — currentFile スキップ時の削除数不足

- **ファイル**: `app_session_log.go` L89-100
- **深刻度**: 🟡 Important (軽微)

`currentFile` がソート順で `logFiles[:excess]` の範囲に入った場合、スキップにより `sessionLogMaxFiles + 1` ファイルが残る。`sessionLogMaxFiles = 100` のため実質影響は微小。

→ 厳密な上限管理よりアクティブファイルの保護を優先する設計は適切。

---

### I-6: `viewerRegistry.ts` — `globalThis` への直接書き込み

- **ファイル**: `viewerRegistry.ts` L13-27
- **深刻度**: 🟡 Important

**本番コード確認済み**: `__mytx_view_registry__` 文字列をキーとして `globalThis` に保存。HMR dispose でリセット + `registerView` の重複対策（`findIndex` + 上書き）は適切。

**リスク**: キー衝突（他ライブラリ等）の可能性。テスト環境でのグローバル状態汚染。  
**推奨**: `Symbol.for("mytx_view_registry")` の使用、またはテスト用 `clearRegistry()` ヘルパー追加。ただし `CLAUDE.md` の「内部Web通信の外部公開リスク不指摘」に該当するため現状は許容。

---

### I-7: `ErrorLogView.tsx` — `markAllRead` が `entries` 変更のたびに呼ばれる

- **ファイル**: `ErrorLogView.tsx` L13-15
- **深刻度**: 🟡 Important

```tsx
useEffect(() => {
    markAllRead();
}, [entries, markAllRead]); // エントリが増えるたびに実行
```

ErrorLogView が開いている間は全エントリが即座に既読化される。「ビューを開いている＝全て既読」という意図的な動作。`markAllRead` は zustand の `set` を呼ぶため微小な再レンダリングが発生するが、batching で吸収される。

→ 意図をコメントで明記することを推奨。

---

### I-8: `DiffFileSidebar.tsx` — `TreeOuter` の `forwardRef` 型定義

- **ファイル**: `DiffFileSidebar.tsx`
- **深刻度**: 🟡 Important

`React.HTMLAttributes` の型を使用しているが、`React` 名前空間インポートが必要。直接インポートで修正可能:
```ts
import {forwardRef, type HTMLAttributes} from "react";
const TreeOuter = forwardRef<HTMLDivElement, HTMLAttributes<HTMLDivElement>>(...)
```

---

### I-9: `useDiffView.ts` — `buildDiffTree` の `addedDirs` 登録タイミング

- **ファイル**: `useDiffView.ts`
- **深刻度**: 🟡 Important

**問題**: `addedDirs.add(dirPath)` が親ディレクトリ非展開時のスキップ前に実行されるため、後で親が展開されたときに以前スキップしたディレクトリが再追加される機会を失う。

**修正案**: `addedDirs.add(dirPath)` を実際に nodes に追加した場合のみ実行:
```ts
if (i > 1 && !expandedDirs.has(parentPath)) {
    continue;
}
addedDirs.add(dirPath); // ← 表示した場合のみ追加
nodes.push({...});
```

---

### I-10: `removeWindowAtIndexLocked` — スライスの二重割り当て

- **ファイル**: `session_manager_windows.go` L109-117
- **深刻度**: 🟡 Important (軽微)

```go
removedPanes := make([]*TmuxPane, 0)           // 最初: 空スライス
if window != nil && len(window.Panes) > 0 {
    removedPanes = make([]*TmuxPane, len(window.Panes))  // 上書き
    copy(removedPanes, window.Panes)
}
```

`window.Panes > 0` の場合、最初の `make` は即座に捨てられる。hot pathではないため実害なし。

---

### I-11: `app.go` + `useBackendSync.ts` — `[DEBUG-WS]` ログプレフィックス未統一

- **ファイル**: `app.go` L141, `useBackendSync.ts` L153
- **深刻度**: 🟡 Important

他ファイルでは `[DEBUG-*]` → `[*]` に統一されているが、以下が未更新:
- `app.go` L141: `slog.Debug("[DEBUG-WS] wsHub is nil...")`
- `useBackendSync.ts` L153: `console.warn("[DEBUG-WS] GetWebSocketURL failed", err)`

また `command_router_handlers_window.go` L404 で `"DEBUG-KILLWINDOW"` も残存。

---

### I-12: `app_events.go` — `tmux:window-created` の `snapshotEventPolicies` 追加

- **ファイル**: `app_events.go`
- **深刻度**: 🟡 Important

`tmux:window-created` を `trigger: true, bypassDebounce: true` で追加したが、コメントには「1-window モデルでは emit されない」と記載。発行箇所の確認を推奨。

---

## Suggestions (14 件)

### S-1: `buildUntrackedFileDiffSingle` のセキュリティチェックのコメント明確化
- **ファイル**: `app_devpanel_api.go` L726-760
- 3段階チェック（lexical guard → EvalSymlinks guard → Lstat guard）の各防御対象を明記推奨。

### S-2: `parseDiffHeaderPaths` の対称性ヒューリスティックのコメント改善
- **ファイル**: `app_devpanel_api.go` L969-982
- rename の edge case テスト追加も推奨 (`TestParseDiffHeaderPaths_RenameWithSpaceInPath` 等)。

### S-3: `parseNULSeparatedGitPaths` のキャパシティ最適化
- **ファイル**: `app_devpanel_api.go` L620
- `min(len(entries), devPanelMaxUntrackedFilePaths)` をキャパシティに使用推奨。

### S-4: `DevPanelWorkingDiff` — freshRepo 非対称エラーハンドリングのコメント追加
- **ファイル**: `app_devpanel_api.go` L520-541
- freshRepo時は `diffLoadIncomplete` で継続、通常repoはエラー返却。非対称の理由をコメントで明示推奨。

### S-5: `DevPanelWorkingDiff` — 空 output 時の早期リターン
- **ファイル**: `app_devpanel_api.go` L543-555
- `if len(output) == 0` で `string(output)` のアロケーション回避可能。低優先度。

### S-6: ログプレフィックスの統一残存箇所
- **ファイル**: `app_lifecycle.go` L439,449,492 (`[DEBUG-HOTKEY]`), L186 (`[DEBUG-CONFIG]`)
- テスト側の文字列マッチ修正も必要。意図的に残している場合はコメント追加推奨。
- `app_lifecycle.go` 内で `[shim]` (小文字) と `[SHIM]` (大文字) の混在あり（L247 vs L277）。

### S-7: `DiffContentViewer.tsx` — `key={li}` → `key={`${hi}-${li}`}` に改善
- **ファイル**: `DiffContentViewer.tsx`
- hunk切り替え時のDOM再利用をより安定化可能。

### S-8: `DiffFileSidebar.tsx` — 初期 `height = 0` でのちらつき
- **ファイル**: `DiffFileSidebar.tsx`
- `ResizeObserver` 計測完了までサイドバーが空になる。placeholderまたはCSS `min-height` で対処推奨。

### S-9: `DiffView.tsx` — ヘッダー構造の重複定義
- `!activeSession`、`error`、通常表示の3ケースで同様のヘッダーDOM。共通 `DiffViewShell` コンポーネントへの抽出で重複削減可能。

### S-10: `diff-view/index.ts` — インポートスタイルの不一致
- スペースあり `{ registerView }` が他ファイルと不一致。`eslint --fix` で統一可能。

### S-11: `ActivityStrip.tsx` — position デフォルト値のコメント追加
- `position` 未指定 = `top` 相当。暗黙の挙動をコメントで明示推奨。

### S-12: `command_router_env_test.go` — `copy` → `got` リネーム
- Go組み込み関数 `copy` のシャドウイング回避。良い改善。問題なし。

### S-13: `bytes.IndexByte` / `--` 終端子追加 / `cap` → `bufCap` リネーム
- いずれも良い改善。パフォーマンス・安全性向上。追加対応不要。

### S-14: テストコードでの `stubRuntimeEventsEmit(t)` 共通化 / `boolPtr` → `testutil.Ptr` 統一
- テスト可読性・保守性向上の良いリファクタリング。問題なし。

---

## Positive Observations (良い点)

1. **ping+fetch モデルの設計品質**: `writeSessionLogEntry` 内でシーケンス割当・リングバッファ追加・スロットル判定を単一ロック内で完了し、ロック外で `Sync()` と `emitRuntimeEvent` を実行。レイテンシとデータ整合性のバランスが優れている。
2. **防御的コーディングの多層構造**: `buildUntrackedFileDiffSingle` の5段階防御（lexical guard → EvalSymlinks guard → Lstat → サイズチェック → バイナリ検出）。
3. **テストの網羅性**: `injectTestWindow` を使ったマルチウィンドウテスト、フィールド数ガード、エッジケース網羅。
4. **エラーログの循環参照防止**: `fmt.Fprintf(os.Stderr, ...)` で slog → TeeHandler → writeSessionLogEntry の再帰回避。
5. **フロントエンドの fetch seq パターン**: `errorLogFetchSeq` によるモノトニックカウンターで古いレスポンス破棄。
6. **セッションログのseqフィールド**: `uint64` の安定識別子導入。~3000年の実用計算コメントも適切。
7. **リングバッファの堅牢化**: `newSessionLogRingBuffer` のクランプ、`push` のゼロガード、`snapshot` の `min` ビルトイン使用。
8. **TeeHandler のパニック回復**: `recover()` + stderr出力 + 空入力最適化。
9. **`rollbackSession` パターン**: `handleNewWindow` のロールバック関数による cleanup 保証。
10. **1-window モデルの設計文書**: コメントで将来の拡張方針を明確化。
11. **viewerRegistry のHMR対応**: dispose + 再登録のVite HMRパターンが正しく実装。
12. **DiffFileSidebar の仮想スクロール**: `react-window` の `FixedSizeList` で大量ファイル対応。

---

## Recommended Action

| 優先度 | タスクID | 概要 | 工数見積 |
|:------:|---------|------|---------|
| 🔴 最優先 | C-1 | `app_events.go` の文字化けコメント修正（5箇所） | 15分 |
| 🔴 最優先 | C-2 | `app_devpanel_api.go` L687 の予算チェック条件修正 | 5分 |
| 🔴 最優先 | C-3 | `DiffContentViewer.tsx` のハンクヘッダーregex null guard追加 | 5分 |
| 🔴 最優先 | C-4 | `handleNewWindow` snapshot-refetchロールバックパスのテスト追加 | 30分 |
| 🟡 中 | I-2 | `useBackendSync.ts` の `errorLogFetchSeq` リセット追加 | 5分 |
| 🟡 中 | I-3 | `errorLogStore.ts` 初回既読判定の設計コメント追加 | 5分 |
| 🟡 中 | I-7 | `ErrorLogView.tsx` markAllRead 意図コメント追加 | 5分 |
| 🟡 中 | I-8 | `DiffFileSidebar.tsx` forwardRef 型修正 | 5分 |
| 🟡 中 | I-9 | `useDiffView.ts` buildDiffTree addedDirs修正 | 10分 |
| 🟡 中 | I-11 | ログプレフィックス `[DEBUG-WS]` 等の統一 | 10分 |
| 🟢 低 | I-4 | `EINVAL` 抑制のWindows条件限定 | 5分 |
| 🟢 低 | I-5 | `cleanupOldSessionLogs` excess再計算 | 10分 |
| 🟢 低 | I-10 | `removeWindowAtIndexLocked` スライス二重割り当て整理 | 5分 |
| 🟢 低 | S-1〜S-14 | 各種コメント追加・最適化 | 各5分 |

---

## 並列作業表

### 詳細タスク × 並列可否マトリクス

| # | タスクID | 対象ファイル | 指摘概要 | 優先度 | 作業量 | 並列 | 競合タスク | 備考 |
|---|---------|------------|---------|--------|--------|:----:|-----------|------|
| 1 | C-1 | `app_events.go` | 文字化けコメント修正（5箇所） | 🔴 Critical | 小 | ✅ | なし | コメント修正のみ。独立ファイル |
| 2 | C-2 | `app_devpanel_api.go` L687 | 予算チェック `>=0 && <=0` → `== 0` に修正 | 🔴 Critical | 極小 | ⚠️ | #9,#10 (同一ファイル) | 1行修正 |
| 3 | C-3 | `DiffContentViewer.tsx` | ハンクヘッダーregex null guard | 🔴 Critical | 小 | ✅ | なし | 新規ファイル。独立 |
| 4 | C-4 | `command_router_handlers_window_test.go` | rollbackパスのテスト追加 | 🔴 Critical | 中 | ✅ | なし | テスト追加のみ。本番コード変更なし |
| 5 | I-2 | `useBackendSync.ts` | `errorLogFetchSeq` cleanup時リセット | 🟡 Important | 極小 | ✅ | なし | フロントエンドのみ |
| 6 | I-3 | `errorLogStore.ts` | 初回既読コメント追記 | 🟡 Important | 極小 | ✅ | なし | フロントエンドのみ |
| 7 | I-7 | `ErrorLogView.tsx` | markAllRead 意図コメント | 🟡 Important | 極小 | ✅ | なし | フロントエンドのみ |
| 8 | I-8 | `DiffFileSidebar.tsx` | forwardRef型修正 | 🟡 Important | 極小 | ✅ | なし | 新規ファイル。独立 |
| 9 | I-9 | `useDiffView.ts` | buildDiffTree addedDirs修正 | 🟡 Important | 小 | ✅ | なし | 新規ファイル。独立 |
| 10 | I-1 | `app_devpanel_api.go` | Lstat冗長性のコメント追加 | 🟡 Important | 極小 | ⚠️ | #2 (同一ファイル) | コメントのみ |
| 11 | I-4 | `app_session_log.go` | EINVAL抑制のWindows条件限定 | 🟡 Important | 小 | ⚠️ | #12 (同一ファイル) | 低優先度 |
| 12 | I-5 | `app_session_log.go` | cleanupOldSessionLogs修正 | 🟡 Important | 小 | ⚠️ | #11 (同一ファイル) | 低優先度 |
| 13 | I-6 | `viewerRegistry.ts` | globalThisキー衝突対策 | 🟡 Important | 小 | ✅ | なし | フロントエンドのみ |
| 14 | I-10 | `session_manager_windows.go` | スライス二重割り当て | 🟡 Important | 極小 | ✅ | なし | 独立バックエンドファイル |
| 15 | I-11 | `app.go` + `useBackendSync.ts` + `command_router_handlers_window.go` | `[DEBUG-*]` プレフィクス統一 | 🟡 Important | 小 | ✅ | なし | 各ファイル独立 |
| 16 | I-12 | `app_events.go` | `tmux:window-created` emit確認 | 🟡 Important | 小 | ⚠️ | #1 (同一ファイル) | C-1完了後推奨 |
| 17 | S-6 | `app_lifecycle.go` + テスト | `[DEBUG-HOTKEY]` → `[HOTKEY]` 統一 | 🟢 Suggestion | 小 | ⚠️ | テスト文字列も修正要 | セットで対応 |

### 並列作業 推奨グルーピング

| グループ | 担当タスク | 対象ファイル群 | 理由 | 備考 |
|---------|-----------|-------------|------|------|
| **Worker A: バックエンド DevPanel** | C-2, I-1, S-1, S-3, S-4, S-5 | `app_devpanel_api.go` | 同一ファイルへの修正を集約。**1人で担当必須** | グループ内は直列 |
| **Worker B: イベント＆コメント** | C-1, I-12 | `app_events.go` | 文字化け修正 + ポリシー確認。同一ファイル | コメント修正後にI-12確認 |
| **Worker C: バックエンド SessionLog** | I-4, I-5 | `app_session_log.go` | 同一ファイルの修正を集約 | 低優先度 |
| **Worker D: バックエンド tmux/その他** | C-4, I-10, I-14 | `command_router_*`, `session_manager_windows.go` | 各ファイル独立。並列OK | テスト追加中心 |
| **Worker E: フロントエンド Store/Hook** | I-2, I-3, I-6 | `useBackendSync.ts`, `errorLogStore.ts`, `viewerRegistry.ts` | フロントエンドストア系を集約。各ファイル独立 | 全て並列OK |
| **Worker F: フロントエンド Component** | C-3, I-7, I-8, I-9, S-7, S-8, S-9 | `DiffContentViewer.tsx`, `ErrorLogView.tsx`, `DiffFileSidebar.tsx`, `useDiffView.ts`, `DiffView.tsx` | フロントエンドコンポーネント系。各ファイル独立 | 全て並列OK |
| **Worker G: ログプレフィクス統一** | I-11, S-6 | `app.go`, `app_lifecycle.go`, `useBackendSync.ts`, `command_router_handlers_window.go` | テーマが同じ。各ファイル独立 | 並列OK |

### グループ間の依存関係

```
Worker A ─────── 独立 ─────── Worker B
Worker C ─────── 独立 ─────── Worker D
Worker E ─────── 独立 ─────── Worker F
Worker G ─────── 独立 ───────（全グループと並列可能）

※ Worker B の I-12 は Worker B の C-1 完了後が望ましい（同一ファイル）
※ Worker F 内の S-7 は C-3 完了後が望ましい（同一ファイル）
※ Worker G の S-6 はテストファイルとセットで対応
```

### 凡例

- ✅ **可**: 他タスクと完全に独立しており、別作業者が同時着手可能
- ⚠️ **条件付き**: 同一ファイルまたは関連コードへの変更があるため、グルーピング参照
- ❌ **不可**: 直列で実施する必要がある（該当なし）
