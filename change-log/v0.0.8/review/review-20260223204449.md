# PR Review â€” 2026-02-23 20:44:49

## ãƒ¬ãƒ“ãƒ¥ãƒ¼æ¦‚è¦

**å¯¾è±¡ãƒ–ãƒ©ãƒ³ãƒ:** ã‚³ãƒŸãƒƒãƒˆå‰ã®ä½œæ¥­ãƒ„ãƒªãƒ¼  
**ãƒ¬ãƒ“ãƒ¥ãƒ¼æ—¥æ™‚:** 2026-02-23 20:44:49  
**ä¸»è¦å¤‰æ›´ãƒ†ãƒ¼ãƒ:**
- **Input History æ©Ÿèƒ½è¿½åŠ ** (`app_input_history.go`, `app_input_history_types.go`, é–¢é€£ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰)
- **Frontend Error åé›†æ©Ÿèƒ½** (`LogFrontendEvent`, `ErrorBoundary`, ã‚°ãƒ­ãƒ¼ãƒãƒ«ãƒãƒ³ãƒ‰ãƒ©ãƒ¼)
- **ViewerShortcuts è¨­å®šæ©Ÿèƒ½** (è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«æ‹¡å¼µã€UIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆè¿½åŠ )
- **Go ãƒ¢ãƒ€ãƒ³åŒ–** (`strings.SplitSeq`, `strings.CutPrefix` ç­‰ã¸ã®ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°)

---

## å¤‰æ›´ãƒ•ã‚¡ã‚¤ãƒ«ä¸€è¦§

| ã‚«ãƒ†ã‚´ãƒª | ãƒ•ã‚¡ã‚¤ãƒ« | å¤‰æ›´ç¨®åˆ¥ |
|---------|---------|---------|
| **A: Go ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‚³ã‚¢** | `myT-x/app.go` | å¤‰æ›´ |
| | `myT-x/app_devpanel_api.go` | å¤‰æ›´ |
| | `myT-x/app_lifecycle.go` | å¤‰æ›´ |
| | `myT-x/app_pane_api.go` | å¤‰æ›´ |
| | `myT-x/app_session_log.go` | å¤‰æ›´ |
| | `myT-x/app_input_history.go` | **æ–°è¦** |
| | `myT-x/app_input_history_types.go` | **æ–°è¦** |
| **B: Go ãƒ†ã‚¹ãƒˆãƒ»è¨­å®š** | `myT-x/app_session_log_test.go` | å¤‰æ›´ |
| | `myT-x/app_input_history_test.go` | **æ–°è¦** |
| | `myT-x/internal/config/config.go` | å¤‰æ›´ |
| | `myT-x/internal/config/config_test.go` | å¤‰æ›´ |
| | `myT-x/internal/testutil/helpers.go` | å¤‰æ›´ |
| | `myT-x/internal/tmux/command_router_env_test.go` | å¤‰æ›´ |
| | `myT-x/internal/tmux/command_router_handlers_window_test.go` | å¤‰æ›´ |
| **C: ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã‚³ã‚¢** | `myT-x/frontend/src/api.ts` | å¤‰æ›´ |
| | `myT-x/frontend/src/types/tmux.ts` | å¤‰æ›´ |
| | `myT-x/frontend/wailsjs/go/main/App.d.ts` | å¤‰æ›´ |
| | `myT-x/frontend/wailsjs/go/main/App.js` | å¤‰æ›´ |
| | `myT-x/frontend/wailsjs/go/models.ts` | å¤‰æ›´ |
| | `myT-x/frontend/src/main.tsx` | å¤‰æ›´ |
| | `myT-x/frontend/src/hooks/useBackendSync.ts` | å¤‰æ›´ |
| | `myT-x/frontend/src/components/ErrorBoundary.tsx` | **æ–°è¦** |
| | `myT-x/frontend/src/stores/inputHistoryStore.ts` | **æ–°è¦** |
| **D: ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰UI** | `myT-x/frontend/src/components/SettingsModal.tsx` | å¤‰æ›´ |
| | `myT-x/frontend/src/components/settings/KeybindSettings.tsx` | å¤‰æ›´ |
| | `myT-x/frontend/src/components/settings/settingsReducer.ts` | å¤‰æ›´ |
| | `myT-x/frontend/src/components/settings/settingsValidation.ts` | å¤‰æ›´ |
| | `myT-x/frontend/src/components/settings/types.ts` | å¤‰æ›´ |
| | `myT-x/frontend/src/components/settings/ViewerShortcutSettings.tsx` | **æ–°è¦** |
| | `myT-x/frontend/src/components/viewer/ActivityStrip.tsx` | å¤‰æ›´ |
| | `myT-x/frontend/src/components/viewer/ViewerSystem.tsx` | å¤‰æ›´ |
| | `myT-x/frontend/src/components/viewer/viewerRegistry.ts` | å¤‰æ›´ |

---

## Critical Issues (0ä»¶)

ãƒ‡ãƒ¼ã‚¿ç ´æãƒ»ã‚¯ãƒ©ãƒƒã‚·ãƒ¥ãƒ¬ãƒ™ãƒ«ã®é‡å¤§å•é¡Œã¯ç™ºè¦‹ã•ã‚Œã¾ã›ã‚“ã§ã—ãŸã€‚ãƒ­ãƒƒã‚¯é †åºã€ã‚·ãƒ£ãƒƒãƒˆãƒ€ã‚¦ãƒ³ã‚·ãƒ¼ã‚±ãƒ³ã‚¹ã€ã‚¿ã‚¤ãƒãƒ¼ä¸–ä»£ç•ªå·ã«ã‚ˆã‚‹äºŒé‡ãƒ•ãƒ©ãƒƒã‚·ãƒ¥é˜²æ­¢ã¯ã„ãšã‚Œã‚‚æ­£ã—ãå®Ÿè£…ã•ã‚Œã¦ã„ã¾ã™ã€‚

---

## Important Issues (9ä»¶)

### [A-I-1] `flushLineBuffer` ã®ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆãƒ•ãƒ©ãƒƒã‚·ãƒ¥ã§ `source` ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãŒä¸æ­£ç¢º

**ãƒ•ã‚¡ã‚¤ãƒ«:** `myT-x/app_input_history.go` (flushLineBuffer é–¢æ•°ã€ç´„L157)  
**é‡å¤§åº¦:** Important

**å•é¡Œ:**
```go
lb, exists := a.inputLineBuffers[paneID]
if !exists {
    lb = &inputLineBuffer{paneID: paneID, source: source, session: session}
    a.inputLineBuffers[paneID] = lb
}
// æ—¢å­˜ lb ã«å¯¾ã—ã¦ source/session ã¯æ›´æ–°ã•ã‚Œãªã„ â† ã“ã“ãŒå•é¡Œ
```

`SendInput`ï¼ˆ"keyboard"ï¼‰ã§ lb ãŒä½œæˆã•ã‚ŒãŸå¾Œã« `SendSyncInput`ï¼ˆ"sync-input"ï¼‰ãŒåŒã˜ `paneID` ã«å…¥åŠ›ã•ã‚ŒãŸå ´åˆã€ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆãƒ•ãƒ©ãƒƒã‚·ãƒ¥æ™‚ã®ã‚¨ãƒ³ãƒˆãƒªãŒ `source = "keyboard"` ã¨ã—ã¦èª¤è¨˜éŒ²ã•ã‚Œã‚‹ã€‚`\r` / `^C` / `^D` ã®ãƒ•ãƒ©ãƒƒã‚·ãƒ¥ãƒ‘ã‚¹ã§ã¯å¼•æ•°ã® `source` ã‚’ç›´æ¥ä½¿ç”¨ã™ã‚‹ãŸã‚æ­£ã—ã„ãŒã€ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆãƒ•ãƒ©ãƒƒã‚·ãƒ¥ãƒ‘ã‚¹ã ã‘ãŒå–ã‚Šæ®‹ã•ã‚Œã¦ã„ã‚‹ã€‚

**ä¿®æ­£æ¡ˆ:**
```go
lb, exists := a.inputLineBuffers[paneID]
if !exists {
    lb = &inputLineBuffer{paneID: paneID, source: source, session: session}
    a.inputLineBuffers[paneID] = lb
} else {
    lb.source = source   // æœ€å¾Œã«é€ã£ã¦ããŸ source ã§ä¸Šæ›¸ã
    lb.session = session
}
```

---

### [A-I-2] PID æ–‡å­—åˆ—ã‚½ãƒ¼ãƒˆã«ã‚ˆã‚‹ã€Œæœ€å¤ã§ãªã„å‰Šé™¤ã€ã®å¯èƒ½æ€§

**ãƒ•ã‚¡ã‚¤ãƒ«:** `myT-x/app_input_history.go` (cleanupOldInputHistory é–¢æ•°ã€ç´„L68)  
**é‡å¤§åº¦:** Important

**å•é¡Œ:**
ãƒ•ã‚¡ã‚¤ãƒ«åå½¢å¼ `input-20260223-120000-<PID>.jsonl` ã‚’ãã®ã¾ã¾è¾æ›¸é †ã‚½ãƒ¼ãƒˆã™ã‚‹ã¨ã€ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ãŒåŒä¸€ãƒ»PID ã®æ¡æ•°ãŒç•°ãªã‚‹å ´åˆã«ã€Œæœ€å¤ã®ãƒ•ã‚¡ã‚¤ãƒ«ãŒå¿…ãšã—ã‚‚å…ˆé ­ã«æ¥ãªã„ã€ã€‚

ä¾‹: PID=100ï¼ˆæ–°ã—ã„ï¼‰vs PID=9999ï¼ˆå¤ã„ï¼‰ã®å ´åˆã€`"...100.jsonl"` < `"...9999.jsonl"` ã¨ãªã‚‹ãŸã‚ã€æ–°ã—ã„ã»ã†ãŒå…ˆã«å‰Šé™¤å¯¾è±¡ã«ãªã‚‹ã€‚

ã‚³ãƒ¡ãƒ³ãƒˆã«ã¯ `"The timestamp prefix ensures files are primarily ordered by creation time"` ã¨ã‚ã‚‹ãŒã€åŒä¸€ç§’å†…ã®è¤‡æ•°èµ·å‹•ã§ç¢ºå®Ÿã«èª¤é †åºã«ãªã‚‹ã€‚

**ä¿®æ­£æ¡ˆ:**
```go
// sort.Strings(histFiles) â†’ slices.Sort(histFiles) ã¸ã®å¤‰æ›´ã¨åˆã‚ã›ã¦
// os.ReadDir ã§ãƒ•ã‚¡ã‚¤ãƒ«ã® ModTime ã‚’ä½¿ã†ã‹ã€ãƒ•ã‚¡ã‚¤ãƒ«åã‹ã‚‰PIDã‚’é™¤ã„ãŸ
// ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—éƒ¨åˆ†ã®ã¿ã§ã‚½ãƒ¼ãƒˆã™ã‚‹
```

---

### [A-I-3] å‰Šé™¤å¤±æ•—æ™‚ã« MAX_FILES è¶…éãŒæ®‹å­˜ï¼ˆWindows ç’°å¢ƒã§é »åº¦é«˜ï¼‰

**ãƒ•ã‚¡ã‚¤ãƒ«:** `myT-x/app_input_history.go` (cleanupOldInputHistory ç´„L71)  
**é‡å¤§åº¦:** Importantï¼ˆWindows å›ºæœ‰ï¼‰

**å•é¡Œ:**
```go
if err := os.Remove(target); err != nil {
    slog.Warn(...)
    continue  // deleted++ ã•ã‚Œãªã„
}
deleted++
```

Windows ã§ã¯é–‹ã‹ã‚Œã¦ã„ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã®å‰Šé™¤ãŒå¤±æ•—ã™ã‚‹ï¼ˆã‚¢ãƒ³ãƒã‚¦ã‚¤ãƒ«ã‚¹ã€ã‚¨ãƒ‡ã‚£ã‚¿ç­‰ã«ã‚ˆã‚‹å æœ‰ï¼‰ã€‚å…¨ excess åˆ†ã®å‰Šé™¤å€™è£œã§å¤±æ•—ãŒç¶šãã¨ MAX_FILES è¶…éçŠ¶æ…‹ã®ã¾ã¾çµ‚äº†ã™ã‚‹ã€‚`app_session_log.go` ã® `cleanupOldSessionLogs` ã‚‚åŒãƒ‘ã‚¿ãƒ¼ãƒ³ã€‚

**å¯¾å‡¦ï¼ˆæœ€å°é™ï¼‰:** å‰Šé™¤å¤±æ•—ã§ã‚‚å‹•ä½œç¶™ç¶šã™ã‚‹ä»•æ§˜ã‚’æ˜ç¤ºã‚³ãƒ¡ãƒ³ãƒˆã§æ®‹ã™ï¼ˆ`// NOTE: On Windows, file removal may fail if held by another process. MAX_FILES limit is a best-effort constraint.`ï¼‰ã€‚

---

### [B-I-1] `testutil.Ptr` ç§»è¡ŒãŒ `app_session_api_test.go` ã«æœªé©ç”¨

**ãƒ•ã‚¡ã‚¤ãƒ«:** `myT-x/app_session_api_test.go` (ç´„L68, L69, L82, L90, L356, L364, L370, L371)  
**é‡å¤§åº¦:** Important

**å•é¡Œ:**
`internal/tmux` ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸å†…ã®2ãƒ•ã‚¡ã‚¤ãƒ«ã¯ `boolPtrTest` ãƒ˜ãƒ«ãƒ‘ãƒ¼ã¸ç§»è¡Œæ¸ˆã¿ã ãŒã€`app_session_api_test.go` ã«ã¯ `testutil.Ptr(true/false)` ãŒ **8ç®‡æ‰€** æ®‹å­˜ã—ã¦ã„ã‚‹ã€‚`testutil.Ptr` ã« `//go:fix inline` ãŒä»˜ä¸ã•ã‚ŒãŸã“ã¨ã§ `go fix ./...` ã«ã‚ˆã‚‹è‡ªå‹•ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³åŒ–ã¯å¯èƒ½ã ãŒã€æ‰‹å‹•å¯¾å¿œãŒæœªå®Ÿæ–½ã§ç§»è¡Œã®ä¸€è²«æ€§ãŒæãªã‚ã‚Œã¦ã„ã‚‹ã€‚

**å¯¾å‡¦:** `go fix ./...` å®Ÿè¡Œã€ã¾ãŸã¯ `app_session_api_test.go` ã«ã‚‚ `boolPtrTest` ã¨åŒç­‰ã®ãƒ­ãƒ¼ã‚«ãƒ«ãƒ˜ãƒ«ãƒ‘ãƒ¼å®šç¾©ã‚’è¿½åŠ ã€‚

---

### [B-I-2] `TestFlushAllLineBuffers_PersistsPendingBuffers` ã§å„ã‚¨ãƒ³ãƒˆãƒªã®æ¤œè¨¼ãŒä¸è¶³

**ãƒ•ã‚¡ã‚¤ãƒ«:** `myT-x/app_input_history_test.go` (TestFlushAllLineBuffers_PersistsPendingBuffers)  
**é‡å¤§åº¦:** Important

**å•é¡Œ:**
```go
result := a.GetInputHistory()
if len(result) != 3 {  // ä»¶æ•°ã®ã¿ç¢ºèª
    t.Fatalf(...)
}
```

3ã¤ã®ãƒšã‚¤ãƒ³ï¼ˆ%1:%2:%3ï¼‰ã‹ã‚‰ãƒ•ãƒ©ãƒƒã‚·ãƒ¥ã—ãŸã¯ãšãŒã€å„ã‚¨ãƒ³ãƒˆãƒªã® `PaneID` ã¨ `Input` ã®æ­£å½“æ€§ã‚’æ¤œè¨¼ã—ã¦ã„ãªã„ã€‚ã€Œ1ãƒšã‚¤ãƒ³ãŒ3å›æ›¸ã„ãŸã€å ´åˆã§ã‚‚é€šéã—ã¦ã—ã¾ã„ã€ãƒã‚°ã‚’è¦‹è½ã¨ã™å¯èƒ½æ€§ãŒã‚ã‚‹ã€‚

**ä¿®æ­£æ¡ˆ:**
```go
paneInputs := map[string]string{}
for _, e := range result {
    paneInputs[e.PaneID] = e.Input
}
if paneInputs["%1"] != "cmd1" { t.Errorf(...) }
if paneInputs["%2"] != "cmd2" { t.Errorf(...) }
if paneInputs["%3"] != "cmd3" { t.Errorf(...) }
```

---

### [B-I-3] `TestCleanupOldInputHistory_KeepsMaxFiles` ã§ã‚«ãƒ¬ãƒ³ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ä¿æŒã¨å‰Šé™¤é †åºã®æœªæ¤œè¨¼

**ãƒ•ã‚¡ã‚¤ãƒ«:** `myT-x/app_input_history_test.go` (TestCleanupOldInputHistory_KeepsMaxFiles)  
**é‡å¤§åº¦:** Important

**å•é¡Œ:**
ãƒ•ã‚¡ã‚¤ãƒ«æ•°ï¼ˆ50ï¼‰ã¯æ­£ã—ãæ¤œè¨¼ã•ã‚Œã‚‹ãŒã€ã€Œå‰Šé™¤ã•ã‚Œã‚‹ã¹ãå¤ã„ãƒ•ã‚¡ã‚¤ãƒ«ãŒæ¶ˆãˆã¦ã„ã‚‹ã‹ã€ã€Œã‚«ãƒ¬ãƒ³ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ãŒä¿æŒã•ã‚Œã¦ã„ã‚‹ã‹ã€ã‚’æ¤œè¨¼ã—ã¦ã„ãªã„ã€‚ãƒ•ã‚¡ã‚¤ãƒ«åã‚½ãƒ¼ãƒˆé †ãŒæ„å›³é€šã‚Šã§ãªã„å®Ÿè£…ãƒã‚°ãŒã‚ã£ã¦ã‚‚ä»¶æ•°ã ã‘ã§ã¯é€šéã—ã¦ã—ã¾ã†ã€‚`app_session_log_test.go` ã«ã¯ `TestCleanupOldSessionLogs_PreservesCurrentFile` ã¨ `TestCleanupOldSessionLogs_DeletesOldest` ãŒåˆ¥é€”å­˜åœ¨ã™ã‚‹ãŒã€input history å´ã¯æ¬ è½ã€‚

---

### [C-I-1] `api.LogFrontendEvent` åŒæœŸã‚¹ãƒ­ãƒ¼æ™‚ã®éä¿è­·

**ãƒ•ã‚¡ã‚¤ãƒ«:** `myT-x/frontend/src/main.tsx` (ç´„L17, L30), `myT-x/frontend/src/components/ErrorBoundary.tsx` (ç´„L48)  
**é‡å¤§åº¦:** Important

**å•é¡Œ:**
```typescript
void api.LogFrontendEvent("error", message, "frontend/unhandled").catch(() => {});
```

`window['go']` ãŒ `undefined` ã®å ´åˆï¼ˆWails æœªåˆæœŸåŒ–ç­‰ï¼‰ã€`TypeError` ãŒ**åŒæœŸçš„ã«**ã‚¹ãƒ­ãƒ¼ã•ã‚Œã‚‹ã€‚`void` æ¼”ç®—å­ã¨ `.catch()` ãƒã‚§ãƒ¼ãƒ³ã¯éåŒæœŸã® Promise rejection ã®ã¿å‡¦ç†ã™ã‚‹ãŸã‚ã€åŒæœŸä¾‹å¤–ã¯ã‚­ãƒ£ãƒƒãƒã•ã‚Œãªã„ã€‚Wails ã‚¢ãƒ—ãƒªã§ã¯é€šå¸¸é‹ç”¨ã§ã®ç™ºç”Ÿç¢ºç‡ã¯ä½ã„ãŒã€é˜²å¾¡çš„ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã®è¦³ç‚¹ã‹ã‚‰å¯¾å¿œã‚’æ¨å¥¨ã€‚

åŒã˜ãƒ‘ã‚¿ãƒ¼ãƒ³ãŒä»¥ä¸‹3ç®‡æ‰€ã«å­˜åœ¨:
- `main.tsx` ã® `window.addEventListener("error", ...)` å†…
- `main.tsx` ã® `window.addEventListener("unhandledrejection", ...)` å†…
- `ErrorBoundary.tsx` ã® `componentDidCatch` å†…

**ä¿®æ­£æ¡ˆ:**
```typescript
window.addEventListener("error", (event) => {
    try {
        const message = ...;
        void api.LogFrontendEvent("error", message, "frontend/unhandled").catch(() => {});
    } catch {
        // Guard: Wails binding unavailable during early init
    }
});
```

---

### [D-I-1] å¾ªç’°ä¾å­˜ â€” ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãŒ UI ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã«ä¾å­˜

**ãƒ•ã‚¡ã‚¤ãƒ«:** `myT-x/frontend/src/components/settings/settingsValidation.ts` (L3)  
**é‡å¤§åº¦:** Important

**å•é¡Œ:**
```typescript
import {VIEWER_SHORTCUTS} from "./ViewerShortcutSettings"; // UIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¸ã®ä¾å­˜
```

`settingsValidation.ts` ã¯ç´”ç²‹é–¢æ•°ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã§ã‚ã‚‹ã¹ãã¨ã“ã‚ã€`ShortcutInput` ã‚’ import ã— React ã‚’ãƒãƒ³ãƒ‰ãƒ«ãƒ„ãƒªãƒ¼ã«å¼•ãè¾¼ã‚€ UIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ (`ViewerShortcutSettings.tsx`) ã«ä¾å­˜ã—ã¦ã„ã‚‹ã€‚å˜ä½“ãƒ†ã‚¹ãƒˆæ™‚ã« React ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ãƒ¢ãƒƒã‚¯ãŒå¿…è¦ã«ãªã‚Šã€å°†æ¥ã®ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°ã§å¤‰æ›´ãŒé€£é–ã™ã‚‹ã€‚

**ä¿®æ­£æ¡ˆ:** `VIEWER_SHORTCUTS` å®šæ•°ã¨ `ViewerShortcutDef` å‹ã‚’ç‹¬ç«‹ã—ãŸ `viewerShortcutConstants.ts`ï¼ˆã¾ãŸã¯ `constants.ts`ï¼‰ã«ç§»å‹•ã™ã‚‹ã€‚

```typescript
// æ–°è¦: viewerShortcutConstants.ts
export interface ViewerShortcutDef { viewId: string; label: string; defaultShortcut: string; }
export const VIEWER_SHORTCUTS: ViewerShortcutDef[] = [...];

// settingsValidation.ts
import { VIEWER_SHORTCUTS } from "./viewerShortcutConstants";

// ViewerShortcutSettings.tsx
import { VIEWER_SHORTCUTS } from "./viewerShortcutConstants";
```

---

### [D-I-2] `effectiveShortcut` ãƒ­ã‚¸ãƒƒã‚¯ãŒ ActivityStrip ã¨ ViewerSystem ã§é‡è¤‡ãƒ»å‹ä¸ä¸€è‡´

**ãƒ•ã‚¡ã‚¤ãƒ« A:** `myT-x/frontend/src/components/viewer/ActivityStrip.tsx` (ç´„L26-27)  
**ãƒ•ã‚¡ã‚¤ãƒ« B:** `myT-x/frontend/src/components/viewer/ViewerSystem.tsx` (ç´„L43-44)  
**é‡å¤§åº¦:** Important

**å•é¡Œ:**
```typescript
// ActivityStrip.tsx
const effectiveShortcut = configShortcut || view.shortcut || null;  // string | null

// ViewerSystem.tsx
const effectiveShortcut = configShortcut || view.shortcut;  // string | undefined
```

åŒä¸€ãƒ­ã‚¸ãƒƒã‚¯ãŒ2ã‹æ‰€ã«é‡è¤‡ã—ã€è¿”ã™å‹ãŒ `string | null` ã¨ `string | undefined` ã§ä¸çµ±ä¸€ã€‚å°†æ¥ configShortcut ã®å–å¾—æ–¹æ³•ãŒå¤‰ã‚ã£ãŸå ´åˆã«2ã‹æ‰€ã®ä¿®æ­£æ¼ã‚ŒãŒç™ºç”Ÿã™ã‚‹ã€‚

**ä¿®æ­£æ¡ˆ:** `viewerRegistry.ts` ã«å…±é€šãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°ã‚’è¿½åŠ :
```typescript
export function resolveEffectiveShortcut(
    view: ViewPlugin,
    config: Record<string, string> | null,
): string | null {
    const configShortcut = config?.[view.id]?.trim();
    return configShortcut || view.shortcut || null;
}
```

---

## Suggestions (16ä»¶)

### [A-S-1] C1 åˆ¶å¾¡æ–‡å­— (U+0080â€“U+009F) ã®ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°æ¬ å¦‚

**ãƒ•ã‚¡ã‚¤ãƒ«:** `myT-x/app_input_history.go` (processInputString ç´„L103)

```go
if r >= 0x20 || r == '\r' || ...
```

`r >= 0x20` ã¯ `0x80`ï¼ˆ128ï¼‰ä»¥ä¸Šã‚‚å«ã‚€ãŸã‚ã€C1 åˆ¶å¾¡æ–‡å­—ï¼ˆ0x80â€“0x9Fï¼‰ã€ç‰¹ã«8-bit CSI (`\x9B`) ã‚„ OSC (`\x9D`) ãŒãã®ã¾ã¾é€šéã—ã€history ã«æ„ë„ã—ãªã„åˆ¶å¾¡æ–‡å­—ãŒæ®‹ã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ã€‚

**ä¿®æ­£æ¡ˆ:**
```go
if (r >= 0x20 && r <= 0x7E) || r >= 0xA0 ||
   r == '\r' || r == '\x03' || r == '\x04' || r == '\x08' || r == '\x7f' {
```

---

### [A-S-2] `flushLineBuffer` ã®è¤‡æ•° `Unlock()` â†’ `defer` æ¨å¥¨

**ãƒ•ã‚¡ã‚¤ãƒ«:** `myT-x/app_input_history.go` (flushLineBuffer ç´„L196)

ç¾çŠ¶ 4ç®‡æ‰€ã® `a.inputLineBufMu.Unlock()` ãŒæ•£åœ¨ã—ã¦ãŠã‚Šã€å°†æ¥ã®å¤‰æ›´ã§ãƒ­ãƒƒã‚¯è§£æ”¾æ¼ã‚Œã®ãƒªã‚¹ã‚¯ãŒã‚ã‚‹ã€‚`defer` + ãƒ­ãƒ¼ã‚«ãƒ«å¤‰æ•°ãƒ‘ã‚¿ãƒ¼ãƒ³ã¸ã®ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°ã‚’æ¨å¥¨ã€‚

---

### [A-S-3] `flushLineBuffer(gen=0)` ã§ `lb.timer.Stop()` ãŒæœªå‘¼ã³å‡ºã—

**ãƒ•ã‚¡ã‚¤ãƒ«:** `myT-x/app_input_history.go` (flushLineBuffer ç´„L221)

`gen=0`ï¼ˆãƒ†ã‚¹ãƒˆã‚„ã‚·ãƒ£ãƒƒãƒˆãƒ€ã‚¦ãƒ³ã‹ã‚‰ç›´æ¥å‘¼ã¶ã‚±ãƒ¼ã‚¹ï¼‰ã§ã¯ã‚¿ã‚¤ãƒãƒ¼ãŒã¾ã ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªå¯èƒ½æ€§ãŒã‚ã‚‹ãŒã€`lb.timer.Stop()` ã‚’å‘¼ã°ãšã« `nil` ã«ã—ã¦ã„ã‚‹ã€‚5ç§’å¾Œã«ã‚´ãƒ¼ã‚¹ãƒˆã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ãŒèµ·å‹•ã™ã‚‹ãŒã€ãƒãƒƒãƒ•ã‚¡ãŒç©ºã§ early return ã™ã‚‹ãŸã‚å®Ÿå®³ã¯ãªã„ã€‚ãŸã ã—é˜²å¾¡ã¨ã—ã¦ `lb.timer.Stop()` ã‚’è¿½åŠ ã™ã‚‹ã“ã¨ã‚’æ¨å¥¨ã€‚

---

### [A-S-4] `sort.Strings` â†’ `slices.Sort` ã¸ã®ç§»è¡Œ

**ãƒ•ã‚¡ã‚¤ãƒ«:** `myT-x/app_input_history.go` (ç´„L68)

Go 1.21+ ã§ã¯ `slices.Sort(histFiles)` ãŒæ¨å¥¨ï¼ˆreflect ãƒ•ãƒªãƒ¼ã€ã‚ˆã‚Šé«˜é€Ÿï¼‰ã€‚`app_session_log.go` ã«ã‚‚åŒæ§˜ã®ç®‡æ‰€ãŒã‚ã‚Šã€ä¸¡æ–¹ã¾ã¨ã‚ã¦ç§»è¡Œã‚’æ¨å¥¨ã€‚

---

### [A-S-5] `ok0` å¤‰æ•°å â†’ ã‚ˆã‚Šæ˜ç¢ºãªå‘½å

**ãƒ•ã‚¡ã‚¤ãƒ«:** `myT-x/app_devpanel_api.go` (ç´„L971)

```go
} else if after, ok0 := strings.CutPrefix(line, "rename from "); ok0 {
```

`ok0` ã¯ã‚¹ã‚³ãƒ¼ãƒ—è¡çªã‚’é¿ã‘ã‚‹ãŸã‚ã®å·¥å¤«ã ãŒèª­ã¿ã«ãã„ã€‚`found` / `hasPrefix` ã®æ–¹ãŒæ„å›³ãŒæ˜ç¢º:
```go
} else if after, found := strings.CutPrefix(line, "rename from "); found {
```
`rename to` ã®ç®‡æ‰€ã‚‚åŒæ§˜ã€‚

---

### [A-S-6] `inputLineBuffers` ã® lazy åˆæœŸåŒ–ã¨ `inputHistoryEntries` ã® eager åˆæœŸåŒ–ã®éå¯¾ç§°

**ãƒ•ã‚¡ã‚¤ãƒ«:** `myT-x/app.go`, `myT-x/app_input_history.go`

`inputHistoryEntries` ã¯ `NewApp()` ã§åˆæœŸåŒ–ã•ã‚Œã‚‹ãŒã€`inputLineBuffers` ã¯ `recordInput` å†…ã§ lazy åˆæœŸåŒ–ã•ã‚Œã€`flushAllLineBuffers` ã§ `nil` ã«ãƒªã‚»ãƒƒãƒˆã•ã‚Œã‚‹ã€‚è¨­è¨ˆæ„å›³ã¯ã‚ã‚‹ãŒã€2ã¤ã®çŠ¶æ…‹ãŒç•°ãªã‚‹åˆæœŸåŒ–ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’æŒã¤ã“ã¨ã¯æ··ä¹±ã‚’æ‹›ãã€‚ã‚³ãƒ¡ãƒ³ãƒˆã§ã®æ˜ç¤ºã‚’æ¨å¥¨ã€‚

---

### [B-S-1] `TestNormalizeLogLevel` ã« "WARNING" å¤§æ–‡å­—ã‚±ãƒ¼ã‚¹ãŒæœªãƒ†ã‚¹ãƒˆ

**ãƒ•ã‚¡ã‚¤ãƒ«:** `myT-x/app_session_log_test.go` (TestNormalizeLogLevel)

"ERROR" ã¨ "DEBUG" ã®å¤§æ–‡å­—ã‚±ãƒ¼ã‚¹ã¯ãƒ†ã‚¹ãƒˆæ¸ˆã¿ã ãŒ "WARNING" ã®å¤§æ–‡å­—ã‚±ãƒ¼ã‚¹ãŒæ¬ ã‘ã¦ã„ã‚‹ã€‚
```go
{name: "WARNING uppercase normalized", input: "WARNING", expected: "warn"},
```
ã‚’è¿½åŠ ã™ã‚‹ã“ã¨ã‚’æ¨å¥¨ã€‚

---

### [B-S-2] `TestLogFrontendEvent_WritesToSessionLog` ã§ source ã®ãƒˆãƒªãƒ æ¤œè¨¼ãŒä¸è¶³

**ãƒ•ã‚¡ã‚¤ãƒ«:** `myT-x/app_session_log_test.go` (TestLogFrontendEvent_WritesToSessionLog)

production code ã® `source = strings.TrimSpace(source)` ã‚’ä»•æ§˜ã¨ã—ã¦æ¤œè¨¼ã™ã‚‹ãªã‚‰ã€ã‚¹ãƒšãƒ¼ã‚¹ä»˜ã source ã®ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹è¿½åŠ ãŒæœ›ã¾ã—ã„ã€‚

---

### [B-S-3] `TestCleanupOldInputHistory_KeepsMaxFiles` ã® `expectedAfter` ãŒãƒã‚¸ãƒƒã‚¯ãƒŠãƒ³ãƒãƒ¼

**ãƒ•ã‚¡ã‚¤ãƒ«:** `myT-x/app_input_history_test.go` (TestCleanupOldInputHistory_KeepsMaxFiles)

```go
expectedAfter: 11, // 10 created + 1 current file
```

`filesToCreate` ãŒå¤‰æ›´ã•ã‚ŒãŸå ´åˆã« `expectedAfter` ã®æ›´æ–°å¿˜ã‚ŒãŒèµ·ãã‚„ã™ã„ã€‚å¼ã¨ã—ã¦è¡¨ç¾ã™ã‚‹ã“ã¨ã‚’æ¨å¥¨:
```go
expectedAfter: tt.filesToCreate + 1, // + current file
```

---

### [B-S-4] `TestInputHistoryRingBuffer_SnapshotIndependence` ã§ãƒªãƒ³ã‚°ãƒãƒƒãƒ•ã‚¡å†…éƒ¨ã¸ã®å½±éŸ¿æœªæ¤œè¨¼

**ãƒ•ã‚¡ã‚¤ãƒ«:** `myT-x/app_input_history_test.go`

ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆé–“ã®ç‹¬ç«‹æ€§ã¯ç¢ºèªã—ã¦ã„ã‚‹ãŒã€ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆå¤‰æ›´ãŒãƒªãƒ³ã‚°ãƒãƒƒãƒ•ã‚¡å†…éƒ¨ãƒ‡ãƒ¼ã‚¿ã‚’æ›´æ–°ã—ãªã„ã“ã¨ã®æ¤œè¨¼ãŒä¸è¶³ã€‚3ã¤ç›®ã®ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆå–å¾—ã§ "original" ãŒè¿”ã‚‹ã“ã¨ã‚’ç¢ºèªã™ã¹ãã€‚

---

### [B-S-5] `TestWriteInputHistoryEntry_EmitsCorrectEvent` ã®ã‚¹ãƒ­ãƒƒãƒˆãƒªãƒ³ã‚°æš—é»™ä¾å­˜

**ãƒ•ã‚¡ã‚¤ãƒ«:** `myT-x/app_input_history_test.go`

ã€Œåˆå›ã¯ `inputHistoryLastEmit` ãŒã‚¼ãƒ­æ™‚åˆ»ã®ãŸã‚ emit ã•ã‚Œã‚‹ã€ã¨ã„ã†å‰æã«æš—é»™ä¾å­˜ã—ã¦ã„ã‚‹ã€‚
```go
a.inputHistoryLastEmit = time.Time{} // ensure emit is not throttled on first write
```
ã‚’æ˜ç¤ºçš„ã«è¨­å®šã™ã‚‹ã‚³ãƒ¡ãƒ³ãƒˆã¾ãŸã¯ã‚³ãƒ¼ãƒ‰è¿½åŠ ã‚’æ¨å¥¨ã€‚

---

### [C-S-1] `inputHistoryStore.ts` / `errorLogStore.ts` â€” Wails ç”Ÿæˆå‹ã¨ã® DRIFT ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ¬ å¦‚

**ãƒ•ã‚¡ã‚¤ãƒ«:** `myT-x/frontend/src/stores/inputHistoryStore.ts`, `errorLogStore.ts`

`types/tmux.ts` ã«ã¯ DRIFT RISK ã‚³ãƒ¡ãƒ³ãƒˆãŒã‚ã‚‹ãŒã€Store ã®ç‹¬è‡ªå‹å®šç¾©ã«ã¯å¯¾å¿œã™ã‚‹ `models.ts` ã‚¯ãƒ©ã‚¹ã¨ã®åŒæœŸæ‰‹é †ãŒè¨˜è¼‰ã•ã‚Œã¦ã„ãªã„ã€‚Go å´ã®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰è¿½åŠ æ™‚ã« Store å´ã®æ›´æ–°ãŒæ¼ã‚Œã‚‹ãƒªã‚¹ã‚¯ãŒã‚ã‚‹ã€‚

---

### [C-S-2] `fetchInputHistory` ã® retry DEV ãƒ­ã‚°ãŒ `fetchErrorLog` ã¨éå¯¾ç§°

**ãƒ•ã‚¡ã‚¤ãƒ«:** `myT-x/frontend/src/hooks/useBackendSync.ts`

`fetchErrorLog` ã®ãƒªãƒˆãƒ©ã‚¤ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«æ™‚ã«ã¯ DEV ãƒ­ã‚°ãŒå‡ºåŠ›ã•ã‚Œã‚‹ãŒã€`fetchInputHistory` ã®å¯¾å¿œç®‡æ‰€ã«ã¯ãªã„ã€‚ãƒ‡ãƒãƒƒã‚°æ™‚ã« GetInputHistory ã®å†è©¦è¡ŒæŒ™å‹•ã‚’è¿½è·¡ã§ããªã„ã€‚

---

### [C-S-3] debounce/retry å®šæ•°ã®åŒå€¤ãŒèª¬æ˜ãªã—

**ãƒ•ã‚¡ã‚¤ãƒ«:** `myT-x/frontend/src/hooks/useBackendSync.ts` (L11-14)

```typescript
const ERROR_LOG_DEBOUNCE_MS = 80;
const INPUT_HISTORY_DEBOUNCE_MS = 80;  // åŒå€¤
```

è¨­è¨ˆæ„å›³ï¼ˆç‹¬ç«‹èª¿æ•´å¯èƒ½ãªãŸã‚åˆ¥å®šæ•°ï¼‰ã‚’ã‚³ãƒ¡ãƒ³ãƒˆã§æ˜ç¤ºã™ã‚‹ã“ã¨ã‚’æ¨å¥¨:
```typescript
// Same value as ERROR_LOG_DEBOUNCE_MS â€” separate constant to allow independent tuning.
```

---

### [C-S-4] `inputHistoryStore.ts` ã¨ `errorLogStore.ts` ã®ã»ã¼å®Œå…¨ãªé‡è¤‡

**ãƒ•ã‚¡ã‚¤ãƒ«:** `myT-x/frontend/src/stores/inputHistoryStore.ts`, `errorLogStore.ts`

`isValidSeq()`, `normalizeEntries()`, `setEntries` ã®ãƒªã‚°ãƒ¬ãƒƒã‚·ãƒ§ãƒ³æ¤œå‡º/åˆå›ãƒ­ãƒ¼ãƒ‰æ—¢èª­ãƒ­ã‚¸ãƒƒã‚¯ã€`markAllRead`, unreadCount ã‚¹ã‚­ãƒ£ãƒ³ãƒ«ãƒ¼ãƒ—ãŒã»ã¼åŒä¸€ã€‚å…±é€šãƒ•ã‚¡ã‚¯ãƒˆãƒªãƒ¼é–¢æ•°ã¸ã®æŠ½è±¡åŒ–ã‚’ä¸­é•·æœŸçš„ã«æ¤œè¨ã€‚ãŸã ã—å‹ã®å·®ç•°ãŒã‚ã‚‹ãŸã‚å„ªå…ˆåº¦ã¯ä½ã„ã€‚

---

### [D-S-1] 3ã¤ä»¥ä¸Šã®é‡è¤‡ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆã§ã® `seenShortcuts` æœªæ›´æ–°ï¼ˆæ„å›³æ˜ç¤ºæ¨å¥¨ï¼‰

**ãƒ•ã‚¡ã‚¤ãƒ«:** `myT-x/frontend/src/components/settings/settingsValidation.ts` (validateViewerShortcuts)

Aãƒ»Bãƒ»C ãŒå…¨ã¦åŒã˜ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆã‚’æŒã¤å ´åˆã€`seenShortcuts` ã¯æœ€åˆã® A ã§ã®ã¿æ›´æ–°ã•ã‚Œã€B ãŠã‚ˆã³ C ã¯å…¨ã¦ã€ŒA ã¨ã®é‡è¤‡ã€ã¨ã—ã¦æ¤œå‡ºã•ã‚Œã‚‹ã€‚æ©Ÿèƒ½çš„ã«ã¯å…¨å“¡ã‚¨ãƒ©ãƒ¼ãŒå‡ºã‚‹ãŸã‚å‹•ä½œã¯æ­£ã—ã„ãŒã€ã‚³ãƒ¡ãƒ³ãƒˆã§æ„å›³ã‚’æ˜è¨˜ã™ã‚‹ã“ã¨ã‚’æ¨å¥¨:
```typescript
} else {
    // Register first-seen viewId; subsequent duplicates will reference this entry.
    seenShortcuts.set(normalized, viewId);
}
```

---

### [D-S-2] JSDoc ã‚³ãƒ¡ãƒ³ãƒˆå†…ã®ã‚°ãƒ­ãƒ–ãƒ‘ã‚¿ãƒ¼ãƒ³ãŒã‚³ãƒ¡ãƒ³ãƒˆã‚’æ—©æœŸã«é–‰ã˜ã‚‹å¯èƒ½æ€§

**ãƒ•ã‚¡ã‚¤ãƒ«:** `myT-x/frontend/src/components/settings/ViewerShortcutSettings.tsx` (L6-8)

```typescript
/** ...
 *  SYNC: viewId values must match view registrations in components/viewer/views/*/index.ts
* /
```

`views/*/index.ts` ã® `*/` ãŒ JSDoc ã‚³ãƒ¡ãƒ³ãƒˆçµ‚äº†ãƒˆãƒ¼ã‚¯ãƒ³ã¨ã—ã¦èªè­˜ã•ã‚Œã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ï¼ˆç¾çŠ¶ã¯ã‚¹ãƒšãƒ¼ã‚¹ã§å›é¿ã•ã‚Œã¦ã„ã‚‹ãŒæ„å›³ãŒä¸æ˜ç¢ºï¼‰ã€‚ãƒãƒƒã‚¯ãƒ†ã‚£ãƒƒã‚¯ã‚„ã‚³ãƒ¼ãƒ‰ãƒ–ãƒ­ãƒƒã‚¯ã§æ˜ç¤ºã™ã‚‹ã“ã¨ã‚’æ¨å¥¨ã€‚

---

### [D-S-3] ãƒãƒƒã‚¸è¡¨ç¤ºã® `view.id` ãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‰

**ãƒ•ã‚¡ã‚¤ãƒ«:** `myT-x/frontend/src/components/viewer/ActivityStrip.tsx` (ç´„L39-44)

```tsx
{view.id === "error-log" && unreadCount > 0 && (...)}
{view.id === "input-history" && inputHistoryUnreadCount > 0 && (...)}
```

ãƒãƒƒã‚¸ã‚’æŒã¤æ–°ã—ã„ãƒ“ãƒ¥ãƒ¼ãŒè¿½åŠ ã•ã‚Œã‚‹ãŸã³ã« ActivityStrip.tsx ã®ä¿®æ­£ã€å¯¾å¿œ Store ã® import è¿½åŠ ã€useCallback ã®ä¾å­˜é…åˆ—ã¸ã®è¿½åŠ ã®3ç‚¹ãŒå¿…è¦ã«ãªã‚‹è¨­è¨ˆã€‚`ViewPlugin` ã« `getBadgeCount?: () => number` ã®ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ã‚’è¿½åŠ ã™ã‚‹ã“ã¨ã§è²¬ä»»ã‚’åˆ†é›¢ã§ãã‚‹ã€‚

---

### [D-S-4] `defaultShortcut` ã¨ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã®ä¹–é›¢ãƒªã‚¹ã‚¯

**ãƒ•ã‚¡ã‚¤ãƒ«:** `myT-x/frontend/src/components/settings/ViewerShortcutSettings.tsx`

`VIEWER_SHORTCUTS[].defaultShortcut` ã¯ UI ã® placeholder è¡¨ç¤ºã«ã®ã¿ä½¿ã‚ã‚Œã¦ãŠã‚Šã€å®Ÿéš›ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã¯ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ Go ã‚³ãƒ¼ãƒ‰ãŒä¿æŒã—ã¦ã„ã‚‹ã€‚ä¸¡è€…ã®ä¹–é›¢ãŒã‚µã‚¤ãƒ¬ãƒ³ãƒˆã«ç™ºç”Ÿã—å¾—ã‚‹ã€‚å°†æ¥çš„ã«ã¯ `GetConfig()` ã§ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã‚’å–å¾—ã™ã‚‹ã“ã¨ã‚’æ¤œè¨ã€‚

---

### [D-S-5] `ErrorBoundary.tsx` ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒ `getDerivedStateFromError` ã¨ `componentDidCatch` ã§ä¸ä¸€è‡´

**ãƒ•ã‚¡ã‚¤ãƒ«:** `myT-x/frontend/src/components/ErrorBoundary.tsx` (L21 vs L28)

```typescript
// getDerivedStateFromError (UIè¡¨ç¤º)
String(error ?? "Unknown error")

// componentDidCatch (ãƒ­ã‚°è¨˜éŒ²)
String(error ?? "Unknown React error")
```

åŒä¸€ã‚¨ãƒ©ãƒ¼ã§ UI ã¨ãƒ­ã‚°ã®å†…å®¹ãŒä¹–é›¢ã™ã‚‹ã€‚å…±é€šå®šæ•°ã¾ãŸã¯å…±é€šé–¢æ•°ã«æŠ½å‡ºã—ã¦çµ±ä¸€ã‚’æ¨å¥¨ã€‚

---

## Strengthsï¼ˆè‰¯ã„å®Ÿè£…ï¼‰

1. **ãƒ­ãƒƒã‚¯è¨­è¨ˆã®æ˜ç¤ºåŒ–** â€” `app.go` ã®ã‚³ãƒ¡ãƒ³ãƒˆã«ãƒ­ãƒƒã‚¯ç‹¬ç«‹æ€§ã¨ `lock ordering` ãŒæ˜è¨˜ã•ã‚Œã¦ãŠã‚Šã€ãƒ‡ãƒƒãƒ‰ãƒ­ãƒƒã‚¯é˜²æ­¢ãŒè¨­è¨ˆãƒ¬ãƒ™ãƒ«ã§ä¿è¨¼ã•ã‚Œã¦ã„ã‚‹
2. **fsync çœç•¥ã®è¨­è¨ˆåˆ¤æ–­** â€” `writeInputHistoryEntry` ã§ã®fsyncçœç•¥ã«ã¤ã„ã¦ã€session log ã¨ã®å¯¾æ¯”ã‚’å«ã‚€è©³ç´°ãªã‚³ãƒ¡ãƒ³ãƒˆãŒè¨˜è¼‰ã•ã‚Œã¦ã„ã‚‹ï¼ˆé«˜é »åº¦ãƒ»éã‚¯ãƒªãƒ†ã‚£ã‚«ãƒ«ãªãƒ‡ãƒ¼ã‚¿ã«å¯¾ã™ã‚‹é©åˆ‡ãªãƒˆãƒ¬ãƒ¼ãƒ‰ã‚ªãƒ•ï¼‰
3. **ã‚¿ã‚¤ãƒãƒ¼ä¸–ä»£ç•ªå·** â€” `timerGen` ã«ã‚ˆã‚‹äºŒé‡ãƒ•ãƒ©ãƒƒã‚·ãƒ¥é˜²æ­¢ãŒæ­£ã—ãå®Ÿè£…ã•ã‚Œã¦ãŠã‚Šã€ã‚¿ã‚¤ãƒãƒ¼ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ã® stale çŠ¶æ…‹ã‚’å®‰å…¨ã«å‡¦ç†ã§ãã¦ã„ã‚‹
4. **ping-only ã‚¤ãƒ™ãƒ³ãƒˆãƒ¢ãƒ‡ãƒ«** â€” `app:input-history-updated` ãŒ payload ãªã—ã® ping ã§ã€ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ãŒ `GetInputHistory()` ã‚’ãƒ•ã‚§ãƒƒãƒã™ã‚‹ãƒ¢ãƒ‡ãƒ«ã¯ãƒ‡ãƒ¼ã‚¿ãƒ­ã‚¹ã‚’é˜²ãè‰¯ã„è¨­è¨ˆ
5. **ãƒ«ãƒ¼ãƒ³å®‰å…¨ãªåˆ‡ã‚Šè©°ã‚** â€” `LogFrontendEvent` ã§ã® `[]rune(msg)[:maxLen]` ã«ã‚ˆã‚‹ãƒãƒ«ãƒãƒã‚¤ãƒˆå®‰å…¨ãªåˆ‡ã‚Šè©°ã‚ãŒæ­£ã—ãå®Ÿè£…ã•ã‚Œã¦ã„ã‚‹
6. **ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸** â€” `app_input_history_test.go` ãŒ ring bufferã€ãƒ•ã‚¡ã‚¤ãƒ«I/Oã€ãƒ©ã‚¤ãƒ³å‡¦ç†ã€ã‚¿ã‚¤ãƒãƒ¼ãƒ•ãƒ©ãƒƒã‚·ãƒ¥ã€ä¸¦è¡Œå®‰å…¨æ€§ã¾ã§åºƒãã‚«ãƒãƒ¼ã—ã¦ã„ã‚‹
7. **HMR å¯¾å¿œ** â€” `Symbol.for("mytx.global.error.handlers")` ã«ã‚ˆã‚‹ã‚°ãƒ­ãƒ¼ãƒãƒ«ãƒãƒ³ãƒ‰ãƒ©ãƒ¼ã®äºŒé‡ç™»éŒ²é˜²æ­¢ã¯ Vite HMR ç’°å¢ƒã§æ­£ã—ãæ©Ÿèƒ½ã™ã‚‹
8. **Go ãƒ¢ãƒ€ãƒ³åŒ–** â€” `strings.SplitSeq`, `strings.CutPrefix`, `for i := range N`, `//go:fix inline` ãªã© Go 1.22+/1.24 ã® best practice ãŒä¸€è²«ã—ã¦é©ç”¨ã•ã‚Œã¦ã„ã‚‹
9. **ViewerShortcuts ã® Config å®Ÿè£…** â€” `omitempty`, æ·±ã„ã‚³ãƒ”ãƒ¼ (`maps.Copy`), ãƒ©ã‚¦ãƒ³ãƒ‰ãƒˆãƒªãƒƒãƒ—ãƒ†ã‚¹ãƒˆãŒæƒã£ã¦ãŠã‚Šã€è¨­å®šé …ç›®è¿½åŠ ã®æ‰‹é †ãŒæ­£ã—ãè¸ã¾ã‚Œã¦ã„ã‚‹
10. **ã‚¤ãƒ³ãƒ—ãƒƒãƒˆå…¥åŠ›æ¬„ `inputHistory` ãƒãƒƒã‚¸ã® unread è¿½è·¡** â€” `lastReadSeq` ã‚’ä½¿ã£ãŸæ—¢èª­ç®¡ç†ã§åˆå›ãƒ­ãƒ¼ãƒ‰ã‚’ã€Œæ—¢èª­ã€æ‰±ã„ã«ã™ã‚‹è¨­è¨ˆãŒé©åˆ‡ã§ã€ä¸è¦ãªã€Œæœªèª­ã‚ã‚Šã€è¡¨ç¤ºã‚’é˜²ã„ã§ã„ã‚‹

---

## PR Review Summary

| é‡å¤§åº¦ | ä»¶æ•° |
|-------|------|
| Critical | **0** |
| Important | **9** |
| Suggestion | **16** |

---

## ã‚¿ã‚¹ã‚¯ä¸€è¦§ã¨ä¸¦åˆ—ä½œæ¥­å¯å¦ãƒãƒˆãƒªã‚¯ã‚¹

ä»¥ä¸‹ã®è¡¨ã¯ã€ç™ºè¦‹ã•ã‚ŒãŸå…¨ Important/Suggestion ã‚¿ã‚¹ã‚¯ã«ã¤ã„ã¦ã€ä½œæ¥­è€…è¦–ç‚¹ã§ã€Œä½•ã‚’ä¿®æ­£ã™ã‚Œã°è‰¯ã„ã‹ã€ã€Œä»–ã®ã‚¿ã‚¹ã‚¯ã¨åŒæ™‚ã«ä½œæ¥­ã§ãã‚‹ã‹ã€ã‚’ç¤ºã—ã¦ã„ã¾ã™ã€‚

### å‡¡ä¾‹
- âœ… **ä¸¦åˆ—OK** â€” ä»–ã®ã‚¿ã‚¹ã‚¯ã¨åŒæ™‚ã«ä½œæ¥­å¯èƒ½
- âš ï¸ **è¦èª¿æ•´** â€” é–¢é€£ã‚¿ã‚¹ã‚¯ã¨åŒæ™‚ã«ä½œæ¥­ã™ã‚‹ã¨ç«¶åˆã®å¯èƒ½æ€§ï¼ˆèª¿æ•´ãŒå¿…è¦ï¼‰
- ğŸ”— **ä¾å­˜ã‚ã‚Š** â€” å…ˆã«å®Œäº†ã™ã¹ãåˆ¥ã‚¿ã‚¹ã‚¯ãŒã‚ã‚‹

---

### Important ã‚¿ã‚¹ã‚¯ä¸€è¦§

| ID | å¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ« | ä¿®æ­£å†…å®¹ | ä¸¦åˆ—å¯å¦ | å‚™è€ƒ |
|----|------------|---------|---------|------|
| **A-I-1** | `app_input_history.go` | `recordInput` ã§æ—¢å­˜ lb ã® source/session ã‚’æœ€æ–°å€¤ã§æ›´æ–° | âœ… ä¸¦åˆ—OK | ç‹¬ç«‹ã—ãŸå°ä¿®æ­£ |
| **A-I-2** | `app_input_history.go` | `cleanupOldInputHistory` ã®ã‚½ãƒ¼ãƒˆã‚’ ModTime ã¾ãŸã¯ ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—éƒ¨åˆ†ã®ã¿ã«å¤‰æ›´ | âš ï¸ A-I-3ã¨åŒæ™‚ä¸å¯ | åŒã˜é–¢æ•°ã‚’ä¿®æ­£ã™ã‚‹ãŸã‚èª¿æ•´ãŒå¿…è¦ |
| **A-I-3** | `app_input_history.go` | å‰Šé™¤å¤±æ•—æ™‚ã®ä»•æ§˜ã‚’æ˜ç¤ºã‚³ãƒ¡ãƒ³ãƒˆè¿½åŠ ï¼ˆã¾ãŸã¯ `app_session_log.go` åŒç®‡æ‰€ã‚‚åˆã‚ã›ã¦ï¼‰ | âš ï¸ A-I-2ã¨åŒæ™‚ä¸å¯ | åŒã˜é–¢æ•°ã‚’ä¿®æ­£ã™ã‚‹ãŸã‚èª¿æ•´ãŒå¿…è¦ |
| **B-I-1** | `app_session_api_test.go` | `testutil.Ptr` ã‚’ `boolPtrTest` ã¾ãŸã¯ ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³åŒ– (`go fix ./...`) | âœ… ä¸¦åˆ—OK | `go fix ./...` ã§ä¸€æ‹¬å‡¦ç†å¯èƒ½ |
| **B-I-2** | `app_input_history_test.go` | `TestFlushAllLineBuffers_PersistsPendingBuffers` ã« paneID/input ã®å€‹åˆ¥æ¤œè¨¼ã‚’è¿½åŠ  | âœ… ä¸¦åˆ—OK | ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã®ã¿ã®å¤‰æ›´ |
| **B-I-3** | `app_input_history_test.go` | ã‚«ãƒ¬ãƒ³ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ä¿æŒãƒ»æœ€å¤å‰Šé™¤ã®å°‚ç”¨ãƒ†ìŠ¤ãƒˆè¿½åŠ  | âœ… ä¸¦åˆ—OK | ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã®ã¿ã€B-I-2ã¨åŒä¸€ãƒ•ã‚¡ã‚¤ãƒ«ã ãŒç®‡æ‰€ãŒç‹¬ç«‹ |
| **C-I-1** | `main.tsx`, `ErrorBoundary.tsx` | `api.LogFrontendEvent` å‘¼ã³å‡ºã—ã‚’ `try-catch` ã§ãƒ©ãƒƒãƒ—ï¼ˆ3ç®‡æ‰€ï¼‰ | âœ… ä¸¦åˆ—OK | ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã®ç‹¬ç«‹ã—ãŸä¿®æ­£ |
| **D-I-1** | `settingsValidation.ts`, `ViewerShortcutSettings.tsx` | `VIEWER_SHORTCUTS` ã‚’ `viewerShortcutConstants.ts` (ã¾ãŸã¯ `constants.ts`) ã«ç§»å‹• | âš ï¸ D-I-2å‰å¾Œã‚’ç¢ºèª | æ–°ãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆã‚’ä¼´ã†ã€‚importã®å¤‰æ›´ãŒé€£é–ã™ã‚‹ãŒå¤‰æ›´é‡ã¯å°‘ãªã„ |
| **D-I-2** | `ActivityStrip.tsx`, `ViewerSystem.tsx`, `viewerRegistry.ts` | `resolveEffectiveShortcut` ãƒ˜ãƒ«ãƒ‘ãƒ¼ã‚’ `viewerRegistry.ts` ã«è¿½åŠ ã—2ç®‡æ‰€ã§å…±ç”¨ | âœ… ä¸¦åˆ—OK | D-I-1ã¨ç‹¬ç«‹ã€‚ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã®ã¿ |

---

### Suggestion ã‚¿ã‚¹ã‚¯ä¸€è¦§ï¼ˆå¯¾å¿œæ¨å¥¨é †ï¼‰

| ID | å¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ« | ä¿®æ­£å†…å®¹ | ä¸¦åˆ—å¯å¦ | å‚™è€ƒ |
|----|------------|---------|---------|------|
| **A-S-1** | `app_input_history.go` | C1åˆ¶å¾¡æ–‡å­—ãƒ•ã‚£ãƒ«ã‚¿è¿½åŠ  (`processInputString`) | âœ… ä¸¦åˆ—OK | ç‹¬ç«‹ã€‚A-I-1/2/3ã¨ç„¡é–¢ä¿‚ |
| **A-S-2** | `app_input_history.go` | `flushLineBuffer` ã‚’ `defer` + ãƒ­ãƒ¼ã‚«ãƒ«å¤‰æ•°ãƒ‘ã‚¿ãƒ¼ãƒ³ã«ãƒªãƒ•ã‚¡ã‚¯ã‚¿ | âœ… ä¸¦åˆ—OK | A-I-1/3ã¨åŒä¸€ãƒ•ã‚¡ã‚¤ãƒ«ã ãŒé–¢æ•°ã¯åˆ†é›¢ |
| **A-S-3** | `app_input_history.go` | `flushLineBuffer` ã® `gen=0` ã‚±ãƒ¼ã‚¹ã§ `lb.timer.Stop()` è¿½åŠ  | âœ… ä¸¦åˆ—OK | A-S-2 ã¨åŒé–¢æ•°ã®ãŸã‚åŒæ™‚ã«å®Ÿæ–½ã‚’æ¨å¥¨ |
| **A-S-4** | `app_input_history.go`, `app_session_log.go` | `sort.Strings` â†’ `slices.Sort` | âœ… ä¸¦åˆ—OK | æ©Ÿæ¢°çš„ãªå¤‰æ›´ |
| **A-S-5** | `app_devpanel_api.go` | `ok0` â†’ `found` ã«ãƒªãƒãƒ¼ãƒ ï¼ˆ2ç®‡æ‰€ï¼‰ | âœ… ä¸¦åˆ—OK | ç‹¬ç«‹ã—ãŸå¤‰æ•°åå¤‰æ›´ |
| **A-S-6** | `app.go`, `app_input_history.go` | lazy/eager åˆæœŸåŒ–ã®éå¯¾ç§°ã‚’ã‚³ãƒ¡ãƒ³ãƒˆã§æ˜ç¤º | âœ… ä¸¦åˆ—OK | ã‚³ãƒ¡ãƒ³ãƒˆè¿½åŠ ã®ã¿ |
| **B-S-1** | `app_session_log_test.go` | `TestNormalizeLogLevel` ã« "WARNING" å¤§æ–‡å­—ã‚±ãƒ¼ã‚¹è¿½åŠ  | âœ… ä¸¦åˆ—OK | ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹1è¡Œè¿½åŠ  |
| **B-S-2** | `app_session_log_test.go` | ã‚¹ãƒšãƒ¼ã‚¹ä»˜ã source ã®ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹è¿½åŠ  | âœ… ä¸¦åˆ—OK | B-S-1ã¨åŒä¸€ãƒ•ã‚¡ã‚¤ãƒ«ã ãŒè¡Œã¯ç‹¬ç«‹ |
| **B-S-3** | `app_input_history_test.go` | `expectedAfter: 11` â†’ `expectedAfter: tt.filesToCreate + 1` | âœ… ä¸¦åˆ—OK | 1è¡Œå¤‰æ›´ |
| **B-S-4** | `app_input_history_test.go` | `TestInputHistoryRingBuffer_SnapshotIndependence` ã« 3ã¤ç›®ã® snapshot ãƒ†ã‚¹ãƒˆè¿½åŠ  | âœ… ä¸¦åˆ—OK | ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹è¿½åŠ  |
| **B-S-5** | `app_input_history_test.go` | `TestWriteInputHistoryEntry_EmitsCorrectEvent` ã« `a.inputHistoryLastEmit = time.Time{}` è¿½åŠ  | âœ… ä¸¦åˆ—OK | 1è¡Œè¿½åŠ  |
| **C-S-1** | `inputHistoryStore.ts`, `errorLogStore.ts` | Wails ç”Ÿæˆå‹ã¨ã® DRIFT ã‚³ãƒ¡ãƒ³ãƒˆè¿½åŠ  | âœ… ä¸¦åˆ—OK | ã‚³ãƒ¡ãƒ³ãƒˆè¿½åŠ ã®ã¿ |
| **C-S-2** | `useBackendSync.ts` | `fetchInputHistory` retry ã‚±ãƒ¼ã‚¹ã« DEV ãƒ­ã‚°è¿½åŠ  | âœ… ä¸¦åˆ—OK | æ•°è¡Œè¿½åŠ  |
| **C-S-3** | `useBackendSync.ts` | debounce å®šæ•°ã«è¨­è¨ˆæ„å›³ã‚³ãƒ¡ãƒ³ãƒˆè¿½åŠ  | âœ… ä¸¦åˆ—OK | ã‚³ãƒ¡ãƒ³ãƒˆè¿½åŠ ã®ã¿ |
| **C-S-4** | *(å°†æ¥å¯¾å¿œ)* | `createSeqStore` ãƒ•ã‚¡ã‚¯ãƒˆãƒªãƒ¼æŠ½è±¡åŒ– | ğŸ”— ç‹¬ç«‹ã‚¿ã‚¹ã‚¯ | å„ªå…ˆåº¦ä½ã€‚C-S-1å®Œäº†å¾Œã«æ¤œè¨ |
| **D-S-1** | `settingsValidation.ts` | `validateViewerShortcuts` ã® `seenShortcuts` è¨­è¨ˆæ„å›³ã‚³ãƒ¡ãƒ³ãƒˆè¿½åŠ  | âœ… ä¸¦åˆ—OK | 1è¡Œã‚³ãƒ¡ãƒ³ãƒˆè¿½åŠ  |
| **D-S-2** | `ViewerShortcutSettings.tsx` | JSDoc ã®ã‚°ãƒ­ãƒ–ãƒ‘ã‚¿ãƒ¼ãƒ³ä¿®æ­£ | âœ… ä¸¦åˆ—OK | ã‚³ãƒ¡ãƒ³ãƒˆä¿®æ­£ã®ã¿ |
| **D-S-3** | `ActivityStrip.tsx`, `viewerRegistry.ts` | ãƒãƒƒã‚¸è¡¨ç¤ºã‚’ `getBadgeCount?: () => number` ã§æ±ç”¨åŒ– | âš ï¸ D-I-2ã¨èª¿æ•´ | æ‹¡å¼µçš„å¤‰æ›´ã€‚æ¬¡ã® View è¿½åŠ ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§å®Ÿæ–½ã§ã‚‚å¯ |
| **D-S-4** | *(å°†æ¥å¯¾å¿œ)* | ViewerShortcuts ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã‚’ API çµŒç”±ã§å–å¾— | ğŸ”— ç‹¬ç«‹ã‚¿ã‚¹ã‚¯ | å„ªå…ˆåº¦ä½ã€‚ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰APIå¤‰æ›´ã‚’ä¼´ã† |
| **D-S-5** | `ErrorBoundary.tsx` | `getDerivedStateFromError` ã¨ `componentDidCatch` ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸çµ±ä¸€ | âœ… ä¸¦åˆ—OK | C-I-1ã¨åŒä¸€ãƒ•ã‚¡ã‚¤ãƒ«ã€‚C-I-1ã¨åŒæ™‚ã«å®Ÿæ–½æ¨å¥¨ |

---

## Recommended Action Plan

### Phase 1: æœ€å„ªå…ˆï¼ˆãƒãƒ¼ã‚¸å‰ã«å¯¾å¿œï¼‰

1. **[A-I-1]** `recordInput` ã® source/session æ›´æ–°æ¼ã‚Œä¿®æ­£
2. **[A-I-2] + [A-I-3]** `cleanupOldInputHistory` ã®ã‚½ãƒ¼ãƒˆæ”¹å–„ã¨ã‚³ãƒ¡ãƒ³ãƒˆè¿½åŠ ï¼ˆåŒé–¢æ•°ã®å¤‰æ›´ã®ãŸã‚1ã‚»ãƒƒãƒˆï¼‰
3. **[D-I-1]** `VIEWER_SHORTCUTS` ã‚’ç‹¬ç«‹ãƒ•ã‚¡ã‚¤ãƒ«ã¸ç§»å‹•ï¼ˆå¾ªç’°ä¾å­˜è§£æ¶ˆï¼‰
4. **[C-I-1]** `api.LogFrontendEvent` å‘¼ã³å‡ºã—ã‚’ try-catch ã§ãƒ©ãƒƒãƒ—ï¼ˆ3ç®‡æ‰€ï¼‰

### Phase 2: æ¨å¥¨ï¼ˆé«˜å“è³ªç¶­æŒã®ãŸã‚å¯¾å¿œï¼‰

5. **[B-I-1]** `go fix ./...` ã§ `testutil.Ptr` ã‚’ã‚¤ãƒ³ãƒ©ã‚¤ãƒ³åŒ–
6. **[B-I-2] + [B-I-3]** ãƒ†ã‚¹ãƒˆã®æ¤œè¨¼å¼·åŒ–ï¼ˆåŒä¸€ãƒ•ã‚¡ã‚¤ãƒ«ã®ãŸã‚1ã‚»ãƒƒãƒˆï¼‰
7. **[D-I-2]** `resolveEffectiveShortcut` ãƒ˜ãƒ«ãƒ‘ãƒ¼ã§é‡è¤‡è§£æ¶ˆ

### Phase 3: Suggestionsï¼ˆéšæ™‚å¯¾å¿œï¼‰

- **[A-S-2] + [A-S-3]**: `flushLineBuffer` ãƒªãƒ•ã‚¡ã‚¯ã‚¿ï¼ˆåŒä¸€é–¢æ•°ã®ãŸã‚ã‚»ãƒƒãƒˆï¼‰
- **[A-S-4]**: `sort.Strings` â†’ `slices.Sort`ï¼ˆæ©Ÿæ¢°çš„å¤‰æ›´ï¼‰
- **[A-S-5]**: `ok0` â†’ `found` ãƒªãƒãƒ¼ãƒ ï¼ˆ2ç®‡æ‰€ï¼‰
- **[D-S-5] + [C-I-1]**: ErrorBoundary ã®ä¿®æ­£ã¯åŒæ™‚å¯¾å¿œæ¨å¥¨
- ã‚³ãƒ¡ãƒ³ãƒˆè¿½åŠ ç³»ï¼ˆA-S-1, A-S-6, B-S-1ã€œ5, C-S-1ã€œ3, D-S-1ã€œ2ï¼‰ã¯éšæ™‚

---

*Generated by parallel review (4 agents: Go Backend, Go Tests/Config, Frontend Core, Frontend UI)*
