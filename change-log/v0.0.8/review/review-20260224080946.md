# コミット前レビュー: myT-x 差分全体

**日時**: 2026-02-24 08:09:46  
**レビュー対象**: myT-x/ 配下の全変更ファイル（新規・修正・削除）  
**手法**: カテゴリ別並列レビュー（5カテゴリ）

---

## 変更概要

| 新機能 | 概要 |
|--------|------|
| Input History | ターミナル入力の記録・JSONL永続化・フロントエンド表示 |
| Viewer Shortcuts | ビューア別カスタムキーボードショートカット（config.yaml保存） |
| Frontend Error Logging | LogFrontendEvent Wailsバインディング + logFrontendEventSafe + ErrorBoundary |

---

## カテゴリ別レビュー結果

### カテゴリ1: Go バックエンド新規実装

#### [BUG] #1: cleanupOldSessionLogs のソート方向が逆（重大バグ）

**ファイル**: `myT-x/app_session_log.go`

```go
// 現在の実装（バグあり）
if leftOK != rightOK {
    return leftOK   // ← leftOK=true の場合 true を返す = 正規ファイルを先に削除！
}

// inputHistory の正しい実装（参照）
if leftOK != rightOK {
    return !leftOK  // ← leftOK=false（=ゴミファイル）を先に削除 ✓
}
```

`inputHistory` 側の `cleanupOldInputHistory` は `return !leftOK` が正しい実装（ゴミファイルを先に削除）。`cleanupOldSessionLogs` は `return leftOK` となっており、正規ファイルを先に削除してしまう。上限到達時に保持すべきセッションログが消える。

**修正**: `return leftOK` → `return !leftOK`

---

#### [BUG] #2: processInputString で DCS/SOS/PM/APC のシーケンス本体が通過する

**ファイル**: `myT-x/app_input_history.go`

```go
// ESC ハンドラの default: ブランチ
default:
    s.state = stateNormal
    // ← stateNormal に戻るだけで、シーケンス後続バイトが次の処理で出力される
```

DCS (`\x1bP`)、SOS (`\x1bX`)、PM (`\x1b^`)、APC (`\x1b_`) のシーケンスは ST (`\x1b\\`) で終端するまで本体バイトをスキップする必要があるが、現在は `default:` ブランチで `stateNormal` に戻るため、後続のシーケンス本体が通常文字として `inp` に追加される。

**修正例**:
```go
case stateEsc:
    switch b {
    case 'P', 'X', '^', '_':
        s.state = stateDCS // ST (\x1b\\) まで読み飛ばす新ステート
    // ...
    }
```

---

#### [PERF] #3: バックスペース時の O(N) strings.Builder 再構築

**ファイル**: `myT-x/app_input_history.go`

バックスペース (`\x08`, `\x7f`) 処理で毎回 `strings.Builder` を再構築しており、N 文字バッファに対して O(N) アロケーションが発生する。ターミナルでのコマンド編集時は多数のバックスペースが連続するため、ホットパスでの問題になりうる。

**修正案**: rune スライスでバッファを管理し、末尾 pop で O(1) に。

```go
// strings.Builder の代わりに []rune を使用
type inputLineBuffer struct {
    buf     []rune  // strings.Builder の代替
    // ...
}

// バックスペース時
if len(lb.buf) > 0 {
    lb.buf = lb.buf[:len(lb.buf)-1]
}
```

---

#### [CONCURRENCY] #4: シャットダウン時の recordInput でタイマーが閉じたファイルに書き込む

**ファイル**: `myT-x/app_input_history.go`

`closeInputHistory()` 後に残留タイマーが起動し `flushLineBuffer()` → `writeInputHistoryEntry()` を呼ぶ可能性がある。`writeInputHistoryEntry` 内で `w == nil` チェックはあるが、`closeInputHistory` でファイルを `nil` にする前にタイマーが起動した場合は書き込みが発生する。

現状ではエントリが失われるだけで実害は小さいが、`shuttingDown` フラグか `context.Context` での制御を推奨する。

---

#### [SUGGESTION] #5: LogFrontendEvent の rune カウント時に不要アロケーション

**ファイル**: `myT-x/app_session_log.go`

```go
// 現在
runes := []rune(msg)
if len(runes) > maxMsgRunes { ... }

// 修正案（アロケーションゼロ）
if utf8.RuneCountInString(msg) > maxMsgRunes {
    // 切り詰め
    runes := []rune(msg)
    msg = string(runes[:maxMsgRunes])
}
```

制限未満のメッセージ（多数派）でも `[]rune` を生成している。`utf8.RuneCountInString` でチェック後、超過時のみ変換する。

---

#### [SUGGESTION] #6: source 更新条件が冗長

**ファイル**: `myT-x/app_input_history.go`

```go
// 現在
if source != "" || lb.source == "" { lb.source = source }

// 修正案（意図が明確）
if source != "" { lb.source = source }
```

`lb.source == ""` のケースは `source != ""` が false の時のみ効く (`source == ""` のまま代入) が、これは `lb.source = ""` への上書きで意味がない。

---

#### [SUGGESTION] #7: isAllDecimalDigits が strconv.Atoi と二重ロジック

**ファイル**: `myT-x/app_input_history.go`

`parseInputHistoryFileName` で `isAllDecimalDigits` チェックしてから `strconv.Atoi` している。`strconv.Atoi` のエラーハンドリングだけで十分。

---

#### [SUGGESTION] #8: pendingEntry struct が2箇所に重複

**ファイル**: `myT-x/app_input_history.go`

`recordInput` と `flushAllLineBuffers` の双方でほぼ同一構造の `pendingEntry` 相当のローカル変数群がある。共通の named struct として切り出せる。

---

### カテゴリ2: Go テストファイル

#### [CRITICAL] #9: `new(v)` は Go 仕様違反（testutil/helpers.go）

**ファイル**: `myT-x/internal/testutil/helpers.go:18`

```go
// 現在（仕様違反）
func Ptr[T any](v T) *T { return new(v) }

// 正しい実装
func Ptr[T any](v T) *T { return &v }
```

`new()` は型（type）を引数に取る組み込み関数。変数 `v` を渡すと「`v` の型 `T` の zero value へのポインタ」を返す偶然の動作となり、`v` の値が無視される。現状のテストは `Ptr(42)` が `0` を指すポインタを返し、テストが誤った値で通過している可能性がある。即時修正必須。

---

#### [CRITICAL] #10: `//go:fix inline` ディレクティブの重複

**ファイル**: `myT-x/internal/testutil/helpers.go:16-17`

```go
//go:fix inline
//go:fix inline  ← コピペミス
func Ptr[T any](v T) *T { return new(v) }
```

コンパイルエラーにはならないが混乱を招くコピペミス。1行に削減。

---

#### [CRITICAL] #11: `boolPtrTest` 関数が定義されているが未使用

**ファイル**: `myT-x/app_session_api_test.go:39`（他ファイルにも同様）

```go
func boolPtrTest(b bool) *bool { ... }
```

定義されているが `nil` チェック等で一切呼ばれていない。dead code として削除推奨。Goの `go vet` で検出可能。

---

#### [CRITICAL] #12: `new(true)` / `new(false)` の直接使用（10箇所以上）

**影響ファイル**: 複数の `*_test.go`

```go
// 危険なパターン（10箇所以上）
new(true)   // → bool の zero value (*false) を返す！ true ではない
new(false)  // → bool の zero value (*false) を返す

// 正しい使用方法
testutil.Ptr(true)   // v=true の *bool
testutil.Ptr(false)  // v=false の *bool
```

しかし上記 #9 のバグにより `Ptr(true)` も `false` を返す。`new(v)` バグ修正と同時に全置換が必要。

**修正手順**:
1. `helpers.go` の `return new(v)` → `return &v` に修正
2. 全テストの `new(true)` / `new(false)` → `testutil.Ptr(true)` / `testutil.Ptr(false)` に置換

---

#### [IMPORTANT] #13: TestNormalizeLogLevel に "WARNING" の大文字ケースが欠落

**ファイル**: `myT-x/app_session_log_test.go`

現在のテストケース: `"warn"`, `"warning"`, `"Warn"`, `"Warning"` はあるが `"WARNING"` がない。`normalizeLogLevel` の `strings.EqualFold` 実装上は通るが、テーブル駆動テストの網羅性として追加すべき。

---

#### [IMPORTANT] #14: セッションログの切り詰めテストが `initSessionLog()` を呼ばない

**ファイル**: `myT-x/app_session_log_test.go`

トランケーションテストが `initSessionLog()` を呼ばずにファイル書き込みパスをテストしているため、実際の書き込み経路が検証されていない。

---

#### [SUGGESTION] #15: TestLoadViewerShortcuts に空マップケースが欠落

**ファイル**: `myT-x/app_config_state_test.go`

`viewer_shortcuts: {}` の空マップケースを追加。

---

#### [SUGGESTION] #16: TestResolveSessionNameForPane に複数セッションシナリオが欠落

**ファイル**: `myT-x/app_pane_api_test.go`

ペインが複数セッションに属するシナリオのテストを追加。

---

### カテゴリ3: フロントエンド コア

#### [MEDIUM] #17: ErrorBoundary のリトライに上限がない

**ファイル**: `myT-x/frontend/src/components/ErrorBoundary.tsx`

永続的エラーがある場合、「再試行」ボタンを押すたびに `logFrontendEventSafe` が呼ばれ続ける。リトライカウンタ（例: 3回）を設け、超過後はリトライボタンを非表示にする。

```typescript
// 修正例
state = { hasError: false, retryCount: 0 };

handleReset = () => {
    if (this.state.retryCount >= 3) return;
    this.setState(s => ({ hasError: false, retryCount: s.retryCount + 1 }));
};
```

---

#### [LOW] #18: fetchInputHistory のキャッチブロックに DEV ログがない

**ファイル**: `myT-x/frontend/src/hooks/useBackendSync.ts`

`fetchErrorLog` には `console.warn` があるが、`fetchInputHistory` の `catch` ブロックには同等の DEV ログがない。非対称で、デバッグ時に問題が見えにくい。

---

#### [LOW] #19: logFrontendEventSafe の msg にクライアント側長さ制限がない

**ファイル**: `myT-x/frontend/src/utils/logFrontendEventSafe.ts`

Go 側でサーバー側トランケーション処理はあるが、クライアント側でも長大メッセージの早期切り詰めを行うと IPC コストが節約できる。

---

#### [LOW] #20: logFrontendEventSafe.test.ts の非同期リジェクションテスト

**ファイル**: `myT-x/frontend/tests/logFrontendEventSafe.test.ts`

Vitest の `UnhandledPromiseRejection` を抑制するため、テスト内で明示的な `.catch(() => {})` チェーンが必要な場合がある。テスト環境によっては flaky になりうる。

---

### カテゴリ4: フロントエンド 設定・ビューアシステム

#### [HIGH] #21: normalizeKeyboardKey のデッドコード

**ファイル**: `myT-x/frontend/src/components/viewer/viewerShortcutUtils.ts`

```typescript
// 現在（両ブランチが同一）
const normalizeKeyboardKey = (rawKey: string): string =>
    rawKey.length === 1 ? rawKey.toLowerCase() : rawKey.toLowerCase();
//                       ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
//                       両ブランチが同じ処理

// 修正案（単純化）
const normalizeKeyboardKey = (rawKey: string): string => rawKey.toLowerCase();
```

`rawKey.length === 1` のとき `rawKey.toUpperCase()` が意図だった可能性もある。コードレビューで意図を確認する。

---

#### [HIGH] #22: settingsReducer.test.ts にフィールド数ガードテストがない

**ファイル**: `myT-x/frontend/src/components/settings/settingsReducer.test.ts`

`INITIAL_FORM` に `viewerShortcuts` フィールドが追加されたにもかかわらず、フィールド数をチェックするガードテスト（型安全のセーフガード）が更新されていない。`Object.keys(INITIAL_FORM).length` のアサーションを追加。

---

#### [HIGH] #23: ActivityStrip のバッジロジックが view.id ハードコード（OCP 違反）

**ファイル**: `myT-x/frontend/src/components/viewer/ActivityStrip.tsx`

```typescript
// 現在（ハードコード）
const badge = view.id === "error-log"
    ? errorLogUnreadCount
    : view.id === "input-history"
    ? inputHistoryUnreadCount
    : 0;
```

新しいビューアを追加するたびにここを修正する必要がある。`viewerShortcutDefinitions.ts` の定義に `getBadgeCount?: () => number` コールバックを持たせるか、ビューアレジストリにバッジプロバイダーを登録する設計が望ましい。

---

#### [MEDIUM] #24: validateViewerShortcuts でモディファイアなしショートカットが通過する

**ファイル**: `myT-x/frontend/src/components/settings/settingsValidation.ts`

単一キー（例: `"f"`, `"a"`）がバリデーションを通過してしまう。ターミナルアプリではモディファイアキー必須のショートカットのみ登録可能にすべき。

```typescript
// 追加バリデーション例
if (!shortcut.includes("ctrl+") && !shortcut.includes("alt+") && !shortcut.includes("meta+")) {
    errors.push(`Shortcut "${shortcut}" requires at least one modifier key (Ctrl, Alt, Meta)`);
}
```

---

#### [MEDIUM] #25: shortcutMap での重複ショートカットのラスト優先問題

**ファイル**: `myT-x/frontend/src/components/viewer/ViewerSystem.tsx`

同一ショートカットが複数ビューに設定されている場合、最後のビューが `shortcutMap` に登録されるが、タイトル表示では最初のビューのショートカットが表示される。ユーザーが誤った表示を見てキー操作が効かない問題が発生する。

バリデーション側 (`validateViewerShortcuts`) で重複を弾くか、ViewerSystem 側で重複を検出して警告を出す。

---

#### [MEDIUM] #26: ShortcutInput が Meta キーを捕捉しない

**ファイル**: `myT-x/frontend/src/components/settings/ViewerShortcutSettings.tsx`（ShortcutInputコンポーネント）

`buildShortcutFromKeyboardEvent` は `meta` を扱えるが、`ShortcutInput` コンポーネントの `onKeyDown` ハンドラが Meta キーを無視している。Mac ユーザー（WSL2 経由使用など）への考慮か意図的な除外かをコメントで明記。

---

#### [MEDIUM] #27: getEffectiveViewerShortcut が非正規化文字列を返す可能性

**ファイル**: `myT-x/frontend/src/components/viewer/viewerShortcutUtils.ts`

ユーザー設定値（例: `"ctrl+shift+e"`）をそのまま返すケースがある。ActivityStrip のキーヒントタイトルに生の文字列が表示される。正規化 (`normalizeShortcut`) を通してから返すべき。

---

#### [LOW] #28: SettingsModal で viewer_shortcuts 値をトリムしていない

**ファイル**: `myT-x/frontend/src/components/settings/SettingsModal.tsx`

入力値の前後スペースをトリムせずに保存するため、`"ctrl+shift+e "` のような値が config.yaml に書き込まれる。`normalizeShortcut` の前に `.trim()` を追加。

---

#### [LOW] #29: ViewerShortcutSettings の label と input が未关联

**ファイル**: `myT-x/frontend/src/components/settings/ViewerShortcutSettings.tsx`

`<label>` に `htmlFor` が設定されておらず、対応する `<ShortcutInput>` に `id` もない。アクセシビリティ（スクリーンリーダー）対応として追加。

---

#### [LOW] #30: normalizeShortcut が余分なキーをサイレントにドロップ

**ファイル**: `myT-x/frontend/src/components/viewer/viewerShortcutUtils.ts`

```typescript
normalizeShortcut("Ctrl+A+B")
// → "ctrl+b" (A は無視される、警告なし)
```

DEV 環境では `console.warn` でドロップされたキーを通知すべき。

---

#### [LOW] #31: Alt ショートカットに対する Windows システムメニュー競合の UI 警告なし

**ファイル**: `myT-x/frontend/src/components/settings/ViewerShortcutSettings.tsx`

Windows では Alt+ ショートカットがシステムメニューを開く場合がある。設定 UI で入力時に警告メッセージ（`⚠ Alt+... on Windows may conflict with system menu`）を表示することを推奨。

---

### カテゴリ5: フロントエンド InputHistory 実装

#### [BUG] #32: InputHistoryView が useLayoutEffect ではなく useEffect を使用

**ファイル**: `myT-x/frontend/src/components/viewer/views/input-history/InputHistoryView.tsx`

```typescript
// 現在（バグあり）
useEffect(() => {
    markAllRead();
}, [entries, markAllRead]);

// 参照実装 ErrorLogView.tsx（正しい）
useLayoutEffect(() => {
    markAllRead();
}, [entries, markAllRead]);
```

`useEffect` は paint 後の非同期実行のため、エントリ追加のたびにバッジが一瞬点灯し、その後 0 に戻るフリッカーが発生する。`useLayoutEffect` に変更して paint 前に `markAllRead` を呼ぶことで解消できる。

---

#### [BUG] #33: formatInputForDisplay の制御文字 regex から CR/LF/DEL が漏れ

**ファイル**: `myT-x/frontend/src/components/viewer/views/input-history/useInputHistory.ts`

```typescript
// 現在（CR=\x0d、LF=\x0a、DEL=\x7f が除外されている）
/[\x00-\x08\x0b\x0c\x0e-\x1f]/g

// 修正案（全 C0 制御文字 + DEL）
/[\x00-\x1f\x7f]/g
```

`\x0d` (CR) が制御文字として変換されず raw whitespace として表示される。ターミナルユーザーが CR 含みコマンドを送った場合に `^M` として表示されるべきが、改行扱いになる。

TAB (`\x09`) を敢えて除外するなら理由をコメントで明記すること。

---

#### [DESIGN] #34: バックエンド再起動後の unreadCount リセットロジックとコメントの乖離

**ファイル**: `myT-x/frontend/src/stores/inputHistoryStore.ts`

```typescript
// コメント（誤解を招く）
// Backend restart resets seq to 1. If the latest seq regresses, clear read marker.

// 実際の動作
lastReadSeq = maxNewSeq; // maxNewSeq=5 なら lastReadSeq=5 → 全エントリが既読扱い
```

「read marker をクリア」と書いてあるが、実際には `maxNewSeq` にセットするため再起動後の全エントリが既読になる（バッジ 0）。`errorLogStore.ts` と一貫しているが、コメントが実装と矛盾している。

**修正**: コメントを実態に合わせる。
```typescript
// Backend restart resets seq to 1. If the latest seq regresses,
// treat restored entries as pre-read to avoid badge flooding on restart.
```

動作の変更（= 再起動後にバッジを表示したい）を望む場合は `lastReadSeq = 0` に変更する。

---

#### [OPTIMIZE] #35: markAllRead の依存配列が不必要な過剰発火を招く

**ファイル**: `myT-x/frontend/src/components/viewer/views/input-history/InputHistoryView.tsx`

```typescript
// 現在（entries 参照が変わるたびに発火）
useLayoutEffect(() => {
    markAllRead();
}, [entries, markAllRead]);

// 改善案（実際に末尾 seq が変わった時だけ発火）
useLayoutEffect(() => {
    markAllRead();
}, [entries.at(-1)?.seq, markAllRead]);
```

`entries` は `setEntries` が呼ばれるたびに新配列参照が生成される。末尾 seq の変化だけに反応することで、不要な `markAllRead` 呼び出しを抑制できる。

---

## 修正タスク一覧と並列作業可否表

### 凡例
- **並列可**: 他タスクと独立して作業可能
- **注意**: 別タスクとファイルが被るが論理的独立
- **順次**: 別タスクの完了後に実施すべき

---

| No | 優先度 | 分類 | タスク内容 | 対象ファイル | 並列可否 | 依存タスク | 備考 |
|----|--------|------|-----------|-------------|---------|-----------|------|
| 1 | 🔴 CRITICAL | Go | `return new(v)` → `return &v` に修正 | `internal/testutil/helpers.go` | 並列可 | — | まず修正。これが #3 の前提 |
| 2 | 🔴 CRITICAL | Go | `//go:fix inline` ディレクティブの重複削除 | `internal/testutil/helpers.go` | **注意** | #1 と同ファイル | #1 と同時作業可（同ファイル内） |
| 3 | 🔴 CRITICAL | Go | `new(true)` / `new(false)` → `testutil.Ptr(true/false)` に全置換 | `*_test.go` 複数 | **順次** | #1 完了後 | #1 が修正されないと置換が意味をなさない |
| 4 | 🔴 CRITICAL | Go | `boolPtrTest` 未使用関数を削除 | `app_session_api_test.go` ほか | 並列可 | — | `go vet` で検出可能 |
| 5 | 🔴 BUG | Go | `cleanupOldSessionLogs` ソート方向 `return leftOK` → `return !leftOK` | `app_session_log.go` | 並列可 | — | 正規ファイル誤削除バグ |
| 6 | 🔴 BUG | Go | `processInputString` DCS/SOS/PM/APC シーケンス本体フィルタ追加 | `app_input_history.go` | 並列可 | — | 新ステート追加が必要 |
| 7 | 🟡 BUG | Frontend | `useEffect` → `useLayoutEffect` (InputHistoryView) | `InputHistoryView.tsx` | 並列可 | — | ErrorLogView 参照 |
| 8 | 🟡 BUG | Frontend | `formatInputForDisplay` regex に `\x0a`, `\x0d`, `\x7f` 追加 | `useInputHistory.ts` | 並列可 | — | 意図的除外ならコメント追加 |
| 9 | 🟡 HIGH | Frontend | `normalizeKeyboardKey` デッドコード修正（両ブランチ統一） | `viewerShortcutUtils.ts` | 並列可 | — | 意図確認後に修正 |
| 10 | 🟡 HIGH | Frontend | `settingsReducer.test.ts` フィールド数ガードテスト追加 | `settingsReducer.test.ts` | 並列可 | — | `viewerShortcuts` フィールド追加に対応 |
| 11 | 🟡 HIGH | Frontend | `ActivityStrip` バッジロジックの OCP 対応（ハードコード解消） | `ActivityStrip.tsx` | 並列可 | — | ビューアレジストリ設計変更が必要 |
| 12 | 🟠 MEDIUM | Go | バックスペース処理を rune スライスで O(1) に変更 | `app_input_history.go` | **注意** | #6 と同ファイル | #6 と独立した変更箇所 |
| 13 | 🟠 MEDIUM | Go | シャットダウン時の残留タイマー対策 (`shuttingDown` フラグ等) | `app_input_history.go` | **注意** | #6, #12 と同ファイル | 同ファイル内、独立変更 |
| 14 | 🟠 MEDIUM | Frontend | `validateViewerShortcuts` にモディファイアキー必須バリデーション追加 | `settingsValidation.ts` | 並列可 | — | |
| 15 | 🟠 MEDIUM | Frontend | `shortcutMap` 重複ショートカット検出とバリデーション強化 | `ViewerSystem.tsx` / `settingsValidation.ts` | **注意** | #14 と連携 | 設計選択が必要 |
| 16 | 🟠 MEDIUM | Frontend | `ShortcutInput` Meta キー捕捉追加 or 意図的除外コメント | `ViewerShortcutSettings.tsx` | 並列可 | — | |
| 17 | 🟠 MEDIUM | Frontend | `getEffectiveViewerShortcut` の戻り値を `normalizeShortcut` 通過後に | `viewerShortcutUtils.ts` | **注意** | #9 と同ファイル | |
| 18 | 🟠 MEDIUM | Frontend | `ErrorBoundary` リトライ上限実装（3回程度） | `ErrorBoundary.tsx` | 並列可 | — | |
| 19 | 🟠 MEDIUM | Frontend | `inputHistoryStore` 再起動後ロジックのコメント修正 | `inputHistoryStore.ts` | 並列可 | — | コードは正しいがコメントが実態未反映 |
| 20 | 🟠 MEDIUM | Go | `TestNormalizeLogLevel` に `"WARNING"` ケース追加 | `app_session_log_test.go` | 並列可 | — | |
| 21 | 🟠 MEDIUM | Go | 切り詰めテストに `initSessionLog()` 呼び出しを追加 | `app_session_log_test.go` | **注意** | #20 と同ファイル | |
| 22 | 🟢 LOW | Go | `LogFrontendEvent` の rune カウント最適化（`utf8.RuneCountInString` 利用） | `app_session_log.go` | 並列可 | — | |
| 23 | 🟢 LOW | Go | `source` 更新条件の冗長ロジック簡略化 | `app_input_history.go` | **注意** | #6, #12, #13 と同ファイル | |
| 24 | 🟢 LOW | Go | `isAllDecimalDigits` 削除（`strconv.Atoi` のみで十分） | `app_input_history.go` | **注意** | 上記と同ファイル | |
| 25 | 🟢 LOW | Go | `TestLoadViewerShortcuts` に空マップケース追加 | `app_config_state_test.go` | 並列可 | — | |
| 26 | 🟢 LOW | Go | `TestResolveSessionNameForPane` に複数セッションシナリオ追加 | `app_pane_api_test.go` | 並列可 | — | |
| 27 | 🟢 LOW | Frontend | `SettingsModal` で `viewer_shortcuts` 値を trim してから保存 | `SettingsModal.tsx` | 並列可 | — | |
| 28 | 🟢 LOW | Frontend | `ViewerShortcutSettings` の label/input アクセシビリティ対応 | `ViewerShortcutSettings.tsx` | 並列可 | — | `htmlFor` + `id` |
| 29 | 🟢 LOW | Frontend | `normalizeShortcut` での余分キードロップに DEV 警告追加 | `viewerShortcutUtils.ts` | **注意** | #9, #17 と同ファイル | |
| 30 | 🟢 LOW | Frontend | Alt ショートカット入力時の Windows 競合警告 UI 追加 | `ViewerShortcutSettings.tsx` | **注意** | #28 と同ファイル | |
| 31 | 🟢 LOW | Frontend | `fetchInputHistory` の catch に DEV `console.warn` 追加 | `useBackendSync.ts` | 並列可 | — | fetchErrorLog と対称性 |
| 32 | 🟢 LOW | Frontend | `markAllRead` deps を `entries.at(-1)?.seq` に変更（過剰発火抑止） | `InputHistoryView.tsx` | **注意** | #7 と同ファイル | |
| 33 | 🟢 LOW | Go | `pendingEntry` 構造体の共通化 | `app_input_history.go` | **注意** | 上記と同ファイル | リファクタリング |
| 34 | 🟢 LOW | Go | `parseInputHistoryFileName` の単体テスト追加 | `app_input_history_test.go` | 並列可 | — | |

---

## 並列作業グループ（推奨ワークフロー）

### Wave 1: CRITICAL 最優先（同時並列可）

| グループ | 担当者 A | 担当者 B |
|---------|---------|---------|
| A1 | #1 + #2: helpers.go 修正 | #4: boolPtrTest 削除 |
| A2 | #5: session_log ソート方向 | #6: processInputString DCS 対応 |
| A3 | #7: useLayoutEffect | #8: formatInputForDisplay regex |

### Wave 2: HIGH（Wave 1 完了後）

| グループ | 担当者 A | 担当者 B |
|---------|---------|---------|
| B1 | #3: new(true/false) 全置換（#1完了後） | #9: normalizeKeyboardKey |
| B2 | #10: settingsReducer.test.ts | #11: ActivityStrip OCP |

### Wave 3: MEDIUM（随時並列可）

#12〜#21 は同ファイル内での変更が被らない限り並列作業可能。

---

## 指摘一覧サマリ（重要度別）

| 重要度 | 件数 | 主要課題 |
|--------|------|---------|
| 🔴 CRITICAL / BUG | 7件 | `new(v)` 仕様違反、sort 方向バグ、useLayoutEffect、DCS フィルタ漏れ |
| 🟡 HIGH | 4件 | dead code、フィールドガードテスト欠落、OCP 違反 |
| 🟠 MEDIUM | 12件 | バリデーション不足、重複ショートカット、Meta キー未捕捉、コメント乖離 |
| 🟢 LOW | 11件 | アクセシビリティ、DEV ログ、最適化、テスト追加 |
| **合計** | **34件** | |
