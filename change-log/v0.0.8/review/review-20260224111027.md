# PR Review Summary

**レビュー日時:** 2026-02-24 11:10  
**差分ファイル数:** 42  
**レビュー方針:** review-pr-para.prompt.md 準拠  

---

## カテゴリ分類

レビュー対象を以下のカテゴリに分類して並列レビューを実施。

| カテゴリ | ファイル |
|---------|---------|
| **A: バックエンド - Input History** | `app.go`, `app_input_history.go`, `app_input_history_test.go`, `app_input_history_types.go` |
| **B: バックエンド - Session/Pane API** | `app_session_api.go`, `app_session_api_test.go`, `app_pane_api.go`, `app_pane_api_test.go`, `app_lifecycle.go` |
| **C: バックエンド - Session Log** | `app_session_log.go`, `app_session_log_test.go` |
| **D: バックエンド - Config/Infra** | `config.yaml`, `internal/config/config.go`, `internal/config/config_test.go`, `internal/testutil/helpers.go` |
| **E: バックエンド - リファクタ (変数名/テストユーティリティ)** | `app_devpanel_api.go`, `internal/tmux/command_router_env_test.go`, `internal/tmux/command_router_handlers_window_test.go` |
| **F: フロントエンド - Viewer/ActivityStrip** | `ActivityStrip.tsx`, `ViewerSystem.tsx`, `viewerRegistry.ts`, `viewerShortcutUtils.ts`, `error-log/index.ts`, `input-history/index.ts`, `input-history/InputHistoryView.tsx`, `input-history/useInputHistory.ts`, `inputHistoryStore.ts` |
| **G: フロントエンド - Settings/QuickStart** | `SessionView.tsx`, `SettingsModal.tsx`, `GeneralSettings.tsx`, `ShortcutInput.tsx`, `settingsReducer.ts`, `settingsValidation.ts`, `types.ts`, `base.css` |
| **H: フロントエンド - 型定義/バインディング** | `api.ts`, `types/tmux.ts`, `wailsjs/go/main/App.d.ts`, `wailsjs/go/main/App.js`, `wailsjs/go/models.ts` |
| **I: フロントエンド - テスト** | `settingsValidation.test.ts` |

---

## Critical Issues (3件)

### C-1: [code] `cleanupOldSessionLogs` ソート順の変更が `cleanupOldInputHistory` と不整合だった既存バグのFix確認
- **ファイル:** `app_session_log.go:117-119`
- **内容:** `return leftOK` → `return !leftOK` への変更。malformed ファイルを先にソートし、優先的に削除する修正。
- **影響分析:** 本番コード `app_input_history.go:94-97` の `sortInputHistoryFilesForCleanup` を確認したところ、同じロジック（`return !leftOK`）が既に適用されている。**session log 側のみが旧バグを残していた**ため、本修正で整合性が取れた。
- **判定:** ✅ 修正は正しい。session log と input history で cleanup ソート順が統一された。

### C-2: [code] `flushLineBuffer` にシャットダウンチェックが2箇所あるが、ロック解放後の2回目チェックでデータが消失する可能性
- **ファイル:** `app_input_history.go:394-430`
- **内容:** `flushLineBuffer` にシャットダウンガードが追加されたが、以下の流れでデータ消失が発生する可能性がある:
  1. ロック前チェック (L395): `shuttingDown=false` → 通過
  2. ロック取得し `lb.buf` を読み取り、`lb.buf[:0]` でクリア (L421)
  3. ロック解放後の再チェック (L426): `shuttingDown=true` → **return**
  4. `writeInputHistoryEntry` が呼ばれず、バッファ内容は既にクリアされたため**永久消失**
- **補足:** `flushAllLineBuffers` が shutdown 時に gen=0 でフラッシュするため、**flushAllLineBuffers の前にタイマーが発火した場合のみ**この問題が発生する。`flushAllLineBuffers` は各ペインの `lb.buf` を直接読むが、この時点で `lb.buf` は既に空（L421でクリア済み）。
- **推奨:** ロック解放後の2回目のシャットダウンチェック（L426-430）を削除するか、バッファクリア前にシャットダウンチェックを行うように順序を変更すべき。
  - **代替案:** ロック内でシャットダウンチェックを行い、true なら `lb.buf` をクリアせずにロック解放 → `flushAllLineBuffers` に任せる。

### C-3: [tests] `TestLogFrontendEvent_MultibyteSafeRune` で使用されている文字が不正
- **ファイル:** `app_session_log_test.go:56 (diff L56)`
- **内容:** `strings.Repeat("日", ...)` → `strings.Repeat("譌･", ...)` に変更されているが、`"譌･"` は文字化けのように見える（UTF-8の2文字）。`"譌"` と `"･"` の2文字で構成されている。
- **影響:** `frontendLogMaxMsgLen+1` 文字のつもりが、実際は `(frontendLogMaxMsgLen+1)*2` ルーン（2文字を繰り返すため）となり、テストの意図と実際の挙動に乖離が生じている可能性がある。
- **推奨:** 文字コードを確認し、1ルーンのマルチバイト文字（例: `"日"`, `"あ"`, `"🎉"` など）を使用するべき。diffの生成過程でエンコーディングが壊れた可能性がある。

---

## Important Issues (8件)

### I-1: [code] `QuickStartSession` の `CreateSessionOptions` が全てデフォルト（false）
- **ファイル:** `app_session_api.go:81`
- **内容:** `CreateSession(dir, sessionName, CreateSessionOptions{})` で呼ばれるが、`UseClaudeEnv` と `UsePaneEnv` が共に `false`。設定画面で ClaudeEnv や PaneEnv を有効にしているユーザーがクイックスタートすると、これらの設定が反映されない。
- **推奨:** `cfg.ClaudeEnv.DefaultEnabled`、`cfg.PaneEnvDefaultEnabled` を参照して `CreateSessionOptions` を構築すべきか検討。通常の `CreateSession` UI ではユーザーがチェックボックスで選択するが、QuickStart ではそのUIがないため、デフォルト設定を使うのが自然。

### I-2: [code] `QuickStartSession` のセッション名衝突時に新規IDが `filepath.Base(dir)` 固定
- **ファイル:** `app_session_api.go:76-79`
- **内容:** `sessionName := filepath.Base(dir)` で常に同じ名前のセッションを作ろうとする。`CreateSession` 内で `findAvailableSessionName` が重複回避するが、繰り返しクイックスタートすると `dirname-2`, `dirname-3` と増えていく。ユーザーにとって混乱する可能性がある。
- **推奨:** 既存セッション検出（`findSessionByRootPath`）が正しく動作しているため、通常は同じディレクトリで2つ目のセッションは作られない。ただし、ユーザーが手動でセッションを削除した後に再作成するケースでは問題ない。**現時点では許容範囲**。

### I-3: [types] `inputLineBuffer.buf` が `strings.Builder` から `[]rune` に変更 — バックスペース処理の意味変更
- **ファイル:** `app_input_history_types.go`, `app_input_history.go` 複数箇所
- **内容:** `strings.Builder` + `runes int` → `[]rune` への変更は簡素化として良い。しかし、以前のバックスペース処理は `[]rune` 変換して末尾を削除していたのに対し、新実装は `lb.buf[:len(lb.buf)-1]` でスライスの最後の rune を直接削除。
- **分析:** `processInputString` はマルチバイト文字を正しく rune に変換してから `recordInput` に渡しているため、`[]rune` のスライス操作は正しい。**問題なし**だが、`inputHistoryMaxInputLen` のセマンティクスが「runeカウント」から「[]runeのlen」に変わった点は、実質的に同じであることを確認済み。

### I-4: [errors] `resolveSessionNameForPane` のシグネチャ変更による既存呼び出し元の影響
- **ファイル:** `app_pane_api.go:11-28`
- **内容:** `resolveSessionNameForPane(sessions, paneID)` → `resolveSessionNameForPane(paneID)` に変更。内部で `requireSessions()` を呼ぶようになった。
- **影響分析:** 呼び出し元 `SendInput` と `SendSyncInput` では、既に `requireSessionsWithPaneID` でセッション取得済み。新実装では `requireSessions()` を再度呼ぶため、二重ロック取得のオーバーヘッドが発生する。
- **推奨:** パフォーマンス上の影響は微小（ベストエフォートのヘルパー関数）だが、設計として `sessions` を再取得するのは冗長。ただし、CLAUDE.mdの方針「session取得失敗は非致命的」に合致しているため**許容**。

### I-5: [comments] `ShortcutInput.tsx` のコメントが日本語から英語に変更
- **ファイル:** `ShortcutInput.tsx:9-21`
- **内容:** `// 修飾キー単体は無視` → `// Ignore a modifier-only key press and keep capture mode active.`、`// キー名の正規化` → `// Normalize key labels to a stable display form.`
- **AGENTS.md規約:** 「基本的にファイルへの書き込みには、全て英語を利用する事」とあるので、**英語化は正しい方針**。
- **AGENTS.md規約:** 「既存の日本語のコメントや画面表示は変更しない事」とも書かれている。
- **判定:** この変更はコメントの英語化であり、「画面表示」ではない。ただし「既存の日本語コメント変更」に該当する可能性がある。**プロジェクトオーナーに確認推奨**。

### I-6: [code] `ShortcutInput.tsx` に `parts.length === 0` ガードが追加 — 単独キー入力が無視される
- **ファイル:** `ShortcutInput.tsx:18`
- **内容:** `if (parts.length === 0) return;` が追加され、修飾キーなしのキー入力が完全に無視される。
- **影響:** これにより `F1`〜`F12` などのファンクションキー単体でのショートカット割り当てが不可能になる。`viewerShortcutUtils.ts` の `hasShortcutModifier` と整合する設計変更。
- **判定:** セキュリティ/UX上の理由（通常キー入力との衝突防止）として妥当。**ViewerSystem.tsx** にも同様のチェック（L63-68）が追加されており整合性が確保されている。

### I-7: [simplify] `viewerShortcutUtils.ts` の `hasShortcutModifier` 関数が冗長
- **ファイル:** `viewerShortcutUtils.ts:13-27`
- **内容:** `normalizeShortcut` を呼んでから `tokens.split("+")` で分解し、最後のトークンが key、それ以前が modifier かを判定。しかし、`tokens.length < 2` チェックの後に `modifierTokens.length > 0` をさらにチェックしているのは冗長（`tokens.length >= 2` なら `modifierTokens` は必ず1つ以上のため）。
- **推奨:** 以下に簡略化可能:
  ```typescript
  const tokens = normalized.split("+");
  return tokens.length >= 2 && tokens[tokens.length - 1] !== "";
  ```

### I-8: [tests] `settingsValidation.test.ts` の新テストで `globalHotkey` パラメータの扱い
- **ファイル:** `settingsValidation.test.ts:9-14`
- **内容:** `validateViewerShortcuts({"file-tree": "f"})` を `globalHotkey` 引数なしで呼んでいるが、`settingsValidation.ts` の新シグネチャは `validateViewerShortcuts(viewerShortcuts, globalHotkey = "")` とデフォルト引数を持つ。
- **分析:** TypeScript のデフォルト引数により動作する。既存テスト `validateViewerShortcuts({})` も同様に動作する。**問題なし**。ただし、既存テストが `globalHotkey` なしで呼ばれている箇所のカバレッジは確保されている。

---

## Suggestions (12件)

### S-1: [simplify] `normalizeKeyboardKey` の重複コード削除
- **ファイル:** `viewerShortcutUtils.ts:23`
- **内容:** `return rawKey.length === 1 ? rawKey.toLowerCase() : rawKey.toLowerCase()` → `return rawKey.toLowerCase()` に変更済み。✅ 良い改善。

### S-2: [code] `ActivityStrip` のリファクタリングで `useSyncExternalStore` 導入
- **ファイル:** `ActivityStrip.tsx` 全体
- **内容:** `useErrorLogStore` と `useInputHistoryStore` の直接参照を廃止し、`ViewPlugin` インターフェースに `getBadgeCount`/`subscribeBadgeCount` を追加して汎用化。`useSyncExternalStore` で購読。
- **評価:** ✅ 優れたリファクタリング。ActivityStrip がストア依存を解消し、新しいビューを追加してもバッジ対応が容易。ただし、各ビューの `subscribeBadgeCount` が zustand の `subscribe` を直接使っている点で、zustand の unsubscribe 関数が `useSyncExternalStore` の期待する `() => void` 型と一致していることを確認済み。

### S-3: [code] `InputHistoryView.tsx` で `useEffect` → `useLayoutEffect` に変更
- **ファイル:** `InputHistoryView.tsx:18-21`
- **内容:** `markAllRead()` の呼び出しを `useLayoutEffect` に変更し、ペイント前に既読マークを更新。
- **評価:** ✅ 適切。未読バッジの一瞬のフラッシュ（チラつき）を防止できる。

### S-4: [code] `InputHistoryView.tsx` の依存配列を `entries` → `latestEntrySeq` に変更
- **ファイル:** `InputHistoryView.tsx:17,21`
- **内容:** `entries` 配列全体ではなく `entries.at(-1)?.seq` を依存配列に使用。
- **評価:** ✅ パフォーマンス改善。`entries` は新しい配列参照を毎回返すため、不要な再実行を防止。

### S-5: [code] `useInputHistory.ts` の formatInputForDisplay 拡張
- **ファイル:** `useInputHistory.ts:9-17`
- **内容:** 制御文字の変換範囲を `[\x00-\x08\x0b\x0c\x0e-\x1f]` → `[\x00-\x1f\x7f]` に拡大し、DEL (0x7f) も `^?` として表示。
- **評価:** ✅ より堅牢な制御文字表示。`\t`(0x09), `\n`(0x0a), `\r`(0x0d) も `^I`, `^J`, `^M` として表示されるようになるが、processInputString で既にこれらは除去されているため問題ない。

### S-6: [code] `ErrorBoundary.tsx` にリトライ回数制限（MAX_RETRIES=3）追加
- **ファイル:** `ErrorBoundary.tsx` 全体
- **内容:** 無限リトライを防止。`getDerivedStateFromError` の戻り値を `Partial<ErrorBoundaryState>` に変更し、`retryCount` をリセットしないようにした。
- **評価:** ✅ 良い改善。無限リトライループによるブラウザハングを防止。

### S-7: [code] `GeneralSettings.tsx` の「デフォルトセッションディレクトリ」UI
- **ファイル:** `GeneralSettings.tsx:15-60`
- **内容:** テキスト入力 + 参照ボタン + クリアボタンのUI。`PickSessionDirectory` API を使用。
- **評価:** ✅ 良いUX。ただし、入力値のバリデーション（絶対パスかどうか）がフロントエンド側で行われていない。バックエンドの `validateDefaultSessionDir` が相対パスを除去するため、保存後にリロードすると値が消えるケースがある。
- **推奨:** フロントエンド側でもパスが空でない場合に絶対パスかどうかを即座にフィードバックするバリデーションを追加するとUXが向上する。

### S-8: [code] `SettingsModal.tsx` でショートカット保存時に `normalizeShortcut` を適用
- **ファイル:** `SettingsModal.tsx:291-293`
- **内容:** `viewerShortcuts` の値を保存前に正規化。表記揺れ（`Ctrl+shift+e` → `ctrl+shift+e`）を統一。
- **評価:** ✅ 良い改善。

### S-9: [code] `ViewerSystem.tsx` に重複ショートカット検出のDEV警告追加
- **ファイル:** `ViewerSystem.tsx:63-81`
- **内容:** 設定由来のショートカットでビュー間の重複がある場合、DEV環境でコンソール警告を出力。
- **評価:** ✅ 良い防御的プログラミング。本番環境では出力されない。

### S-10: [code] `viewerRegistry.ts` に `getBadgeCount`/`subscribeBadgeCount` の片方だけ定義された場合のDEV警告
- **ファイル:** `viewerRegistry.ts:94-100`
- **内容:** 片方のみ定義された場合に開発環境で警告。
- **評価:** ✅ 良い防御的プログラミング。

### S-11: [code] `inputHistoryStore.ts` のコメント修正（seq リグレッション時の挙動説明）
- **ファイル:** `inputHistoryStore.ts:10-12`
- **内容:** コメントが「clear read marker」→「align the marker to the latest entry so pre-existing entries are treated as already read」に変更。
- **評価:** ✅ より正確な説明。

### S-12: [code] `internal/testutil/helpers.go` の `Ptr` 関数修正
- **ファイル:** `internal/testutil/helpers.go:9-11`
- **内容:** 重複 `//go:fix inline` ディレクティブの削除、`new(v)` → `&v` への変更。
- **影響分析:** Go 1.26では `new("文字列")` 構文が使えるが、`Ptr[T any]` ではジェネリック型のため `&v` が標準的。各テストファイルで `new(true)` → `testutil.Ptr(true)` への統一的置換が行われており、テストユーティリティの一元管理が実現。
- **評価:** ✅ 良いリファクタリング。

---

## Strengths (良い点)

1. **包括的なテストカバレッジ**: 新機能（QuickStartSession、シャットダウンガード、ST終端シーケンス除去）に対して適切なテストが追加されている。
2. **一貫したリファクタリング**: `boolPtrTest` → `testutil.Ptr` への統一、`ok0` → `ok` への変数名統一など、コードベース全体の一貫性が向上。
3. **防御的プログラミング**: シャットダウン時の入力記録ガード、ErrorBoundary のリトライ制限、ショートカット重複検出など。
4. **パフォーマンス意識**: `strings.Builder` → `[]rune` への変更で不要な文字列変換を排除。`utf8.RuneCountInString` の使用で条件判定時のメモリ確保を回避。
5. **拡張性の向上**: `ViewPlugin` にバッジ機能を汎用化し、新ビュー追加時のコスト削減。
6. **設定バリデーションの強化**: ショートカットの修飾キー必須化、グローバルホットキーとの衝突検出の追加。
7. **DCS/SOS/PM/APC シーケンスの処理**: ESC P, ESC X, ESC ^, ESC _ に対する skipEscString の共通化は、以前の OSC 処理コードの重複を解消した良いリファクタ。

---

## Recommended Action

1. **Critical C-2 を修正**: `flushLineBuffer` のロック解放後シャットダウンチェックによるデータ消失を防止
2. **Critical C-3 を確認**: テストファイルの文字化け（`"譌･"`）が意図的か確認
3. **Important I-1 を検討**: `QuickStartSession` でデフォルトのClaudeEnv/PaneEnv設定を反映すべきか
4. **Important I-5 を確認**: 既存日本語コメントの英語化がプロジェクト方針に合致するか
5. **Suggestion S-7 を検討**: フロントエンド側の絶対パスバリデーション追加
6. 全修正後にレビューを再実行

---

## 本番コード影響範囲分析（二次レビュー）

### 1. `app_input_history.go` — `processInputString` のエスケープシーケンス処理拡張

**変更内容:** DCS (`ESC P`), SOS (`ESC X`), PM (`ESC ^`), APC (`ESC _`) シーケンスの処理を追加。

**影響範囲確認:**
- `processInputString` は純粋関数（副作用なし）であり、`recordInput` からのみ呼ばれる
- `recordInput` は `SendInput` と `SendSyncInput` から呼ばれる
- **影響範囲は限定的**。新しいエスケープシーケンスが入力に含まれていた場合、以前は部分的に通過していたものが正しく除去される
- **後方互換性:** 入力履歴に以前記録されていたゴミ文字列が、今後は記録されなくなる。改善方向のみ。

### 2. `app_pane_api.go` — `resolveSessionNameForPane` のシグネチャ変更

**影響範囲確認:**
- 呼び出し元: `SendInput`, `SendSyncInput` の2箇所のみ（差分で確認済み）
- テスト: `TestResolveSessionNameForPane` が更新済み（新テストケース追加）
- **本番コードの他の箇所で `resolveSessionNameForPane` を呼んでいる箇所がないか確認:** `grep` の代わりに差分とアウトラインから確認。`app_pane_api.go` 内のみで使用されており、影響は閉じている。

### 3. `app_session_api.go` — `QuickStartSession` の新規追加

**影響範囲確認:**
- Wails バインディング: `App.d.ts`, `App.js` に `QuickStartSession` が追加済み
- フロントエンド: `api.ts` にインポート追加、`SessionView.tsx` で使用
- **依存先:** `getConfigSnapshot()`, `findSessionByRootPath()`, `requireSessions()`, `CreateSession()` — 全て既存の安定したAPIを使用
- **TOCTOU:** `findSessionByRootPath` と `CreateSession` の間にセッションが消える可能性があるが、コメントで明示されており `CreateSession` がフォールバックとして機能する
- **`os.Stat` の呼び出し:** ディレクトリ存在確認は適切。ネットワークドライブ上のディレクトリではレイテンシが発生する可能性があるが、UIがローディング状態を表示するため許容

### 4. `internal/config/config.go` — `DefaultSessionDir` フィールド追加

**影響範囲確認:**
- `Config` struct にフィールド追加 → `TestConfigStructFieldCounts` のガードテストが `12 → 13` に更新済み
- `isZeroConfig` テストに新テストケース追加済み
- `Clone()` 関数: `DefaultSessionDir` は `string` 型のため、構造体コピーで自動的にディープコピーされる。**Clone への追加修正不要**
- `Save`/`Load` ラウンドトリップテスト追加済み
- `applyDefaultsAndValidate` で `validateDefaultSessionDir` が呼ばれるように追加済み
- **`config.yaml` への追記:** コメントアウト状態で追加されており、既存設定ファイルとの後方互換性あり

### 5. `app_session_log.go` — `LogFrontendEvent` のルーンカウント最適化

**影響範囲確認:**
- 変更前: `[]rune(msg)` で rune スライスを作成 → `len()` でカウント → 条件分岐後に再度 `[]rune` 変換
- 変更後: `utf8.RuneCountInString(msg)` でカウント → 条件分岐 → `[]rune(msg)[:limit]` で切り詰め
- **パフォーマンス:** 変更前は条件チェック時に `[]rune` 変換（メモリ確保）が常に発生。変更後は閾値超過時のみ `[]rune` 変換が発生。**改善方向**
- **正確性:** `utf8.RuneCountInString` は `len([]rune(msg))` と同等の結果を返すが、メモリアロケーションなし。**問題なし**

### 6. フロントエンド — `ActivityStrip` のバッジシステム汎用化

**影響範囲確認:**
- `useErrorLogStore` と `useInputHistoryStore` の direct import が `ActivityStrip.tsx` から削除
- 代わりに各ビューの `index.ts` で `getBadgeCount` / `subscribeBadgeCount` を登録
- **`useSyncExternalStore` の使用:** React 18+ の公式フック。zustand の `subscribe` は `(listener) => unsubscribe` 形式の関数を返すため、`useSyncExternalStore` の `subscribe` 引数と互換
- **注意:** `subscribeBadgeCount` で `state.unreadCount !== prevState.unreadCount` のフィルタリングを行っているため、不要な再レンダリングは発生しない
- **他のビュー（diff, file-tree, git-graph 等）への影響:** `getBadgeCount` / `subscribeBadgeCount` がない場合は `ZERO_BADGE` / `EMPTY_SUBSCRIBE` フォールバックが使われるため、**既存ビューに影響なし**

### 7. `settingsValidation.ts` — ショートカットバリデーション強化

**影響範囲確認:**
- `validateViewerShortcuts` の引数に `globalHotkey` 追加（デフォルト値あり）
- 呼び出し元: `SettingsModal.tsx` で `s.globalHotkey` を渡すように更新済み
- **既存テストへの影響:** デフォルト引数により既存の呼び出し（引数1つ）は動作継続
- **新バリデーション:** 修飾キーなしのショートカットを拒否、グローバルホットキーとの衝突検出
- **`setShortcutError` ヘルパー:** 最初のエラーのみを保持する設計。複数バリデーションルールが同じビューにエラーを設定した場合、最初のエラー（修飾キーなし → グローバルホットキー衝突 → 重複の順）が優先される。意図的なUX選択として妥当。

---

## 並列作業可否テーブル

以下のテーブルは、各タスクの修正作業を**並列で行えるか**を整理したものです。依存関係がある場合は「順次」、独立して作業可能な場合は「並列OK」としています。

| # | タスクID | タスク名 | 対象ファイル | 重要度 | 並列作業 | 依存先 | 備考 |
|---|---------|---------|-------------|--------|---------|-------|------|
| 1 | C-2 | `flushLineBuffer` データ消失防止 | `app_input_history.go` | 🔴 Critical | 並列OK | なし | ロジック修正のみ。テスト `TestFlushLineBuffer_*` の更新も必要 |
| 2 | C-3 | テスト文字化け確認 | `app_session_log_test.go` | 🔴 Critical | 並列OK | なし | テストファイルのみの変更。文字コード確認 |
| 3 | I-1 | QuickStart のデフォルトEnvフラグ | `app_session_api.go` | 🟡 Important | 並列OK | なし | `QuickStartSession` メソッド内のみの変更 |
| 4 | I-5 | 日本語コメント英語化の確認 | `ShortcutInput.tsx` | 🟡 Important | 並列OK | なし | プロジェクトオーナーへの確認のみ。コード変更は不要の可能性 |
| 5 | I-7 | `hasShortcutModifier` 簡略化 | `viewerShortcutUtils.ts` | 🟡 Important | ⚠️ S-8, S-9 と順次推奨 | S-8, S-9 | ショートカット関連の変更は一括で行うと安全 |
| 6 | S-7 | フロントエンド絶対パスバリデーション | `GeneralSettings.tsx`, `settingsValidation.ts` | 🔵 Suggestion | 並列OK | なし | フロントエンドのみの変更。バックエンドに影響なし |
| 7 | C-1 | ソート順修正の検証 (対応済み) | `app_session_log.go` | ✅ 確認済み | — | — | 修正は正しい。追加作業不要 |
| 8 | I-3 | `inputLineBuffer` 型変更の検証 (問題なし) | `app_input_history_types.go` | ✅ 確認済み | — | — | 追加作業不要 |
| 9 | I-4 | `resolveSessionNameForPane` 二重取得 (許容) | `app_pane_api.go` | ✅ 許容 | — | — | 将来的な改善候補として記録 |
| 10 | I-6 | 修飾キー必須化 (設計意図として妥当) | `ShortcutInput.tsx` | ✅ 確認済み | — | — | 追加作業不要 |
| 11 | I-8 | テストのデフォルト引数 (問題なし) | `settingsValidation.test.ts` | ✅ 確認済み | — | — | 追加作業不要 |

### 並列作業マトリクス（修正が必要なタスクのみ）

```
タスク C-2 ──── 独立 ──── 単独で着手可能
タスク C-3 ──── 独立 ──── 単独で着手可能
タスク I-1 ──── 独立 ──── 単独で着手可能
タスク I-5 ──── 独立 ──── 確認のみ
タスク I-7 ──┐
タスク S-8  ├── ショートカット関連 ── 順次推奨（同じファイル群に影響）
タスク S-9  ┘
タスク S-7 ──── 独立 ──── 単独で着手可能
```

### 作業者向けガイド

| 作業パターン | 同時に作業できるタスク | 注意点 |
|-------------|---------------------|-------|
| **パターンA: 2人で並列** | 作業者1: C-2 + I-1（バックエンド Go） / 作業者2: C-3 + S-7（テスト+フロントエンド） | Go と フロントエンドは完全に独立 |
| **パターンB: 3人で並列** | 作業者1: C-2（Go） / 作業者2: C-3（テスト） / 作業者3: I-7+S-7（フロントエンド） | 最大並列度 |
| **パターンC: 1人で順次** | C-2 → C-3 → I-1 → I-7 → S-7 | Critical を先に、フロントエンドを後に |

### 凡例
- 🔴 **Critical**: マージ前に必ず修正
- 🟡 **Important**: 修正すべき
- 🔵 **Suggestion**: あると良い
- ✅ **確認済み**: 追加作業不要
